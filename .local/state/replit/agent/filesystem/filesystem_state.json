{"file_contents":{"server/auth.ts":{"content":"import passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport { Express, Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport { scrypt, timingSafeEqual, randomBytes } from \"crypto\";\nimport { promisify } from \"util\";\nimport * as bcryptjs from \"bcryptjs\";\nimport { storage } from \"./storage\";\nimport { User as SelectUser, UserRole } from \"@shared/schema\";\nimport { AuthInfo } from \"passport\";\n\n// Promisify the scrypt function\nconst scryptAsync = promisify(scrypt);\n\ndeclare global {\n  namespace Express {\n    interface User extends SelectUser {}\n  }\n}\n\nexport async function hashPassword(password: string) {\n  // Use our native crypto.scrypt function for password hashing\n  const salt = randomBytes(16).toString('hex');\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nexport async function comparePasswords(supplied: string, stored: string) {\n  try {\n    // Ensure we have valid inputs\n    if (!supplied || !stored) {\n      console.log(\"Missing password or stored hash\");\n      return false;\n    }\n\n    // Check for bcrypt format first\n    if (stored.startsWith('$2a$') || stored.startsWith('$2b$') || stored.startsWith('$2y$')) {\n      try {\n        console.log(\"Checking bcrypt password format\");\n        const result = await bcryptjs.compare(supplied, stored);\n        console.log(\"Bcrypt comparison result:\", result ? \"success\" : \"failed\");\n        return result;\n      } catch (err) {\n        console.error('Error comparing bcrypt password:', err);\n        return false;\n      }\n    } \n    // Check if it's our crypto.scrypt format (hex.salt)\n    else if (stored.includes('.')) {\n      try {\n        console.log(\"Checking crypto.scrypt password format\");\n        const parts = stored.split('.');\n        if (parts.length !== 2) {\n          console.log(\"Invalid crypto.scrypt format (not hash.salt)\");\n          return false;\n        }\n        \n        const [hashedPart, salt] = parts;\n        console.log(`Processing hash: ${hashedPart.substring(0, 10)}... with salt: ${salt.substring(0, 8)}...`);\n        \n        const hashedBuf = Buffer.from(hashedPart, 'hex');\n        const suppliedBuf = (await scryptAsync(supplied, salt, 64)) as Buffer;\n        \n        // Ensure buffers are same length before comparison to avoid error\n        if (hashedBuf.length !== suppliedBuf.length) {\n          console.log(`Buffer length mismatch: stored=${hashedBuf.length}, supplied=${suppliedBuf.length}`);\n          return false;\n        }\n        \n        const result = timingSafeEqual(hashedBuf, suppliedBuf);\n        console.log(\"Crypto.scrypt comparison result:\", result ? \"success\" : \"failed\");\n        return result;\n      } catch (err) {\n        console.error('Error comparing crypto.scrypt password:', err);\n        return false;\n      }\n    } \n    // Unknown format\n    else {\n      console.log(`Unsupported password format: ${stored.substring(0, 4)}...`);\n      return false;\n    }\n  } catch (error) {\n    console.error(\"Error in comparePasswords:\", error);\n    return false;\n  }\n}\n\nexport function setupAuth(app: Express) {\n  const sessionSettings: session.SessionOptions = {\n    secret: process.env.SESSION_SECRET || \"coinflip-game-secret\",\n    resave: false,\n    saveUninitialized: false,\n    store: storage.sessionStore,\n    cookie: {\n      secure: false, // Set to false for development\n      httpOnly: true,\n      maxAge: 24 * 60 * 60 * 1000, // 1 day\n      sameSite: 'lax',\n    },\n  };\n\n  app.set(\"trust proxy\", 1);\n  app.use(session(sessionSettings));\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  passport.use(\n    new LocalStrategy(async (username, password, done) => {\n      try {\n        console.log(`Authenticating user: ${username}`);\n        const user = await storage.getUserByUsername(username);\n        \n        if (!user) {\n          console.log(`User not found: ${username}`);\n          return done(null, false, { message: \"Invalid username or password\" });\n        }\n        \n        const passwordMatch = await comparePasswords(password, user.password);\n        console.log(`Password verification result: ${passwordMatch ? \"success\" : \"failed\"}`);\n        \n        if (!passwordMatch) {\n          return done(null, false, { message: \"Invalid username or password\" });\n        }\n        \n        if (user.isBlocked) {\n          return done(null, false, { message: \"Account is blocked. Please contact support.\" });\n        }\n\n        return done(null, user);\n      } catch (err) {\n        console.error(\"Authentication error:\", err);\n        return done(err);\n      }\n    }),\n  );\n\n  passport.serializeUser((user, done) => done(null, user.id));\n  passport.deserializeUser(async (id: number, done) => {\n    try {\n      const user = await storage.getUser(id);\n      done(null, user);\n    } catch (err) {\n      done(err);\n    }\n  });\n\n  app.post(\"/api/register\", async (req, res, next) => {\n    try {\n      const existingUser = await storage.getUserByUsername(req.body.username);\n      if (existingUser) {\n        return res.status(400).send(\"Username already exists\");\n      }\n\n      // Set default role to player \n      let role = UserRole.PLAYER;\n      \n      // Only admins can create users with different roles\n      if (req.isAuthenticated() && req.user?.role === UserRole.ADMIN) {\n        role = req.body.role || UserRole.PLAYER;\n      } else if (req.isAuthenticated() && req.user?.role === UserRole.SUBADMIN) {\n        // Subadmins can ONLY create players, override any role passed\n        role = UserRole.PLAYER;\n      }\n\n      // Assign users to admins/subadmins by default\n      let assignedTo = null;\n      if (role === UserRole.PLAYER && req.isAuthenticated()) {\n        assignedTo = req.user?.id;\n      }\n\n      const user = await storage.createUser({\n        ...req.body,\n        role,\n        assignedTo,\n        password: await hashPassword(req.body.password),\n      });\n\n      // Remove password from the response\n      const { password, ...userWithoutPassword } = user;\n\n      // Only auto-login if this is a self-registration (not initiated by admin/subadmin)\n      if (!req.isAuthenticated()) {\n        // Normal registration flow - log the user in\n        req.login(user, (err) => {\n          if (err) return next(err);\n          res.status(201).json({ ...userWithoutPassword, autoLogin: true });\n        });\n      } else {\n        // Admin/subadmin is creating a user - don't log in as that user\n        res.status(201).json({ ...userWithoutPassword, autoLogin: false });\n      }\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  app.post(\"/api/login\", (req, res, next) => {\n    console.log(\"Login attempt:\", req.body.username);\n    \n    passport.authenticate(\"local\", (err: Error | null, user: Express.User | false, info?: AuthInfo) => {\n      if (err) {\n        console.log(\"Authentication error:\", err);\n        return next(err);\n      }\n      \n      if (!user) {\n        console.log(\"Authentication failed:\", info?.message || \"No user\");\n        return res.status(401).json({ \n          message: info?.message || \"Invalid username or password\" \n        });\n      }\n      \n      console.log(\"Authentication successful for:\", (user as SelectUser).username);\n      \n      req.login(user, (err: Error | null) => {\n        if (err) {\n          console.log(\"Login error:\", err);\n          return next(err);\n        }\n        // Remove password from the response\n        const { password, ...userWithoutPassword } = user as SelectUser;\n        console.log(\"Login successful, sending response\");\n        res.status(200).json(userWithoutPassword);\n      });\n    })(req, res, next);\n  });\n\n  app.post(\"/api/logout\", (req, res, next) => {\n    req.logout((err) => {\n      if (err) return next(err);\n      res.sendStatus(200);\n    });\n  });\n\n  // Login as subadmin - only available to admin users\n  app.post(\"/api/admin/login-as/:userId\", async (req, res, next) => {\n    try {\n      // Check if user is authenticated and is an admin\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized: Please login first\" });\n      }\n      \n      if (req.user.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: \"Forbidden: Only admins can use this feature\" });\n      }\n      \n      const { userId } = req.params;\n      \n      // Find the user to login as\n      const targetUser = await storage.getUser(parseInt(userId));\n      if (!targetUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Verify that the target user is a subadmin\n      if (targetUser.role !== UserRole.SUBADMIN) {\n        return res.status(403).json({ \n          message: \"You can only login as subadmin accounts\" \n        });\n      }\n      \n      // Ensure we don't expose the password in the response\n      const { password, ...userWithoutPassword } = targetUser as SelectUser;\n      \n      // Switch the login to the subadmin account\n      await new Promise<void>((resolve, reject) => {\n        req.logout((err) => {\n          if (err) {\n            console.error(\"Logout error during login-as:\", err);\n            return reject(err);\n          }\n          resolve();\n        });\n      });\n      \n      // After logout completes, login as the target user\n      await new Promise<void>((resolve, reject) => {\n        req.login(targetUser, (err) => {\n          if (err) {\n            console.error(\"Login-as error:\", err);\n            return reject(err);\n          }\n          resolve();\n        });\n      });\n      \n      console.log(`Admin logged in as subadmin: ${targetUser.username}`);\n      \n      // Important: Set the response header to JSON to prevent any middleware from changing it\n      res.setHeader('Content-Type', 'application/json');\n      return res.status(200).json(userWithoutPassword);\n    } catch (err) {\n      console.error(\"Error in login-as functionality:\", err);\n      // Make sure we return a proper JSON error response\n      if (!res.headersSent) {\n        res.status(500).json({ message: \"Internal server error during login-as operation\" });\n      } else {\n        next(err);\n      }\n    }\n  });\n\n  app.get(\"/api/user\", (req, res) => {\n    if (!req.isAuthenticated()) return res.sendStatus(401);\n    // Remove password from the response\n    const { password, ...userWithoutPassword } = req.user as SelectUser;\n    res.json(userWithoutPassword);\n  });\n  \n  // Password change endpoint\n  app.patch(\"/api/user/password\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const { currentPassword, newPassword } = req.body;\n      \n      if (!currentPassword || !newPassword) {\n        return res.status(400).json({ message: \"Current password and new password are required\" });\n      }\n      \n      // Verify the current password\n      const user = await storage.getUser(req.user.id);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Verify the current password\n      const isPasswordValid = await comparePasswords(currentPassword, user.password);\n      if (!isPasswordValid) {\n        return res.status(400).json({ message: \"Current password is incorrect\" });\n      }\n      \n      // Hash the new password\n      const hashedPassword = await hashPassword(newPassword);\n      \n      // Update the user's password in the database\n      const updatedUser = await storage.updateUserPassword(req.user.id, hashedPassword);\n      \n      if (!updatedUser) {\n        return res.status(500).json({ message: \"Failed to update password\" });\n      }\n      \n      // Return success response\n      res.status(200).json({ message: \"Password updated successfully\" });\n    } catch (err) {\n      console.error(\"Error updating password:\", err);\n      next(err);\n    }\n  });\n  \n  // Admin password reset endpoint - allows admins to reset any user's password\n  app.patch(\"/api/admin/reset-password/:userId\", async (req, res, next) => {\n    try {\n      // Check if user is authenticated and is an admin\n      if (!req.isAuthenticated() || req.user.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: \"Forbidden: Only admins can reset passwords\" });\n      }\n      \n      const { userId } = req.params;\n      const { newPassword } = req.body;\n      \n      if (!newPassword) {\n        return res.status(400).json({ message: \"New password is required\" });\n      }\n      \n      // Find the user whose password will be reset\n      const user = await storage.getUser(parseInt(userId));\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Hash the new password\n      const hashedPassword = await hashPassword(newPassword);\n      \n      // Update the user's password in the database\n      const updatedUser = await storage.updateUserPassword(user.id, hashedPassword);\n      \n      if (!updatedUser) {\n        return res.status(500).json({ message: \"Failed to reset password\" });\n      }\n      \n      // Return success response\n      res.status(200).json({ \n        message: `Password for user ${user.username} was reset successfully` \n      });\n    } catch (err) {\n      console.error(\"Error resetting password:\", err);\n      next(err);\n    }\n  });\n  \n  // Subadmin password reset endpoint - allows subadmins to reset their players' password\n  app.patch(\"/api/subadmin/reset-password/:userId\", async (req, res, next) => {\n    try {\n      // Check if user is authenticated and is a subadmin\n      if (!req.isAuthenticated() || req.user.role !== UserRole.SUBADMIN) {\n        return res.status(403).json({ message: \"Forbidden: Only subadmins can access this endpoint\" });\n      }\n      \n      const { userId } = req.params;\n      const { newPassword } = req.body;\n      \n      if (!newPassword) {\n        return res.status(400).json({ message: \"New password is required\" });\n      }\n      \n      // Find the user whose password will be reset\n      const user = await storage.getUser(parseInt(userId));\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Verify that the user belongs to this subadmin\n      if (user.assignedTo !== req.user.id) {\n        return res.status(403).json({ \n          message: \"You can only reset passwords for players assigned to you\" \n        });\n      }\n      \n      // Verify that the user is a player (subadmins can only reset player passwords)\n      if (user.role !== UserRole.PLAYER) {\n        return res.status(403).json({ \n          message: \"You can only reset passwords for player accounts\" \n        });\n      }\n      \n      // Hash the new password\n      const hashedPassword = await hashPassword(newPassword);\n      \n      // Update the user's password in the database\n      const updatedUser = await storage.updateUserPassword(user.id, hashedPassword);\n      \n      if (!updatedUser) {\n        return res.status(500).json({ message: \"Failed to reset password\" });\n      }\n      \n      // Return success response\n      res.status(200).json({ \n        message: `Password for player ${user.username} was reset successfully` \n      });\n    } catch (err) {\n      console.error(\"Error resetting password:\", err);\n      next(err);\n    }\n  });\n}\n\n// Middleware for role-based access control\nexport function requireRole(roles: UserRole | UserRole[]) {\n  const allowedRoles = Array.isArray(roles) ? roles : [roles];\n  \n  return (req: Express.Request, res: Express.Response, next: Express.NextFunction) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n    \n    if (!allowedRoles.includes(req.user!.role as UserRole)) {\n      return res.status(403).json({ message: \"Forbidden: Insufficient permissions\" });\n    }\n    \n    next();\n  };\n}\n","path":null,"size_bytes":15896,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"removed_files/cricket-toss-api.ts":{"content":"import express, { Request, Response, NextFunction } from \"express\";\nimport { z } from \"zod\";\nimport { storage } from \"./storage\";\nimport { GameType, TeamMatchResult, games } from \"@shared/schema\";\nimport { db, pool } from \"./db\";\nimport { eq } from \"drizzle-orm\";\n\n// Schema for creating a cricket toss game\nconst createCricketTossSchema = z.object({\n  teamA: z.string().min(2, \"Team A name must be at least 2 characters\"),\n  teamB: z.string().min(2, \"Team B name must be at least 2 characters\"),\n  description: z.string().optional(),\n  tossTime: z.string(),\n  imageUrl: z.string().optional(),\n  openTime: z.string().optional(),\n  closeTime: z.string().optional(),\n});\n\n// Schema for updating a cricket toss game status\nconst updateCricketTossStatusSchema = z.object({\n  status: z.string().refine(val => [\"open\", \"closed\", \"resulted\"].includes(val), {\n    message: \"Status must be one of: open, closed, resulted\"\n  })\n});\n\n// Schema for declaring a cricket toss game result\nconst declareCricketTossResultSchema = z.object({\n  result: z.enum([TeamMatchResult.TEAM_A, TeamMatchResult.TEAM_B], {\n    errorMap: () => ({ message: \"Result must be either team_a or team_b\" })\n  })\n});\n\n// Helper function to validate user role\nfunction requireAdmin(req: Request, res: Response, next: NextFunction) {\n  if (!req.user) {\n    return res.status(401).json({ error: \"Unauthorized\" });\n  }\n  \n  if (req.user.role !== \"admin\") {\n    return res.status(403).json({ error: \"Forbidden. Admin role required.\" });\n  }\n  \n  next();\n}\n\nexport function setupCricketTossApiRoutes(app: express.Express) {\n  // Get all cricket toss games\n  app.get(\"/api/cricket-toss\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      // If we have a dedicated storage method for Cricket Toss:\n      // const games = await storage.getAllCricketTossGames();\n      \n      // For now, we'll use the regular games method with a filter\n      const allGames = await storage.getAllGames();\n      const cricketTossGames = allGames.filter(game => game.gameType === GameType.CRICKET_TOSS);\n      \n      res.json(cricketTossGames);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get active cricket toss games\n  app.get(\"/api/cricket-toss/active\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const allGames = await storage.getAllGames();\n      const activeGames = allGames.filter(\n        game => game.gameType === GameType.CRICKET_TOSS && \n        (game.gameData as any)?.status === \"open\"\n      );\n      \n      res.json(activeGames);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get a single cricket toss game\n  app.get(\"/api/cricket-toss/:id\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const gameId = parseInt(req.params.id, 10);\n      \n      if (isNaN(gameId)) {\n        return res.status(400).json({ error: \"Invalid game ID\" });\n      }\n      \n      const game = await storage.getGame(gameId);\n      \n      if (!game) {\n        return res.status(404).json({ error: \"Cricket Toss game not found\" });\n      }\n      \n      if (game.gameType !== GameType.CRICKET_TOSS) {\n        return res.status(400).json({ error: \"Game is not a Cricket Toss game\" });\n      }\n      \n      res.json(game);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Create a new cricket toss game (admin only) - DISABLED\n  app.post(\"/api/cricket-toss\", requireAdmin, async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      // Just return a message telling users to use the new endpoint\n      // Don't redirect or create games here to prevent duplicates\n      res.status(410).json({ \n        message: \"This API endpoint is deprecated. Please use /api/cricket-toss-games instead.\",\n        redirectTo: \"/api/cricket-toss-games\" \n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Update cricket toss game status (admin only)\n  app.patch(\"/api/cricket-toss/:id/status\", requireAdmin, async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const gameId = parseInt(req.params.id, 10);\n      \n      if (isNaN(gameId)) {\n        return res.status(400).json({ error: \"Invalid game ID\" });\n      }\n      \n      const validationResult = updateCricketTossStatusSchema.safeParse(req.body);\n      \n      if (!validationResult.success) {\n        return res.status(400).json({ \n          error: \"Invalid data\", \n          details: validationResult.error.format() \n        });\n      }\n      \n      const { status } = validationResult.data;\n      \n      const game = await storage.getGame(gameId);\n      \n      if (!game) {\n        return res.status(404).json({ error: \"Cricket Toss game not found\" });\n      }\n      \n      if (game.gameType !== GameType.CRICKET_TOSS) {\n        return res.status(400).json({ error: \"Game is not a Cricket Toss game\" });\n      }\n      \n      // Update the game data with new status similarly to cricket-toss.ts\n      // Get the game data\n      const gameData = typeof game.gameData === 'object' && game.gameData !== null \n        ? { ...game.gameData as any } \n        : {};\n      \n      // Update the status in the gameData\n      gameData.status = status;\n      \n      // Update the game data\n      try {\n        const result = await pool.query(\n          `UPDATE games SET game_data = $1 WHERE id = $2 RETURNING *`,\n          [JSON.stringify(gameData), gameId]\n        );\n\n        if (result.rows.length === 0) {\n          return res.status(404).json({ error: \"Failed to update game status\" });\n        }\n\n        // Return the updated game\n        const updatedGame = await storage.getGame(gameId);\n        res.json(updatedGame);\n      } catch (error) {\n        console.error(\"Error updating game status:\", error);\n        return res.status(500).json({ \n          error: \"Failed to update game status\", \n          details: error instanceof Error ? error.message : String(error) \n        });\n      }\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Declare cricket toss game result (admin only)\n  app.patch(\"/api/cricket-toss/:id/result\", requireAdmin, async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const gameId = parseInt(req.params.id, 10);\n      \n      if (isNaN(gameId)) {\n        return res.status(400).json({ error: \"Invalid game ID\" });\n      }\n      \n      const validationResult = declareCricketTossResultSchema.safeParse(req.body);\n      \n      if (!validationResult.success) {\n        return res.status(400).json({ \n          error: \"Invalid data\", \n          details: validationResult.error.format() \n        });\n      }\n      \n      const { result } = validationResult.data;\n      \n      const game = await storage.getGame(gameId);\n      \n      if (!game) {\n        return res.status(404).json({ error: \"Cricket Toss game not found\" });\n      }\n      \n      if (game.gameType !== GameType.CRICKET_TOSS) {\n        return res.status(400).json({ error: \"Game is not a Cricket Toss game\" });\n      }\n      \n      // Process the result and handle user balance updates for payouts\n      try {\n        // Get the user who placed the bet\n        const user = await storage.getUser(game.userId);\n        if (!user) {\n          return res.status(404).json({ error: \"User not found\" });\n        }\n        \n        // Calculate payout based on result\n        let payout = 0;\n        if (game.prediction === result) {\n          // If prediction matches, calculate payout based on the odds in gameData\n          // Include the bet amount in the payout (total return, not just profit)\n          const gameData = game.gameData as any;\n          const odds = result === 'team_a' ? gameData.oddTeamA : gameData.oddTeamB;\n          // Calculate total payout including original bet amount\n          const winAmount = Math.floor(game.betAmount * (odds / 100));\n          payout = winAmount + game.betAmount;\n        }\n        \n        // Update user balance with the payout\n        const updatedBalance = user.balance + payout;\n        await storage.updateUserBalance(user.id, updatedBalance);\n        \n        // Get the existing game data\n        const gameData = typeof game.gameData === 'object' && game.gameData !== null \n          ? { ...game.gameData as any } \n          : {};\n        \n        // Update the status in the gameData\n        gameData.status = \"resulted\";\n        \n        // Update the game with result, payout, and updated gameData\n        const updateResult = await db.update(games)\n          .set({\n            result,\n            payout,\n            balanceAfter: updatedBalance, // Track the balance after this result is applied\n            gameData: JSON.stringify(gameData) // Update gameData with the resulted status\n          })\n          .where(eq(games.id, gameId))\n          .returning();\n        \n        if (updateResult.length === 0) {\n          return res.status(404).json({ error: \"Game not found or could not be updated\" });\n        }\n        \n        // Get the updated game to return to client\n        const updatedGame = await storage.getGame(gameId);\n        \n        if (!updatedGame) {\n          return res.status(500).json({ error: \"Failed to retrieve updated game\" });\n        }\n        \n        res.json(updatedGame);\n      } catch (error) {\n        console.error(\"Error updating game result:\", error);\n        return res.status(500).json({ \n          error: \"Failed to update game result\",\n          message: error instanceof Error ? error.message : String(error)\n        });\n      }\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Play (place a bet on) a cricket toss game\n  app.post(\"/api/cricket-toss/:id/play\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const gameId = parseInt(req.params.id, 10);\n      \n      if (isNaN(gameId)) {\n        return res.status(400).json({ error: \"Invalid game ID\" });\n      }\n      \n      if (!req.user) {\n        return res.status(401).json({ error: \"You must be logged in to play\" });\n      }\n      \n      // Validate the request body\n      const playSchema = z.object({\n        betAmount: z.number().min(10, \"Minimum bet amount is 10\"),\n        betOn: z.enum([TeamMatchResult.TEAM_A, TeamMatchResult.TEAM_B], {\n          errorMap: () => ({ message: \"Bet must be on either team_a or team_b\" })\n        })\n      });\n      \n      // Handle potential parsing errors (client may send string instead of number)\n      const parsedBody = {\n        ...req.body,\n        betAmount: typeof req.body.betAmount === 'string' \n          ? parseInt(req.body.betAmount, 10)\n          : req.body.betAmount\n      };\n      \n      const validationResult = playSchema.safeParse(parsedBody);\n      \n      if (!validationResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid bet amount or prediction\" \n        });\n      }\n      \n      const { betAmount, betOn } = validationResult.data;\n      \n      // Get the cricket toss game directly - no dependency on team match\n      const game = await storage.getGame(gameId);\n      \n      if (!game) {\n        return res.status(404).json({ message: \"Cricket Toss game not found\" });\n      }\n      \n      if (game.gameType !== GameType.CRICKET_TOSS) {\n        return res.status(400).json({ message: \"Game is not a Cricket Toss game\" });\n      }\n      \n      if ((game.gameData as any)?.status !== 'open') {\n        return res.status(400).json({ message: \"Game is not open for betting\" });\n      }\n      \n      // Check if user has sufficient balance\n      const user = await storage.getUser(req.user.id);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      if (user.balance < betAmount) {\n        return res.status(400).json({ message: \"Insufficient balance\" });\n      }\n      \n      // Deduct the bet amount from user's balance\n      await storage.updateUserBalance(user.id, user.balance - betAmount);\n      \n      // Calculate potential payout based on odds from the game data\n      const gameData = game.gameData as any;\n      const odds = betOn === TeamMatchResult.TEAM_A ? gameData.oddTeamA : gameData.oddTeamB;\n      // Calculate potential winnings based on odds and include original bet amount\n      const winAmount = Math.floor((betAmount * odds) / 100);\n      const potentialPayout = winAmount + betAmount;\n      \n      // Calculate new balance after bet\n      const newBalance = user.balance - betAmount;\n      \n      // Create a new game entry for this user's bet\n      const userBet = {\n        userId: user.id,\n        gameType: GameType.CRICKET_TOSS,\n        betAmount,\n        prediction: betOn, // Use betOn as prediction to match the schema\n        gameData: {\n          teamA: gameData.teamA,\n          teamB: gameData.teamB,\n          tossGameId: game.id, // Link to the original cricket toss game\n          oddTeamA: gameData.oddTeamA,\n          oddTeamB: gameData.oddTeamB,\n          description: gameData.description,\n          tossTime: gameData.tossTime,\n          openTime: gameData.openTime,\n          closeTime: gameData.closeTime,\n          status: 'pending'\n        },\n        result: \"pending\", // Use pending instead of null\n        payout: potentialPayout,\n        balanceAfter: newBalance // Track balance after this bet\n      };\n      \n      const createdBet = await storage.createGame(userBet);\n      \n      res.status(201).json({\n        message: \"Bet placed successfully\",\n        bet: createdBet,\n        potentialPayout\n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n}","path":null,"size_bytes":13501,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([_, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item.dataKey || item.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10466,"size_tokens":null},"reset-game-data.js":{"content":"/**\n * This script removes all game data with no interactive confirmation.\n * Designed for use in automated scripts or development environments.\n * \n * It removes:\n * - Games (all types: coin flip, Satamatka, cricket toss, team match)\n * - Team matches\n * - Satamatka markets\n * \n * While preserving:\n * - User accounts and balances\n * - Transactions (wallet history)\n * - System settings\n * - Commissions and odds\n */\n\nimport pg from 'pg';\nconst { Pool } = pg;\n\n// Create a PostgreSQL connection pool\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL\n});\n\nasync function resetGameData() {\n  const client = await pool.connect();\n  \n  try {\n    console.log(\"Starting game data reset...\");\n    \n    // Begin transaction\n    await client.query('BEGIN');\n    \n    // Delete all games in specific order to avoid foreign key issues\n    const gameTypes = ['coin_flip', 'satamatka', 'cricket_toss', 'team_match'];\n    \n    let totalGamesRemoved = 0;\n    for (const gameType of gameTypes) {\n      const deleteResult = await client.query('DELETE FROM \"games\" WHERE \"game_type\" = $1', [gameType]);\n      console.log(`Removed ${deleteResult.rowCount} ${gameType} games`);\n      totalGamesRemoved += deleteResult.rowCount;\n    }\n    \n    // Delete team matches\n    const deleteTeamMatchesResult = await client.query('DELETE FROM \"team_matches\"');\n    console.log(`Removed ${deleteTeamMatchesResult.rowCount} team matches`);\n    \n    // Delete Satamatka markets\n    const deleteSatamatkaMarketsResult = await client.query('DELETE FROM \"satamatka_markets\"');\n    console.log(`Removed ${deleteSatamatkaMarketsResult.rowCount} Satamatka markets`);\n    \n    // Reset sequence counters\n    await client.query('ALTER SEQUENCE \"games_id_seq\" RESTART WITH 1');\n    await client.query('ALTER SEQUENCE \"team_matches_id_seq\" RESTART WITH 1');\n    await client.query('ALTER SEQUENCE \"satamatka_markets_id_seq\" RESTART WITH 1');\n    \n    // Commit transaction\n    await client.query('COMMIT');\n    \n    console.log(\"Game data reset completed successfully!\");\n    console.log(`Total records removed: ${totalGamesRemoved + deleteTeamMatchesResult.rowCount + deleteSatamatkaMarketsResult.rowCount}`);\n    \n  } catch (error) {\n    // Rollback in case of error\n    await client.query('ROLLBACK');\n    console.error(\"Error resetting game data:\", error);\n    throw error;\n  } finally {\n    // Release the client back to the pool\n    client.release();\n  }\n}\n\n// Run the reset\nresetGameData()\n  .then(() => {\n    console.log(\"Game data has been completely reset.\");\n    process.exit(0);\n  })\n  .catch(error => {\n    console.error(\"Reset script failed:\", error);\n    process.exit(1);\n  });","path":null,"size_bytes":2671,"size_tokens":null},"migrate.ts":{"content":"import { drizzle } from 'drizzle-orm/neon-serverless';\nimport { migrate } from 'drizzle-orm/neon-serverless/migrator';\nimport { Pool, neonConfig } from '@neondatabase/serverless';\nimport ws from 'ws';\nimport * as schema from './shared/schema';\nimport { eq } from 'drizzle-orm';\nimport { createHash, randomBytes, scrypt } from 'crypto';\nimport { promisify } from 'util';\n\nneonConfig.webSocketConstructor = ws;\n\n// Create a connection to the database\nconst pool = new Pool({ connectionString: process.env.DATABASE_URL });\nconst db = drizzle({ client: pool, schema });\n\n// Create a promisified version of scrypt\nconst scryptAsync = promisify(scrypt);\n\n// Function to hash a password with crypto.scrypt\nasync function hashPassword(password: string): Promise<string> {\n  const salt = randomBytes(16).toString('hex');\n  const derivedKey = await scryptAsync(password, salt, 64) as Buffer;\n  return `${derivedKey.toString('hex')}.${salt}`;\n}\n\nasync function main() {\n  try {\n    console.log('Creating tables from schema...');\n    // Push the schema to the database\n    await migrate.drizzle({ client: pool }, {\n      migrationsFolder: './drizzle'\n    });\n    \n    console.log('Tables created successfully');\n    \n    // Check if admin user exists\n    const adminUser = await db.select()\n      .from(schema.users)\n      .where(eq(schema.users.username, 'admin'))\n      .limit(1);\n    \n    if (adminUser.length === 0) {\n      console.log('Creating admin user...');\n      \n      // Hash the password\n      const hashedPassword = await hashPassword('admin123');\n      \n      // Insert the admin user\n      await db.insert(schema.users).values({\n        username: 'admin',\n        password: hashedPassword,\n        email: 'admin@example.com',\n        mobile: '1234567890',\n        role: 'admin',\n        balance: 100000, // Initial balance (in cents)\n      });\n      \n      console.log('Admin user created successfully');\n    } else {\n      console.log('Admin user already exists');\n    }\n    \n    console.log('Migration complete');\n  } catch (error) {\n    console.error('Migration failed:', error);\n  } finally {\n    await pool.end();\n  }\n}\n\nmain();","path":null,"size_bytes":2137,"size_tokens":null},"fix-subadmin-password.ts":{"content":"/**\n * Script to update a subadmin password to make it work with the authentication system\n */\nimport { pool, db } from './server/db';\nimport { hashPassword } from './server/auth';\nimport { users } from './shared/schema';\nimport { eq } from 'drizzle-orm';\n\nasync function fixSubadminPassword() {\n  console.log('Updating subadmin password...');\n  \n  try {\n    // Check if the user exists\n    const existingUsers = await db.select()\n      .from(users)\n      .where(eq(users.username, 'shubham'));\n    \n    if (existingUsers.length === 0) {\n      console.log(\"User 'shubham' not found in the database.\");\n      return;\n    }\n    \n    // Generate a proper crypto.scrypt hash for 'asdf1234'\n    const hashedPassword = await hashPassword('asdf1234');\n    console.log('Generated hash:', hashedPassword);\n    \n    // Update the password\n    const result = await db.update(users)\n      .set({ password: hashedPassword })\n      .where(eq(users.username, 'shubham'))\n      .returning();\n    \n    if (result.length > 0) {\n      console.log('Updated password for user:', result[0].username);\n      console.log('You can now login with:');\n      console.log('Username: shubham');\n      console.log('Password: asdf1234');\n    } else {\n      console.log('No user was updated.');\n    }\n  } catch (error) {\n    console.error('Error updating password:', error);\n  }\n}\n\n// Run the script\nfixSubadminPassword().catch(console.error);","path":null,"size_bytes":1410,"size_tokens":null},"reset-admin-password.js":{"content":"import { db } from './server/db.js';\nimport { users } from './shared/schema.js';\nimport { eq } from 'drizzle-orm';\nimport { scrypt, randomBytes } from 'crypto';\nimport { promisify } from 'util';\n\n// Promisify the scrypt function\nconst scryptAsync = promisify(scrypt);\n\nasync function hashPassword(password) {\n  // Use our native crypto.scrypt function for password hashing\n  const salt = randomBytes(16).toString('hex');\n  const buf = (await scryptAsync(password, salt, 64));\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nasync function resetAdminPassword() {\n  try {\n    console.log('Resetting admin password...');\n    \n    // Hash the password using the same algorithm as in auth.js\n    const hashedPassword = await hashPassword('admin123');\n    \n    // Update the admin user password\n    const result = await db.update(users)\n      .set({ \n        password: hashedPassword,\n      })\n      .where(eq(users.username, 'admin'))\n      .returning({ id: users.id, username: users.username });\n    \n    if (result.length > 0) {\n      console.log(`Updated admin password for ${result[0].username} (ID: ${result[0].id})`);\n      console.log('Please try logging in again with username \"admin\" and password \"admin123\"');\n    } else {\n      console.log('No admin user found!');\n    }\n  } catch (error) {\n    console.error('Error resetting password:', error);\n  }\n}\n\nresetAdminPassword().catch(console.error);","path":null,"size_bytes":1399,"size_tokens":null},"create-admin-bcrypt.js":{"content":"/**\n * Creates an admin user with bcrypt hashed password\n */\n\nimport bcryptjs from 'bcryptjs';\nimport { pool } from './server/db.js';\n\nasync function createAdminWithBcrypt() {\n  const client = await pool.connect();\n  \n  try {\n    // Check if admin user exists\n    const checkResult = await client.query('SELECT id FROM users WHERE username = $1', ['admin']);\n    \n    // Generate bcrypt hash for 'admin123'\n    const saltRounds = 10;\n    const password = 'admin123';\n    const hashedPassword = await bcryptjs.hash(password, saltRounds);\n    \n    if (checkResult.rowCount === 0) {\n      // Admin doesn't exist, create one\n      console.log('Creating new admin user...');\n      \n      await client.query(`\n        INSERT INTO users (username, password, email, mobile, role, balance)\n        VALUES ($1, $2, $3, $4, $5, $6)\n      `, ['admin', hashedPassword, 'admin@example.com', '1234567890', 'admin', 0]);\n      \n      console.log('Admin user created successfully!');\n    } else {\n      // Admin exists, update password\n      console.log('Admin user exists, updating password...');\n      \n      await client.query(`\n        UPDATE users\n        SET password = $1\n        WHERE username = 'admin'\n      `, [hashedPassword]);\n      \n      console.log('Admin password updated successfully!');\n    }\n  } catch (error) {\n    console.error('Error:', error);\n  } finally {\n    client.release();\n    await pool.end();\n  }\n}\n\ncreateAdminWithBcrypt();","path":null,"size_bytes":1440,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  ControllerProps,\n  FieldPath,\n  FieldValues,\n  FormProvider,\n  useFormContext,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message) : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4085,"size_tokens":null},"client/src/pages/action-history-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { UserRole } from \"@shared/schema\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { formatDistance } from \"date-fns\";\nimport { ArrowDown, ArrowUp, Coins, Users, CreditCard, Search, Filter } from \"lucide-react\";\n\nexport default function ActionHistoryPage() {\n  const { user } = useAuth();\n  const [tab, setTab] = useState(\"transactions\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [gameFilter, setGameFilter] = useState(\"all\");\n  const [transactionFilter, setTransactionFilter] = useState(\"all\");\n  const isAdmin = user?.role === UserRole.ADMIN;\n  const isSubadmin = user?.role === UserRole.SUBADMIN;\n\n  // Get transactions\n  const { data: transactions = [], isLoading: transactionsLoading } = useQuery({\n    queryKey: [\"/api/transactions\", isAdmin || isSubadmin ? \"all\" : `user-${user?.id}`],\n    enabled: !!user,\n  });\n\n  // Get games\n  const { data: games = [], isLoading: gamesLoading } = useQuery({\n    queryKey: [\"/api/games\", isAdmin || isSubadmin ? \"all\" : `user-${user?.id}`],\n    enabled: !!user,\n  });\n\n  // Filter transactions based on search and filter\n  const filteredTransactions = (transactions as any[]).filter((transaction: any) => {\n    const matchesSearch = searchTerm === \"\" || \n      transaction.userId.toString().includes(searchTerm) ||\n      (transaction.user?.username && transaction.user.username.toLowerCase().includes(searchTerm.toLowerCase()));\n    \n    if (transactionFilter === \"all\") return matchesSearch;\n    if (transactionFilter === \"positive\") return matchesSearch && transaction.amount > 0;\n    if (transactionFilter === \"negative\") return matchesSearch && transaction.amount < 0;\n    return matchesSearch;\n  });\n\n  // Filter games based on search and filter\n  const filteredGames = (games as any[]).filter((game: any) => {\n    const matchesSearch = searchTerm === \"\" || \n      game.userId.toString().includes(searchTerm) ||\n      (game.user?.username && game.user.username.toLowerCase().includes(searchTerm.toLowerCase()));\n    \n    if (gameFilter === \"all\") return matchesSearch;\n    if (gameFilter === \"wins\") return matchesSearch && game.payout > 0;\n    if (gameFilter === \"losses\") return matchesSearch && game.payout === 0;\n    return matchesSearch;\n  });\n\n  // Format amount - all amounts are stored in paisa (divide by 100 to get rupees)\n  const formatAmount = (amount: number) => {\n    return (amount / 100).toFixed(2);\n  };\n\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr);\n    return `${formatDistance(date, new Date(), { addSuffix: true })} (${date.toLocaleDateString()})`;\n  };\n\n  const renderTransactionsTable = () => (\n    <div className=\"overflow-x-auto\">\n      <Table>\n        <TableHeader>\n          <TableRow>\n            {(isAdmin || isSubadmin) && <TableHead>User</TableHead>}\n            <TableHead>Amount</TableHead>\n            <TableHead>Type</TableHead>\n            <TableHead>Performed By</TableHead>\n            <TableHead>Date</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {filteredTransactions.length === 0 ? (\n            <TableRow>\n              <TableCell colSpan={isAdmin || isSubadmin ? 5 : 4} className=\"text-center py-4\">\n                No transactions found\n              </TableCell>\n            </TableRow>\n          ) : (\n            filteredTransactions.map((transaction: any) => (\n              <TableRow key={transaction.id}>\n                {(isAdmin || isSubadmin) && (\n                  <TableCell className=\"font-medium\">\n                    <div className=\"flex items-center gap-2\">\n                      <Users className=\"h-4 w-4\" />\n                      {transaction.user?.username || `User #${transaction.userId}`}\n                    </div>\n                  </TableCell>\n                )}\n                <TableCell>\n                  <span className={transaction.amount > 0 ? \"text-green-600\" : \"text-red-600\"}>\n                    <div className=\"flex items-center gap-1\">\n                      {transaction.amount > 0 ? <ArrowUp className=\"h-4 w-4\" /> : <ArrowDown className=\"h-4 w-4\" />}\n                      {formatAmount(Math.abs(transaction.amount))}\n                    </div>\n                  </span>\n                </TableCell>\n                <TableCell>\n                  <Badge variant={transaction.amount > 0 ? \"outline\" : \"destructive\"}>\n                    {transaction.amount > 0 ? \"Deposit\" : \"Withdrawal\"}\n                  </Badge>\n                </TableCell>\n                <TableCell>\n                  <div className=\"flex items-center gap-1\">\n                    <CreditCard className=\"h-4 w-4\" />\n                    {transaction.performer?.username || `Admin #${transaction.performedBy}`}\n                  </div>\n                </TableCell>\n                <TableCell>{formatDate(transaction.createdAt)}</TableCell>\n              </TableRow>\n            ))\n          )}\n        </TableBody>\n      </Table>\n    </div>\n  );\n\n  const renderGamesTable = () => (\n    <div className=\"overflow-x-auto\">\n      <Table>\n        <TableHeader>\n          <TableRow>\n            {(isAdmin || isSubadmin) && <TableHead>User</TableHead>}\n            <TableHead>Bet Amount</TableHead>\n            <TableHead>Prediction</TableHead>\n            <TableHead>Result</TableHead>\n            <TableHead>Payout</TableHead>\n            <TableHead>Date</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {filteredGames.length === 0 ? (\n            <TableRow>\n              <TableCell colSpan={isAdmin || isSubadmin ? 6 : 5} className=\"text-center py-4\">\n                No games found\n              </TableCell>\n            </TableRow>\n          ) : (\n            filteredGames.map((game: any) => (\n              <TableRow key={game.id}>\n                {(isAdmin || isSubadmin) && (\n                  <TableCell className=\"font-medium\">\n                    <div className=\"flex items-center gap-2\">\n                      <Users className=\"h-4 w-4\" />\n                      {game.user?.username || `User #${game.userId}`}\n                    </div>\n                  </TableCell>\n                )}\n                <TableCell>{formatAmount(game.betAmount)}</TableCell>\n                <TableCell className=\"capitalize\">{game.prediction}</TableCell>\n                <TableCell className=\"capitalize\">{game.result}</TableCell>\n                <TableCell>\n                  <span className={game.payout > 0 ? \"text-green-600\" : \"text-red-600\"}>\n                    <div className=\"flex items-center gap-1\">\n                      <Coins className=\"h-4 w-4\" />\n                      {formatAmount(game.payout)}\n                    </div>\n                  </span>\n                </TableCell>\n                <TableCell>{formatDate(game.createdAt)}</TableCell>\n              </TableRow>\n            ))\n          )}\n        </TableBody>\n      </Table>\n    </div>\n  );\n\n  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchTerm(e.target.value);\n  };\n\n  return (\n    <DashboardLayout title=\"Action History\">\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <CardTitle>Action History</CardTitle>\n          <CardDescription>\n            View transactions and game history\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Tabs defaultValue=\"transactions\" onValueChange={setTab} value={tab}>\n            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between mb-6\">\n              <TabsList className=\"mb-4 md:mb-0\">\n                <TabsTrigger value=\"transactions\">Transactions</TabsTrigger>\n                <TabsTrigger value=\"games\">Games</TabsTrigger>\n              </TabsList>\n              \n              <div className=\"flex flex-col md:flex-row gap-4 md:items-center\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-2 top-3 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Search user...\"\n                    value={searchTerm}\n                    onChange={handleSearchChange}\n                    className=\"pl-8 w-full md:w-60\"\n                  />\n                </div>\n                \n                {tab === \"transactions\" && (\n                  <div className=\"flex items-center gap-2\">\n                    <Label htmlFor=\"transaction-filter\" className=\"hidden md:inline\">Filter:</Label>\n                    <Select value={transactionFilter} onValueChange={setTransactionFilter}>\n                      <SelectTrigger id=\"transaction-filter\" className=\"w-full md:w-40\">\n                        <SelectValue placeholder=\"Filter transactions\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Transactions</SelectItem>\n                        <SelectItem value=\"positive\">Deposits Only</SelectItem>\n                        <SelectItem value=\"negative\">Withdrawals Only</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                )}\n                \n                {tab === \"games\" && (\n                  <div className=\"flex items-center gap-2\">\n                    <Label htmlFor=\"game-filter\" className=\"hidden md:inline\">Filter:</Label>\n                    <Select value={gameFilter} onValueChange={setGameFilter}>\n                      <SelectTrigger id=\"game-filter\" className=\"w-full md:w-40\">\n                        <SelectValue placeholder=\"Filter games\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Games</SelectItem>\n                        <SelectItem value=\"wins\">Wins Only</SelectItem>\n                        <SelectItem value=\"losses\">Losses Only</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                )}\n              </div>\n            </div>\n            \n            <TabsContent value=\"transactions\" className=\"mt-0\">\n              {transactionsLoading ? (\n                <div className=\"flex justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : (\n                renderTransactionsTable()\n              )}\n            </TabsContent>\n            \n            <TabsContent value=\"games\" className=\"mt-0\">\n              {gamesLoading ? (\n                <div className=\"flex justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : (\n                renderGamesTable()\n              )}\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":11644,"size_tokens":null},"client/src/pages/leaderboard-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Trophy, Medal, Award, Calendar, User, Dice1, Target } from \"lucide-react\";\n\n// Sample leaderboard data - in a real app, this would come from the API\nconst sampleLeaderboardData = [\n  {\n    id: 1,\n    username: \"lucky777\",\n    totalBets: 158,\n    totalWins: 82,\n    winRate: 51.9,\n    totalWinnings: 125000,\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=lucky777\"\n  },\n  {\n    id: 2,\n    username: \"betmaster\",\n    totalBets: 203,\n    totalWins: 112,\n    winRate: 55.2,\n    totalWinnings: 180000,\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=betmaster\"\n  },\n  {\n    id: 3,\n    username: \"player123\",\n    totalBets: 89,\n    totalWins: 38,\n    winRate: 42.7,\n    totalWinnings: 65000,\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=player123\"\n  },\n  {\n    id: 4,\n    username: \"kingbet\",\n    totalBets: 176,\n    totalWins: 98,\n    winRate: 55.7,\n    totalWinnings: 210000,\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=kingbet\"\n  },\n  {\n    id: 5,\n    username: \"winner1\",\n    totalBets: 134,\n    totalWins: 59,\n    winRate: 44.0,\n    totalWinnings: 89000,\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=winner1\"\n  },\n  {\n    id: 6,\n    username: \"gambler456\",\n    totalBets: 221,\n    totalWins: 105,\n    winRate: 47.5,\n    totalWinnings: 156000,\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=gambler456\"\n  },\n  {\n    id: 7,\n    username: \"bettingguru\",\n    totalBets: 178,\n    totalWins: 82,\n    winRate: 46.1,\n    totalWinnings: 132000,\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=bettingguru\"\n  },\n  {\n    id: 8,\n    username: \"luckycharm\",\n    totalBets: 92,\n    totalWins: 49,\n    winRate: 53.3,\n    totalWinnings: 98000,\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=luckycharm\"\n  },\n  {\n    id: 9,\n    username: \"fortuneseeker\",\n    totalBets: 143,\n    totalWins: 65,\n    winRate: 45.5,\n    totalWinnings: 112000,\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=fortuneseeker\"\n  },\n  {\n    id: 10,\n    username: \"betking123\",\n    totalBets: 187,\n    totalWins: 94,\n    winRate: 50.3,\n    totalWinnings: 145000,\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=betking123\"\n  }\n];\n\n// Top winners by game type\nconst sampleGameTypeLeaders = {\n  \"coinflip\": [\n    {\n      id: 2,\n      username: \"betmaster\",\n      totalWins: 63,\n      winRate: 58.3,\n      totalWinnings: 95000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=betmaster\"\n    },\n    {\n      id: 8,\n      username: \"luckycharm\",\n      totalWins: 32,\n      winRate: 59.3,\n      totalWinnings: 64000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=luckycharm\"\n    },\n    {\n      id: 4,\n      username: \"kingbet\",\n      totalWins: 41,\n      winRate: 56.2,\n      totalWinnings: 82000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=kingbet\"\n    }\n  ],\n  \"cricket-toss\": [\n    {\n      id: 4,\n      username: \"kingbet\",\n      totalWins: 48,\n      winRate: 60.0,\n      totalWinnings: 96000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=kingbet\"\n    },\n    {\n      id: 1,\n      username: \"lucky777\",\n      totalWins: 41,\n      winRate: 53.9,\n      totalWinnings: 82000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=lucky777\"\n    },\n    {\n      id: 10,\n      username: \"betking123\",\n      totalWins: 36,\n      winRate: 55.4,\n      totalWinnings: 72000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=betking123\"\n    }\n  ],\n  \"market-games\": [\n    {\n      id: 6,\n      username: \"gambler456\",\n      totalWins: 59,\n      winRate: 52.2,\n      totalWinnings: 118000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=gambler456\"\n    },\n    {\n      id: 2,\n      username: \"betmaster\",\n      totalWins: 49,\n      winRate: 51.6,\n      totalWinnings: 98000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=betmaster\"\n    },\n    {\n      id: 7,\n      username: \"bettingguru\",\n      totalWins: 45,\n      winRate: 48.4,\n      totalWinnings: 90000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=bettingguru\"\n    }\n  ],\n  \"sports-betting\": [\n    {\n      id: 10,\n      username: \"betking123\",\n      totalWins: 58,\n      winRate: 48.3,\n      totalWinnings: 87000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=betking123\"\n    },\n    {\n      id: 4,\n      username: \"kingbet\",\n      totalWins: 56,\n      winRate: 50.5,\n      totalWinnings: 84000,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=kingbet\"\n    },\n    {\n      id: 1,\n      username: \"lucky777\",\n      totalWins: 41,\n      winRate: 47.1,\n      totalWinnings: 61500,\n      avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=lucky777\"\n    }\n  ]\n};\n\n// Recent big wins\nconst sampleRecentBigWins = [\n  {\n    id: 1,\n    username: \"kingbet\",\n    game: \"Cricket Toss\",\n    betAmount: 10000,\n    winAmount: 19000,\n    date: \"2025-04-18T03:24:00\",\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=kingbet\"\n  },\n  {\n    id: 2,\n    username: \"betmaster\",\n    game: \"Market Game\",\n    betAmount: 20000,\n    winAmount: 95000,\n    date: \"2025-04-17T18:45:00\",\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=betmaster\"\n  },\n  {\n    id: 3,\n    username: \"gambler456\",\n    game: \"Sports Betting\",\n    betAmount: 15000,\n    winAmount: 28500,\n    date: \"2025-04-17T14:12:00\",\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=gambler456\"\n  },\n  {\n    id: 4,\n    username: \"lucky777\",\n    game: \"Coin Flip\",\n    betAmount: 25000,\n    winAmount: 47500,\n    date: \"2025-04-17T10:08:00\",\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=lucky777\"\n  },\n  {\n    id: 5,\n    username: \"bettingguru\",\n    game: \"Market Game\",\n    betAmount: 30000,\n    winAmount: 135000,\n    date: \"2025-04-16T22:32:00\",\n    avatar: \"https://api.dicebear.com/7.x/avataaars/svg?seed=bettingguru\"\n  }\n];\n\nexport default function LeaderboardPage() {\n  const [timeFrame, setTimeFrame] = useState(\"all-time\");\n  const [sortBy, setSortBy] = useState(\"totalWinnings\");\n\n  // Fetch leaderboard data from API\n  const { \n    data: leaderboardData = [], \n    isLoading: isLoadingLeaderboard,\n    error: leaderboardError\n  } = useQuery({\n    queryKey: ['/api/leaderboard', timeFrame, sortBy],\n    queryFn: async () => {\n      const response = await fetch(`/api/leaderboard?timeFrame=${timeFrame}&sortBy=${sortBy}`);\n      if (!response.ok) throw new Error('Failed to fetch leaderboard data');\n      return response.json();\n    }\n  });\n\n  // Fetch game-specific leaderboard data\n  const { \n    data: coinflipLeaderboardData = [], \n    isLoading: isLoadingCoinflipLeaderboard,\n    error: coinflipLeaderboardError\n  } = useQuery({\n    queryKey: ['/api/leaderboard', timeFrame, sortBy, 'coin_flip'],\n    queryFn: async () => {\n      const response = await fetch(`/api/leaderboard?timeFrame=${timeFrame}&sortBy=${sortBy}&gameType=coin_flip`);\n      if (!response.ok) throw new Error('Failed to fetch coin flip leaderboard data');\n      return response.json();\n    }\n  });\n\n  const { \n    data: cricketTossLeaderboardData = [], \n    isLoading: isLoadingCricketTossLeaderboard,\n    error: cricketTossLeaderboardError\n  } = useQuery({\n    queryKey: ['/api/leaderboard', timeFrame, sortBy, 'cricket_toss'],\n    queryFn: async () => {\n      const response = await fetch(`/api/leaderboard?timeFrame=${timeFrame}&sortBy=${sortBy}&gameType=cricket_toss`);\n      if (!response.ok) throw new Error('Failed to fetch cricket toss leaderboard data');\n      return response.json();\n    }\n  });\n\n  const { \n    data: satamatkaLeaderboardData = [], \n    isLoading: isLoadingSatamatkaLeaderboard,\n    error: satamatkaLeaderboardError\n  } = useQuery({\n    queryKey: ['/api/leaderboard', timeFrame, sortBy, 'satamatka'],\n    queryFn: async () => {\n      const response = await fetch(`/api/leaderboard?timeFrame=${timeFrame}&sortBy=${sortBy}&gameType=satamatka`);\n      if (!response.ok) throw new Error('Failed to fetch satamatka leaderboard data');\n      return response.json();\n    }\n  });\n\n  // Team match leaderboard query removed\n  const teamMatchLeaderboardData = [];\n  const isLoadingTeamMatchLeaderboard = false;\n  const teamMatchLeaderboardError = null;\n\n  // Fetch recent big wins data\n  const {\n    data: recentWinsData = [],\n    isLoading: isLoadingRecentWins,\n    error: recentWinsError\n  } = useQuery({\n    queryKey: ['/api/games/top-winners'],\n    queryFn: async () => {\n      const response = await fetch('/api/games/top-winners');\n      if (!response.ok) throw new Error('Failed to fetch recent wins data');\n      return response.json();\n    }\n  });\n\n  // Format currency (convert from paise to rupees)\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      maximumFractionDigits: 2\n    }).format(amount / 100);\n  };\n\n  // Format date\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return new Intl.DateTimeFormat('en-US', {\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: true\n    }).format(date);\n  };\n\n  return (\n    <DashboardLayout title=\"Leaderboard\">\n      <div className=\"space-y-6\">\n        {/* Top section - filters and stats */}\n        <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6\">\n          <div>\n            <h1 className=\"text-2xl font-bold flex items-center mb-2\">\n              <Trophy className=\"h-6 w-6 mr-2 text-amber-400\" />\n              Top Players Leaderboard\n            </h1>\n            <p className=\"text-slate-400 text-sm\">\n              See who's winning big and claiming glory across all our games\n            </p>\n          </div>\n          \n          <div className=\"flex gap-2\">\n            <Select \n              value={timeFrame} \n              onValueChange={setTimeFrame}\n            >\n              <SelectTrigger className=\"w-[160px]\">\n                <Calendar className=\"h-4 w-4 mr-2\" />\n                <SelectValue placeholder=\"Time Period\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"today\">Today</SelectItem>\n                <SelectItem value=\"this-week\">This Week</SelectItem>\n                <SelectItem value=\"this-month\">This Month</SelectItem>\n                <SelectItem value=\"all-time\">All Time</SelectItem>\n              </SelectContent>\n            </Select>\n            \n            <Select \n              value={sortBy} \n              onValueChange={setSortBy}\n            >\n              <SelectTrigger className=\"w-[160px]\">\n                <SelectValue placeholder=\"Sort By\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"totalWinnings\">Total Winnings</SelectItem>\n                <SelectItem value=\"winRate\">Win Rate</SelectItem>\n                <SelectItem value=\"totalWins\">Total Wins</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n        \n        {/* Main tabs section */}\n        <Tabs defaultValue=\"overall\" className=\"w-full\">\n          <TabsList className=\"mb-6\">\n            <TabsTrigger value=\"overall\" className=\"flex items-center\">\n              <Trophy className=\"h-4 w-4 mr-2\" />\n              Overall Ranking\n            </TabsTrigger>\n            <TabsTrigger value=\"by-game\" className=\"flex items-center\">\n              <Dice1 className=\"h-4 w-4 mr-2\" />\n              By Game Type\n            </TabsTrigger>\n            <TabsTrigger value=\"recent-wins\" className=\"flex items-center\">\n              <Target className=\"h-4 w-4 mr-2\" />\n              Recent Big Wins\n            </TabsTrigger>\n          </TabsList>\n          \n          {/* Overall Ranking Tab */}\n          <TabsContent value=\"overall\" className=\"space-y-6\">\n            <Card>\n              <CardHeader className=\"pb-4\">\n                <CardTitle>Top Players</CardTitle>\n                <CardDescription>\n                  Players ranked by {sortBy === \"totalWinnings\" ? \"total winnings\" : \n                    sortBy === \"winRate\" ? \"win rate\" : \"total wins\"}\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {isLoadingLeaderboard ? (\n                  <div className=\"py-12 flex justify-center\">\n                    <div className=\"animate-spin h-8 w-8 border-2 border-primary rounded-full border-t-transparent\"></div>\n                  </div>\n                ) : leaderboardError ? (\n                  <div className=\"py-12 text-center text-red-400\">\n                    <p>Failed to load leaderboard data. Please try again later.</p>\n                  </div>\n                ) : leaderboardData.length === 0 ? (\n                  <div className=\"py-12 text-center text-slate-400\">\n                    <p>No leaderboard data available for the selected time period.</p>\n                    <p className=\"text-sm mt-2\">Try selecting a different time period or check back later.</p>\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"w-[80px]\">Rank</TableHead>\n                        <TableHead>Player</TableHead>\n                        <TableHead className=\"text-right\">Bets</TableHead>\n                        <TableHead className=\"text-right\">Wins</TableHead>\n                        <TableHead className=\"text-right\">Win Rate</TableHead>\n                        <TableHead className=\"text-right\">Total Winnings</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {leaderboardData.map((player, index) => (\n                        <TableRow key={player.userId} className={index < 3 ? \"bg-slate-800/30\" : \"\"}>\n                          <TableCell className=\"font-medium\">\n                            <div className=\"flex items-center justify-center\">\n                              {index === 0 ? (\n                                <div className=\"h-8 w-8 rounded-full bg-amber-500/20 flex items-center justify-center\">\n                                  <Trophy className=\"h-4 w-4 text-amber-400\" />\n                                </div>\n                              ) : index === 1 ? (\n                                <div className=\"h-8 w-8 rounded-full bg-slate-400/20 flex items-center justify-center\">\n                                  <Medal className=\"h-4 w-4 text-slate-300\" />\n                                </div>\n                              ) : index === 2 ? (\n                                <div className=\"h-8 w-8 rounded-full bg-amber-700/20 flex items-center justify-center\">\n                                  <Award className=\"h-4 w-4 text-amber-700\" />\n                                </div>\n                              ) : (\n                                <span className=\"text-slate-400\">{index + 1}</span>\n                              )}\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center\">\n                              <div className=\"h-10 w-10 rounded-full overflow-hidden mr-3 bg-slate-800\">\n                                <img \n                                  src={player.avatar} \n                                  alt={player.username}\n                                  className=\"h-full w-full object-cover\"\n                                />\n                              </div>\n                              <span className={index < 3 ? \"font-medium\" : \"\"}>{player.username}</span>\n                            </div>\n                          </TableCell>\n                          <TableCell className=\"text-right\">{player.totalBets}</TableCell>\n                          <TableCell className=\"text-right\">{player.totalWins}</TableCell>\n                          <TableCell className=\"text-right\">{player.winRate}%</TableCell>\n                          <TableCell className=\"text-right font-medium\">\n                            {formatCurrency(player.totalWinnings)}\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n          \n          {/* By Game Type Tab */}\n          <TabsContent value=\"by-game\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* Coin Flip Leaders */}\n              <Card>\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"flex items-center\">\n                    <Dice1 className=\"h-5 w-5 mr-2 text-blue-400\" />\n                    Coin Flip Leaders\n                  </CardTitle>\n                  <CardDescription>Top players in our coin flip game</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {isLoadingCoinflipLeaderboard ? (\n                    <div className=\"py-12 flex justify-center\">\n                      <div className=\"animate-spin h-8 w-8 border-2 border-primary rounded-full border-t-transparent\"></div>\n                    </div>\n                  ) : coinflipLeaderboardError ? (\n                    <div className=\"py-6 text-center text-red-400\">\n                      <p>Failed to load coin flip leaderboard data.</p>\n                    </div>\n                  ) : coinflipLeaderboardData.length === 0 ? (\n                    <div className=\"py-6 text-center text-slate-400\">\n                      <p>No coin flip leaderboard data available.</p>\n                    </div>\n                  ) : (\n                    coinflipLeaderboardData.slice(0, 3).map((player, index) => (\n                      <div \n                        key={player.userId}\n                        className=\"flex items-center justify-between py-3 border-b border-slate-800 last:border-0\"\n                      >\n                        <div className=\"flex items-center\">\n                          <div className=\"h-8 w-8 rounded-full flex items-center justify-center mr-3 bg-slate-800/60\">\n                            {index === 0 ? (\n                              <Trophy className=\"h-4 w-4 text-amber-400\" />\n                            ) : index === 1 ? (\n                              <Medal className=\"h-4 w-4 text-slate-300\" />\n                            ) : (\n                              <Award className=\"h-4 w-4 text-amber-700\" />\n                            )}\n                          </div>\n                          <div className=\"flex items-center\">\n                            <div className=\"h-10 w-10 rounded-full overflow-hidden mr-3 bg-slate-800\">\n                              <img \n                                src={player.avatar} \n                                alt={player.username}\n                                className=\"h-full w-full object-cover\"\n                              />\n                            </div>\n                            <div>\n                              <p className=\"font-medium\">{player.username}</p>\n                              <p className=\"text-xs text-slate-400\">{player.totalWins} wins  {player.winRate}% win rate</p>\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"text-right font-medium\">\n                          {formatCurrency(player.totalWinnings)}\n                        </div>\n                      </div>\n                    ))\n                  )}\n                </CardContent>\n              </Card>\n              \n              {/* Cricket Toss Leaders */}\n              <Card>\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"flex items-center\">\n                    <Target className=\"h-5 w-5 mr-2 text-emerald-400\" />\n                    Cricket Toss Leaders\n                  </CardTitle>\n                  <CardDescription>Top players in cricket toss betting</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {isLoadingCricketTossLeaderboard ? (\n                    <div className=\"py-12 flex justify-center\">\n                      <div className=\"animate-spin h-8 w-8 border-2 border-primary rounded-full border-t-transparent\"></div>\n                    </div>\n                  ) : cricketTossLeaderboardError ? (\n                    <div className=\"py-6 text-center text-red-400\">\n                      <p>Failed to load cricket toss leaderboard data.</p>\n                    </div>\n                  ) : cricketTossLeaderboardData.length === 0 ? (\n                    <div className=\"py-6 text-center text-slate-400\">\n                      <p>No cricket toss leaderboard data available.</p>\n                    </div>\n                  ) : (\n                    cricketTossLeaderboardData.slice(0, 3).map((player, index) => (\n                      <div \n                        key={player.userId}\n                        className=\"flex items-center justify-between py-3 border-b border-slate-800 last:border-0\"\n                      >\n                        <div className=\"flex items-center\">\n                          <div className=\"h-8 w-8 rounded-full flex items-center justify-center mr-3 bg-slate-800/60\">\n                            {index === 0 ? (\n                              <Trophy className=\"h-4 w-4 text-amber-400\" />\n                            ) : index === 1 ? (\n                              <Medal className=\"h-4 w-4 text-slate-300\" />\n                            ) : (\n                              <Award className=\"h-4 w-4 text-amber-700\" />\n                            )}\n                          </div>\n                          <div className=\"flex items-center\">\n                            <div className=\"h-10 w-10 rounded-full overflow-hidden mr-3 bg-slate-800\">\n                              <img \n                                src={player.avatar} \n                                alt={player.username}\n                                className=\"h-full w-full object-cover\"\n                              />\n                            </div>\n                            <div>\n                              <p className=\"font-medium\">{player.username}</p>\n                              <p className=\"text-xs text-slate-400\">{player.totalWins} wins  {player.winRate}% win rate</p>\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"text-right font-medium\">\n                          {formatCurrency(player.totalWinnings)}\n                        </div>\n                      </div>\n                    ))\n                  )}\n                </CardContent>\n              </Card>\n              \n              {/* Market Games Leaders */}\n              <Card>\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"flex items-center\">\n                    <Calendar className=\"h-5 w-5 mr-2 text-violet-400\" />\n                    Market Game Leaders\n                  </CardTitle>\n                  <CardDescription>Top players in market betting games</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {isLoadingSatamatkaLeaderboard ? (\n                    <div className=\"py-12 flex justify-center\">\n                      <div className=\"animate-spin h-8 w-8 border-2 border-primary rounded-full border-t-transparent\"></div>\n                    </div>\n                  ) : satamatkaLeaderboardError ? (\n                    <div className=\"py-6 text-center text-red-400\">\n                      <p>Failed to load satamatka leaderboard data.</p>\n                    </div>\n                  ) : satamatkaLeaderboardData.length === 0 ? (\n                    <div className=\"py-6 text-center text-slate-400\">\n                      <p>No market game leaderboard data available.</p>\n                    </div>\n                  ) : (\n                    satamatkaLeaderboardData.slice(0, 3).map((player, index) => (\n                      <div \n                        key={player.userId}\n                        className=\"flex items-center justify-between py-3 border-b border-slate-800 last:border-0\"\n                      >\n                        <div className=\"flex items-center\">\n                          <div className=\"h-8 w-8 rounded-full flex items-center justify-center mr-3 bg-slate-800/60\">\n                            {index === 0 ? (\n                              <Trophy className=\"h-4 w-4 text-amber-400\" />\n                            ) : index === 1 ? (\n                              <Medal className=\"h-4 w-4 text-slate-300\" />\n                            ) : (\n                              <Award className=\"h-4 w-4 text-amber-700\" />\n                            )}\n                          </div>\n                          <div className=\"flex items-center\">\n                            <div className=\"h-10 w-10 rounded-full overflow-hidden mr-3 bg-slate-800\">\n                              <img \n                                src={player.avatar} \n                                alt={player.username}\n                                className=\"h-full w-full object-cover\"\n                              />\n                            </div>\n                            <div>\n                              <p className=\"font-medium\">{player.username}</p>\n                              <p className=\"text-xs text-slate-400\">{player.totalWins} wins  {player.winRate}% win rate</p>\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"text-right font-medium\">\n                          {formatCurrency(player.totalWinnings)}\n                        </div>\n                      </div>\n                    ))\n                  )}\n                </CardContent>\n              </Card>\n              \n              {/* Sports Betting Leaders section removed */}\n            </div>\n          </TabsContent>\n          \n          {/* Recent Big Wins Tab */}\n          <TabsContent value=\"recent-wins\" className=\"space-y-6\">\n            <Card>\n              <CardHeader className=\"pb-4\">\n                <CardTitle>Recent Big Wins</CardTitle>\n                <CardDescription>\n                  Players who have recently won big on our platform\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {isLoadingRecentWins ? (\n                  <div className=\"py-12 flex justify-center\">\n                    <div className=\"animate-spin h-8 w-8 border-2 border-primary rounded-full border-t-transparent\"></div>\n                  </div>\n                ) : recentWinsError ? (\n                  <div className=\"py-12 text-center text-red-400\">\n                    <p>Failed to load recent wins data. Please try again later.</p>\n                  </div>\n                ) : recentWinsData.length === 0 ? (\n                  <div className=\"py-12 text-center text-slate-400\">\n                    <p>No recent big wins available yet.</p>\n                    <p className=\"text-sm mt-2\">Check back later as more players win big!</p>\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Player</TableHead>\n                        <TableHead>Game</TableHead>\n                        <TableHead>Date & Time</TableHead>\n                        <TableHead className=\"text-right\">Bet Amount</TableHead>\n                        <TableHead className=\"text-right\">Win Amount</TableHead>\n                        <TableHead className=\"text-right\">Multiplier</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {recentWinsData.map((win) => (\n                        <TableRow key={win.id}>\n                          <TableCell>\n                            <div className=\"flex items-center\">\n                              <div className=\"h-10 w-10 rounded-full overflow-hidden mr-3 bg-slate-800\">\n                                <img \n                                  src={`https://api.dicebear.com/7.x/avataaars/svg?seed=${win.username}`} \n                                  alt={win.username}\n                                  className=\"h-full w-full object-cover\"\n                                />\n                              </div>\n                              <span>{win.username}</span>\n                            </div>\n                          </TableCell>\n                          <TableCell>{win.game}</TableCell>\n                          <TableCell>{formatDate(win.createdAt)}</TableCell>\n                          <TableCell className=\"text-right\">{formatCurrency(win.amount)}</TableCell>\n                          <TableCell className=\"text-right font-medium text-emerald-400\">\n                            {formatCurrency(win.payout)}\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            {(win.payout / win.amount).toFixed(1)}x\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n              </CardContent>\n            </Card>\n            \n            {/* Call to action */}\n            <div className=\"bg-gradient-to-r from-slate-800/70 to-indigo-900/30 p-6 rounded-lg border border-slate-700 text-center\">\n              <h3 className=\"text-xl font-bold mb-2\">Want to join the leaderboard?</h3>\n              <p className=\"text-slate-400 mb-4\">Start playing now and climb your way to the top!</p>\n              <div className=\"flex justify-center gap-4\">\n                <Button className=\"bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500\">\n                  Play Now\n                </Button>\n                <Button variant=\"outline\" className=\"border-slate-600\">\n                  View All Games\n                </Button>\n              </div>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":31189,"size_tokens":null},"client/src/lib/sound-utils.ts":{"content":"/**\n * Sound utilities for the game\n * Uses simple Audio elements to play WAV files\n */\n\n// Sound mute state\nlet isMuted = false;\n\n/**\n * Initialize audio (now just a placeholder function)\n */\nexport function initAudio() {\n  // Nothing to initialize for basic Audio elements\n  return true;\n}\n\n/**\n * Toggle the mute state\n */\nexport function toggleMute() {\n  isMuted = !isMuted;\n  return isMuted;\n}\n\n/**\n * Get the current mute state\n */\nexport function isSoundMuted() {\n  return isMuted;\n}\n\n/**\n * Helper function to play sounds\n */\nfunction playSound(url: string) {\n  if (isMuted) return;\n\n  try {\n    // Create a new audio element for each sound to avoid conflicts\n    const sound = new Audio(url);\n    sound.volume = 0.8;\n    sound.play().catch(error => {\n      console.error(`Error playing sound (${url}):`, error);\n    });\n  } catch (error) {\n    console.error(`Error playing sound (${url}):`, error);\n  }\n}\n\n/**\n * Play the coin flip sound\n */\nexport function playCoinFlipSound() {\n  playSound('/sounds/coin-flip-sound.wav');\n}\n\n/**\n * Play the win sound\n */\nexport function playWinSound() {\n  // Using the same sound for win as well\n  playSound('/sounds/coin-flip-sound.wav');\n}\n\n/**\n * Placeholder for losing sound - not used as per user request\n */\nexport function playLoseSound() {\n  // No sound played for losses as requested by the user\n  return;\n}","path":null,"size_bytes":1361,"size_tokens":null},"create-test-users.js":{"content":"/**\n * This script creates test users for validating game odds:\n * 1. A new subadmin\n * 2. A player assigned to that subadmin\n */\n\nimport { Pool } from 'pg';\nimport bcrypt from 'bcrypt';\n\nasync function createTestUsers() {\n  console.log('Starting to create test users...');\n  \n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL\n  });\n\n  try {\n    // Create hash for password\n    const saltRounds = 10;\n    const password = 'pass123';\n    const hashedPassword = await bcrypt.hash(password, saltRounds);\n    \n    console.log('Password hashed successfully');\n    \n    // Create test subadmin if doesn't exist\n    const subadminCheck = await pool.query(\n      'SELECT * FROM users WHERE username = $1',\n      ['oddstester']\n    );\n    \n    let subadminId;\n    \n    if (subadminCheck.rows.length === 0) {\n      // Create subadmin\n      const subadminResult = await pool.query(\n        `INSERT INTO users \n        (username, email, password, mobile, role, balance, is_blocked) \n        VALUES ($1, $2, $3, $4, $5, $6, $7) \n        RETURNING id`,\n        ['oddstester', 'oddstester@example.com', hashedPassword, '1234567890', 'subadmin', 10000, false]\n      );\n      \n      subadminId = subadminResult.rows[0].id;\n      console.log(`Test subadmin created with ID: ${subadminId}`);\n    } else {\n      subadminId = subadminCheck.rows[0].id;\n      console.log(`Using existing subadmin with ID: ${subadminId}`);\n    }\n    \n    // Create test player if doesn't exist\n    const playerCheck = await pool.query(\n      'SELECT * FROM users WHERE username = $1',\n      ['playertester']\n    );\n    \n    if (playerCheck.rows.length === 0) {\n      // Create player under this subadmin\n      const playerResult = await pool.query(\n        `INSERT INTO users \n        (username, email, password, mobile, role, balance, assigned_to, is_blocked) \n        VALUES ($1, $2, $3, $4, $5, $6, $7, $8) \n        RETURNING id`,\n        ['playertester', 'playertester@example.com', hashedPassword, '9876543210', 'player', 5000, subadminId, false]\n      );\n      \n      console.log(`Test player created with ID: ${playerResult.rows[0].id}`);\n    } else {\n      // Ensure player is assigned to our subadmin\n      await pool.query(\n        'UPDATE users SET assigned_to = $1 WHERE username = $2',\n        [subadminId, 'playertester']\n      );\n      \n      console.log(`Updated player to be assigned to subadmin ID: ${subadminId}`);\n    }\n    \n    // Set custom odds for the subadmin\n    // First get the current odds to see if we need to insert or update\n    const oddCheck = await pool.query(\n      'SELECT * FROM game_odds WHERE game_type = $1 AND subadmin_id = $2',\n      ['coin_flip', subadminId]\n    );\n    \n    // Set a custom odd that's different from platform default\n    const customOddValue = 210; // 2.10x (stored as 210 in DB)\n    \n    if (oddCheck.rows.length === 0) {\n      // Insert new odd\n      await pool.query(\n        `INSERT INTO game_odds \n        (game_type, odd_value, set_by_admin, subadmin_id) \n        VALUES ($1, $2, $3, $4)`,\n        ['coin_flip', customOddValue, false, subadminId]\n      );\n    } else {\n      // Update existing odd\n      await pool.query(\n        `UPDATE game_odds \n        SET odd_value = $1 \n        WHERE game_type = $2 AND subadmin_id = $3`,\n        [customOddValue, 'coin_flip', subadminId]\n      );\n    }\n    \n    console.log(`Set custom coin flip odds for subadmin ID ${subadminId} to ${customOddValue/100}x`);\n    \n    console.log('Test setup completed successfully!');\n    console.log('Login credentials:');\n    console.log(`Subadmin: username=oddstester, password=${password}`);\n    console.log(`Player: username=playertester, password=${password}`);\n    \n  } catch (error) {\n    console.error('Error creating test accounts:', error);\n  } finally {\n    await pool.end();\n  }\n}\n\ncreateTestUsers().catch(err => console.error('Unhandled error:', err));","path":null,"size_bytes":3892,"size_tokens":null},"fix-subadmin-password.js":{"content":"/**\n * Script to update a subadmin password to make it work with the authentication system\n */\nconst { Pool } = require('pg');\nconst { promisify } = require('util');\nconst { scrypt, randomBytes } = require('crypto');\n\n// Promisify the scrypt function\nconst scryptAsync = promisify(scrypt);\n\n// Connect to database using environment variables\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL\n});\n\nasync function hashPassword(password) {\n  // Use our native crypto.scrypt function for password hashing\n  const salt = randomBytes(16).toString('hex');\n  const buf = await scryptAsync(password, salt, 64);\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nasync function fixSubadminPassword() {\n  console.log('Updating subadmin password...');\n  \n  const client = await pool.connect();\n  \n  try {\n    // Check if the user exists\n    const checkResult = await client.query(\n      `SELECT * FROM users WHERE username = 'shubham'`\n    );\n    \n    if (checkResult.rows.length === 0) {\n      console.log(\"User 'shubham' not found in the database.\");\n      return;\n    }\n    \n    // Generate a proper crypto.scrypt hash for 'asdf1234'\n    const hashedPassword = await hashPassword('asdf1234');\n    console.log('Generated hash:', hashedPassword);\n    \n    // Update the password\n    const result = await client.query(\n      `UPDATE users SET password = $1 WHERE username = 'shubham' RETURNING id, username, role`,\n      [hashedPassword]\n    );\n    \n    if (result.rows.length > 0) {\n      console.log('Updated password for user:', result.rows[0]);\n      console.log('You can now login with:');\n      console.log('Username: shubham');\n      console.log('Password: asdf1234');\n    } else {\n      console.log('No user was updated.');\n    }\n  } catch (error) {\n    console.error('Error updating password:', error);\n  } finally {\n    client.release();\n  }\n}\n\n// Run the script\nfixSubadminPassword().catch(console.error);","path":null,"size_bytes":1918,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":845,"size_tokens":null},"create-admin-simple.js":{"content":"import { pool } from './server/db.js';\n\nasync function createAdmin() {\n  const client = await pool.connect();\n  try {\n    // Create a simple bcrypt hash for 'admin123'\n    const hashedPassword = '$2b$10$6ry7fnztTLJGCEJ.XTfuOOYTi6YkxuCMqN3Zpn9FLrGwKJVbjBQ5i';\n    \n    // Insert admin directly with SQL to avoid any potential issues\n    const result = await client.query(`\n      INSERT INTO users (username, password, email, mobile, role, balance, is_blocked)\n      VALUES ('admin', $1, 'admin@example.com', '1234567890', 'admin', 0, false)\n      RETURNING id, username\n    `, [hashedPassword]);\n    \n    console.log('Created new admin account:', result.rows[0]);\n    console.log('You can now login with:');\n    console.log('Username: admin');\n    console.log('Password: admin123');\n  } catch (error) {\n    console.error('Error creating admin account:', error);\n  } finally {\n    client.release();\n  }\n}\n\ncreateAdmin().catch(console.error);\n","path":null,"size_bytes":940,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":772,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [\n    require(\"tailwindcss-animate\"), \n    require(\"@tailwindcss/typography\"),\n    require(\"tailwind-scrollbar\"),\n  ],\n} satisfies Config;\n","path":null,"size_bytes":2836,"size_tokens":null},"client/src/components/market-card.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { formatDistanceToNow, format } from \"date-fns\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"./ui/card\";\nimport { Badge } from \"./ui/badge\";\nimport { Button } from \"./ui/button\";\nimport { Clock, Calendar, Target, Dice1, ArrowRightCircle, Award } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\ninterface MarketCardProps {\n  id: number;\n  name: string;\n  type: string;\n  openTime: string;\n  closeTime: string;\n  openResult?: string;\n  closeResult?: string;\n  status: string;\n  showFullInfo?: boolean;\n  coverImage?: string;\n}\n\nexport default function MarketCard({\n  id,\n  name,\n  type,\n  openTime,\n  closeTime,\n  openResult,\n  closeResult,\n  status,\n  showFullInfo = false,\n  coverImage,\n}: MarketCardProps) {\n  const [_, setLocation] = useLocation();\n\n  // Parse dates\n  const openTimeDate = new Date(openTime);\n  const closeTimeDate = new Date(closeTime);\n  \n  // Format times\n  const openTimeFormatted = format(openTimeDate, \"h:mm a\");\n  const closeTimeFormatted = format(closeTimeDate, \"h:mm a\");\n  \n  // Time remaining until close (if market is open)\n  const timeRemainingText = status === \"open\" \n    ? formatDistanceToNow(closeTimeDate, { addSuffix: true })\n    : \"\";\n  \n  // Get appropriate status badge color\n  const getStatusBadge = () => {\n    switch (status) {\n      case \"open\":\n        return <Badge className=\"bg-green-500 hover:bg-green-600 text-white\">Open</Badge>;\n      case \"closed\":\n        return <Badge variant=\"destructive\">Waiting Results</Badge>;\n      case \"resulted\":\n        return <Badge variant=\"secondary\">Resulted</Badge>;\n      case \"waiting\":\n        return <Badge className=\"bg-purple-500 hover:bg-purple-600 text-white\">Upcoming</Badge>;\n      case \"waiting_result\":\n        return <Badge variant=\"destructive\">Waiting Results</Badge>;\n      default:\n        return <Badge>{status}</Badge>;\n    }\n  };\n\n  // Get market icon based on type\n  const getMarketIcon = () => {\n    switch (type) {\n      case \"dishawar\":\n        return <Calendar className=\"h-14 w-14 text-primary\" />;\n      case \"gali\":\n        return <Target className=\"h-14 w-14 text-primary\" />;\n      case \"mumbai\":\n        return <Dice1 className=\"h-14 w-14 text-primary\" />;\n      case \"kalyan\":\n        return <Clock className=\"h-14 w-14 text-primary\" />;\n      default:\n        return <Calendar className=\"h-14 w-14 text-primary\" />;\n    }\n  };\n  \n  // Get cover style based on market type or admin-provided cover image\n  const getMarketCoverStyle = () => {\n    const gradientOverlay = \"linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.7))\";\n    \n    // If admin provided a specific coverImage for this market, use it (highest priority)\n    if (coverImage) {\n      console.log(`Using market's own cover image: ${coverImage} for \"${name}\"`);\n      return { \n        backgroundImage: `${gradientOverlay}, url(\"${coverImage}\")`,\n        className: \"bg-slate-900 bg-cover bg-center\"\n      };\n    }\n    \n    // Otherwise, use default gradient patterns based on market type (don't use generic market images)\n    let backgroundImage;\n    let bgColor;\n    \n    switch (type) {\n      case \"dishawar\":\n        bgColor = \"bg-purple-900\";\n        backgroundImage = `${gradientOverlay}, url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cpath fill='%23a855f7' fill-opacity='0.2' d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z'%3E%3C/path%3E%3C/svg%3E\")`;\n        break;\n      case \"gali\":\n        bgColor = \"bg-amber-900\";\n        backgroundImage = `${gradientOverlay}, url(\"data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23f59e0b' fill-opacity='0.2'%3E%3C/path%3E%3C/svg%3E\")`;\n        break;\n      case \"mumbai\":\n        bgColor = \"bg-sky-900\";\n        backgroundImage = `${gradientOverlay}, url(\"data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%230ea5e9' fill-opacity='0.2'%3E%3C/path%3E%3C/svg%3E\")`;\n        break;\n      case \"kalyan\":\n        bgColor = \"bg-emerald-900\";\n        backgroundImage = `${gradientOverlay}, url(\"data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%2310b981' fill-opacity='0.2'%3E%3C/path%3E%3C/svg%3E\")`;\n        break;\n      default:\n        bgColor = \"bg-slate-900\";\n        backgroundImage = `${gradientOverlay}, url(\"data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%236366f1' fill-opacity='0.2'%3E%3C/path%3E%3C/svg%3E\")`;\n    }\n    \n    return { backgroundImage, className: bgColor };\n  };\n\n  // Get result display component\n  const getResultDisplay = () => {\n    if (status === \"resulted\" && (openResult || closeResult)) {\n      // Use closeResult as primary, fallback to openResult if closeResult is not available\n      const resultToShow = closeResult || openResult;\n      \n      if (resultToShow) {\n        return (\n          <div className=\"flex justify-center items-center py-2\">\n            <div className=\"text-center\">\n              <Badge variant=\"outline\" className=\"text-xl font-bold px-3 py-1\">\n                {resultToShow}\n              </Badge>\n            </div>\n          </div>\n        );\n      }\n    }\n    return null;\n  };\n  \n  const { backgroundImage, className } = getMarketCoverStyle();\n\n  return (\n    <Card className=\"overflow-hidden h-full transition-all duration-200 hover:shadow-md\">\n      <div \n        className={`h-28 flex items-center justify-center p-4 text-white ${className}`}\n        style={{ backgroundImage }}\n      >\n        <div className=\"text-center\">\n          <h3 className=\"text-2xl font-bold\">{name}</h3>\n        </div>\n      </div>\n      \n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2 pt-3\">\n        <div>\n          <CardDescription className=\"flex items-center text-sm\">\n            <Clock className=\"h-4 w-4 mr-1 text-muted-foreground\" />\n            <span>{openTimeFormatted} - {closeTimeFormatted}</span>\n          </CardDescription>\n          {status === \"open\" && (\n            <div className=\"text-xs opacity-80 mt-1\">\n              Closes {timeRemainingText}\n            </div>\n          )}\n        </div>\n        <div>{getStatusBadge()}</div>\n      </CardHeader>\n      \n      {(status === \"resulted\" || (openResult || closeResult)) && (\n        <CardContent className=\"py-0 px-6\">\n          {status === \"resulted\" && (\n            <div className=\"flex items-center justify-center mb-2\">\n              <Award className=\"h-5 w-5 text-amber-500 mr-2\" />\n              <span className=\"text-sm font-medium\">Results Declared</span>\n            </div>\n          )}\n          {getResultDisplay()}\n        </CardContent>\n      )}\n      \n      <CardFooter className=\"bg-muted/50 pt-2 pb-2 mt-auto\">\n        {/* For open markets, show Place Bet button */}\n        {status === \"open\" && (\n          <Button \n            className=\"w-full\"\n            onClick={() => setLocation(`/game/satamatka/${id}`)}\n          >\n            Place Bet <ArrowRightCircle className=\"ml-2 h-4 w-4\" />\n          </Button>\n        )}\n        \n        {/* \"View Market\" button - Don't show for \"waiting\" or \"closed\" statuses */}\n        {status !== \"open\" && status !== \"waiting\" && status !== \"closed\" && !showFullInfo && (\n          <Button \n            className=\"w-full\" \n            variant=\"outline\"\n            onClick={() => setLocation(`/game/satamatka/${id}`)}\n          >\n            View Market\n          </Button>\n        )}\n      </CardFooter>\n    </Card>\n  );\n}","path":null,"size_bytes":12914,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\ninterface CommandDialogProps extends DialogProps {}\n\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4879,"size_tokens":null},"client/src/components/dashboard-stats-card.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { ReactNode } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface DashboardStatsCardProps {\n  title: string;\n  value: string | number;\n  icon: ReactNode;\n  trend?: 'up' | 'down' | 'neutral';\n  color?: 'blue' | 'green' | 'red' | 'purple' | 'amber' | 'slate';\n}\n\nexport default function DashboardStatsCard({ \n  title, \n  value, \n  icon, \n  trend = 'neutral',\n  color = 'blue'\n}: DashboardStatsCardProps) {\n  \n  // Color mappings for different elements\n  const colorClasses = {\n    blue: {\n      bg: 'bg-blue-900/20',\n      border: 'border-blue-900/50',\n      text: 'text-blue-400',\n      iconBg: 'bg-blue-900/30',\n    },\n    green: {\n      bg: 'bg-green-900/20',\n      border: 'border-green-900/50',\n      text: 'text-emerald-400',\n      iconBg: 'bg-green-900/30',\n    },\n    red: {\n      bg: 'bg-red-900/20',\n      border: 'border-red-900/50',\n      text: 'text-red-400',\n      iconBg: 'bg-red-900/30',\n    },\n    purple: {\n      bg: 'bg-purple-900/20',\n      border: 'border-purple-900/50',\n      text: 'text-purple-400',\n      iconBg: 'bg-purple-900/30',\n    },\n    amber: {\n      bg: 'bg-amber-900/20',\n      border: 'border-amber-900/50',\n      text: 'text-amber-400',\n      iconBg: 'bg-amber-900/30',\n    },\n    slate: {\n      bg: 'bg-slate-800/70',\n      border: 'border-slate-700',\n      text: 'text-slate-300',\n      iconBg: 'bg-slate-800',\n    },\n  };\n\n  // Trend arrow display\n  const trendIcon = {\n    up: (\n      <svg className=\"w-4 h-4 text-emerald-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 10l7-7m0 0l7 7m-7-7v18\"></path>\n      </svg>\n    ),\n    down: (\n      <svg className=\"w-4 h-4 text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 14l-7 7m0 0l-7-7m7 7V3\"></path>\n      </svg>\n    ),\n    neutral: null,\n  };\n\n  return (\n    <Card className={cn(\n      \"shadow-md border\",\n      colorClasses[color].bg,\n      colorClasses[color].border\n    )}>\n      <CardContent className=\"p-5\">\n        <div className=\"flex justify-between items-start\">\n          <div>\n            <p className=\"text-sm font-medium text-slate-400\">{title}</p>\n            <p className={cn(\"text-2xl font-bold mt-1\", colorClasses[color].text)}>\n              {value}\n            </p>\n          </div>\n          \n          <div className={cn(\n            \"p-2 rounded-full\",\n            colorClasses[color].iconBg\n          )}>\n            {icon}\n          </div>\n        </div>\n        \n        {trend !== 'neutral' && (\n          <div className=\"flex items-center mt-3\">\n            {trendIcon[trend]}\n            <span className={cn(\n              \"text-xs ml-1\",\n              trend === 'up' ? 'text-emerald-400' : 'text-red-400'\n            )}>\n              {trend === 'up' ? 'Increasing' : 'Decreasing'}\n            </span>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","path":null,"size_bytes":3057,"size_tokens":null},"test-odds-setup.js":{"content":"// This script creates test accounts to validate the game odds system\nimport { db } from './server/db.js';\nimport { users, gameOdds } from './shared/schema.js';\nimport { eq } from 'drizzle-orm';\nimport bcrypt from 'bcrypt';\n\nasync function createTestSetup() {\n  try {\n    console.log('Starting test setup...');\n    \n    // Hash the password\n    const password = 'testing123';\n    const saltRounds = 10;\n    const hashedPassword = await bcrypt.hash(password, saltRounds);\n    \n    // Create or find test subadmin\n    let subadmin;\n    const existingSubadmin = await db.select().from(users).where(eq(users.username, 'oddstester'));\n    \n    if (existingSubadmin.length === 0) {\n      console.log('Creating new test subadmin...');\n      const [newSubadmin] = await db.insert(users).values({\n        username: 'oddstester',\n        email: 'oddstester@example.com',\n        password: hashedPassword,\n        mobile: '1234567890',\n        role: 'subadmin',\n        balance: 10000,\n        isBlocked: false\n      }).returning();\n      \n      subadmin = newSubadmin;\n    } else {\n      console.log('Using existing subadmin...');\n      subadmin = existingSubadmin[0];\n    }\n    \n    console.log(`Subadmin ID: ${subadmin.id}`);\n    \n    // Create or find test player\n    let player;\n    const existingPlayer = await db.select().from(users).where(eq(users.username, 'playertester'));\n    \n    if (existingPlayer.length === 0) {\n      console.log('Creating new test player...');\n      const [newPlayer] = await db.insert(users).values({\n        username: 'playertester',\n        email: 'playertester@example.com',\n        password: hashedPassword,\n        mobile: '9876543210',\n        role: 'player',\n        balance: 5000,\n        assignedTo: subadmin.id,\n        isBlocked: false\n      }).returning();\n      \n      player = newPlayer;\n    } else {\n      console.log('Using existing player...');\n      player = existingPlayer[0];\n      \n      // Ensure player is assigned to our test subadmin\n      if (player.assignedTo !== subadmin.id) {\n        await db.update(users)\n          .set({ assignedTo: subadmin.id })\n          .where(eq(users.id, player.id));\n        console.log(`Updated player to be assigned to subadmin ID: ${subadmin.id}`);\n      }\n    }\n    \n    console.log(`Player ID: ${player.id}`);\n    \n    // Set custom coin flip odds for the subadmin (different from platform default)\n    const existingOdds = await db.select()\n      .from(gameOdds)\n      .where(eq(gameOdds.gameType, 'coin_flip'))\n      .where(eq(gameOdds.subadminId, subadmin.id));\n    \n    const customOddValue = 210; // 2.10x (stored as 210 in DB)\n    \n    if (existingOdds.length === 0) {\n      console.log('Creating new custom odds...');\n      await db.insert(gameOdds).values({\n        gameType: 'coin_flip',\n        oddValue: customOddValue,\n        setByAdmin: false,\n        subadminId: subadmin.id\n      });\n    } else {\n      console.log('Updating existing odds...');\n      await db.update(gameOdds)\n        .set({ oddValue: customOddValue })\n        .where(eq(gameOdds.gameType, 'coin_flip'))\n        .where(eq(gameOdds.subadminId, subadmin.id));\n    }\n    \n    console.log(`Set custom coin flip odds for subadmin to ${customOddValue/100}x`);\n    \n    // Print login details\n    console.log('\\nTest setup completed successfully!');\n    console.log('Login credentials:');\n    console.log(`Subadmin: username=oddstester, password=${password}`);\n    console.log(`Player: username=playertester, password=${password}`);\n    \n  } catch (error) {\n    console.error('Error in test setup:', error);\n  }\n}\n\ncreateTestSetup();","path":null,"size_bytes":3595,"size_tokens":null},"migrate-game-odds.js":{"content":"/**\n * This script creates the game_odds table in the database\n * Run this to fix the game odds error in subadmin management\n */\nimport 'dotenv/config';\nimport pg from 'pg';\n\nasync function createGameOddsTable() {\n  const client = new pg.Client({\n    connectionString: process.env.DATABASE_URL\n  });\n\n  try {\n    await client.connect();\n    console.log('Connected to database');\n    \n    console.log('Creating game_odds table...');\n    \n    await client.query(`\n      CREATE TABLE IF NOT EXISTS game_odds (\n        id SERIAL PRIMARY KEY,\n        game_type TEXT NOT NULL,\n        odd_value INTEGER NOT NULL,\n        set_by_admin BOOLEAN NOT NULL DEFAULT true,\n        subadmin_id INTEGER REFERENCES users(id) ON DELETE CASCADE,\n        is_active BOOLEAN NOT NULL DEFAULT true,\n        created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n        updated_at TIMESTAMP NOT NULL DEFAULT NOW()\n      );\n    `);\n    \n    console.log('game_odds table created successfully!');\n\n    // Adding default game odds\n    console.log('Setting up default game odds...');\n    \n    // Default game types and their odds\n    const defaultOdds = [\n      { gameType: 'coin_flip', oddValue: 19500 }, // 1.95\n      { gameType: 'cricket_toss', oddValue: 19000 }, // 1.90\n      { gameType: 'satamatka_jodi', oddValue: 900000 }, // 90.00\n      { gameType: 'satamatka_harf', oddValue: 90000 }, // 9.00\n      { gameType: 'satamatka_odd_even', oddValue: 19000 }, // 1.90\n      { gameType: 'satamatka_crossing', oddValue: 950000 }, // 95.00\n    ];\n    \n    for (const odd of defaultOdds) {\n      // We need to modify this because ON CONFLICT requires a unique constraint\n      // First check if record exists\n      const existingRecord = await client.query(\n        'SELECT * FROM game_odds WHERE game_type = $1 AND set_by_admin = true',\n        [odd.gameType]\n      );\n      \n      if (existingRecord.rows.length > 0) {\n        // Update existing record\n        await client.query(\n          'UPDATE game_odds SET odd_value = $1, updated_at = NOW() WHERE game_type = $2 AND set_by_admin = true',\n          [odd.oddValue, odd.gameType]\n        );\n      } else {\n        // Insert new record\n        await client.query(\n          'INSERT INTO game_odds (game_type, odd_value, set_by_admin) VALUES ($1, $2, true)',\n          [odd.gameType, odd.oddValue]\n        );\n      }\n    }\n    \n    console.log('Default game odds set up successfully!');\n    \n  } catch (error) {\n    console.error('Error creating game_odds table:', error);\n  } finally {\n    await client.end();\n    console.log('Database connection closed');\n  }\n}\n\ncreateGameOddsTable();","path":null,"size_bytes":2601,"size_tokens":null},"client/src/components/stats-card.tsx":{"content":"import { Card } from \"@/components/ui/card\";\n\ninterface StatsCardProps {\n  winRate: number;\n  totalBets: number;\n  showFullWidth?: boolean;\n}\n\nexport default function StatsCard({ winRate, totalBets, showFullWidth = false }: StatsCardProps) {\n  return (\n    <Card className={`bg-slate-900/70 shadow-lg border border-slate-800 p-4 ${showFullWidth ? 'w-full' : 'w-full lg:w-auto'}`}>\n        <div className=\"flex items-center justify-between w-full\">\n          <div>\n            <p className=\"text-sm text-slate-400\">Win Rate</p>\n            <p className=\"text-xl font-bold text-emerald-400\">{winRate}%</p>\n          </div>\n          <div className=\"mx-4 h-10 border-r border-slate-800\"></div>\n          <div>\n            <p className=\"text-sm text-slate-400\">Total Bets</p>\n            <p className=\"text-xl font-bold text-amber-300\">{totalBets}</p>\n          </div>\n          \n          {showFullWidth && (\n            <>\n              <div className=\"mx-4 h-10 border-r border-slate-800\"></div>\n              <div>\n                <p className=\"text-sm text-slate-400\">Wins</p>\n                <p className=\"text-xl font-bold text-indigo-400\">{Math.round(totalBets * (winRate / 100))}</p>\n              </div>\n              <div className=\"mx-4 h-10 border-r border-slate-800\"></div>\n              <div>\n                <p className=\"text-sm text-slate-400\">Losses</p>\n                <p className=\"text-xl font-bold text-slate-300\">{totalBets - Math.round(totalBets * (winRate / 100))}</p>\n              </div>\n            </>\n          )}\n        </div>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1575,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n        success:\n          \"success group border border-green-600 bg-gradient-to-r from-green-600 to-green-500 text-white\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600 group-[.success]:text-white/70 group-[.success]:hover:text-white\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":5034,"size_tokens":null},"migrate-all-passwords.js":{"content":"/**\n * This script migrates all user passwords to the crypto.scrypt format \n * for consistent password handling throughout the system.\n */\n\nimport pg from 'pg';\nimport crypto from 'crypto';\nimport { promisify } from 'util';\nimport bcryptjs from 'bcryptjs';\n\n// Promisify the scrypt function\nconst scryptAsync = promisify(crypto.scrypt);\n\n// Connect to the database\nconst { Pool } = pg;\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL\n});\n\n// Function to hash password with crypto.scrypt\nasync function hashPassword(password) {\n  const salt = crypto.randomBytes(16).toString('hex');\n  const buf = await scryptAsync(password, salt, 64);\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nasync function comparePasswords(supplied, stored) {\n  try {\n    // Check if it's a bcrypt hash (starts with $2a$, $2b$, or $2y$)\n    if (stored.startsWith('$2a$') || stored.startsWith('$2b$') || stored.startsWith('$2y$')) {\n      try {\n        return await bcryptjs.compare(supplied, stored);\n      } catch (err) {\n        console.error('Error comparing bcrypt password:', err);\n        return false;\n      }\n    } else {\n      console.log('Password is not in bcrypt format');\n      return false;\n    }\n  } catch (error) {\n    console.error(\"Error in comparePasswords:\", error);\n    return false;\n  }\n}\n\nasync function migratePasswords() {\n  try {\n    console.log('Starting password migration for all users...');\n\n    // Collect all users with bcrypt passwords\n    const userResult = await pool.query(\n      \"SELECT id, username, role, password FROM users WHERE password LIKE '$2%'\"\n    );\n\n    console.log(`Found ${userResult.rowCount} users with bcrypt passwords to migrate`);\n\n    if (userResult.rowCount === 0) {\n      console.log('No users with bcrypt passwords found. Migration complete.');\n      return;\n    }\n\n    const defaultPasswords = {\n      'admin': 'admin123',\n      'subadmin': 'subadmin123',\n      'player': 'player123'\n    };\n\n    // Process each user\n    for (const user of userResult.rows) {\n      try {\n        // Default fallback password based on role\n        const fallbackPassword = defaultPasswords[user.role] || 'password123';\n        \n        // Generate new password hash using crypto.scrypt\n        const newPasswordHash = await hashPassword(fallbackPassword);\n        \n        // Update user's password\n        await pool.query(\n          'UPDATE users SET password = $1 WHERE id = $2',\n          [newPasswordHash, user.id]\n        );\n        \n        console.log(`Migrated password for ${user.username} (ID: ${user.id}) to crypto.scrypt format`);\n      } catch (error) {\n        console.error(`Error migrating password for user ${user.username} (ID: ${user.id}):`, error);\n      }\n    }\n\n    console.log('Password migration completed successfully');\n  } catch (error) {\n    console.error('Error during password migration:', error);\n  } finally {\n    await pool.end();\n  }\n}\n\n// Run the migration\nmigratePasswords();","path":null,"size_bytes":2949,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/pages/satamatka-game-page.tsx":{"content":"import SatamatkaGame from \"@/components/satamatka-game\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { useParams } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { getQueryFn } from \"@/lib/queryClient\";\n\nexport default function SatamatkaGamePage() {\n  const { id } = useParams<{ id: string }>();\n  const marketId = parseInt(id || \"0\");\n  \n  // Get market name for the page title\n  const { data: market } = useQuery({\n    queryKey: [\"/api/satamatka/markets\", marketId],\n    queryFn: getQueryFn({ on401: \"throw\" }),\n    enabled: !!marketId,\n  });\n\n  return (\n    <DashboardLayout title={market?.name || \"Market Game\"}>\n      <SatamatkaGame />\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":719,"size_tokens":null},"create-test-admin.ts":{"content":"import { db } from './server/db';\nimport bcrypt from 'bcrypt';\nimport { users } from './shared/schema';\nimport { UserRole } from './shared/schema';\n\nasync function createTestData() {\n  try {\n    console.log('Creating test admin and data for risk management testing...');\n    \n    // Create admin\n    const hashedPassword = await bcrypt.hash('admin123', 10);\n    \n    // Check if admin already exists\n    const existingAdmin = await db.select().from(users).where({ username: 'testadmin' }).execute();\n    \n    let adminId: number;\n    \n    if (existingAdmin.length === 0) {\n      const [admin] = await db.insert(users).values({\n        username: 'testadmin',\n        password: hashedPassword,\n        email: 'testadmin@example.com',\n        mobile: '1234567890',\n        role: UserRole.ADMIN,\n        balance: 1000000,\n        isBlocked: false\n      }).returning();\n      \n      adminId = admin.id;\n      console.log('Created test admin:', admin);\n    } else {\n      adminId = existingAdmin[0].id;\n      console.log('Using existing admin:', existingAdmin[0]);\n    }\n    \n    // Create subadmin\n    const existingSubadmin = await db.select().from(users).where({ username: 'testsubadmin' }).execute();\n    \n    let subadminId: number;\n    \n    if (existingSubadmin.length === 0) {\n      const [subadmin] = await db.insert(users).values({\n        username: 'testsubadmin',\n        password: hashedPassword,\n        email: 'testsubadmin@example.com',\n        mobile: '9876543210',\n        role: UserRole.SUBADMIN,\n        balance: 500000,\n        isBlocked: false,\n        assignedTo: adminId\n      }).returning();\n      \n      subadminId = subadmin.id;\n      console.log('Created test subadmin:', subadmin);\n    } else {\n      subadminId = existingSubadmin[0].id;\n      console.log('Using existing subadmin:', existingSubadmin[0]);\n    }\n    \n    // Create test players\n    for (let i = 1; i <= 3; i++) {\n      const username = `player${i}`;\n      const existingPlayer = await db.select().from(users).where({ username }).execute();\n      \n      if (existingPlayer.length === 0) {\n        const [player] = await db.insert(users).values({\n          username,\n          password: hashedPassword,\n          email: `${username}@example.com`,\n          mobile: `555000${i}`,\n          role: UserRole.PLAYER,\n          balance: 10000 * i,\n          isBlocked: false,\n          assignedTo: i % 2 === 0 ? adminId : subadminId\n        }).returning();\n        \n        console.log(`Created test player:`, player);\n      } else {\n        console.log(`Using existing player:`, existingPlayer[0]);\n      }\n    }\n    \n    console.log('\\nTest accounts created or verified successfully!');\n    console.log('Login credentials for all accounts:');\n    console.log('Password: admin123');\n    console.log('Usernames: testadmin, testsubadmin, player1, player2, player3');\n    \n  } catch (error) {\n    console.error('Error creating test data:', error);\n  }\n}\n\n// Run the function\ncreateTestData()\n  .then(() => console.log('Done!'))\n  .catch(err => console.error('Failed:', err))\n  .finally(() => process.exit(0));","path":null,"size_bytes":3087,"size_tokens":null},"client/src/components/responsive-header.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Menu, X, Wallet, ChevronDown, LogOut, User as UserIcon } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Sheet, \n  SheetContent, \n  SheetTrigger, \n  SheetClose \n} from \"@/components/ui/sheet\";\nimport { \n  DropdownMenu, \n  DropdownMenuContent, \n  DropdownMenuItem, \n  DropdownMenuTrigger,\n  DropdownMenuSeparator\n} from \"@/components/ui/dropdown-menu\";\nimport { UserRole } from \"@shared/schema\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\n\nexport default function ResponsiveHeader() {\n  const [_, setLocation] = useLocation();\n  const { user, logoutMutation } = useAuth();\n  const [isOpen, setIsOpen] = useState(false);\n\n  const handleLogout = () => {\n    logoutMutation.mutate();\n  };\n\n  const isAdmin = user?.role === UserRole.ADMIN;\n  const isSubadmin = user?.role === UserRole.SUBADMIN;\n\n  if (!user) {\n    // Public header for non-authenticated users\n    return (\n      <header className=\"w-full bg-card/50 border-b border-border py-4\">\n        <div className=\"container mx-auto px-4 flex justify-between items-center\">\n          <h1 className=\"text-2xl font-bold flex items-center gap-1 cursor-pointer hover:opacity-80 transition-opacity\" onClick={() => setLocation(\"/\")}>\n            <img src=\"/images/royal-k-logo.svg\" alt=\"Royal K Logo\" className=\"w-7 h-7\" />\n            <span className=\"text-primary\">King</span>\n            <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-primary\">Games</span>\n          </h1>\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              className=\"text-slate-300 hover:text-white hover:bg-slate-800/50\"\n              onClick={() => setLocation(\"/results\")}\n            >\n              Results\n            </Button>\n            <Button\n              className=\"bg-gradient-to-r from-primary to-blue-400 hover:from-primary/90 hover:to-blue-600\"\n              onClick={() => setLocation(\"/auth\")}\n            >\n              Login / Register\n            </Button>\n          </div>\n        </div>\n      </header>\n    );\n  }\n\n  // Authenticated header\n  return (\n    <header className=\"w-full bg-card/50 border-b border-border py-3 sticky top-0 z-40\">\n      <div className=\"container mx-auto px-4 flex justify-between items-center\">\n        <div className=\"flex items-center\">\n          <h1 className=\"text-2xl font-bold flex items-center gap-1\">\n            <img src=\"/images/royal-k-logo.svg\" alt=\"Royal K Logo\" className=\"w-7 h-7\" />\n            <span className=\"text-primary\">King</span>\n            <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-primary\">Games</span>\n          </h1>\n        </div>\n        \n        <div className=\"flex items-center\">\n          {/* Balance display - Always visible, even on mobile */}\n          <div className=\"mr-4 flex items-center bg-muted/50 px-3 py-1.5 rounded-full\">\n            <Wallet className=\"h-4 w-4 mr-2 text-primary\" />\n            <span className=\"font-medium\">{(user.balance / 100).toFixed(2)}</span>\n          </div>\n          \n          {/* User dropdown menu */}\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"outline\" size=\"icon\" className=\"rounded-full hover:bg-primary/10 border-primary/20\">\n                <Avatar className=\"h-9 w-9 bg-gradient-to-r from-primary to-blue-400\">\n                  <AvatarFallback className=\"text-white font-bold text-sm\">\n                    {user.username.charAt(0).toUpperCase()}\n                  </AvatarFallback>\n                </Avatar>\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-56\">\n              <div className=\"flex items-center gap-3 p-3 border-b border-border\">\n                <Avatar className=\"h-12 w-12 bg-gradient-to-r from-primary to-blue-400\">\n                  <AvatarFallback className=\"text-white font-bold text-lg\">\n                    {user.username.charAt(0).toUpperCase()}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <p className=\"font-medium\">{user.username}</p>\n                  <p className=\"text-xs text-muted-foreground capitalize\">{user.role}</p>\n                </div>\n              </div>\n              <div className=\"p-2 border-b border-border\">\n                <div className=\"p-2 bg-muted/50 rounded-lg flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <Wallet className=\"h-4 w-4 mr-2 text-primary\" />\n                    <span className=\"text-sm\">Balance</span>\n                  </div>\n                  <span className=\"font-medium text-sm\">{(user.balance / 100).toFixed(2)}</span>\n                </div>\n              </div>\n              <DropdownMenuItem onClick={() => setLocation(\"/profile\")} className=\"mt-1 flex items-center gap-2\">\n                <UserIcon className=\"h-4 w-4\" />\n                <span>Profile</span>\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={handleLogout} className=\"text-destructive focus:text-destructive flex items-center gap-2\">\n                <LogOut className=\"h-4 w-4\" />\n                <span>Logout</span>\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n          \n          {/* Mobile menu trigger - only shown on very small screens */}\n          <Sheet>\n            <SheetTrigger asChild className=\"lg:hidden ml-2\">\n              <Button variant=\"outline\" size=\"icon\">\n                <Menu className=\"h-5 w-5\" />\n              </Button>\n            </SheetTrigger>\n            <SheetContent side=\"right\">\n              <div className=\"flex flex-col h-full\">\n                <div className=\"flex justify-between items-center mb-6\">\n                  <h2 className=\"text-xl font-bold flex items-center gap-1\">\n                    <img src=\"/images/royal-k-logo.svg\" alt=\"Royal K Logo\" className=\"w-6 h-6\" />\n                    <span className=\"text-primary\">King</span>\n                    <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-primary\">Games</span>\n                  </h2>\n                  <SheetClose asChild>\n                    <Button variant=\"ghost\" size=\"icon\">\n                      <X className=\"h-5 w-5\" />\n                    </Button>\n                  </SheetClose>\n                </div>\n                \n                <div className=\"flex items-center mb-6 p-3 bg-muted/50 rounded-lg\">\n                  <Avatar className=\"h-12 w-12 bg-gradient-to-r from-primary to-blue-400 mr-3\">\n                    <AvatarFallback className=\"text-white font-bold text-lg\">\n                      {user.username.charAt(0).toUpperCase()}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div>\n                    <p className=\"font-medium\">{user.username}</p>\n                    <p className=\"text-xs text-muted-foreground capitalize\">{user.role}</p>\n                  </div>\n                </div>\n                \n                <div className=\"p-3 bg-muted/50 rounded-lg mb-6 flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <Wallet className=\"h-5 w-5 mr-2 text-primary\" />\n                    <span className=\"font-medium\">Balance</span>\n                  </div>\n                  <span className=\"font-bold\">{(user.balance / 100).toFixed(2)}</span>\n                </div>\n                \n                <div className=\"space-y-3 mt-4\">\n                  <SheetClose asChild>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full flex items-center justify-center gap-2\"\n                      onClick={() => setLocation(\"/profile\")}\n                    >\n                      <UserIcon className=\"h-4 w-4\" />\n                      My Profile\n                    </Button>\n                  </SheetClose>\n                  \n                  <SheetClose asChild>\n                    <Button \n                      variant=\"destructive\" \n                      className=\"w-full flex items-center justify-center gap-2\"\n                      onClick={handleLogout}\n                    >\n                      <LogOut className=\"h-4 w-4\" />\n                      Logout\n                    </Button>\n                  </SheetClose>\n                </div>\n                \n                <div className=\"mt-auto\"></div>\n              </div>\n            </SheetContent>\n          </Sheet>\n        </div>\n      </div>\n    </header>\n  );\n}","path":null,"size_bytes":8832,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"public/coin-flip-sound.js":{"content":"// Generate sound using the Web Audio API\nfunction generateCoinFlipSound() {\n  const audioContext = new AudioContext();\n  const oscillator = audioContext.createOscillator();\n  const gainNode = audioContext.createGain();\n  \n  oscillator.type = 'triangle';\n  oscillator.frequency.setValueAtTime(800, audioContext.currentTime);\n  oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);\n  \n  gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n  gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);\n  \n  oscillator.connect(gainNode);\n  gainNode.connect(audioContext.destination);\n  \n  oscillator.start();\n  oscillator.stop(audioContext.currentTime + 0.2);\n}\n\n// Generate and play the sound when the page loads\nwindow.addEventListener('DOMContentLoaded', generateCoinFlipSound);","path":null,"size_bytes":843,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-slate-900/70 text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1885,"size_tokens":null},"client/src/lib/format-utils.ts":{"content":"/**\n * Utility functions for formatting values consistently across the application\n */\n\n/**\n * Game types that store amounts in paisa (1 rupee = 100 paisa)\n */\nexport const PAISA_BASED_GAMES = ['coin_flip', 'team_match', 'cricket_toss', 'satamatka'];\n\n/**\n * Threshold for amount to be considered in paisa\n * (amounts 10000+ are likely in paisa)\n */\nexport const PAISA_THRESHOLD = 10000;\n\n/**\n * Format a currency amount consistently based on game type\n * \n * @param amount - The amount to format\n * @param gameType - The type of game (used to determine if amount is in paisa)\n * @param includeSymbol - Whether to include the  symbol\n * @param gameMode - Optional game mode for special cases like odd_even\n * @returns Formatted amount string\n */\nexport function formatCurrency(\n  amount: number, \n  gameType?: string, \n  includeSymbol = true, \n  gameMode?: string\n): string {\n  if (!amount && amount !== 0) return includeSymbol ? '0.00' : '0.00';\n  \n  // Determine if we need to convert from paisa to rupees\n  let convertedAmount = amount;\n  \n  // For safety, always convert large numbers (likely stored in paisa)\n  // This is the root cause of the 1,020,000.00 vs 10,200.00 issue\n  if (amount >= 1000) {\n    convertedAmount = amount / 100;\n  }\n  // Always convert for known paisa-based games regardless of amount size\n  else if (gameType && PAISA_BASED_GAMES.includes(gameType)) {\n    // All satamatka game modes (jodi, harf, crossing, odd_even) need to display in rupees\n    // Potential win amounts need to show in rupees (e.g., 900 for jodi) instead of paisa\n    convertedAmount = amount / 100;\n  } \n  // If no game type but amount looks like paisa (for backward compatibility)\n  else if (!gameType && amount >= PAISA_THRESHOLD) {\n    convertedAmount = amount / 100;\n  }\n  \n  // Format with 2 decimal places and add symbol if requested\n  const formattedAmount = convertedAmount.toFixed(2);\n  return includeSymbol ? `${formattedAmount}` : formattedAmount;\n}\n\n/**\n * Calculate and format profit/loss amount\n * \n * @param betAmount - Original bet amount\n * @param payout - Payout amount (0 if loss)\n * @param gameType - Type of game\n * @param result - Game result (optional)\n * @returns Formatted profit/loss string with sign\n */\nexport function formatProfitLoss(\n  betAmount: number, \n  payout: number, \n  gameType?: string, \n  result?: string | null\n): string {\n  const isPaisaBased = gameType && PAISA_BASED_GAMES.includes(gameType);\n  \n  // Convert to rupees if needed\n  let normalizedBet = betAmount;\n  let normalizedPayout = payout;\n  \n  // Always convert for paisa-based games\n  if (isPaisaBased) {\n    normalizedBet = betAmount / 100;\n    normalizedPayout = payout / 100;\n  }\n  // For backward compatibility with non-typed amounts\n  else if (!gameType && betAmount >= PAISA_THRESHOLD) {\n    normalizedBet = betAmount / 100;\n    normalizedPayout = payout / 100;\n  }\n  \n  // Different calculation based on game state\n  let profitLoss: number;\n  \n  // If the result is not set (pending game), show as \"potential win/loss\"\n  if (!result || result === 'pending') {\n    // For pending games, show the potential win amount (this will be positive)\n    profitLoss = normalizedPayout - normalizedBet;\n  } else {\n    // For games with a result, calculate actual win/loss\n    if (gameType === 'cricket_toss') {\n      // For cricket toss games with a result declared\n      if (result === 'team_a' || result === 'team_b') {\n        if (normalizedPayout > 0) {\n          // Player won - show the FULL payout amount as profit (not just profit)\n          // This matches what admin declared and what user expects\n          profitLoss = normalizedPayout;\n        } else {\n          // Player lost - show negative bet amount as the loss\n          profitLoss = -normalizedBet;\n        }\n      } else {\n        // If result is invalid or unexpected, fall back to default calculation\n        profitLoss = normalizedPayout > 0 ? normalizedPayout : -normalizedBet;\n      }\n    } else {\n      // For other game types, use the standard calculation\n      // If payout is 0, the player lost - show negative bet amount\n      if (normalizedPayout <= 0) {\n        profitLoss = -normalizedBet;\n      } else {\n        // Player won - show the full payout amount (including original bet)\n        profitLoss = normalizedPayout;\n      }\n    }\n  }\n  \n  // Format with sign and 2 decimal places\n  // No additional division needed as we already converted from paisa to rupees above\n  // Removing this condition as it's causing 800 rupees to display as 15.60 instead of 1560\n  \n  return `${profitLoss > 0 ? '+' : ''}${Math.abs(profitLoss).toFixed(2)}`;\n}\n\n/**\n * Format bet amount for display in forms\n * @param amount - Current amount (might be in paisa)\n * @param gameType - Game type\n * @returns Amount ready for display in input field\n */\nexport function formatBetAmountForInput(amount: number, gameType?: string): string {\n  if (!amount) return '';\n  \n  const isPaisaBased = gameType && PAISA_BASED_GAMES.includes(gameType);\n  \n  // Always convert for paisa-based games\n  if (isPaisaBased) {\n    return (amount / 100).toString();\n  }\n  // For backward compatibility\n  else if (!gameType && amount >= PAISA_THRESHOLD) {\n    return (amount / 100).toString();\n  }\n  \n  return amount.toString();\n}\n\n/**\n * Parse user input to internal amount format\n * @param value - User input value\n * @param gameType - Game type\n * @returns Amount in the correct format for storage\n */\nexport function parseInputAmount(value: string, gameType?: string): number {\n  const parsed = parseFloat(value);\n  if (isNaN(parsed)) return 0;\n  \n  const isPaisaBased = gameType && PAISA_BASED_GAMES.includes(gameType);\n  \n  // For paisa-based games, multiply by 100 to convert to paisa\n  if (isPaisaBased) {\n    return parsed * 100;\n  }\n  \n  return parsed;\n}","path":null,"size_bytes":5822,"size_tokens":null},"server/reset-system.ts":{"content":"import express, { Request, Response, NextFunction } from \"express\";\nimport { UserRole } from \"@shared/schema\";\nimport { storage } from \"./storage\";\nimport { db } from \"./db\";\nimport {\n  games,\n  satamatkaMarkets,\n  teamMatches,\n  transactions,\n  users\n} from \"@shared/schema\";\nimport { eq, ne } from \"drizzle-orm\";\nimport { z } from \"zod\";\n\n// Validation schema for reset request\nconst resetRequestSchema = z.object({\n  resetType: z.enum([\"all\", \"games\", \"transactions\", \"balance\"]),\n  confirmationCode: z.string().refine(\n    val => val === \"RESET_CONFIRM\",\n    { message: \"Invalid confirmation code\" }\n  )\n});\n\n// Router for reset system endpoints\nconst router = express.Router();\n\n/**\n * Reset system data\n * POST /api/admin/reset-system\n */\nrouter.post(\"/reset-system\", async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    if (!req.isAuthenticated() || req.user.role !== UserRole.ADMIN) {\n      return res.status(403).json({ message: \"Forbidden: Only admin can perform system reset\" });\n    }\n\n    // Validate request\n    const validatedData = resetRequestSchema.parse(req.body);\n    const { resetType } = validatedData;\n\n    // Perform reset based on type\n    switch (resetType) {\n      case \"all\":\n        await resetAllData();\n        break;\n      case \"games\":\n        await resetGameData();\n        break;\n      case \"transactions\":\n        await resetTransactionData();\n        break;\n      case \"balance\":\n        await resetUserBalances();\n        break;\n    }\n\n    return res.status(200).json({\n      success: true,\n      message: `System ${resetType} reset completed successfully`\n    });\n  } catch (error: any) {\n    console.error(\"Reset system error:\", error);\n    return res.status(400).json({\n      message: error.message || \"An error occurred during system reset\"\n    });\n  }\n});\n\n/**\n * Reset all data in the system except admin accounts\n */\nasync function resetAllData() {\n  await db.transaction(async (tx) => {\n    // Delete all games\n    await tx.delete(games);\n    \n    // Delete all markets\n    await tx.delete(satamatkaMarkets);\n    \n    // Delete all team matches\n    await tx.delete(teamMatches);\n    \n    // Delete all transactions\n    await tx.delete(transactions);\n    \n    // Reset all user balances except admin\n    await tx.update(users)\n      .set({ balance: 0 })\n      .where(ne(users.role, UserRole.ADMIN));\n  });\n}\n\n/**\n * Reset only game-related data\n */\nasync function resetGameData() {\n  await db.transaction(async (tx) => {\n    // Delete all games\n    await tx.delete(games);\n    \n    // Delete all markets\n    await tx.delete(satamatkaMarkets);\n    \n    // Delete all team matches\n    await tx.delete(teamMatches);\n  });\n}\n\n/**\n * Reset all transactions and balances\n */\nasync function resetTransactionData() {\n  await db.transaction(async (tx) => {\n    // Delete all transactions\n    await tx.delete(transactions);\n    \n    // Reset all user balances except admin\n    await tx.update(users)\n      .set({ balance: 0 })\n      .where(ne(users.role, UserRole.ADMIN));\n  });\n}\n\n/**\n * Reset user balances only\n */\nasync function resetUserBalances() {\n  await db.transaction(async (tx) => {\n    // Reset all user balances except admin\n    await tx.update(users)\n      .set({ balance: 0 })\n      .where(ne(users.role, UserRole.ADMIN));\n  });\n}\n\nexport default router;","path":null,"size_bytes":3324,"size_tokens":null},"add-simple-admin.ts":{"content":"import { db } from './server/db';\nimport bcrypt from 'bcrypt';\nimport { users } from './shared/schema';\nimport { UserRole } from './shared/schema';\n\nasync function createAdminUser() {\n  try {\n    console.log('Creating simple admin user for testing...');\n    \n    // Hash password\n    const password = 'admin123';\n    const hashedPassword = await bcrypt.hash(password, 10);\n    \n    // Insert admin user directly\n    const [admin] = await db.insert(users).values({\n      username: 'admin',\n      password: hashedPassword,\n      email: 'admin@example.com',\n      mobile: '1234567890',\n      role: UserRole.ADMIN,\n      balance: 1000000,\n      isBlocked: false\n    }).returning();\n    \n    console.log('Created admin user:', admin);\n    console.log('Login with:');\n    console.log('Username: admin');\n    console.log('Password: admin123');\n    \n  } catch (error) {\n    console.error('Error creating admin user:', error);\n  }\n}\n\n// Run the function\ncreateAdminUser()\n  .then(() => console.log('Done!'))\n  .catch(err => console.error('Failed:', err));","path":null,"size_bytes":1046,"size_tokens":null},"client/src/pages/wallet-page-old.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Loader2, ArrowUp, ArrowDown, FileCheck, CheckCircle, XCircle, Clock, IndianRupee, Wallet, History, Ban, CheckCircle2, CircleDollarSign, Landmark, Banknote, RefreshCw, CreditCard, User } from \"lucide-react\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { \n  Pagination, \n  PaginationContent, \n  PaginationEllipsis, \n  PaginationItem, \n  PaginationLink, \n  PaginationNext, \n  PaginationPrevious \n} from \"@/components/ui/pagination\";\nimport { formatDistance } from \"date-fns\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useLocation } from \"wouter\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { PaymentMode, RequestType, RequestStatus, WalletRequest, PaymentDetails } from \"@/lib/types\";\n\n// API response type for payment details\ninterface SystemPaymentDetails {\n  upi?: {\n    id: string;\n    qrCode: string | null;\n  };\n  bank?: {\n    name: string;\n    accountNumber: string;\n    ifscCode: string;\n    accountHolder: string;\n  };\n}\n\n// Form schemas\nconst depositFormSchema = z.object({\n  amount: z.coerce.number().min(100, \"Minimum deposit amount is 100\").max(100000, \"Maximum deposit amount is 100,000\"),\n  paymentMode: z.enum([\"upi\", \"bank\"]),\n  paymentDetails: z.object({\n    upiId: z.string().optional(),\n    transactionId: z.string().optional(),\n    utrNumber: z.string().optional(),\n    bankName: z.string().optional(),\n    accountNumber: z.string().optional(),\n    ifscCode: z.string().optional(),\n  }),\n  notes: z.string().optional(),\n});\n\nconst withdrawalFormSchema = z.object({\n  amount: z.coerce.number().min(500, \"Minimum withdrawal amount is 500\").max(50000, \"Maximum withdrawal amount is 50,000\"),\n  paymentMode: z.enum([\"upi\", \"bank\"]),\n  paymentDetails: z.object({\n    upiId: z.string().optional(),\n    bankName: z.string().optional(),\n    accountNumber: z.string().optional(),\n    ifscCode: z.string().optional(),\n  }),\n  notes: z.string().optional(),\n});\n\ntype DepositFormValues = z.infer<typeof depositFormSchema>;\ntype WithdrawalFormValues = z.infer<typeof withdrawalFormSchema>;\n\nexport default function WalletPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [location, setLocation] = useLocation();\n  \n  // Extract tab parameter from URL or default to \"balance\"\n  const getTabFromUrl = () => {\n    const searchParams = new URLSearchParams(window.location.search);\n    const tab = searchParams.get('tab');\n    \n    // Check if user is a direct player (assigned to admin or null)\n    const isDirectPlayer = user?.role === \"player\" && (!user.assignedTo || user.assignedTo === 1);\n    \n    // Only direct players can access deposit/withdraw tabs\n    if (!isDirectPlayer && (tab === 'deposit' || tab === 'withdraw')) {\n      return 'balance';\n    }\n    \n    // Only allow valid tabs\n    return tab === 'deposit' || tab === 'withdraw' || tab === 'history' ? tab : 'balance';\n  };\n  \n  const [activeTab, setActiveTab] = useState(getTabFromUrl());\n  const [proofImage, setProofImage] = useState<File | null>(null);\n  const [paymentModeDetails, setPaymentModeDetails] = useState<PaymentDetails | null>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [itemsPerPage, setItemsPerPage] = useState(20);\n  \n  // Update URL when tab changes\n  const updateTab = (tab: string) => {\n    setActiveTab(tab);\n    // Update URL with tab parameter\n    const searchParams = new URLSearchParams(window.location.search);\n    searchParams.set('tab', tab);\n    const newUrl = `${window.location.pathname}?${searchParams.toString()}`;\n    window.history.replaceState(null, '', newUrl);\n  };\n\n  // Fetch payment details from the system\n  const { data: systemPaymentDetails, isLoading: loadingPaymentDetails } = useQuery<SystemPaymentDetails>({\n    queryKey: [\"/api/wallet/payment-details\"],\n    queryFn: async ({ queryKey }) => {\n      const res = await fetch(queryKey[0] as string, {\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        throw new Error(\"Failed to fetch payment details\");\n      }\n      const data = await res.json();\n      return data;\n    }\n  });\n  \n  // Set payment details when they are fetched\n  useEffect(() => {\n    if (systemPaymentDetails) {\n      // Transform the API response to match the expected structure\n      // Use exactly what the admin has set in payment settings\n      const transformedDetails: PaymentDetails = {\n        upiDetails: systemPaymentDetails.upi ? {\n          upiId: systemPaymentDetails.upi.id,\n          qrImageUrl: systemPaymentDetails.upi.qrCode || undefined\n        } : undefined,\n        bankDetails: systemPaymentDetails.bank ? {\n          accountName: systemPaymentDetails.bank.accountHolder,\n          accountNumber: systemPaymentDetails.bank.accountNumber,\n          ifscCode: systemPaymentDetails.bank.ifscCode,\n          bankName: systemPaymentDetails.bank.name\n        } : undefined\n      };\n      \n      setPaymentModeDetails(transformedDetails);\n    }\n  }, [systemPaymentDetails]);\n\n  // Fetch user's wallet requests\n  const { \n    data: walletRequests = [], \n    isLoading: loadingRequests,\n    refetch: refetchRequests\n  } = useQuery<WalletRequest[]>({\n    queryKey: [\"/api/wallet/my-requests\"],\n    enabled: activeTab === \"history\" || activeTab === \"balance\",\n  });\n  \n  // Fetch user's direct transactions (fund transfers, etc.)\n  const {\n    data: transactions = [],\n    isLoading: loadingTransactions,\n    refetch: refetchTransactions\n  } = useQuery<any[]>({\n    queryKey: [\"/api/transactions\"],\n    enabled: activeTab === \"history\" || activeTab === \"balance\"\n  });\n\n  // File upload handler\n  const handleProofImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      setProofImage(e.target.files[0]);\n    }\n  };\n\n  // Upload proof image\n  const uploadProofImage = async (file: File): Promise<string> => {\n    const formData = new FormData();\n    formData.append(\"proofImage\", file);\n\n    try {\n      const res = await fetch('/api/upload/proof', {\n        method: 'POST',\n        body: formData\n      });\n\n      if (!res.ok) {\n        throw new Error(\"Failed to upload image\");\n      }\n\n      const data = await res.json();\n      return data.imageUrl;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  // Form for handling deposits\n  const depositForm = useForm<DepositFormValues>({\n    resolver: zodResolver(depositFormSchema),\n    defaultValues: {\n      amount: 0,\n      paymentMode: \"upi\",\n      paymentDetails: {},\n      notes: \"\",\n    },\n  });\n\n  // Form for handling withdrawals\n  const withdrawalForm = useForm<WithdrawalFormValues>({\n    resolver: zodResolver(withdrawalFormSchema),\n    defaultValues: {\n      amount: 0,\n      paymentMode: \"upi\",\n      paymentDetails: {},\n      notes: \"\",\n    },\n  });\n\n  // Create wallet request mutation\n  const createRequestMutation = useMutation({\n    mutationFn: async (data: {\n      amount: number;\n      requestType: RequestType;\n      paymentMode: PaymentMode;\n      paymentDetails: Record<string, string>;\n      proofImageUrl?: string;\n      notes?: string;\n    }) => {\n      const res = await apiRequest(\"POST\", \"/api/wallet/requests\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Request Submitted\",\n        description: \"Your request has been submitted successfully and is pending approval.\",\n      });\n      // Reset forms\n      depositForm.reset();\n      withdrawalForm.reset();\n      setProofImage(null);\n      \n      // Refetch user data to update balance\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      \n      // Refetch transactions data\n      refetchRequests();\n      refetchTransactions();\n      \n      // Switch to history tab\n      updateTab(\"history\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Request Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Handle deposit form submission\n  const handleDepositSubmit = async (values: DepositFormValues) => {\n    try {\n      // Filter out undefined values from payment details\n      const paymentDetails: Record<string, string> = {};\n      Object.entries(values.paymentDetails).forEach(([key, value]) => {\n        if (value) paymentDetails[key] = value;\n      });\n\n      // Proof image is required for all payment methods\n      if (!proofImage) {\n        toast({\n          title: \"Error\",\n          description: \"Please upload proof of payment\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      let imageUrl = undefined;\n      \n      // Upload proof image\n      if (proofImage) {\n        try {\n          imageUrl = await uploadProofImage(proofImage);\n        } catch (uploadError) {\n          toast({\n            title: \"Upload Failed\",\n            description: \"Failed to upload payment proof. Please try again.\",\n            variant: \"destructive\",\n          });\n          return;\n        }\n      }\n\n      // Create deposit request\n      await createRequestMutation.mutateAsync({\n        amount: values.amount,\n        requestType: RequestType.DEPOSIT,\n        paymentMode: values.paymentMode as PaymentMode,\n        paymentDetails,\n        proofImageUrl: imageUrl,\n        notes: values.notes,\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Deposit Request Failed\",\n        description: error.message || \"An error occurred while processing your deposit request.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Handle withdrawal form submission\n  const handleWithdrawalSubmit = async (values: WithdrawalFormValues) => {\n    try {\n      // Check if user has sufficient balance\n      if (user && user.balance < values.amount) {\n        toast({\n          title: \"Insufficient Balance\",\n          description: \"You don't have enough balance for this withdrawal.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Filter out undefined values from payment details\n      const paymentDetails: Record<string, string> = {};\n      Object.entries(values.paymentDetails).forEach(([key, value]) => {\n        if (value) paymentDetails[key] = value;\n      });\n\n      // Create withdrawal request\n      await createRequestMutation.mutateAsync({\n        amount: values.amount,\n        requestType: RequestType.WITHDRAWAL,\n        paymentMode: values.paymentMode as PaymentMode,\n        paymentDetails,\n        notes: values.notes,\n      });\n      \n      // Success notification handled by the createRequestMutation onSuccess\n      \n    } catch (error: any) {\n      toast({\n        title: \"Withdrawal Request Failed\",\n        description: error.message || \"An error occurred while processing your withdrawal request.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Get color and icon for request status\n  const getStatusInfo = (status: RequestStatus) => {\n    switch (status) {\n      case RequestStatus.APPROVED:\n        return { \n          color: \"text-green-600\", \n          bgColor: \"bg-green-100\", \n          icon: <CheckCircle className=\"h-5 w-5 text-green-600\" />\n        };\n      case RequestStatus.REJECTED:\n        return { \n          color: \"text-red-600\", \n          bgColor: \"bg-red-100\", \n          icon: <XCircle className=\"h-5 w-5 text-red-600\" />\n        };\n      case RequestStatus.PENDING:\n      default:\n        return { \n          color: \"text-yellow-600\", \n          bgColor: \"bg-yellow-100\", \n          icon: <Clock className=\"h-5 w-5 text-yellow-600\" />\n        };\n    }\n  };\n\n  // Get title and icon for request type\n  const getRequestTypeInfo = (type: RequestType) => {\n    switch (type) {\n      case RequestType.DEPOSIT:\n        return { \n          title: \"Deposit\", \n          icon: <ArrowDown className=\"h-5 w-5 text-green-600\" />\n        };\n      case RequestType.WITHDRAWAL:\n        return { \n          title: \"Withdrawal\", \n          icon: <ArrowUp className=\"h-5 w-5 text-blue-600\" />\n        };\n      default:\n        return { \n          title: \"Unknown\", \n          icon: null\n        };\n    }\n  };\n\n  // Format date for display\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-IN', {\n      day: '2-digit',\n      month: 'short',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  // Payment mode fields - what to show based on selected payment mode\n  const renderDepositPaymentFields = () => {\n    const paymentMode = depositForm.watch(\"paymentMode\");\n    \n    switch (paymentMode) {\n      case \"upi\":\n        return (\n          <>\n            <div className=\"space-y-2\">\n\n              <FormField\n                control={depositForm.control}\n                name=\"paymentDetails.utrNumber\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>UTR Number</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter UTR number\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            {/* Display system UPI details */}\n            {paymentModeDetails?.upiDetails && (\n              <div className=\"mt-4 p-4 rounded-lg bg-slate-900/70 border border-slate-800 text-slate-300\">\n                <div className=\"flex items-center gap-3 mb-2\">\n                  <div className=\"p-2 rounded-full bg-gradient-to-r from-violet-600 to-fuchsia-600\">\n                    <FileCheck className=\"h-4 w-4 text-white\" />\n                  </div>\n                  <h3 className=\"text-lg font-semibold text-fuchsia-300\">UPI Payment Details</h3>\n                </div>\n                <div className=\"pl-9\">\n                  <div className=\"mt-2 flex items-center gap-2\">\n                    <p className=\"text-slate-300\"><strong className=\"text-slate-200\">UPI ID:</strong> {paymentModeDetails.upiDetails.upiId}</p>\n                    <Button \n                      type=\"button\" \n                      variant=\"ghost\" \n                      size=\"icon\" \n                      className=\"h-6 w-6 rounded-md bg-slate-800 hover:bg-slate-700 text-slate-300\"\n                      onClick={() => {\n                        if (paymentModeDetails?.upiDetails?.upiId) {\n                          navigator.clipboard.writeText(paymentModeDetails.upiDetails.upiId);\n                          toast({\n                            title: \"Copied!\",\n                            description: \"UPI ID copied to clipboard\",\n                          });\n                        }\n                      }}\n                    >\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\"/><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"/></svg>\n                    </Button>\n                  </div>\n                  {paymentModeDetails.upiDetails.qrImageUrl && (\n                    <div className=\"mt-3\">\n                      <p className=\"text-slate-200 font-medium\">Scan QR Code:</p>\n                      <img \n                        src={paymentModeDetails.upiDetails.qrImageUrl} \n                        alt=\"UPI QR Code\" \n                        className=\"w-48 h-48 mt-2 border border-slate-700 rounded-md\"\n                      />\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </>\n        );\n      \n      case \"bank\":\n        return (\n          <>\n            <div className=\"space-y-2\">\n              <FormField\n                control={depositForm.control}\n                name=\"paymentDetails.transactionId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Transaction Reference</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter bank transfer reference\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            {/* Display system bank details */}\n            {paymentModeDetails?.bankDetails && (\n              <div className=\"mt-4 p-4 rounded-lg bg-slate-900/70 border border-slate-800 text-slate-300\">\n                <div className=\"flex items-center gap-3 mb-2\">\n                  <div className=\"p-2 rounded-full bg-gradient-to-r from-violet-600 to-fuchsia-600\">\n                    <FileCheck className=\"h-4 w-4 text-white\" />\n                  </div>\n                  <h3 className=\"text-lg font-semibold text-fuchsia-300\">Bank Transfer Details</h3>\n                </div>\n                <div className=\"pl-9\">\n                  <div className=\"mt-2 flex items-center gap-2\">\n                    <p className=\"text-slate-300\"><strong className=\"text-slate-200\">Account Name:</strong> {paymentModeDetails.bankDetails.accountName}</p>\n                    <Button \n                      type=\"button\" \n                      variant=\"ghost\" \n                      size=\"icon\" \n                      className=\"h-6 w-6 rounded-md bg-slate-800 hover:bg-slate-700 text-slate-300\"\n                      onClick={() => {\n                        if (paymentModeDetails?.bankDetails?.accountName) {\n                          navigator.clipboard.writeText(paymentModeDetails.bankDetails.accountName);\n                          toast({\n                            title: \"Copied!\",\n                            description: \"Account name copied to clipboard\",\n                          });\n                        }\n                      }}\n                    >\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\"/><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"/></svg>\n                    </Button>\n                  </div>\n                  \n                  <div className=\"mt-1 flex items-center gap-2\">\n                    <p className=\"text-slate-300\"><strong className=\"text-slate-200\">Account Number:</strong> {paymentModeDetails.bankDetails.accountNumber}</p>\n                    <Button \n                      type=\"button\" \n                      variant=\"ghost\" \n                      size=\"icon\" \n                      className=\"h-6 w-6 rounded-md bg-slate-800 hover:bg-slate-700 text-slate-300\"\n                      onClick={() => {\n                        if (paymentModeDetails?.bankDetails?.accountNumber) {\n                          navigator.clipboard.writeText(paymentModeDetails.bankDetails.accountNumber);\n                          toast({\n                            title: \"Copied!\",\n                            description: \"Account number copied to clipboard\",\n                          });\n                        }\n                      }}\n                    >\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\"/><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"/></svg>\n                    </Button>\n                  </div>\n                  \n                  <div className=\"mt-1 flex items-center gap-2\">\n                    <p className=\"text-slate-300\"><strong className=\"text-slate-200\">IFSC Code:</strong> {paymentModeDetails.bankDetails.ifscCode}</p>\n                    <Button \n                      type=\"button\" \n                      variant=\"ghost\" \n                      size=\"icon\" \n                      className=\"h-6 w-6 rounded-md bg-slate-800 hover:bg-slate-700 text-slate-300\"\n                      onClick={() => {\n                        if (paymentModeDetails?.bankDetails?.ifscCode) {\n                          navigator.clipboard.writeText(paymentModeDetails.bankDetails.ifscCode);\n                          toast({\n                            title: \"Copied!\",\n                            description: \"IFSC code copied to clipboard\",\n                          });\n                        }\n                      }}\n                    >\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\"/><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"/></svg>\n                    </Button>\n                  </div>\n                  \n                  <div className=\"mt-1 flex items-center gap-2\">\n                    <p className=\"text-slate-300\"><strong className=\"text-slate-200\">Bank Name:</strong> {paymentModeDetails.bankDetails.bankName}</p>\n                    <Button \n                      type=\"button\" \n                      variant=\"ghost\" \n                      size=\"icon\" \n                      className=\"h-6 w-6 rounded-md bg-slate-800 hover:bg-slate-700 text-slate-300\"\n                      onClick={() => {\n                        if (paymentModeDetails?.bankDetails?.bankName) {\n                          navigator.clipboard.writeText(paymentModeDetails.bankDetails.bankName);\n                          toast({\n                            title: \"Copied!\",\n                            description: \"Bank name copied to clipboard\",\n                          });\n                        }\n                      }}\n                    >\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\"/><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"/></svg>\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </>\n        );\n      \n      default:\n        return null;\n    }\n  };\n\n  const renderWithdrawalPaymentFields = () => {\n    const paymentMode = withdrawalForm.watch(\"paymentMode\");\n    \n    switch (paymentMode) {\n      case \"upi\":\n        return (\n          <FormField\n            control={withdrawalForm.control}\n            name=\"paymentDetails.upiId\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>UPI ID</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Enter your UPI ID\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        );\n      \n      case \"bank\":\n        return (\n          <>\n            <FormField\n              control={withdrawalForm.control}\n              name=\"paymentDetails.bankName\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Bank Name</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Enter your bank name\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={withdrawalForm.control}\n              name=\"paymentDetails.accountNumber\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Account Number</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Enter your account number\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={withdrawalForm.control}\n              name=\"paymentDetails.ifscCode\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>IFSC Code</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Enter IFSC code\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </>\n        );\n      \n      default:\n        return null;\n    }\n  };\n\n  return (\n    <DashboardLayout title=\"Wallet\">\n      <div className=\"mb-6\">\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n          <div \n            className={`p-4 rounded-lg border cursor-pointer transition-all ${\n              activeTab === \"balance\" \n                ? \"bg-slate-900/90 border-primary shadow-md\" \n                : \"bg-slate-900/50 border-slate-800 hover:border-primary/40\"\n            }`}\n            onClick={() => setActiveTab(\"balance\")}\n          >\n            <div className=\"flex flex-col items-center justify-center text-center\">\n              <div className={`p-3 rounded-full mb-2 ${\n                activeTab === \"balance\" \n                  ? \"bg-gradient-to-r from-violet-600 to-fuchsia-600\" \n                  : \"bg-slate-800\"\n              }`}>\n                <Wallet className=\"w-5 h-5 text-white\" />\n              </div>\n              <span className={`font-medium ${\n                activeTab === \"balance\" ? \"text-primary\" : \"text-slate-300\"\n              }`}>Balance</span>\n            </div>\n          </div>\n          \n          {/* Deposit option - Only for direct players (assigned to admin or null) */}\n          {user?.role === \"player\" && (!user.assignedTo || user.assignedTo === 1) && (\n            <div \n              className={`p-4 rounded-lg border cursor-pointer transition-all ${\n                activeTab === \"deposit\" \n                  ? \"bg-slate-900/90 border-primary shadow-md\" \n                  : \"bg-slate-900/50 border-slate-800 hover:border-primary/40\"\n              }`}\n              onClick={() => setActiveTab(\"deposit\")}\n            >\n              <div className=\"flex flex-col items-center justify-center text-center\">\n                <div className={`p-3 rounded-full mb-2 ${\n                  activeTab === \"deposit\" \n                    ? \"bg-gradient-to-r from-violet-600 to-fuchsia-600\" \n                    : \"bg-slate-800\"\n                }`}>\n                  <ArrowDown className=\"w-5 h-5 text-white\" />\n                </div>\n                <span className={`font-medium ${\n                  activeTab === \"deposit\" ? \"text-primary\" : \"text-slate-300\"\n                }`}>Deposit</span>\n              </div>\n            </div>\n          )}\n          \n          {/* Withdraw option - Only for direct players (assigned to admin or null) */}\n          {user?.role === \"player\" && (!user.assignedTo || user.assignedTo === 1) && (\n            <div \n              className={`p-4 rounded-lg border cursor-pointer transition-all ${\n                activeTab === \"withdraw\" \n                  ? \"bg-slate-900/90 border-primary shadow-md\" \n                  : \"bg-slate-900/50 border-slate-800 hover:border-primary/40\"\n              }`}\n              onClick={() => setActiveTab(\"withdraw\")}\n            >\n              <div className=\"flex flex-col items-center justify-center text-center\">\n                <div className={`p-3 rounded-full mb-2 ${\n                  activeTab === \"withdraw\" \n                    ? \"bg-gradient-to-r from-violet-600 to-fuchsia-600\" \n                    : \"bg-slate-800\"\n                }`}>\n                  <ArrowUp className=\"w-5 h-5 text-white\" />\n                </div>\n                <span className={`font-medium ${\n                  activeTab === \"withdraw\" ? \"text-primary\" : \"text-slate-300\"\n                }`}>Withdraw</span>\n              </div>\n            </div>\n          )}\n          \n          <div \n            className={`p-4 rounded-lg border cursor-pointer transition-all ${\n              activeTab === \"history\" \n                ? \"bg-slate-900/90 border-primary shadow-md\" \n                : \"bg-slate-900/50 border-slate-800 hover:border-primary/40\"\n            }`}\n            onClick={() => setActiveTab(\"history\")}\n          >\n            <div className=\"flex flex-col items-center justify-center text-center\">\n              <div className={`p-3 rounded-full mb-2 ${\n                activeTab === \"history\" \n                  ? \"bg-gradient-to-r from-violet-600 to-fuchsia-600\" \n                  : \"bg-slate-800\"\n              }`}>\n                <History className=\"w-5 h-5 text-white\" />\n              </div>\n              <span className={`font-medium ${\n                activeTab === \"history\" ? \"text-primary\" : \"text-slate-300\"\n              }`}>History</span>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <Tabs defaultValue=\"balance\" value={activeTab} onValueChange={updateTab} className=\"w-full\">\n\n        {/* Balance Tab */}\n        <TabsContent value=\"balance\" className=\"space-y-4\">\n          <Card className=\"bg-slate-900/70 shadow-lg border border-slate-800\">\n            <CardContent className=\"p-6 md:p-8\">\n              <div className=\"flex flex-col items-center md:flex-row md:justify-between\">\n                <div className=\"flex items-center mb-4 md:mb-0\">\n                  <div className=\"p-3 rounded-full bg-gradient-to-r from-violet-600 to-fuchsia-600 mr-4\">\n                    <IndianRupee className=\"w-7 h-7 text-white\" />\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-slate-400\">Current Balance</p>\n                    <p className=\"text-3xl font-bold text-fuchsia-300\">{user?.balance ? (user.balance / 100).toFixed(2) : '0.00'}</p>\n                    <p className=\"text-xs text-slate-500 mt-1\">\n                      Last updated: {new Date().toLocaleDateString('en-IN')}\n                    </p>\n                  </div>\n                </div>\n                {user?.role === \"player\" && (\n                  <div className=\"flex gap-3\">\n                    <Button \n                      onClick={() => updateTab(\"deposit\")}\n                      className=\"bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-700 hover:to-fuchsia-700 text-white\"\n                    >\n                      <ArrowDown className=\"mr-2 h-4 w-4\" />\n                      Deposit\n                    </Button>\n                    <Button \n                      onClick={() => updateTab(\"withdraw\")} \n                      variant=\"outline\"\n                      className=\"border-slate-700 text-slate-300 hover:bg-slate-800 hover:text-white\"\n                    >\n                      <ArrowUp className=\"mr-2 h-4 w-4\" />\n                      Withdraw\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Recent Transactions</CardTitle>\n              <CardDescription>Your most recent wallet activities</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {(loadingRequests || loadingTransactions) ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : (walletRequests.length === 0 && transactions.length === 0) ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <p>No recent transactions found.</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {/* Direct transactions from admin/subadmin */}\n                  {transactions.slice(0, 3).map((transaction) => (\n                    <div key={`tx-${transaction.id}`} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                      <div className=\"flex items-center\">\n                        <div className=\"mr-4\">\n                          {transaction.amount > 0 ? (\n                            <ArrowDown className=\"h-5 w-5 text-green-600\" />\n                          ) : (\n                            <ArrowUp className=\"h-5 w-5 text-red-600\" />\n                          )}\n                        </div>\n                        <div>\n                          <h4 className=\"font-medium\">\n                            {transaction.amount > 0 ? \"Fund Credit\" : \"Fund Debit\"}\n                          </h4>\n                          <p className=\"text-sm text-muted-foreground\">\n                            <span className=\"flex items-center gap-1\">\n                              <User className=\"h-3 w-3\" /> \n                              By {transaction.performer?.username || `Admin #${transaction.performedBy}`}\n                              <span className=\"mx-1\"></span>\n                              {formatDate(transaction.createdAt)}\n                            </span>\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-3\">\n                        <span className={`font-semibold ${transaction.amount > 0 ? \"text-green-600\" : \"text-red-600\"}`}>\n                          {transaction.amount > 0 ? \"+\" : \"\"}\n                          {(Math.abs(transaction.amount) / 100).toFixed(2)}\n                        </span>\n                        <div className={`p-1 rounded-full ${transaction.amount > 0 ? \"bg-green-100\" : \"bg-red-100\"}`}>\n                          {transaction.amount > 0 ? (\n                            <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                          ) : (\n                            <Ban className=\"h-5 w-5 text-red-600\" />\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                  \n                  {/* Deposit/Withdrawal requests */}\n                  {walletRequests.slice(0, 3).map((request) => {\n                    const { color, bgColor, icon } = getStatusInfo(request.status as RequestStatus);\n                    const { title, icon: typeIcon } = getRequestTypeInfo(request.requestType as RequestType);\n                    \n                    return (\n                      <div key={`req-${request.id}`} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                        <div className=\"flex items-center\">\n                          <div className=\"mr-4\">\n                            {typeIcon}\n                          </div>\n                          <div>\n                            <h4 className=\"font-medium\">{title}</h4>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {formatDate(request.createdAt)}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-3\">\n                          <span className=\"font-semibold\">\n                            {request.amount.toFixed(2)}\n                          </span>\n                          <div className={`p-1 rounded-full ${bgColor}`}>\n                            {icon}\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n            <CardFooter>\n              <Button variant=\"outline\" className=\"w-full\" onClick={() => updateTab(\"history\")}>\n                View All Transactions\n              </Button>\n            </CardFooter>\n          </Card>\n        </TabsContent>\n\n        {/* Deposit Tab */}\n        <TabsContent value=\"deposit\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Add Funds</CardTitle>\n              <CardDescription>\n                Deposit money into your account\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Form {...depositForm}>\n                <form onSubmit={depositForm.handleSubmit(handleDepositSubmit)} className=\"space-y-6\">\n                  <FormField\n                    control={depositForm.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount ()</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            placeholder=\"Enter amount\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={depositForm.control}\n                    name=\"paymentMode\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Payment Method</FormLabel>\n                        <FormControl>\n                          <div className=\"grid grid-cols-2 gap-3\">\n                            <div \n                              className={`p-4 rounded-lg border cursor-pointer transition-all ${\n                                field.value === \"upi\" \n                                  ? \"bg-slate-900/90 border-primary shadow-md\" \n                                  : \"bg-slate-900/50 border-slate-800 hover:border-primary/40\"\n                              }`}\n                              onClick={() => depositForm.setValue(\"paymentMode\", \"upi\")}\n                            >\n\n                              <div className=\"flex flex-col items-center justify-center text-center\">\n                                <div className={`p-3 rounded-full mb-2 ${\n                                  field.value === \"upi\" \n                                    ? \"bg-gradient-to-r from-violet-600 to-fuchsia-600\" \n                                    : \"bg-slate-800\"\n                                }`}>\n                                  <IndianRupee className=\"w-5 h-5 text-white\" />\n                                </div>\n                                <span className={`font-medium ${\n                                  field.value === \"upi\" ? \"text-primary\" : \"text-slate-300\"\n                                }`}>UPI</span>\n                              </div>\n                            </div>\n                            \n                            <div \n                              className={`p-4 rounded-lg border cursor-pointer transition-all ${\n                                field.value === \"bank\" \n                                  ? \"bg-slate-900/90 border-primary shadow-md\" \n                                  : \"bg-slate-900/50 border-slate-800 hover:border-primary/40\"\n                              }`}\n                              onClick={() => depositForm.setValue(\"paymentMode\", \"bank\")}\n                            >\n\n                              <div className=\"flex flex-col items-center justify-center text-center\">\n                                <div className={`p-3 rounded-full mb-2 ${\n                                  field.value === \"bank\" \n                                    ? \"bg-gradient-to-r from-violet-600 to-fuchsia-600\" \n                                    : \"bg-slate-800\"\n                                }`}>\n                                  <Landmark className=\"w-5 h-5 text-white\" />\n                                </div>\n                                <span className={`font-medium ${\n                                  field.value === \"bank\" ? \"text-primary\" : \"text-slate-300\"\n                                }`}>Bank</span>\n                              </div>\n                            </div>\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {renderDepositPaymentFields()}\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"proofImage\">Payment Proof Image</Label>\n                    <Input\n                      id=\"proofImage\"\n                      type=\"file\"\n                      accept=\"image/*\"\n                      onChange={handleProofImageChange}\n                      className=\"cursor-pointer\"\n                    />\n                    {proofImage && (\n                      <div className=\"mt-2\">\n                        <p className=\"text-sm text-green-600\">\n                          Image selected: {proofImage.name}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n\n                  <FormField\n                    control={depositForm.control}\n                    name=\"notes\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Notes (Optional)</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Any additional information\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full\" \n                    disabled={createRequestMutation.isPending}\n                  >\n                    {createRequestMutation.isPending && (\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    )}\n                    Submit Deposit Request\n                  </Button>\n                </form>\n              </Form>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Withdraw Tab */}\n        <TabsContent value=\"withdraw\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Withdraw Funds</CardTitle>\n              <CardDescription>\n                Withdraw money from your account\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"mb-6 p-4 rounded-lg bg-slate-900/70 border border-slate-800 text-slate-300\">\n                <div className=\"flex items-center gap-3 mb-2\">\n                  <div className=\"p-2 rounded-full bg-gradient-to-r from-violet-600 to-fuchsia-600\">\n                    <IndianRupee className=\"h-4 w-4 text-white\" />\n                  </div>\n                  <h3 className=\"text-lg font-semibold text-fuchsia-300\">Your balance: {user?.balance ? (user.balance / 100).toFixed(2) : '0.00'}</h3>\n                </div>\n                <p className=\"pl-9 text-sm text-slate-400\">\n                  Minimum withdrawal amount is 500. Maximum is 50,000.\n                </p>\n              </div>\n\n              <Form {...withdrawalForm}>\n                <form onSubmit={withdrawalForm.handleSubmit(handleWithdrawalSubmit)} className=\"space-y-6\">\n                  <FormField\n                    control={withdrawalForm.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount ()</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            placeholder=\"Enter amount\" \n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={withdrawalForm.control}\n                    name=\"paymentMode\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Withdrawal Method</FormLabel>\n                        <FormControl>\n                          <div className=\"grid grid-cols-2 gap-3\">\n                            <div \n                              className={`p-4 rounded-lg border cursor-pointer transition-all ${\n                                field.value === \"upi\" \n                                  ? \"bg-slate-900/90 border-primary shadow-md\" \n                                  : \"bg-slate-900/50 border-slate-800 hover:border-primary/40\"\n                              }`}\n                              onClick={() => withdrawalForm.setValue(\"paymentMode\", \"upi\")}\n                            >\n\n                              <div className=\"flex flex-col items-center justify-center text-center\">\n                                <div className={`p-3 rounded-full mb-2 ${\n                                  field.value === \"upi\" \n                                    ? \"bg-gradient-to-r from-violet-600 to-fuchsia-600\" \n                                    : \"bg-slate-800\"\n                                }`}>\n                                  <IndianRupee className=\"w-5 h-5 text-white\" />\n                                </div>\n                                <span className={`font-medium ${\n                                  field.value === \"upi\" ? \"text-primary\" : \"text-slate-300\"\n                                }`}>UPI</span>\n                              </div>\n                            </div>\n                            \n                            <div \n                              className={`p-4 rounded-lg border cursor-pointer transition-all ${\n                                field.value === \"bank\" \n                                  ? \"bg-slate-900/90 border-primary shadow-md\" \n                                  : \"bg-slate-900/50 border-slate-800 hover:border-primary/40\"\n                              }`}\n                              onClick={() => withdrawalForm.setValue(\"paymentMode\", \"bank\")}\n                            >\n\n                              <div className=\"flex flex-col items-center justify-center text-center\">\n                                <div className={`p-3 rounded-full mb-2 ${\n                                  field.value === \"bank\" \n                                    ? \"bg-gradient-to-r from-violet-600 to-fuchsia-600\" \n                                    : \"bg-slate-800\"\n                                }`}>\n                                  <Landmark className=\"w-5 h-5 text-white\" />\n                                </div>\n                                <span className={`font-medium ${\n                                  field.value === \"bank\" ? \"text-primary\" : \"text-slate-300\"\n                                }`}>Bank</span>\n                              </div>\n                            </div>\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {renderWithdrawalPaymentFields()}\n\n                  <FormField\n                    control={withdrawalForm.control}\n                    name=\"notes\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Notes (Optional)</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Any additional information\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full\" \n                    disabled={createRequestMutation.isPending}\n                  >\n                    {createRequestMutation.isPending && (\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    )}\n                    Submit Withdrawal Request\n                  </Button>\n                </form>\n              </Form>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* History Tab */}\n        <TabsContent value=\"history\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <div>\n                <CardTitle>Transaction History</CardTitle>\n                <CardDescription>\n                  All your wallet transactions\n                </CardDescription>\n              </div>\n            </CardHeader>\n            \n            <CardContent className=\"pt-4\">\n              {(loadingRequests || loadingTransactions) ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : (walletRequests.length === 0 && transactions.length === 0) ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <p>No transaction history found.</p>\n                </div>\n              ) : (\n                <>\n                  {/* Mobile-optimized transaction table */}\n                  {(() => {\n                    // Define types for our combined transactions\n                    type RequestTransaction = {\n                      id: string;\n                      isRequest: true;\n                      createdAt: string;\n                      requestData: WalletRequest;\n                    };\n                    \n                    type DirectTransaction = {\n                      id: string;\n                      isRequest: false;\n                      createdAt: string;\n                      transactionData: any;\n                    };\n                    \n                    type CombinedTransaction = RequestTransaction | DirectTransaction;\n                    \n                    // Create transaction-like objects from wallet requests for unified sorting\n                    const requestTransactions: RequestTransaction[] = walletRequests.map(request => ({\n                      id: `req-${request.id}`,\n                      isRequest: true,\n                      createdAt: request.createdAt,\n                      requestData: request\n                    }));\n                    \n                    // Mark direct transactions\n                    const directTransactions: DirectTransaction[] = transactions.map(tx => ({\n                      id: `tx-${tx.id}`,\n                      isRequest: false,\n                      createdAt: tx.createdAt,\n                      transactionData: tx\n                    }));\n                    \n                    // Combine and sort by date (newest first)\n                    const allTransactions: CombinedTransaction[] = [...requestTransactions, ...directTransactions]\n                      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n                    \n                    // Pagination calculation\n                    const totalItems = allTransactions.length;\n                    const totalPages = Math.ceil(totalItems / itemsPerPage);\n                    const startIndex = (currentPage - 1) * itemsPerPage;\n                    const endIndex = Math.min(startIndex + itemsPerPage, totalItems);\n                    const currentItems = allTransactions.slice(startIndex, endIndex);\n                      \n                    return (\n                      <>\n                        {/* Mobile-Optimized Transaction Table */}\n                        <div className=\"overflow-x-auto\">\n                          <Table>\n                            <TableHeader>\n                              <TableRow>\n                                <TableHead className=\"w-[100px]\">Date</TableHead>\n                                <TableHead>Type</TableHead>\n                                <TableHead className=\"text-right\">Amount</TableHead>\n                                <TableHead className=\"text-right\">Balance</TableHead>\n                                <TableHead className=\"w-[80px]\">Status</TableHead>\n                              </TableRow>\n                            </TableHeader>\n                            <TableBody>\n                              {currentItems.map(item => {\n                                if (item.isRequest) {\n                                  // It's a wallet request\n                                  const request = item.requestData;\n                                  const { title } = getRequestTypeInfo(request.requestType as RequestType);\n                                  \n                                  return (\n                                    <TableRow key={item.id}>\n                                      <TableCell className=\"text-sm\">\n                                        {formatDate(request.createdAt).split(' ')[0]}\n                                      </TableCell>\n                                      <TableCell>\n                                        <div className=\"flex flex-col\">\n                                          <span className=\"font-medium text-sm\">{title} Request</span>\n                                          <span className=\"text-xs text-muted-foreground\">\n                                            {request.paymentMode}\n                                          </span>\n                                        </div>\n                                      </TableCell>\n                                      <TableCell className=\"text-right\">\n                                        <span className={\n                                          request.requestType === RequestType.DEPOSIT \n                                            ? \"text-green-600\" \n                                            : \"text-red-600\"\n                                        }>\n                                          {request.requestType === RequestType.DEPOSIT ? '+' : '-'}\n                                          {request.amount.toFixed(2)}\n                                        </span>\n                                      </TableCell>\n                                      <TableCell className=\"text-right text-sm text-muted-foreground\">\n                                        -\n                                      </TableCell>\n                                      <TableCell>\n                                        <Badge \n                                          variant={\n                                            request.status === RequestStatus.APPROVED \n                                              ? \"default\" \n                                              : request.status === RequestStatus.REJECTED \n                                                ? \"destructive\" \n                                                : \"secondary\"\n                                          }\n                                          className=\"text-xs\"\n                                        >\n                                          {request.status}\n                                        </Badge>\n                                      </TableCell>\n                                    </TableRow>\n                                } else {\n                                  // It's a direct transaction\n                                  const transaction = item.transactionData;\n                                  return (\n                                    <TableRow key={item.id}>\n                                      <TableCell className=\"text-sm\">\n                                        {formatDate(transaction.createdAt).split(' ')[0]}\n                                      </TableCell>\n                                      <TableCell>\n                                        <div className=\"flex flex-col\">\n                                          <span className=\"font-medium text-sm\">\n                                            {transaction.amount > 0 ? \"Credit\" : \"Debit\"}\n                                          </span>\n                                          <span className=\"text-xs text-muted-foreground\">\n                                            {transaction.description?.split(' ').slice(0, 3).join(' ') || \"Balance update\"}\n                                          </span>\n                                        </div>\n                                      </TableCell>\n                                      <TableCell className=\"text-right\">\n                                        <span className={transaction.amount > 0 ? \"text-green-600\" : \"text-red-600\"}>\n                                          {transaction.amount > 0 ? '+' : ''}\n                                          {(Math.abs(transaction.amount) / 100).toFixed(2)}\n                                        </span>\n                                      </TableCell>\n                                      <TableCell className=\"text-right\">\n                                        <span className=\"font-medium text-primary\">\n                                          {(transaction.balanceAfter / 100).toFixed(2)}\n                                        </span>\n                                      </TableCell>\n                                      <TableCell>\n                                        <Badge variant=\"default\" className=\"text-xs\">\n                                          Complete\n                                        </Badge>\n                                      </TableCell>\n                                    </TableRow>\n                                  );\n                                }\n                              })}\n                            </TableBody>\n                          </Table>\n                        \n                        {/* Pagination */}\n                        {totalPages > 1 && (\n                          <div className=\"mt-6 flex justify-center\">\n                            <Pagination>\n                              <PaginationContent>\n                                <PaginationItem>\n                                  <PaginationPrevious \n                                    onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                                    className={currentPage === 1 ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"}\n                                  />\n                                </PaginationItem>\n                                \n                                {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n                                  const pageNum = i + 1;\n                                  return (\n                                    <PaginationItem key={pageNum}>\n                                      <PaginationLink\n                                        onClick={() => setCurrentPage(pageNum)}\n                                        isActive={currentPage === pageNum}\n                                        className=\"cursor-pointer\"\n                                      >\n                                        {pageNum}\n                                      </PaginationLink>\n                                    </PaginationItem>\n                                  );\n                                })}\n                                \n                                <PaginationItem>\n                                  <PaginationNext \n                                    onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}\n                                    className={currentPage === totalPages ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"}\n                                  />\n                                </PaginationItem>\n                              </PaginationContent>\n                            </Pagination>\n                          </div>\n                        )}\n                      </>\n                    );\n                  })()}\n                                          {formatDate(transaction.createdAt)}\n                                        </p>\n                                      </div>\n                                    </div>\n                                    <div className=\"flex flex-col items-end gap-2\">\n                                      <Badge variant={transaction.amount > 0 ? \"outline\" : \"secondary\"}>\n                                        <div className=\"flex items-center gap-1\">\n                                          <CreditCard className=\"h-3 w-3\" />\n                                          {transaction.performer ? \n                                            `${transaction.performer.username} (${transaction.performer.role})` : \n                                            `Admin #${transaction.performedBy}`}\n                                        </div>\n                                      </Badge>\n                                      {transaction.balanceAfter !== undefined && (\n                                        <div className=\"text-sm text-muted-foreground\">\n                                          <span className=\"font-medium\">Your Balance After: </span>\n                                          {(transaction.balanceAfter / 100).toFixed(2)}\n                                        </div>\n                                      )}\n                                    </div>\n                                  </div>\n                                  \n                                  {transaction.description && (\n                                    <div className=\"px-4 pb-4 text-sm border-t border-slate-800 bg-slate-950/50\">\n                                      <p className=\"mt-2\">\n                                        <strong>Description:</strong>{\" \"}\n                                        {/* Handle different transaction description formats */}\n                                        {(() => {\n                                          // For descriptions that match our new simple format (Fund added to/Fund deducted from)\n                                          if (transaction.description?.includes(\"Fund added to\") || \n                                              transaction.description?.includes(\"Fund deducted from\") ||\n                                              transaction.description?.includes(\"Fund transferred to\")) {\n                                            return transaction.description;\n                                          }\n                                          \n                                          // Special case for \"Funds deducted by KingGames\" format (old format)\n                                          if (transaction.description === \"Funds deducted by KingGames\" && transaction.performer) {\n                                            // Convert to proper format for Fund Debit\n                                            return `Fund deducted from ${user?.username} (${user?.role}) by ${transaction.performer.username} (${transaction.performer.role})`;\n                                          }\n                                          \n                                          // Special case for \"Funds recovered from subadmin\" format (old format) \n                                          if (transaction.description?.includes(\"Funds recovered from subadmin\") && transaction.performer) {\n                                            // Convert to proper format for Fund Credit (commission case)\n                                            return `Fund added to ${transaction.performer.username} (${transaction.performer.role}) from ${user?.username} (${user?.role}) for withdrawal (Commission applied)`;\n                                          }\n                                          \n                                          // Special case for \"Funds transferred to subadmin\" format (old format)\n                                          if (transaction.description?.includes(\"Funds transferred to subadmin\") && transaction.performer) {\n                                            // Convert to proper format for Fund Debit (commission case)\n                                            return `Fund transferred to ${user?.username} (${user?.role}) deducted from ${transaction.performer.username} (${transaction.performer.role}) (Commission applied)`;\n                                          }\n                                          \n                                          // Old format: \"Funds added to/deducted from\"\n                                          if (transaction.description?.includes(\"Funds added to\") || \n                                              transaction.description?.includes(\"Funds deducted from\")) {\n                                            return transaction.description.replace(\"Funds \", \"Fund \");\n                                          }\n                                          \n                                          // Special case for older \"Funds added by admin\" format\n                                          if (transaction.description === \"Funds added by admin\" && transaction.performer) {\n                                            if (transaction.amount > 0) {\n                                              // Fund credit\n                                              return `Fund added to ${user?.username} (${user?.role}) by ${transaction.performer.username} (${transaction.performer.role})`;\n                                            } else {\n                                              // Fund debit\n                                              return `Fund deducted from ${user?.username} (${user?.role}) by ${transaction.performer.username} (${transaction.performer.role})`;\n                                            }\n                                          }\n                                          \n                                          // Special case for older \"Funds added by [username]\" format\n                                          if (transaction.description?.startsWith(\"Funds added by \") && transaction.performer) {\n                                            if (transaction.amount > 0) {\n                                              // Fund credit\n                                              return `Fund added to ${user?.username} (${user?.role}) by ${transaction.performer.username} (${transaction.performer.role})`;\n                                            } else {\n                                              // Fund debit\n                                              return `Fund deducted from ${user?.username} (${user?.role}) by ${transaction.performer.username} (${transaction.performer.role})`;\n                                            }\n                                          }\n                                          \n                                          // For \"Added by\" format without recipient info\n                                          if (transaction.description?.includes(\"Added by \") && !transaction.description?.includes(\"added to\") && transaction.performer) {\n                                            return transaction.description.replace(\"Added by \", `Fund added to ${user?.username} (${user?.role}) by `);\n                                          }\n                                          \n                                          // Replace generic \"processed by\" patterns\n                                          if (transaction.description?.includes(\"processed by\") && transaction.performer) {\n                                            return transaction.description.replace(/processed by \\d+/, \n                                              `processed by ${transaction.performer.username} (${transaction.performer.role})`\n                                            );\n                                          }\n                                          \n                                          // Default: return the description as is\n                                          return transaction.description;\n                                        })()}\n                                      </p>\n                                    </div>\n                                  )}\n                                </div>\n                              );\n                            }\n                          })}\n                          \n                          {/* Pagination controls */}\n                          {totalItems > itemsPerPage && (\n                            <div className=\"mt-6 flex flex-col items-center space-y-4\">\n                              <Pagination>\n                                <PaginationContent>\n                                  <PaginationItem>\n                                    <PaginationPrevious \n                                      href=\"#\"\n                                      onClick={(e: React.MouseEvent<HTMLAnchorElement>) => {\n                                        e.preventDefault();\n                                        if (currentPage > 1) setCurrentPage(currentPage - 1);\n                                      }}\n                                      className={currentPage === 1 ? \"cursor-not-allowed opacity-50\" : \"\"}\n                                    />\n                                  </PaginationItem>\n                                  \n                                  {/* Page numbers */}\n                                  {[...Array(Math.min(5, totalPages))].map((_, i) => {\n                                    let pageNum = i + 1;\n                                    \n                                    if (totalPages > 5) {\n                                      if (currentPage <= 3) {\n                                        // Show first 5 pages\n                                        pageNum = i + 1;\n                                      } else if (currentPage >= totalPages - 2) {\n                                        // Show last 5 pages\n                                        pageNum = totalPages - 4 + i;\n                                      } else {\n                                        // Show current page in middle\n                                        pageNum = currentPage - 2 + i;\n                                      }\n                                    }\n                                    \n                                    return (\n                                      <PaginationItem key={pageNum}>\n                                        <PaginationLink\n                                          href=\"#\"\n                                          onClick={(e: React.MouseEvent<HTMLAnchorElement>) => {\n                                            e.preventDefault();\n                                            setCurrentPage(pageNum);\n                                          }}\n                                          isActive={currentPage === pageNum}\n                                        >\n                                          {pageNum}\n                                        </PaginationLink>\n                                      </PaginationItem>\n                                    );\n                                  })}\n                                  \n                                  <PaginationItem>\n                                    <PaginationNext \n                                      href=\"#\"\n                                      onClick={(e: React.MouseEvent<HTMLAnchorElement>) => {\n                                        e.preventDefault();\n                                        if (currentPage < totalPages) setCurrentPage(currentPage + 1);\n                                      }}\n                                      className={currentPage === totalPages ? \"cursor-not-allowed opacity-50\" : \"\"}\n                                    />\n                                  </PaginationItem>\n                                </PaginationContent>\n                              </Pagination>\n                              \n                              {/* Items per page selector */}\n                              <div className=\"flex items-center gap-2\">\n                                <Label htmlFor=\"items-per-page\" className=\"text-sm text-muted-foreground\">\n                                  Items per page:\n                                </Label>\n                                <Select \n                                  value={itemsPerPage.toString()} \n                                  onValueChange={(value) => {\n                                    setItemsPerPage(parseInt(value));\n                                    setCurrentPage(1); // Reset to first page when changing items per page\n                                  }}\n                                >\n                                  <SelectTrigger id=\"items-per-page\" className=\"w-[80px]\">\n                                    <SelectValue placeholder=\"20\" />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"10\">10</SelectItem>\n                                    <SelectItem value=\"20\">20</SelectItem>\n                                    <SelectItem value=\"50\">50</SelectItem>\n                                    <SelectItem value=\"100\">100</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                            </div>\n                          )}\n                        </>\n                      );\n                    })()}\n                  </div>\n                </>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":75132,"size_tokens":null},"fix-admin-login.js":{"content":"/**\n * This script fixes login issues with older admin accounts created before\n * email and mobile fields were required.\n * \n * It adds default values for these fields to existing accounts that lack them.\n */\n\nconst { Pool } = require('pg');\n\nasync function fixAdminLogin() {\n  const pool = new Pool({ connectionString: process.env.DATABASE_URL });\n\n  try {\n    console.log('Connecting to database...');\n    const client = await pool.connect();\n\n    try {\n      // First check if the email and mobile columns exist\n      const columnsExist = await client.query(`\n        SELECT column_name \n        FROM information_schema.columns \n        WHERE table_name = 'users' \n        AND column_name IN ('email', 'mobile')\n      `);\n\n      // If the columns don't exist, we need to add them\n      if (columnsExist.rows.length < 2) {\n        console.log('Adding missing email and/or mobile columns...');\n        \n        // Check which columns need to be added\n        const existingColumns = columnsExist.rows.map(row => row.column_name);\n        \n        if (!existingColumns.includes('email')) {\n          await client.query(`ALTER TABLE users ADD COLUMN email TEXT`);\n          console.log('Added email column');\n        }\n        \n        if (!existingColumns.includes('mobile')) {\n          await client.query(`ALTER TABLE users ADD COLUMN mobile TEXT`);\n          console.log('Added mobile column');\n        }\n      }\n\n      // Update admin accounts to have default values for email and mobile if they are NULL\n      console.log('Updating admin accounts with default values for email and mobile...');\n      const result = await client.query(`\n        UPDATE users \n        SET \n          email = COALESCE(email, username || '@admin.example.com'),\n          mobile = COALESCE(mobile, '1234567890')\n        WHERE \n          role = 'admin' AND (email IS NULL OR mobile IS NULL)\n        RETURNING id, username\n      `);\n\n      if (result.rows.length > 0) {\n        console.log(`Updated ${result.rows.length} admin accounts:`);\n        result.rows.forEach(user => {\n          console.log(`- Admin ID: ${user.id}, Username: ${user.username}`);\n        });\n      } else {\n        console.log('No admin accounts needed updating');\n      }\n\n      // Check for any other accounts (subadmins, players) without email/mobile\n      const otherAccounts = await client.query(`\n        UPDATE users \n        SET \n          email = COALESCE(email, username || '@user.example.com'),\n          mobile = COALESCE(mobile, '9876543210')\n        WHERE \n          role != 'admin' AND (email IS NULL OR mobile IS NULL)\n        RETURNING id, username, role\n      `);\n\n      if (otherAccounts.rows.length > 0) {\n        console.log(`Updated ${otherAccounts.rows.length} other accounts:`);\n        otherAccounts.rows.forEach(user => {\n          console.log(`- ${user.role} ID: ${user.id}, Username: ${user.username}`);\n        });\n      } else {\n        console.log('No other accounts needed updating');\n      }\n\n      console.log('Account fixes completed successfully!');\n\n    } finally {\n      client.release();\n    }\n  } catch (error) {\n    console.error('Error fixing admin accounts:', error);\n  } finally {\n    await pool.end();\n  }\n}\n\n// Run the script\nfixAdminLogin().catch(console.error);\n","path":null,"size_bytes":3266,"size_tokens":null},"client/src/components/promo-slider.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { ChevronLeft, ChevronRight, Loader2 } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\n// Fallback promo images in case no admin uploaded images are available\nconst fallbackPromoImages = [\n  {\n    id: 1,\n    url: \"https://images.unsplash.com/photo-1531415074968-036ba1b575da?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&h=300&q=80\",\n    alt: \"Cricket Stadium - Special Offer Bonus\"\n  },\n  {\n    id: 2,\n    url: \"https://images.unsplash.com/photo-1595604501726-7e1ba58e8c16?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&h=300&q=80\",\n    alt: \"Cricket Match - Daily Cashback\"\n  },\n  {\n    id: 3,\n    url: \"https://images.unsplash.com/photo-1600250624674-fb4969825db7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&h=300&q=80\",\n    alt: \"Cricket Bat and Ball - VIP Rewards\"\n  }\n];\n\nexport default function PromoSlider() {\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n  const [promoImages, setPromoImages] = useState<{id: number, url: string, alt: string}[]>([]);\n  \n  // Fetch slider images from the API\n  const { data: sliderImages, isLoading } = useQuery<{filename: string, url: string}[]>({\n    queryKey: ['/api/sliders'],\n    queryFn: () => apiRequest(\"GET\", '/api/sliders')\n      .then(res => res.json()),\n  });\n  \n  // Process slider images or use fallback images if none are available\n  useEffect(() => {\n    if (sliderImages && sliderImages.length > 0) {\n      // Convert the server images to the format expected by the slider\n      const formattedImages = sliderImages.map((image, index) => ({\n        id: index + 1,\n        url: image.url,\n        alt: `Promotional Slider ${index + 1}`\n      }));\n      setPromoImages(formattedImages);\n    } else {\n      // If no images are available from the server, use the fallback images\n      setPromoImages(fallbackPromoImages);\n    }\n  }, [sliderImages]);\n  \n  // Auto-slide every 5 seconds\n  useEffect(() => {\n    if (promoImages.length === 0) return;\n    \n    const interval = setInterval(() => {\n      setCurrentImageIndex((prevIndex) => \n        prevIndex === promoImages.length - 1 ? 0 : prevIndex + 1\n      );\n    }, 5000);\n    \n    return () => clearInterval(interval);\n  }, [promoImages]);\n  \n  const goToPrevious = () => {\n    if (promoImages.length === 0) return;\n    setCurrentImageIndex((prevIndex) => \n      prevIndex === 0 ? promoImages.length - 1 : prevIndex - 1\n    );\n  };\n  \n  const goToNext = () => {\n    if (promoImages.length === 0) return;\n    setCurrentImageIndex((prevIndex) => \n      prevIndex === promoImages.length - 1 ? 0 : prevIndex + 1\n    );\n  };\n  \n  // Loading state\n  if (isLoading || promoImages.length === 0) {\n    return (\n      <Card className=\"w-full bg-slate-900/50 border-slate-800 overflow-hidden relative\">\n        <CardContent className=\"p-0 flex items-center justify-center h-[180px]\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-blue-500\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"w-full bg-slate-900/50 border-slate-800 overflow-hidden relative\">\n      <CardContent className=\"p-0 relative\">\n        {/* Image container with transition */}\n        <div className=\"relative overflow-hidden w-full h-[180px]\">\n          <div \n            className=\"flex transition-transform duration-500 ease-in-out h-full\"\n            style={{ transform: `translateX(-${currentImageIndex * 100}%)` }}\n          >\n            {promoImages.map((image) => (\n              <div key={image.id} className=\"w-full h-full flex-shrink-0\">\n                <div className=\"relative w-full h-full\">\n                  <img \n                    src={image.url} \n                    alt={image.alt}\n                    className=\"w-full h-full object-cover\"\n                  />\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n        \n        {/* Navigation dots */}\n        <div className=\"absolute bottom-3 left-0 right-0 flex justify-center space-x-2\">\n          {promoImages.map((_, index) => (\n            <button\n              key={index}\n              onClick={() => setCurrentImageIndex(index)}\n              className={`w-2 h-2 rounded-full transition-colors ${\n                index === currentImageIndex ? \"bg-white\" : \"bg-white/40\"\n              }`}\n              aria-label={`Go to slide ${index + 1}`}\n            />\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","path":null,"size_bytes":4729,"size_tokens":null},"setup-tables.ts":{"content":"import { db } from \"./server/db\";\nimport { SQL, sql } from \"drizzle-orm\";\n\nasync function setupTables() {\n  try {\n    console.log(\"Creating tables if they don't exist...\");\n    \n    // Check if tables exist\n    const tablesQuery = await db.execute(sql`\n      SELECT table_name \n      FROM information_schema.tables \n      WHERE table_schema = 'public';\n    `);\n    const existingTables = tablesQuery.rows.map((row: any) => row.table_name);\n    console.log(\"Existing tables:\", existingTables);\n\n    // Create player_deposit_discounts table if it doesn't exist\n    if (!existingTables.includes('player_deposit_discounts')) {\n      console.log(\"Creating player_deposit_discounts table...\");\n      await db.execute(sql`\n        CREATE TABLE IF NOT EXISTS player_deposit_discounts (\n          id SERIAL PRIMARY KEY,\n          subadmin_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n          user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n          discount_rate INTEGER NOT NULL,\n          is_active BOOLEAN NOT NULL DEFAULT TRUE,\n          created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n          updated_at TIMESTAMP NOT NULL DEFAULT NOW()\n        );\n      `);\n      console.log(\"Created player_deposit_discounts table.\");\n    } else {\n      console.log(\"player_deposit_discounts table already exists.\");\n    }\n\n    console.log(\"Table setup complete.\");\n  } catch (error) {\n    console.error(\"Error setting up tables:\", error);\n  } finally {\n    process.exit(0);\n  }\n}\n\nsetupTables();","path":null,"size_bytes":1511,"size_tokens":null},"server/upload-routes.ts":{"content":"import express, { Request, Response, NextFunction } from 'express';\nimport multer from 'multer';\nimport path from 'path';\nimport fs from 'fs';\nimport { UserRole } from '@shared/schema';\n\n// Create uploads directory if it doesn't exist\nconst uploadsDir = path.join(process.cwd(), 'uploads');\nconst proofUploadsDir = path.join(uploadsDir, 'proofs');\nconst sliderUploadsDir = path.join(uploadsDir, 'sliders');\nconst heroSliderUploadsDir = path.join(uploadsDir, 'hero-sliders');\nconst gameCardUploadsDir = path.join(uploadsDir, 'gamecards');\nconst matchBannerUploadsDir = path.join(uploadsDir, 'match-banners');\nconst marketBannerUploadsDir = path.join(uploadsDir, 'market-banners');\nconst qrCodeUploadsDir = path.join(uploadsDir, 'qr-codes');\n\nif (!fs.existsSync(uploadsDir)) {\n  fs.mkdirSync(uploadsDir, { recursive: true });\n}\n\nif (!fs.existsSync(proofUploadsDir)) {\n  fs.mkdirSync(proofUploadsDir, { recursive: true });\n}\n\nif (!fs.existsSync(sliderUploadsDir)) {\n  fs.mkdirSync(sliderUploadsDir, { recursive: true });\n}\n\nif (!fs.existsSync(heroSliderUploadsDir)) {\n  fs.mkdirSync(heroSliderUploadsDir, { recursive: true });\n}\n\nif (!fs.existsSync(gameCardUploadsDir)) {\n  fs.mkdirSync(gameCardUploadsDir, { recursive: true });\n}\n\nif (!fs.existsSync(matchBannerUploadsDir)) {\n  fs.mkdirSync(matchBannerUploadsDir, { recursive: true });\n}\n\nif (!fs.existsSync(marketBannerUploadsDir)) {\n  fs.mkdirSync(marketBannerUploadsDir, { recursive: true });\n}\n\nif (!fs.existsSync(qrCodeUploadsDir)) {\n  fs.mkdirSync(qrCodeUploadsDir, { recursive: true });\n}\n\n// File filter to accept only images\nconst fileFilter = (req: Request, file: Express.Multer.File, cb: multer.FileFilterCallback) => {\n  // Accept only image files\n  if (file.mimetype.startsWith('image/')) {\n    cb(null, true);\n  } else {\n    cb(new Error('Only image files are allowed!'));\n  }\n};\n\n// Configure proof uploads storage\nconst proofStorage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, proofUploadsDir);\n  },\n  filename: function (req, file, cb) {\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const ext = path.extname(file.originalname);\n    cb(null, `proof-${uniqueSuffix}${ext}`);\n  }\n});\n\n// Configure slider uploads storage\nconst sliderStorage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, sliderUploadsDir);\n  },\n  filename: function (req, file, cb) {\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const ext = path.extname(file.originalname);\n    cb(null, `slider-${uniqueSuffix}${ext}`);\n  }\n});\n\n// Configure hero slider uploads storage\nconst heroSliderStorage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, heroSliderUploadsDir);\n  },\n  filename: function (req, file, cb) {\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const ext = path.extname(file.originalname);\n    cb(null, `hero-slider-${uniqueSuffix}${ext}`);\n  }\n});\n\n// Configure game card uploads storage\nconst gameCardStorage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, gameCardUploadsDir);\n  },\n  filename: function (req, file, cb) {\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const ext = path.extname(file.originalname);\n    cb(null, `gamecard-${uniqueSuffix}${ext}`);\n  }\n});\n\n// Configure match banner uploads storage\nconst matchBannerStorage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, matchBannerUploadsDir);\n  },\n  filename: function (req, file, cb) {\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const ext = path.extname(file.originalname);\n    cb(null, `match-banner-${uniqueSuffix}${ext}`);\n  }\n});\n\n// Create multer instances for different upload types\nconst proofUpload = multer({ \n  storage: proofStorage,\n  limits: {\n    fileSize: 5 * 1024 * 1024 // 5MB max file size\n  },\n  fileFilter: fileFilter\n});\n\nconst sliderUpload = multer({ \n  storage: sliderStorage,\n  limits: {\n    fileSize: 2 * 1024 * 1024 // 2MB max file size\n  },\n  fileFilter: fileFilter\n});\n\nconst heroSliderUpload = multer({ \n  storage: heroSliderStorage,\n  limits: {\n    fileSize: 2 * 1024 * 1024 // 2MB max file size\n  },\n  fileFilter: fileFilter\n});\n\nconst gameCardUpload = multer({ \n  storage: gameCardStorage,\n  limits: {\n    fileSize: 2 * 1024 * 1024 // 2MB max file size\n  },\n  fileFilter: fileFilter\n});\n\nconst matchBannerUpload = multer({ \n  storage: matchBannerStorage,\n  limits: {\n    fileSize: 2 * 1024 * 1024 // 2MB max file size\n  },\n  fileFilter: fileFilter\n});\n\n// Configure market banner uploads storage\nconst marketBannerStorage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, marketBannerUploadsDir);\n  },\n  filename: function (req, file, cb) {\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const ext = path.extname(file.originalname);\n    cb(null, `market-banner-${uniqueSuffix}${ext}`);\n  }\n});\n\n// Configure QR code uploads storage\nconst qrCodeStorage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, qrCodeUploadsDir);\n  },\n  filename: function (req, file, cb) {\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const ext = path.extname(file.originalname);\n    cb(null, `qr-code-${uniqueSuffix}${ext}`);\n  }\n});\n\nconst marketBannerUpload = multer({ \n  storage: marketBannerStorage,\n  limits: {\n    fileSize: 2 * 1024 * 1024 // 2MB max file size\n  },\n  fileFilter: fileFilter\n});\n\nconst qrCodeUpload = multer({ \n  storage: qrCodeStorage,\n  limits: {\n    fileSize: 2 * 1024 * 1024 // 2MB max file size\n  },\n  fileFilter: fileFilter\n});\n\nexport function setupUploadRoutes(app: express.Express) {\n  // Handle authentication middleware\n  const requireAuth = (req: Request, res: Response, next: NextFunction) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: 'Unauthorized' });\n    }\n    next();\n  };\n  \n  // Handle admin role check middleware\n  const requireAdmin = (req: Request, res: Response, next: NextFunction) => {\n    if (!req.isAuthenticated() || !req.user || (req.user as any).role !== UserRole.ADMIN) {\n      return res.status(403).json({ message: 'Forbidden - Admin access required' });\n    }\n    next();\n  };\n\n  // API route to upload proof images\n  app.post('/api/upload/proof', requireAuth, proofUpload.single('proofImage'), (req: Request, res: Response) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'No file uploaded' });\n      }\n\n      // Generate URL for the uploaded file\n      const fileUrl = `/uploads/proofs/${req.file.filename}`;\n      \n      // Return the URL to the client\n      res.json({ \n        success: true, \n        imageUrl: fileUrl \n      });\n    } catch (error) {\n      console.error('Upload error:', error);\n      res.status(500).json({ error: 'File upload failed' });\n    }\n  });\n  \n  // API route to upload slider images (admin only)\n  app.post('/api/upload/slider', requireAdmin, sliderUpload.single('sliderImage'), (req: Request, res: Response) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'No file uploaded' });\n      }\n\n      // Generate URL for the uploaded file\n      const fileUrl = `/uploads/sliders/${req.file.filename}`;\n      \n      // Return the URL to the client\n      res.json({ \n        success: true, \n        imageUrl: fileUrl \n      });\n    } catch (error) {\n      console.error('Upload error:', error);\n      res.status(500).json({ error: 'File upload failed' });\n    }\n  });\n  \n  // API route to get all slider images\n  app.get('/api/sliders', async (req: Request, res: Response) => {\n    try {\n      // Read the sliders directory\n      const files = fs.readdirSync(sliderUploadsDir);\n      \n      // Map to URLs\n      const sliderImages = files.map(file => ({\n        filename: file,\n        url: `/uploads/sliders/${file}`\n      }));\n      \n      res.json(sliderImages);\n    } catch (error) {\n      console.error('Error fetching slider images:', error);\n      res.status(500).json({ error: 'Failed to fetch slider images' });\n    }\n  });\n  \n  // API route to delete a slider image (admin only)\n  app.delete('/api/sliders/:filename', requireAdmin, (req: Request, res: Response) => {\n    try {\n      const { filename } = req.params;\n      const filePath = path.join(sliderUploadsDir, filename);\n      \n      // Check if file exists\n      if (!fs.existsSync(filePath)) {\n        return res.status(404).json({ error: 'Image not found' });\n      }\n      \n      // Delete the file\n      fs.unlinkSync(filePath);\n      \n      res.json({ success: true, message: 'Image deleted successfully' });\n    } catch (error) {\n      console.error('Error deleting slider image:', error);\n      res.status(500).json({ error: 'Failed to delete slider image' });\n    }\n  });\n  \n  // API route to upload hero slider images (admin only)\n  app.post('/api/upload/heroslider', requireAdmin, heroSliderUpload.single('heroSliderImage'), (req: Request, res: Response) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'No file uploaded' });\n      }\n\n      // Generate URL for the uploaded file\n      const fileUrl = `/uploads/hero-sliders/${req.file.filename}`;\n      \n      // Return the URL to the client\n      res.json({ \n        success: true, \n        imageUrl: fileUrl \n      });\n    } catch (error) {\n      console.error('Upload error:', error);\n      res.status(500).json({ error: 'File upload failed' });\n    }\n  });\n  \n  // API route to get all hero slider images\n  app.get('/api/herosliders', async (req: Request, res: Response) => {\n    try {\n      // Read the hero sliders directory\n      const files = fs.readdirSync(heroSliderUploadsDir);\n      \n      // Map to URLs\n      const heroSliderImages = files.map(file => ({\n        filename: file,\n        url: `/uploads/hero-sliders/${file}`\n      }));\n      \n      res.json(heroSliderImages);\n    } catch (error) {\n      console.error('Error fetching hero slider images:', error);\n      res.status(500).json({ error: 'Failed to fetch hero slider images' });\n    }\n  });\n  \n  // API route to delete a hero slider image (admin only)\n  app.delete('/api/herosliders/:filename', requireAdmin, (req: Request, res: Response) => {\n    try {\n      const { filename } = req.params;\n      const filePath = path.join(heroSliderUploadsDir, filename);\n      \n      // Check if file exists\n      if (!fs.existsSync(filePath)) {\n        return res.status(404).json({ error: 'Image not found' });\n      }\n      \n      // Delete the file\n      fs.unlinkSync(filePath);\n      \n      res.json({ success: true, message: 'Hero slider image deleted successfully' });\n    } catch (error) {\n      console.error('Error deleting hero slider image:', error);\n      res.status(500).json({ error: 'Failed to delete hero slider image' });\n    }\n  });\n  \n  // API route to upload game card images (admin only)\n  app.post('/api/upload/gamecard', requireAdmin, gameCardUpload.single('gameCardImage'), (req: Request, res: Response) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'No file uploaded' });\n      }\n      \n      // Get game type from request body (market, cricket, sports, coinflip)\n      const { gameType } = req.body;\n      \n      if (!gameType) {\n        return res.status(400).json({ error: 'Game type is required' });\n      }\n\n      // Create a new filename that includes the game type for better organization\n      const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n      const ext = path.extname(req.file.originalname);\n      const newFilename = `gamecard-${gameType}-${uniqueSuffix}${ext}`;\n      \n      // Create the new file path \n      const oldPath = path.join(gameCardUploadsDir, req.file.filename);\n      const newPath = path.join(gameCardUploadsDir, newFilename);\n      \n      // Rename the file to include the game type\n      fs.renameSync(oldPath, newPath);\n      \n      // Generate URL for the uploaded file\n      const fileUrl = `/uploads/gamecards/${newFilename}`;\n      \n      // Return the URL to the client\n      res.json({ \n        success: true, \n        imageUrl: fileUrl,\n        gameType: gameType,\n        filename: newFilename\n      });\n    } catch (error) {\n      console.error('Upload error:', error);\n      res.status(500).json({ error: 'File upload failed' });\n    }\n  });\n  \n  // API route to get all game card images, optionally filtered by game type\n  app.get('/api/gamecards', async (req: Request, res: Response) => {\n    try {\n      const gameType = req.query.gameType as string | undefined;\n      \n      // Read the game cards directory\n      const files = fs.readdirSync(gameCardUploadsDir);\n      \n      // Filter by game type if provided\n      const filteredFiles = gameType \n        ? files.filter(file => file.includes(`gamecard-${gameType}-`))\n        : files;\n      \n      // Map to URLs\n      const gameCardImages = filteredFiles.map(file => {\n        // Extract game type from filename, ensuring we handle existing files correctly\n        let gameType = 'unknown';\n        \n        // Handle the newer format (with gameType in the name)\n        const typeMatch = file.match(/gamecard-(market|sports|cricket|coinflip)-\\d+/);\n        if (typeMatch) {\n          gameType = typeMatch[1];\n        } \n        // Handle older format or files without proper game type\n        else if (file.includes('market')) {\n          gameType = 'market';\n        } else if (file.includes('sports')) {\n          gameType = 'sports';\n        } else if (file.includes('cricket')) {\n          gameType = 'cricket';\n        } else if (file.includes('coinflip')) {\n          gameType = 'coinflip';\n        }\n        \n        return {\n          filename: file,\n          url: `/uploads/gamecards/${file}`,\n          gameType: gameType\n        };\n      });\n      \n      res.json(gameCardImages);\n    } catch (error) {\n      console.error('Error fetching game card images:', error);\n      res.status(500).json({ error: 'Failed to fetch game card images' });\n    }\n  });\n  \n  // API route to delete a game card image (admin only)\n  app.delete('/api/gamecards/:filename', requireAdmin, (req: Request, res: Response) => {\n    try {\n      const { filename } = req.params;\n      const filePath = path.join(gameCardUploadsDir, filename);\n      \n      // Check if file exists\n      if (!fs.existsSync(filePath)) {\n        return res.status(404).json({ error: 'Image not found' });\n      }\n      \n      // Delete the file\n      fs.unlinkSync(filePath);\n      \n      res.json({ success: true, message: 'Game card image deleted successfully' });\n    } catch (error) {\n      console.error('Error deleting game card image:', error);\n      res.status(500).json({ error: 'Failed to delete game card image' });\n    }\n  });\n\n  // API route to upload match banner images (admin only)\n  app.post('/api/upload/match-banner', requireAdmin, matchBannerUpload.single('matchBannerImage'), (req: Request, res: Response) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'No file uploaded' });\n      }\n      \n      // Generate URL for the uploaded file\n      const fileUrl = `/uploads/match-banners/${req.file.filename}`;\n      \n      // Return the URL to the client\n      res.json({ \n        success: true, \n        imageUrl: fileUrl,\n        filename: req.file.filename\n      });\n    } catch (error) {\n      console.error('Upload error:', error);\n      res.status(500).json({ error: 'File upload failed' });\n    }\n  });\n  \n  // API route to get all match banner images\n  app.get('/api/match-banners', async (req: Request, res: Response) => {\n    try {\n      // Read the match banners directory\n      const files = fs.readdirSync(matchBannerUploadsDir);\n      \n      // Map to URLs\n      const matchBannerImages = files.map(file => ({\n        filename: file,\n        url: `/uploads/match-banners/${file}`\n      }));\n      \n      res.json(matchBannerImages);\n    } catch (error) {\n      console.error('Error fetching match banner images:', error);\n      res.status(500).json({ error: 'Failed to fetch match banner images' });\n    }\n  });\n  \n  // API route to delete a match banner image (admin only)\n  app.delete('/api/match-banners/:filename', requireAdmin, (req: Request, res: Response) => {\n    try {\n      const { filename } = req.params;\n      const filePath = path.join(matchBannerUploadsDir, filename);\n      \n      // Check if file exists\n      if (!fs.existsSync(filePath)) {\n        return res.status(404).json({ error: 'Image not found' });\n      }\n      \n      // Delete the file\n      fs.unlinkSync(filePath);\n      \n      res.json({ success: true, message: 'Match banner image deleted successfully' });\n    } catch (error) {\n      console.error('Error deleting match banner image:', error);\n      res.status(500).json({ error: 'Failed to delete match banner image' });\n    }\n  });\n\n  // API route to upload market banner images (admin only)\n  app.post('/api/upload/market-banner', requireAdmin, marketBannerUpload.single('marketBannerImage'), (req: Request, res: Response) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'No file uploaded' });\n      }\n      \n      // Generate URL for the uploaded file\n      const fileUrl = `/uploads/market-banners/${req.file.filename}`;\n      \n      // Return the URL to the client\n      res.json({ \n        success: true, \n        imageUrl: fileUrl,\n        filename: req.file.filename\n      });\n    } catch (error) {\n      console.error('Upload error:', error);\n      res.status(500).json({ error: 'File upload failed' });\n    }\n  });\n  \n  // API route to get all market banner images\n  app.get('/api/market-banners', async (req: Request, res: Response) => {\n    try {\n      // Read the market banners directory\n      const files = fs.readdirSync(marketBannerUploadsDir);\n      \n      // Map to URLs\n      const marketBannerImages = files.map(file => ({\n        filename: file,\n        url: `/uploads/market-banners/${file}`\n      }));\n      \n      res.json(marketBannerImages);\n    } catch (error) {\n      console.error('Error fetching market banner images:', error);\n      res.status(500).json({ error: 'Failed to fetch market banner images' });\n    }\n  });\n  \n  // API route to delete a market banner image (admin only)\n  app.delete('/api/market-banners/:filename', requireAdmin, (req: Request, res: Response) => {\n    try {\n      const { filename } = req.params;\n      const filePath = path.join(marketBannerUploadsDir, filename);\n      \n      // Check if file exists\n      if (!fs.existsSync(filePath)) {\n        return res.status(404).json({ error: 'Image not found' });\n      }\n      \n      // Delete the file\n      fs.unlinkSync(filePath);\n      \n      res.json({ success: true, message: 'Market banner image deleted successfully' });\n    } catch (error) {\n      console.error('Error deleting market banner image:', error);\n      res.status(500).json({ error: 'Failed to delete market banner image' });\n    }\n  });\n\n  // API route to upload QR code images (admin only)\n  app.post('/api/upload/qr-code', requireAdmin, qrCodeUpload.single('qrImage'), (req: Request, res: Response) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'No file uploaded' });\n      }\n      \n      // Generate URL for the uploaded file\n      const fileUrl = `/uploads/qr-codes/${req.file.filename}`;\n      \n      // Return the URL to the client\n      res.json({ \n        success: true, \n        imageUrl: fileUrl,\n        filename: req.file.filename\n      });\n    } catch (error) {\n      console.error('Upload error:', error);\n      res.status(500).json({ error: 'File upload failed' });\n    }\n  });\n\n  // Allow access to static uploads\n  app.use('/uploads', express.static(uploadsDir));\n}","path":null,"size_bytes":19881,"size_tokens":null},"server/fix-crossing-bets.ts":{"content":"import { db } from './db';\nimport { eq, and, like } from 'drizzle-orm';\nimport { games, users, SatamatkaGameMode } from '../shared/schema';\n\n// Endpoint to fix specific crossing bets that should be wins\nexport async function fixCrossingBets(req: any, res: any) {\n  try {\n    // Check if admin\n    if (!req.isAuthenticated() || req.user.role !== 'admin') {\n      return res.status(403).json({ message: 'Only admin can fix crossing bets' });\n    }\n\n    console.log('Admin requested to fix crossing bets...');\n    \n    // Market ID to check is in req.params\n    const marketId = parseInt(req.params.marketId);\n    if (isNaN(marketId)) {\n      return res.status(400).json({ message: 'Invalid market ID' });\n    }\n    \n    // Get the market to check its result\n    const [market] = await db.select()\n      .from('satamatka_markets')\n      .where(eq('satamatka_markets.id', marketId));\n    \n    if (!market) {\n      return res.status(404).json({ message: 'Market not found' });\n    }\n    \n    if (!market.closeResult) {\n      return res.status(400).json({ message: 'Market does not have a close result' });\n    }\n    \n    console.log(`Fixing crossing bets for market ${marketId} with result ${market.closeResult}`);\n    \n    // Find all crossing games for this market\n    const crossingGames = await db.select()\n      .from(games)\n      .where(\n        and(\n          eq(games.marketId, marketId),\n          eq(games.gameMode, SatamatkaGameMode.CROSSING),\n          eq(games.result, 'loss') // Only look at games currently marked as losses\n        )\n      );\n    \n    console.log(`Found ${crossingGames.length} crossing games to check`);\n    \n    // Track fixed games\n    const fixedGames = [];\n    \n    // Process each game\n    for (const game of crossingGames) {\n      // Extract the digits from the prediction\n      let digits = [];\n      \n      // Handle different prediction formats (e.g., \"0,1,2\", \"012\", etc.)\n      if (game.prediction.includes(',')) {\n        digits = game.prediction.split(',').map(d => d.trim());\n      } else {\n        // If no commas, treat each character as a digit\n        digits = game.prediction.split('');\n      }\n      \n      // Generate all crossing combinations\n      const crossingCombinations = [];\n      for (let i = 0; i < digits.length; i++) {\n        for (let j = 0; j < digits.length; j++) {\n          if (i !== j) {\n            crossingCombinations.push(digits[i] + digits[j]);\n          }\n        }\n      }\n      \n      // Check if result or its reverse matches any crossing combination\n      const resultToCheck = market.closeResult;\n      const reverseResult = resultToCheck.length === 2 \n        ? resultToCheck[1] + resultToCheck[0] \n        : resultToCheck;\n      \n      const shouldBeWin = crossingCombinations.includes(resultToCheck) || \n                         crossingCombinations.includes(reverseResult);\n      \n      console.log(`Game ${game.id}: Prediction=${game.prediction}, Combinations=${crossingCombinations.join(',')}, Result=${market.closeResult}, ShouldBeWin=${shouldBeWin}`);\n      \n      // If should be a win but currently a loss, fix it\n      if (shouldBeWin) {\n        // Get the appropriate odds from game_odds\n        const odds = await db.select()\n          .from('game_odds')\n          .where(\n            and(\n              eq('game_odds.gameType', 'satamatka_crossing'),\n              eq('game_odds.setByAdmin', true)\n            )\n          );\n        \n        let oddValue = odds.length > 0 ? odds[0].oddValue : 950000; // Default to 95x\n        \n        // Calculate payout\n        const payout = Math.round(game.betAmount * (oddValue / 10000));\n        \n        // Update the game\n        await db.update(games)\n          .set({ \n            result: 'win',\n            payout \n          })\n          .where(eq(games.id, game.id));\n        \n        // Update user balance\n        const user = await db.select().from(users).where(eq(users.id, game.userId)).limit(1);\n        if (user && user.length > 0) {\n          const newBalance = user[0].balance + payout;\n          await db.update(users)\n            .set({ balance: newBalance })\n            .where(eq(users.id, game.userId));\n            \n          console.log(`Updated user ${user[0].username} balance: ${user[0].balance/100}  ${newBalance/100}`);\n        }\n        \n        fixedGames.push({\n          gameId: game.id,\n          prediction: game.prediction,\n          previousResult: 'loss',\n          newResult: 'win',\n          payout: payout / 100 // Convert to rupees for display\n        });\n      }\n    }\n    \n    return res.json({\n      success: true,\n      fixed: fixedGames.length,\n      details: fixedGames\n    });\n  } catch (error) {\n    console.error('Error fixing crossing bets:', error);\n    return res.status(500).json({ message: 'Error fixing crossing bets', error: String(error) });\n  }\n}","path":null,"size_bytes":4840,"size_tokens":null},"fix-all-storage-functions.ts":{"content":"// This script implements all the missing storage functions\nimport fs from 'fs';\n\nfunction implementAllFunctions() {\n  try {\n    console.log(\"Implementing all storage functions...\");\n    \n    // Read the storage.ts file\n    const storageFile = fs.readFileSync('./server/storage.ts', 'utf8');\n    \n    // Functions to implement\n    const functionsToImplement = [\n      {\n        name: \"getAllUsers\",\n        pattern: /async getAllUsers\\(\\)[^{]*{[^}]*}/,\n        implementation: `async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users);\n  }`\n      },\n      {\n        name: \"getUsersByAssignedTo\",\n        pattern: /async getUsersByAssignedTo\\([^)]*\\)[^{]*{[^}]*}/,\n        implementation: `async getUsersByAssignedTo(assignedToId: number): Promise<User[]> {\n    return await db.select()\n      .from(users)\n      .where(eq(users.assignedTo, assignedToId));\n  }`\n      },\n      {\n        name: \"getGamesByUserId\",\n        pattern: /async getGamesByUserId\\([^)]*\\)[^{]*{[^}]*}/,\n        implementation: `async getGamesByUserId(userId: number): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(eq(games.userId, userId))\n      .orderBy(desc(games.createdAt));\n  }`\n      },\n      {\n        name: \"getGamesByUserIds\",\n        pattern: /async getGamesByUserIds\\([^)]*\\)[^{]*{[^}]*}/,\n        implementation: `async getGamesByUserIds(userIds: number[]): Promise<Game[]> {\n    if (!userIds.length) return [];\n    return await db.select()\n      .from(games)\n      .where(drizzleIn(games.userId, userIds))\n      .orderBy(desc(games.createdAt));\n  }`\n      },\n      {\n        name: \"getAllGames\",\n        pattern: /async getAllGames\\([^)]*\\)[^{]*{[^}]*}/,\n        implementation: `async getAllGames(limit?: number): Promise<Game[]> {\n    let query = db.select()\n      .from(games)\n      .orderBy(desc(games.createdAt));\n\n    if (limit) {\n      query = query.limit(limit);\n    }\n\n    return await query;\n  }`\n      },\n      {\n        name: \"getRecentGames\",\n        pattern: /async getRecentGames\\([^)]*\\)[^{]*{[^}]*}/,\n        implementation: `async getRecentGames(userId: number, limit?: number): Promise<Game[]> {\n    let query = db.select()\n      .from(games)\n      .where(eq(games.userId, userId))\n      .orderBy(desc(games.createdAt));\n\n    if (limit) {\n      query = query.limit(limit);\n    }\n\n    return await query;\n  }`\n      }\n    ];\n    \n    let updatedFile = storageFile;\n    \n    // Replace each function implementation\n    for (const func of functionsToImplement) {\n      console.log(`Implementing ${func.name}...`);\n      \n      if (func.pattern.test(updatedFile)) {\n        updatedFile = updatedFile.replace(func.pattern, func.implementation);\n        console.log(`Implemented ${func.name} successfully`);\n      } else {\n        console.log(`Could not find ${func.name} in storage.ts`);\n      }\n    }\n    \n    // Check if we made any changes\n    if (updatedFile !== storageFile) {\n      // Fix import for drizzleIn\n      if (updatedFile.includes('drizzleIn') && !updatedFile.includes('drizzleIn(')) {\n        updatedFile = updatedFile.replace(\n          \"import { eq, desc, and, lt, gt, gte, lte, ne, isNotNull, or, sql, asc, count, in as drizzleIn, isNull, like, not } from 'drizzle-orm';\",\n          \"import { eq, desc, and, lt, gt, gte, lte, ne, isNotNull, or, sql, asc, count, isNull, like, not, drizzleIn } from 'drizzle-orm';\"\n        );\n      }\n      \n      // Write the updated file\n      fs.writeFileSync('./server/storage.ts', updatedFile);\n      console.log(\"Updated storage.ts with all function implementations\");\n    } else {\n      console.log(\"No changes were made to storage.ts\");\n    }\n    \n    console.log(\"Storage implementation complete!\");\n  } catch (error) {\n    console.error(\"Error implementing storage functions:\", error);\n  }\n}\n\nimplementAllFunctions();","path":null,"size_bytes":3834,"size_tokens":null},"client/src/components/recent-results.tsx":{"content":"import { useState } from \"react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { BarChart2, Clock, Calendar, Target, ArrowRight } from \"lucide-react\";\nimport { \n  Card, \n  CardContent, \n  CardHeader, \n  CardTitle, \n  CardFooter\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useLocation } from \"wouter\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { UserRole } from \"@shared/schema\";\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\n\ninterface MarketResult {\n  id: number;\n  name: string;\n  type: string;\n  openTime: string;\n  closeTime: string;\n  openResult?: string;\n  closeResult?: string | null;\n  status: string;\n  createdAt: string;\n}\n\ninterface RecentResultsProps {\n  results: MarketResult[];\n  showTabs?: boolean; // Optional prop to control tabs visibility\n}\n\nexport default function RecentResults({ results, showTabs = false }: RecentResultsProps) {\n  const [_, setLocation] = useLocation();\n  const [tab, setTab] = useState(\"today\");\n  const { user } = useAuth();\n  const isPlayer = user?.role === UserRole.PLAYER;\n  \n  // Filter today's results\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  \n  const todayResults = results.filter(result => {\n    const resultDate = new Date(result.createdAt);\n    return resultDate >= today;\n  });\n  \n  // Display results - for players, always show only today's results\n  const displayResults = isPlayer ? todayResults : \n    (tab === \"today\" ? todayResults : results);\n  \n  // Empty state\n  if ((isPlayer && todayResults.length === 0) || (!isPlayer && results.length === 0)) {\n    return (\n      <Card className=\"bg-slate-900/70 border-slate-800\">\n        <CardHeader>\n          <CardTitle className=\"text-xl flex items-center text-slate-200\">\n            <BarChart2 className=\"w-5 h-5 text-blue-400 mr-2\" />\n            {isPlayer ? \"Today's Results\" : \"Recent Results\"}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-col items-center justify-center py-6\">\n            <Target className=\"h-12 w-12 text-slate-700 mb-2\" />\n            <p className=\"text-slate-500 text-sm\">\n              {isPlayer ? \"No results available for today\" : \"No recent results available\"}\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"bg-slate-900/70 border-slate-800\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-xl flex items-center text-slate-200\">\n          <BarChart2 className=\"w-5 h-5 text-blue-400 mr-2\" />\n          {isPlayer ? \"Today's Results\" : \"Recent Results\"}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"px-0 pb-1\">\n        {/* Show tabs only for admins/subadmins and when showTabs is true */}\n        {!isPlayer && showTabs ? (\n          <Tabs defaultValue={tab} onValueChange={setTab} className=\"px-6\">\n            <TabsList className=\"mb-4 bg-slate-800/60\">\n              <TabsTrigger \n                value=\"today\" \n                className=\"data-[state=active]:bg-gradient-to-r data-[state=active]:from-primary data-[state=active]:to-purple-700 data-[state=active]:text-white\"\n              >\n                Today\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"all\" \n                className=\"data-[state=active]:bg-gradient-to-r data-[state=active]:from-primary data-[state=active]:to-purple-700 data-[state=active]:text-white\"\n              >\n                All Results\n              </TabsTrigger>\n            </TabsList>\n            \n            <TabsContent value=\"today\" className=\"mt-0\">\n              <div className=\"space-y-3\">\n                {todayResults.slice(0, 5).map((result) => (\n                  <ResultItem key={result.id} result={result} />\n                ))}\n              </div>\n            </TabsContent>\n            \n            <TabsContent value=\"all\" className=\"mt-0\">\n              <div className=\"space-y-3\">\n                {results.slice(0, 8).map((result) => (\n                  <ResultItem key={result.id} result={result} />\n                ))}\n              </div>\n            </TabsContent>\n          </Tabs>\n        ) : (\n          // For players or when tabs are disabled\n          <div className=\"space-y-3 px-6\">\n            {(isPlayer ? todayResults : displayResults).slice(0, 5).map((result) => (\n              <ResultItem key={result.id} result={result} />\n            ))}\n          </div>\n        )}\n      </CardContent>\n      <CardFooter className=\"pt-1\">\n        <Button \n          variant=\"ghost\" \n          className=\"w-full text-primary hover:text-purple-400 hover:bg-slate-800/60 flex items-center justify-center\"\n          onClick={() => setLocation(\"/results\")}\n        >\n          View All Results\n          <ArrowRight className=\"h-4 w-4 ml-1\" />\n        </Button>\n      </CardFooter>\n    </Card>\n  );\n}\n\nfunction ResultItem({ result }: { result: MarketResult }) {\n  const getStatusBadge = (status: string) => {\n    switch (status.toLowerCase()) {\n      case \"open\":\n        return <Badge variant=\"outline\" className=\"bg-violet-900/30 text-violet-300 border-violet-500/30\">Open</Badge>;\n      case \"closed\":\n        return <Badge variant=\"outline\" className=\"bg-amber-900/30 text-amber-300 border-amber-500/30\">Closed</Badge>;\n      case \"resulted\":\n        return <Badge variant=\"outline\" className=\"bg-emerald-900/30 text-emerald-300 border-emerald-500/30\">Resulted</Badge>;\n      default:\n        return <Badge variant=\"outline\" className=\"bg-slate-800 text-slate-300 border-slate-700\">{status}</Badge>;\n    }\n  };\n\n  const formatResult = (result?: string) => {\n    if (!result) return \"-\";\n    \n    // For Dishawar and Gali markets, ensure two-digit format with leading zero if needed\n    if (result.length === 1) {\n      return `0${result}`;\n    } else if (result.length === 2) {\n      return result;\n    } else {\n      return result;\n    }\n  };\n\n  const timeAgo = formatDistanceToNow(new Date(result.createdAt), { addSuffix: true });\n  \n  return (\n    <div className=\"p-3 rounded-lg border border-slate-800 bg-slate-800/50\">\n      <div className=\"flex justify-between items-start mb-2\">\n        <div>\n          <h4 className=\"font-medium text-sm text-slate-200\">{result.name}</h4>\n          <div className=\"flex items-center text-xs text-slate-500 mt-0.5\">\n            <Clock className=\"h-3 w-3 mr-1\" />\n            <span>{timeAgo}</span>\n          </div>\n        </div>\n        {getStatusBadge(result.status)}\n      </div>\n      \n      <div className=\"flex justify-center mt-3 text-sm\">\n        <div className=\"text-center\">\n          <p className=\"text-xs text-slate-500\">Result</p>\n          <p className={`font-medium text-3xl ${result.name === \"Dishawar\" || result.name === \"Gali\" \n            ? \"text-gradient bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-primary\"\n            : \"text-pink-400\"}`}>\n            {formatResult(result.openResult || result.closeResult)}\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":7133,"size_tokens":null},"server/wallet-system.ts":{"content":"import { db } from './db';\nimport express, { Request, Response, NextFunction } from 'express';\nimport { z } from 'zod';\nimport { UserRole, walletRequests, users, transactions, systemSettings, depositCommissions, playerDepositDiscounts } from '@shared/schema';\nimport { eq, desc, and, isNull } from 'drizzle-orm';\n\n// Payment Modes\nexport const PaymentMode = {\n  UPI: 'upi',\n  BANK: 'bank',\n} as const;\n\n// Request Status\nexport const RequestStatus = {\n  PENDING: 'pending',\n  APPROVED: 'approved',\n  REJECTED: 'rejected',\n} as const;\n\n// Request Type\nexport const RequestType = {\n  DEPOSIT: 'deposit',\n  WITHDRAWAL: 'withdrawal',\n  PLATFORM_INVESTMENT: 'platform_investment',\n} as const;\n\n// Validation schemas\nexport const walletRequestSchema = z.object({\n  userId: z.number(),\n  amount: z.number().positive(),\n  requestType: z.enum([RequestType.DEPOSIT, RequestType.WITHDRAWAL, RequestType.PLATFORM_INVESTMENT]),\n  paymentMode: z.enum([PaymentMode.UPI, PaymentMode.BANK]),\n  paymentDetails: z.object({\n    upiId: z.string().optional(),\n    bankName: z.string().optional(),\n    accountNumber: z.string().optional(),\n    ifscCode: z.string().optional(),\n    utrNumber: z.string().optional(),\n    transactionId: z.string().optional(),\n  }),\n  proofImageUrl: z.string().optional(),\n  notes: z.string().optional(),\n});\n\nexport const adminRequestReviewSchema = z.object({\n  status: z.enum([RequestStatus.APPROVED, RequestStatus.REJECTED]),\n  notes: z.string().optional(),\n});\n\n// Wallet Request Types\nexport type WalletRequest = {\n  id: number;\n  userId: number;\n  amount: number;\n  requestType: typeof RequestType[keyof typeof RequestType];\n  paymentMode: typeof PaymentMode[keyof typeof PaymentMode];\n  paymentDetails: {\n    upiId?: string;\n    bankName?: string;\n    accountNumber?: string;\n    ifscCode?: string;\n    utrNumber?: string;\n    transactionId?: string;\n  };\n  status: typeof RequestStatus[keyof typeof RequestStatus];\n  proofImageUrl?: string;\n  notes?: string;\n  reviewedBy?: number;\n  createdAt: Date;\n  updatedAt: Date;\n};\n\n// Helper functions for wallet requests\nexport async function createWalletRequest(walletRequest: Omit<WalletRequest, 'id' | 'status' | 'reviewedBy' | 'createdAt' | 'updatedAt'>) {\n  try {\n    // Store the request using Drizzle ORM\n    const result = await db.insert(walletRequests).values({\n      userId: walletRequest.userId,\n      amount: walletRequest.amount,\n      requestType: walletRequest.requestType,\n      paymentMode: walletRequest.paymentMode,\n      paymentDetails: walletRequest.paymentDetails,\n      status: RequestStatus.PENDING,\n      proofImageUrl: walletRequest.proofImageUrl || null,\n      notes: walletRequest.notes || null,\n    }).returning();\n\n    return result[0];\n  } catch (error) {\n    console.error('Error creating wallet request:', error);\n    throw new Error('Failed to create wallet request');\n  }\n}\n\nexport async function getWalletRequests(userId?: number, status?: string, requestType?: string, adminId?: number) {\n  try {\n    // For subadmin filtering, we need to use a raw SQL query for proper joining\n    if (adminId) {\n      // Import the connection pool for raw SQL queries\n      const { pool } = await import('./db');\n      \n      const filters = [];\n      const params = [];\n      \n      // Add base condition for assigned users\n      filters.push(`u.assigned_to = $${params.length + 1}`);\n      params.push(adminId);\n      \n      if (userId) {\n        filters.push(`wr.user_id = $${params.length + 1}`);\n        params.push(userId);\n      }\n      \n      if (status) {\n        filters.push(`wr.status = $${params.length + 1}`);\n        params.push(status);\n      }\n      \n      if (requestType) {\n        filters.push(`wr.request_type = $${params.length + 1}`);\n        params.push(requestType);\n      }\n      \n      const whereClause = filters.length > 0 ? `WHERE ${filters.join(\" AND \")}` : \"\";\n      \n      const result = await pool.query(\n        `SELECT wr.*, u.username, u.role \n         FROM wallet_requests wr\n         JOIN users u ON wr.user_id = u.id\n         ${whereClause}\n         ORDER BY wr.created_at DESC`,\n        params\n      );\n      \n      // Transform to match the expected format with nested user object\n      return result.rows.map(row => ({\n        ...row,\n        user: {\n          id: row.user_id,\n          username: row.username,\n          role: row.role\n        }\n      }));\n    }\n    \n    // For queries without admin filtering, use a join to include user information\n    const whereConditions = [];\n    \n    if (userId) {\n      whereConditions.push(eq(walletRequests.userId, userId));\n    }\n    \n    if (status) {\n      whereConditions.push(eq(walletRequests.status, status));\n    }\n    \n    if (requestType) {\n      whereConditions.push(eq(walletRequests.requestType, requestType));\n    }\n    \n    // Get wallet requests with joined user data\n    const results = whereConditions.length > 0 \n      ? await db.select({\n          request: walletRequests,\n          user: {\n            id: users.id,\n            username: users.username,\n            role: users.role\n          }\n        })\n        .from(walletRequests)\n        .innerJoin(users, eq(walletRequests.userId, users.id))\n        .where(and(...whereConditions))\n        .orderBy(desc(walletRequests.createdAt))\n      : await db.select({\n          request: walletRequests,\n          user: {\n            id: users.id,\n            username: users.username,\n            role: users.role\n          }\n        })\n        .from(walletRequests)\n        .innerJoin(users, eq(walletRequests.userId, users.id))\n        .orderBy(desc(walletRequests.createdAt));\n    \n    // Transform results to the expected format\n    return results.map(({ request, user }) => ({\n      ...request,\n      user\n    }));\n  } catch (error) {\n    console.error('Error getting wallet requests:', error);\n    throw new Error('Failed to get wallet requests');\n  }\n}\n\n// This function has been moved to deposit-commission-endpoint.ts\n// It is imported there when needed\n// Removing it here to avoid duplicate declarations\n\nexport async function reviewWalletRequest(\n  requestId: number, \n  adminId: number, \n  status: typeof RequestStatus[keyof typeof RequestStatus], \n  notes?: string\n) {\n  try {\n    // Import the connection pool for raw SQL transactions\n    const { pool } = await import('./db');\n    // For transactions, we need to use the raw pool to start/commit/rollback the transaction\n    const client = await pool.connect();\n    \n    try {\n      await client.query('BEGIN');\n      \n      // Update the request status\n      const updatedRequests = await db\n        .update(walletRequests)\n        .set({\n          status: status,\n          notes: notes || null,\n          reviewedBy: adminId,\n          updatedAt: new Date()\n        })\n        .where(eq(walletRequests.id, requestId))\n        .returning();\n      \n      if (updatedRequests.length === 0) {\n        await client.query('ROLLBACK');\n        throw new Error('Wallet request not found');\n      }\n      \n      const request = updatedRequests[0];\n      \n      // If request is approved, update the user's balance and create a transaction record\n      if (status === RequestStatus.APPROVED) {\n        // Convert amount to paisa (multiply by 100) since the balance is stored in paisa\n        // but the deposit/withdrawal amounts are entered in rupees\n        const balanceChangeRupees = request.requestType === RequestType.WITHDRAWAL \n          ? -request.amount \n          : request.amount;\n          \n        // Convert rupees to paisa (multiply by 100) for storage\n        const balanceChangePaisa = balanceChangeRupees * 100;\n        \n        // Update user balance with SQL function to add\n        const updatedUsersResult = await client.query(\n          'UPDATE users SET balance = balance + $1 WHERE id = $2 RETURNING *',\n          [balanceChangePaisa, request.userId]\n        );\n        \n        if (updatedUsersResult.rowCount === 0) {\n          await client.query('ROLLBACK');\n          throw new Error('User not found');\n        }\n        \n        // Get the updated user balance after the transaction\n        const updatedUser = await client.query(\n          'SELECT balance FROM users WHERE id = $1',\n          [request.userId]\n        );\n        \n        // Get the admin's username and role to include in the description\n        const adminResult = await client.query(\n          'SELECT username, role FROM users WHERE id = $1',\n          [adminId]\n        );\n        \n        let adminDescription = '';\n        if (adminResult?.rowCount && adminResult.rowCount > 0) {\n          adminDescription = `${adminResult.rows[0].username} (${adminResult.rows[0].role})`;\n        } else {\n          adminDescription = `Admin #${adminId}`;\n        }\n        \n        // Create appropriate description based on request type\n        let transactionDescription;\n        \n        if (request.requestType === RequestType.PLATFORM_INVESTMENT) {\n          transactionDescription = `Platform Investment approved by ${adminDescription}`;\n        } else {\n          transactionDescription = `${request.requestType === RequestType.DEPOSIT ? 'Deposit' : 'Withdrawal'} request processed by ${adminDescription}`;\n        }\n        \n        // Create transaction record with the player's balance after this transaction\n        await db.insert(transactions).values({\n          userId: request.userId,\n          amount: balanceChangePaisa, // Use the converted amount (paisa)\n          balanceAfter: updatedUser.rows[0].balance, // Include the player's updated balance\n          performedBy: adminId,\n          requestId: requestId,\n          description: transactionDescription,\n        });\n      }\n      \n      await client.query('COMMIT');\n      return request;\n    } catch (error) {\n      await client.query('ROLLBACK');\n      throw error;\n    } finally {\n      client.release();\n    }\n  } catch (error) {\n    console.error('Error reviewing wallet request:', error);\n    throw new Error('Failed to review wallet request');\n  }\n}\n\n// Note: 'getSubadminDepositCommission' has been moved to deposit-commission-endpoint.ts\n// We no longer define it here to avoid duplicate declarations\n\n// This function is kept for backward compatibility\n// All deposit commission endpoints are now managed in deposit-commission-endpoint.ts\nexport async function setupDepositCommissions(app: express.Express) {\n  // This function has been moved to deposit-commission-endpoint.ts\n  // No implementation needed here since endpoints are registered there\n}\n\nexport function setupWalletRoutes(app: express.Express) {\n  // Create a new wallet request (deposit or withdrawal)\n  app.post('/api/wallet/requests', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      const validatedData = walletRequestSchema.parse({\n        ...req.body,\n        userId: req.user.id,\n      });\n      \n      const newRequest = await createWalletRequest(validatedData);\n      res.status(201).json(newRequest);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Special endpoint for admin platform investments (self-funding with tracking)\n  app.post('/api/admin/platform-investment', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Only admin can access this endpoint\n      if (req.user.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: 'Forbidden - Only admins can make platform investments' });\n      }\n      \n      const { amount, notes } = req.body;\n      \n      if (!amount || amount <= 0 || !notes) {\n        return res.status(400).json({ message: 'Invalid request data - amount and notes are required' });\n      }\n      \n      // Start a transaction\n      const { pool } = await import('./db');\n      const client = await pool.connect();\n      \n      try {\n        await client.query('BEGIN');\n        \n        // Convert amount to paisa for storage\n        const amountInPaisa = amount * 100;\n        \n        // Update admin's balance\n        const updatedUserResult = await client.query(\n          'UPDATE users SET balance = balance + $1 WHERE id = $2 RETURNING balance',\n          [amountInPaisa, req.user.id]\n        );\n        \n        if (updatedUserResult.rowCount === 0) {\n          await client.query('ROLLBACK');\n          return res.status(500).json({ message: 'Failed to update admin balance' });\n        }\n        \n        // Get the updated balance\n        const updatedBalance = updatedUserResult.rows[0].balance;\n        \n        // Create transaction record with special description\n        const transactionResult = await client.query(\n          'INSERT INTO transactions (user_id, amount, balance_after, performed_by, description) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n          [req.user.id, amountInPaisa, updatedBalance, req.user.id, `Platform Investment: ${notes}`]\n        );\n        \n        await client.query('COMMIT');\n        \n        // Return the transaction and updated user\n        res.status(201).json({\n          transaction: transactionResult.rows[0],\n          userBalance: updatedBalance / 100, // Convert back to rupees for display\n          message: 'Platform investment recorded successfully.'\n        });\n        \n      } catch (error) {\n        await client.query('ROLLBACK');\n        console.error('Investment error:', error);\n        res.status(500).json({ message: 'Platform investment failed' });\n      } finally {\n        client.release();\n      }\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Get all wallet requests (admin/subadmin only)\n  app.get('/api/wallet/requests', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Only admin and subadmin can access this endpoint\n      if (req.user.role !== UserRole.ADMIN && req.user.role !== UserRole.SUBADMIN) {\n        return res.status(403).json({ message: 'Forbidden' });\n      }\n      \n      const { status, type } = req.query;\n      \n      // For admins, show all requests\n      // For subadmins, show only requests from their assigned users\n      const requests = await getWalletRequests(\n        undefined, \n        status as string, \n        type as string,\n        req.user.role === UserRole.SUBADMIN ? req.user.id : undefined\n      );\n      \n      res.json(requests);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Get user's own wallet requests\n  app.get('/api/wallet/my-requests', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      const requests = await getWalletRequests(req.user.id);\n      res.json(requests);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Admin/subadmin review a wallet request\n  app.patch('/api/wallet/requests/:id', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Only admin and subadmin can access this endpoint\n      if (req.user.role !== UserRole.ADMIN && req.user.role !== UserRole.SUBADMIN) {\n        return res.status(403).json({ message: 'Forbidden' });\n      }\n      \n      const requestId = Number(req.params.id);\n      \n      // Validate the request data\n      const validatedData = adminRequestReviewSchema.parse(req.body);\n      \n      // For subadmins, verify they can only approve requests from their assigned users\n      if (req.user.role === UserRole.SUBADMIN) {\n        // Import the connection pool for raw SQL transactions\n        const { pool } = await import('./db');\n        // Use a direct SQL query for this specific check\n        const result = await pool.query(\n          `SELECT wr.* FROM wallet_requests wr\n           JOIN users u ON wr.user_id = u.id\n           WHERE wr.id = $1 AND u.assigned_to = $2`,\n          [requestId, req.user.id]\n        );\n        \n        if (result.rowCount === 0) {\n          return res.status(403).json({ message: 'You can only review requests from your assigned users' });\n        }\n      }\n      \n      const updatedRequest = await reviewWalletRequest(\n        requestId,\n        req.user.id,\n        validatedData.status,\n        validatedData.notes\n      );\n      \n      res.json(updatedRequest);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Get payment details defined by admin\n  app.get('/api/wallet/payment-details', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Get payment details from settings\n      const paymentSettings = await db.query.systemSettings.findFirst({\n        where: eq(systemSettings.settingKey, 'payment_details')\n      });\n      \n      // Default payment details if none found\n      if (!paymentSettings) {\n        // Get all payment-related settings to build our response\n        const upiSettings = await db.query.systemSettings.findFirst({\n          where: eq(systemSettings.settingKey, 'upi_id')\n        });\n        \n        const bankNameSettings = await db.query.systemSettings.findFirst({\n          where: eq(systemSettings.settingKey, 'bank_name')\n        });\n        \n        const accountHolderSettings = await db.query.systemSettings.findFirst({\n          where: eq(systemSettings.settingKey, 'account_holder')\n        });\n        \n        const accountNumberSettings = await db.query.systemSettings.findFirst({\n          where: eq(systemSettings.settingKey, 'account_number')\n        });\n        \n        const ifscCodeSettings = await db.query.systemSettings.findFirst({\n          where: eq(systemSettings.settingKey, 'ifsc_code')\n        });\n        \n        // Use admin values from settings, or fallback to defaults if truly not set\n        return res.json({\n          upi: {\n            id: upiSettings?.settingValue || 'admin@upi',\n            qrCode: null,\n          },\n          bank: {\n            name: bankNameSettings?.settingValue || 'Bank Name',\n            accountNumber: accountNumberSettings?.settingValue || 'Account Number',\n            ifscCode: ifscCodeSettings?.settingValue || 'IFSC Code',\n            accountHolder: accountHolderSettings?.settingValue || 'Account Holder',\n          }\n        });\n      }\n      \n      // Parse the setting value safely\n      let parsedValue;\n      try {\n        parsedValue = JSON.parse(paymentSettings.settingValue);\n      } catch (e) {\n        console.error('Error parsing payment details:', e);\n        parsedValue = {};\n      }\n      \n      res.json(parsedValue);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Update payment details (admin only)\n  app.put('/api/wallet/payment-details', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Only admin can update payment details\n      if (req.user.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: 'Forbidden' });\n      }\n      \n      // Convert request body to JSON string\n      const settingValueJson = JSON.stringify(req.body);\n      \n      // Check if the setting already exists\n      const existingSetting = await db.query.systemSettings.findFirst({\n        where: eq(systemSettings.settingKey, 'payment_details')\n      });\n      \n      if (existingSetting) {\n        // Update existing setting\n        await db.update(systemSettings)\n          .set({\n            settingValue: settingValueJson\n          })\n          .where(eq(systemSettings.settingKey, 'payment_details'));\n      } else {\n        // Insert new setting\n        await db.insert(systemSettings).values({\n          settingType: 'payment',\n          settingKey: 'payment_details',\n          settingValue: settingValueJson\n        });\n      }\n      \n      res.json({ success: true });\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Admin direct transaction endpoint (for adding/removing funds directly)\n  app.post('/api/admin/transactions', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Only admin and subadmin can access this endpoint\n      if (req.user.role !== UserRole.ADMIN && req.user.role !== UserRole.SUBADMIN) {\n        return res.status(403).json({ message: 'Forbidden' });\n      }\n      \n      // Validate the request data\n      const { userId, amount, transactionType, notes } = req.body;\n      \n      if (!userId || !amount || amount <= 0 || !transactionType || !notes) {\n        return res.status(400).json({ message: 'Invalid request data' });\n      }\n      \n      // For subadmins, verify they can only process transactions for their assigned users\n      if (req.user.role === UserRole.SUBADMIN) {\n        // Import the connection pool for raw SQL transactions\n        const { pool } = await import('./db');\n        // Use a direct SQL query for this specific check\n        const result = await pool.query(\n          `SELECT * FROM users WHERE id = $1 AND assigned_to = $2`,\n          [userId, req.user.id]\n        );\n        \n        if (result.rowCount === 0) {\n          return res.status(403).json({ message: 'You can only process transactions for your assigned users' });\n        }\n      }\n      \n      // Start a transaction\n      const { pool } = await import('./db');\n      const client = await pool.connect();\n      \n      try {\n        await client.query('BEGIN');\n        \n        // Get the user receiving funds\n        const userResult = await client.query('SELECT * FROM users WHERE id = $1', [userId]);\n        \n        if (userResult.rowCount === 0) {\n          await client.query('ROLLBACK');\n          return res.status(404).json({ message: 'User not found' });\n        }\n\n        // Convert amount to paisa for storage\n        const amountInPaisa = amount * 100;\n        const actualAmount = transactionType === 'deposit' ? amountInPaisa : -amountInPaisa;\n        \n        // Special case: Admin adding funds to their own wallet (platform investment)\n        const isAdminSelfFunding = req.user.role === UserRole.ADMIN && userId === req.user.id && transactionType === 'deposit';\n        \n        // If admin is adding funds to another user/subadmin, check admin's balance\n        if (req.user.role === UserRole.ADMIN && transactionType === 'deposit' && userId !== req.user.id) {\n          // Get admin's current balance\n          const adminResult = await client.query('SELECT balance FROM users WHERE id = $1', [req.user.id]);\n          \n          // Check if target user is a subadmin for commission calculations\n          const isTargetSubadmin = userResult.rows[0].role === UserRole.SUBADMIN;\n          \n          // For transfers to subadmins, we apply the commission logic where only a percentage of funds\n          // is deducted from the admin's wallet (commission-based system)\n          let adminDeductionAmount = amountInPaisa; // Default: deduct full amount for players\n          \n          if (isTargetSubadmin) {\n            // Get the commission rate for this subadmin (e.g., 50% = 5000 means subadmin handles 50%)\n            // Import from deposit-commission-endpoint.ts to get the current implementation\n            const { getSubadminDepositCommission } = await import('./deposit-commission-endpoint');\n            const commissionRate = await getSubadminDepositCommission(userId);\n            \n            // Calculate the amount to deduct from admin\n            // Commission rate represents what percentage the subadmin handles themselves\n            // So admin pays (100% - commission%) of the amount\n            // If commission is 0%, admin pays 100%\n            // If commission is 50%, admin pays 50%\n            // If commission is 100%, admin pays 0%\n            adminDeductionAmount = amountInPaisa - Math.floor((amountInPaisa * commissionRate) / 10000);\n            \n            // Log the commission calculation for debugging\n            const subadminHandles = amountInPaisa - adminDeductionAmount;\n            console.log(`Transfer to subadmin ${userId}: Total amount: ${amountInPaisa}, Commission rate: ${commissionRate/100}%, Admin deduction: ${adminDeductionAmount}, Subadmin handles: ${subadminHandles}`);\n          }\n          \n          // Check if admin has sufficient balance for the deduction\n          if (adminResult.rowCount === 0 || adminResult.rows[0].balance < adminDeductionAmount) {\n            await client.query('ROLLBACK');\n            return res.status(400).json({ \n              message: 'Insufficient balance to fund user. Please add funds to your admin wallet first.' \n            });\n          }\n          \n          // Deduct the calculated amount from admin's balance\n          await client.query(\n            'UPDATE users SET balance = balance - $1 WHERE id = $2',\n            [adminDeductionAmount, req.user.id]\n          );\n          \n          // Record this deduction in admin's transactions\n          const description = isTargetSubadmin \n            ? `Fund transferred to ${userResult.rows[0].username} (${userResult.rows[0].role}) deducted from ${req.user.username} (${req.user.role}) (Commission applied)` \n            : `Fund transferred to ${userResult.rows[0].username} (${userResult.rows[0].role}) deducted from ${req.user.username} (${req.user.role})`;\n            \n          await client.query(\n            'INSERT INTO transactions (user_id, amount, performed_by, description, balance_after) VALUES ($1, $2, $3, $4, $5)',\n            [\n              req.user.id, \n              -adminDeductionAmount, \n              req.user.id, \n              description,\n              adminResult.rows[0].balance - adminDeductionAmount\n            ]\n          );\n        }\n        \n        // If admin is deducting funds from a user/subadmin, add those funds to admin's wallet\n        if (req.user.role === UserRole.ADMIN && transactionType === 'withdraw' && userId !== req.user.id) {\n          // First check if user has sufficient balance\n          if (userResult.rows[0].balance < amountInPaisa) {\n            await client.query('ROLLBACK');\n            return res.status(400).json({ \n              message: 'User has insufficient balance for this deduction.' \n            });\n          }\n          \n          // Check if target user is a subadmin for commission calculations\n          const isTargetSubadmin = userResult.rows[0].role === UserRole.SUBADMIN;\n          \n          // For withdrawals from subadmins, we apply the commission logic where only a percentage \n          // of funds is added to the admin's wallet (commission-based system)\n          let adminAdditionAmount = amountInPaisa; // Default: add full amount for players\n          \n          if (isTargetSubadmin) {\n            // Get the commission rate for this subadmin (e.g., 50% = 5000 means subadmin handles 50%)\n            // Import from deposit-commission-endpoint.ts to get the current implementation\n            const { getSubadminDepositCommission } = await import('./deposit-commission-endpoint');\n            const commissionRate = await getSubadminDepositCommission(userId);\n            \n            // Calculate the amount to add to admin\n            // Commission rate represents what percentage the subadmin handles themselves\n            // So admin receives (100% - commission%) of the amount\n            // If commission is 0%, admin gets 100%\n            // If commission is 50%, admin gets 50%\n            // If commission is 100%, admin gets 0%\n            adminAdditionAmount = amountInPaisa - Math.floor((amountInPaisa * commissionRate) / 10000);\n            \n            // Log the commission calculation for debugging\n            console.log(`Withdrawal from subadmin ${userId}: Total amount: ${amountInPaisa}, Commission rate: ${commissionRate/100}%, Admin addition: ${adminAdditionAmount}`);\n          }\n          \n          // Get admin's current balance before update\n          const adminResult = await client.query('SELECT balance FROM users WHERE id = $1', [req.user.id]);\n          \n          // Add the calculated amount to admin's balance\n          await client.query(\n            'UPDATE users SET balance = balance + $1 WHERE id = $2',\n            [adminAdditionAmount, req.user.id]\n          );\n          \n          // Record this addition in admin's transactions\n          const description = isTargetSubadmin \n            ? `Fund added to ${req.user.username} (${req.user.role}) deducted from ${userResult.rows[0].username} (${userResult.rows[0].role}) (Commission applied)` \n            : `Fund added to ${req.user.username} (${req.user.role}) deducted from ${userResult.rows[0].username} (${userResult.rows[0].role})`;\n          \n          await client.query(\n            'INSERT INTO transactions (user_id, amount, performed_by, description, balance_after) VALUES ($1, $2, $3, $4, $5)',\n            [\n              req.user.id, \n              adminAdditionAmount, \n              req.user.id, \n              description,\n              adminResult.rows[0].balance + adminAdditionAmount\n            ]\n          );\n        }\n        \n        // Update user balance\n        const updatedUserResult = await client.query(\n          'UPDATE users SET balance = balance + $1 WHERE id = $2 RETURNING balance',\n          [actualAmount, userId]\n        );\n        \n        if (updatedUserResult.rowCount === 0) {\n          await client.query('ROLLBACK');\n          return res.status(500).json({ message: 'Failed to update user balance' });\n        }\n        \n        // Get the updated balance\n        const updatedBalance = updatedUserResult.rows[0].balance;\n        \n        // Create transaction record with appropriate description\n        let transactionDescription;\n        \n        if (isAdminSelfFunding) {\n          transactionDescription = `Platform Investment`;\n        } else {\n          // Include both recipient and sender information in the description\n          if (transactionType === 'deposit') {\n            // For deposit, include special info about commission for subadmin\n            const isSubadminReceivingFunds = userResult.rows[0].role === UserRole.SUBADMIN;\n            transactionDescription = isSubadminReceivingFunds && req.user.role === UserRole.ADMIN\n              ? `Fund added to ${userResult.rows[0].username} (${userResult.rows[0].role}) from ${req.user.username} (${req.user.role}) (Commission applied)`\n              : `Fund added to ${userResult.rows[0].username} (${userResult.rows[0].role}) from ${req.user.username} (${req.user.role})`;\n          } else {\n            // For withdraw, special handling for subadmin transactions with commission\n            const isSubadminLosingFunds = userResult.rows[0].role === UserRole.SUBADMIN && req.user.role === UserRole.ADMIN;\n            transactionDescription = isSubadminLosingFunds\n              ? `Fund deducted from ${userResult.rows[0].username} (${userResult.rows[0].role}) added to ${req.user.username} (${req.user.role}) (Commission applied)`\n              : `Fund deducted from ${userResult.rows[0].username} (${userResult.rows[0].role}) by ${req.user.username} (${req.user.role})`;\n          }\n        }\n        \n        const transactionResult = await client.query(\n          'INSERT INTO transactions (user_id, amount, balance_after, performed_by, description) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n          [userId, actualAmount, updatedBalance, req.user.id, transactionDescription]\n        );\n        \n        await client.query('COMMIT');\n        \n        // Return the transaction and updated user\n        res.status(201).json({\n          transaction: transactionResult.rows[0],\n          userBalance: updatedBalance / 100, // Convert back to rupees for display\n          message: isAdminSelfFunding ? 'Platform investment recorded successfully.' : 'Transaction completed successfully.'\n        });\n        \n      } catch (error) {\n        await client.query('ROLLBACK');\n        console.error('Transaction error:', error);\n        res.status(500).json({ message: 'Transaction failed' });\n      } finally {\n        client.release();\n      }\n    } catch (err) {\n      next(err);\n    }\n  });\n}","path":null,"size_bytes":32654,"size_tokens":null},"debug-market-results.js":{"content":"import { db } from './server/db.js';\nimport { satamatkaMarkets } from './shared/schema.js';\nimport { eq, desc } from 'drizzle-orm';\n\nasync function debugMarketResults() {\n  try {\n    console.log('Testing direct database query...');\n    \n    // Test direct query\n    const results = await db.select()\n      .from(satamatkaMarkets)\n      .where(eq(satamatkaMarkets.status, 'resulted'))\n      .orderBy(desc(satamatkaMarkets.createdAt))\n      .limit(3);\n    \n    console.log('Direct query results:', results.length);\n    console.log('Sample data:', JSON.stringify(results.slice(0, 2), null, 2));\n    \n    // Test with different status values\n    const allMarkets = await db.select().from(satamatkaMarkets).limit(3);\n    console.log('All markets sample:', JSON.stringify(allMarkets, null, 2));\n    \n  } catch (error) {\n    console.error('Error:', error);\n  }\n  \n  process.exit(0);\n}\n\ndebugMarketResults();","path":null,"size_bytes":900,"size_tokens":null},"client/src/components/hero-slider.tsx":{"content":"import { useCallback, useEffect, useState } from 'react';\nimport { useLocation } from 'wouter';\nimport useEmblaCarousel from 'embla-carousel-react';\nimport { Button } from '@/components/ui/button';\nimport { ChevronLeft, ChevronRight } from 'lucide-react';\n\ninterface SliderItem {\n  id: string;\n  title: string;\n  description: string;\n  backgroundImage: string;\n  buttonText: string;\n  buttonLink: string;\n}\n\ninterface HeroSliderProps {\n  slides: SliderItem[];\n  autoPlayInterval?: number;\n}\n\nexport default function HeroSlider({ \n  slides, \n  autoPlayInterval = 5000 \n}: HeroSliderProps) {\n  const [_, setLocation] = useLocation();\n  const [emblaRef, emblaApi] = useEmblaCarousel({ loop: true });\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const [scrollSnaps, setScrollSnaps] = useState<number[]>([]);\n  \n  const scrollPrev = useCallback(() => {\n    if (emblaApi) emblaApi.scrollPrev();\n  }, [emblaApi]);\n\n  const scrollNext = useCallback(() => {\n    if (emblaApi) emblaApi.scrollNext();\n  }, [emblaApi]);\n\n  const scrollTo = useCallback(\n    (index: number) => {\n      if (emblaApi) emblaApi.scrollTo(index);\n    },\n    [emblaApi]\n  );\n\n  const onSelect = useCallback(() => {\n    if (!emblaApi) return;\n    setSelectedIndex(emblaApi.selectedScrollSnap());\n  }, [emblaApi]);\n\n  useEffect(() => {\n    if (!emblaApi) return;\n    onSelect();\n    setScrollSnaps(emblaApi.scrollSnapList());\n    emblaApi.on('select', onSelect);\n    return () => {\n      emblaApi.off('select', onSelect);\n    };\n  }, [emblaApi, onSelect]);\n\n  // Auto-play functionality\n  useEffect(() => {\n    if (!emblaApi) return;\n    \n    const intervalId = setInterval(() => {\n      emblaApi.scrollNext();\n    }, autoPlayInterval);\n\n    // Clear interval when user interacts with the carousel\n    const onInteractionStarted = () => {\n      clearInterval(intervalId);\n    };\n    \n    emblaApi.on('pointerDown', onInteractionStarted);\n    \n    return () => {\n      clearInterval(intervalId);\n      if (emblaApi) {\n        emblaApi.off('pointerDown', onInteractionStarted);\n      }\n    };\n  }, [emblaApi, autoPlayInterval]);\n\n  return (\n    <div className=\"relative\">\n      <div className=\"overflow-hidden\" ref={emblaRef}>\n        <div className=\"flex h-[300px] sm:h-[400px] md:h-[500px] lg:h-[600px]\">\n          {slides.map((slide, index) => (\n            <div \n              key={slide.id} \n              className=\"flex-[0_0_100%] min-w-0 relative\"\n            >\n              <div \n                className=\"absolute inset-0 bg-cover bg-center\"\n                style={{ \n                  background: slide.backgroundImage.startsWith('linear-gradient') \n                    ? slide.backgroundImage \n                    : `url(${slide.backgroundImage})` \n                }}\n              >\n                <div className=\"absolute inset-0 bg-gradient-to-b from-black/70 to-black/40 flex items-center\">\n                  <div className=\"container mx-auto px-4 md:px-8\">\n                    <div className=\"max-w-2xl pt-0 sm:pt-0 md:pt-0 lg:pt-0\">\n                      <h1 className=\"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-2 sm:mb-4 leading-tight\">\n                        {slide.title}\n                      </h1>\n                      <p className=\"text-white/90 text-sm sm:text-base md:text-lg mb-4 sm:mb-6 max-w-md\">\n                        {slide.description}\n                      </p>\n                      <Button \n                        className=\"px-4 py-2 sm:px-6 sm:py-4 md:px-8 md:py-6 text-sm sm:text-base md:text-lg bg-primary hover:bg-primary/90\"\n                        onClick={() => setLocation(slide.buttonLink)}\n                      >\n                        {slide.buttonText}\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n      \n      {/* Navigation buttons */}\n      <button \n        onClick={scrollPrev}\n        className=\"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white rounded-full p-1 sm:p-2 transition-all\"\n        aria-label=\"Previous slide\"\n      >\n        <ChevronLeft className=\"w-4 h-4 sm:w-6 sm:h-6\" />\n      </button>\n      <button \n        onClick={scrollNext}\n        className=\"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white rounded-full p-1 sm:p-2 transition-all\"\n        aria-label=\"Next slide\"\n      >\n        <ChevronRight className=\"w-4 h-4 sm:w-6 sm:h-6\" />\n      </button>\n      \n      {/* Dots indicators */}\n      <div className=\"absolute bottom-2 sm:bottom-4 left-0 right-0 flex justify-center\">\n        <div className=\"flex space-x-1.5 sm:space-x-2\">\n          {scrollSnaps.map((_, index) => (\n            <button\n              key={index}\n              onClick={() => scrollTo(index)}\n              className={`w-2 h-2 sm:w-3 sm:h-3 rounded-full transition-all ${\n                index === selectedIndex\n                  ? 'bg-white scale-100'\n                  : 'bg-white/50 scale-75'\n              }`}\n              aria-label={`Go to slide ${index + 1}`}\n            />\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":5232,"size_tokens":null},"clear-game-data.js":{"content":"/**\n * This script removes all game data including:\n * - Games (all types: coin flip, Satamatka, cricket toss, team match)\n * - Team matches\n * - Satamatka markets\n * \n * It does NOT affect:\n * - User accounts\n * - User balances\n * - System settings\n * - Commissions\n * - Odds\n */\n\nimport pg from 'pg';\nconst { Pool } = pg;\n\n// Create a PostgreSQL connection pool\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL\n});\n\nasync function clearGameData() {\n  const client = await pool.connect();\n  \n  try {\n    console.log(\"Starting game data cleanup...\");\n    \n    // Begin transaction\n    await client.query('BEGIN');\n    \n    // 1. Delete all games (will cascade to game-specific data)\n    console.log(\"Removing all games...\");\n    const deleteGamesResult = await client.query('DELETE FROM \"games\"');\n    console.log(`Removed ${deleteGamesResult.rowCount} games`);\n    \n    // 2. Delete all team matches\n    console.log(\"Removing all team matches...\");\n    const deleteTeamMatchesResult = await client.query('DELETE FROM \"team_matches\"');\n    console.log(`Removed ${deleteTeamMatchesResult.rowCount} team matches`);\n    \n    // 3. Delete all Satamatka markets\n    console.log(\"Removing all Satamatka markets...\");\n    const deleteSatamatkaMarketsResult = await client.query('DELETE FROM \"satamatka_markets\"');\n    console.log(`Removed ${deleteSatamatkaMarketsResult.rowCount} Satamatka markets`);\n    \n    // Update sequences to reflect empty tables\n    console.log(\"Resetting sequence counters...\");\n    await client.query('ALTER SEQUENCE \"games_id_seq\" RESTART WITH 1');\n    await client.query('ALTER SEQUENCE \"team_matches_id_seq\" RESTART WITH 1');\n    await client.query('ALTER SEQUENCE \"satamatka_markets_id_seq\" RESTART WITH 1');\n    \n    // Commit transaction\n    await client.query('COMMIT');\n    \n    console.log(\"Game data cleanup completed successfully!\");\n    \n  } catch (error) {\n    // Rollback in case of error\n    await client.query('ROLLBACK');\n    console.error(\"Error clearing game data:\", error);\n    throw error;\n  } finally {\n    // Release the client back to the pool\n    client.release();\n  }\n}\n\n// Run the cleanup\nclearGameData()\n  .then(() => {\n    console.log(\"Cleanup script completed. You can now restart the server to initialize with clean game data.\");\n    process.exit(0);\n  })\n  .catch(error => {\n    console.error(\"Cleanup script failed:\", error);\n    process.exit(1);\n  });","path":null,"size_bytes":2425,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"import * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1405,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"add-test-admin.js":{"content":"// Import the necessary modules\nimport { pool, db } from './server/db.js';\nimport { users } from './shared/schema.js';\nimport { UserRole } from './shared/schema.js';\nimport bcrypt from 'bcrypt';\n\nasync function createTestAdmin() {\n  console.log('Creating test admin account...');\n  \n  try {\n    // Hash the password\n    const hashedPassword = await bcrypt.hash('admin123', 10);\n    \n    // Insert new admin\n    const [newAdmin] = await db.insert(users)\n      .values({\n        username: 'testadmin',\n        password: hashedPassword,\n        email: 'testadmin@example.com',\n        mobile: '1234567890',\n        role: UserRole.ADMIN,\n        balance: 1000000, // 10,000 balance for testing\n        isBlocked: false\n      })\n      .returning();\n    \n    console.log('Created test admin account:', newAdmin);\n    console.log('You can now login with:');\n    console.log('Username: testadmin');\n    console.log('Password: admin123');\n    \n    // Create a test subadmin\n    const [newSubadmin] = await db.insert(users)\n      .values({\n        username: 'testsubadmin',\n        password: hashedPassword,\n        email: 'testsubadmin@example.com',\n        mobile: '9876543210',\n        role: UserRole.SUBADMIN,\n        balance: 500000, // 5,000 balance\n        isBlocked: false,\n        assignedTo: newAdmin.id\n      })\n      .returning();\n      \n    console.log('Created test subadmin account:', newSubadmin);\n    console.log('You can now login with:');\n    console.log('Username: testsubadmin');\n    console.log('Password: admin123');\n    \n    // Create some test players\n    for (let i = 1; i <= 5; i++) {\n      const [player] = await db.insert(users)\n        .values({\n          username: `player${i}`,\n          password: hashedPassword,\n          email: `player${i}@example.com`,\n          mobile: `555000${i}`,\n          role: UserRole.PLAYER,\n          balance: 10000 * i, // Different balances for testing\n          isBlocked: false,\n          assignedTo: i % 2 === 0 ? newAdmin.id : newSubadmin.id // Assign to either admin or subadmin\n        })\n        .returning();\n        \n      console.log(`Created player${i} account:`, player);\n    }\n    \n    console.log('Test accounts created successfully!');\n  } catch (error) {\n    console.error('Error creating test accounts:', error);\n  } finally {\n    // Close the database connection\n    await pool.end();\n  }\n}\n\ncreateTestAdmin().catch(console.error);","path":null,"size_bytes":2404,"size_tokens":null},"client/src/components/date-range-picker.tsx":{"content":"import * as React from \"react\";\nimport { Calendar as CalendarIcon } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { DateRange } from \"react-day-picker\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\n\ninterface DateRangePickerProps {\n  date: DateRange;\n  onDateChange: (date: DateRange | undefined) => void;\n  className?: string;\n}\n\nexport function DateRangePicker({\n  date,\n  onDateChange,\n  className,\n}: DateRangePickerProps) {\n  return (\n    <div className={cn(\"grid gap-2\", className)}>\n      <Popover>\n        <PopoverTrigger asChild>\n          <Button\n            id=\"date\"\n            variant=\"outline\"\n            className={cn(\n              \"w-full justify-start text-left font-normal\",\n              !date && \"text-muted-foreground\"\n            )}\n          >\n            <CalendarIcon className=\"mr-2 h-4 w-4\" />\n            {date?.from ? (\n              date.to ? (\n                <>\n                  {format(date.from, \"LLL dd, y\")} -{\" \"}\n                  {format(date.to, \"LLL dd, y\")}\n                </>\n              ) : (\n                format(date.from, \"LLL dd, y\")\n              )\n            ) : (\n              <span>Pick a date range</span>\n            )}\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n          <Calendar\n            initialFocus\n            mode=\"range\"\n            defaultMonth={date?.from}\n            selected={date}\n            onSelect={onDateChange}\n            numberOfMonths={2}\n          />\n        </PopoverContent>\n      </Popover>\n    </div>\n  );\n}","path":null,"size_bytes":1768,"size_tokens":null},"client/src/pages/admin-cricket-toss-page.tsx":{"content":"import React, { useState } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { ExclamationTriangleIcon } from \"@radix-ui/react-icons\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { formatDate } from \"@/lib/utils\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Badge } from \"@/components/ui/badge\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport {\n  Check,\n  X,\n  MoreVertical,\n  Calendar,\n  Search,\n  Clock,\n  CheckCircle2,\n  AlertCircle,\n  Plus,\n  Filter,\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\n\n// Define the schema for creating a cricket toss match\nconst createCricketTossSchema = z.object({\n  teamA: z.string().min(1, \"Team A is required\"),\n  teamB: z.string().min(1, \"Team B is required\"),\n  description: z.string().optional(),\n  matchDate: z.string().min(1, \"Match date is required\"),\n  matchTime: z.string().min(1, \"Match time is required\"),\n  coverImage: z.instanceof(File).optional(),\n  // We'll use fixed odds: 2.00 for both teams\n});\n\n// Define the schema for editing a cricket toss match\nconst editCricketTossSchema = z.object({\n  teamA: z.string().min(1, \"Team A is required\"),\n  teamB: z.string().min(1, \"Team B is required\"),\n  description: z.string().optional(),\n  matchDate: z.string().min(1, \"Match date is required\"),\n  matchTime: z.string().min(1, \"Match time is required\"),\n  coverImage: z.instanceof(File).optional(),\n});\n\n// Type for a cricket toss match\ninterface CricketTossMatch {\n  id: number;\n  teamA: string;\n  teamB: string;\n  description?: string;\n  matchTime: string;\n  teamAImage?: string;\n  teamBImage?: string;\n  coverImage?: string;\n  oddTeamA: number;\n  oddTeamB: number;\n  result: string;\n  status: string;\n  createdAt: string;\n}\n\n// Types for the betting data\ninterface BetData {\n  id: number;\n  userId: number;\n  username: string;\n  betAmount: number;\n  prediction: string;\n  potential: number;\n  result: string | null;\n  payout: number;\n}\n\nexport default function AdminCricketTossPage() {\n  const [selectedMatch, setSelectedMatch] = useState<CricketTossMatch | null>(\n    null,\n  );\n  const [open, setOpen] = useState(false);\n  const [declareOpen, setDeclareOpen] = useState(false);\n  const [confirmCloseOpen, setConfirmCloseOpen] = useState(false);\n  const [matchToClose, setMatchToClose] = useState<number | null>(null);\n  const [coverImagePreview, setCoverImagePreview] = useState<string | null>(\n    null,\n  );\n  const [activeTab, setActiveTab] = useState(\"all\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [editingMatch, setEditingMatch] = useState<CricketTossMatch | null>(\n    null,\n  );\n  const [editOpen, setEditOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Today's date formatted for display\n  const dateString = format(new Date(), \"EEEE, MMMM d, yyyy\");\n\n  // Form setup for creating a new cricket toss match\n  const form = useForm<z.infer<typeof createCricketTossSchema>>({\n    resolver: zodResolver(createCricketTossSchema),\n    defaultValues: {\n      teamA: \"\",\n      teamB: \"\",\n      description: \"\",\n      matchDate: new Date().toISOString().split(\"T\")[0],\n      matchTime: \"12:00\",\n    },\n  });\n\n  // Form setup for editing a cricket toss match\n  const editForm = useForm<z.infer<typeof editCricketTossSchema>>({\n    resolver: zodResolver(editCricketTossSchema),\n    defaultValues: {\n      teamA: \"\",\n      teamB: \"\",\n      description: \"\",\n      matchDate: new Date().toISOString().split(\"T\")[0],\n      matchTime: \"12:00\",\n    },\n  });\n\n  // Query to fetch cricket toss matches\n  const { data: cricketTossMatches = [], isLoading } = useQuery<\n    CricketTossMatch[]\n  >({\n    queryKey: [\"/api/cricket-toss/matches\"],\n    staleTime: 10000,\n  });\n\n  // Query to fetch cricket match betting stats\n  const { data: cricketMatchStats = [], isLoading: isLoadingStats } = useQuery<\n    any[]\n  >({\n    queryKey: [\"/api/cricket-toss/match-stats\"],\n    staleTime: 5000,\n  });\n\n  // Filter matches based on status and search query\n  const openMatches = cricketTossMatches.filter(\n    (match) => match.status === \"open\",\n  );\n  const closedMatches = cricketTossMatches.filter(\n    (match) => match.status === \"closed\",\n  );\n  const resultedMatches = cricketTossMatches.filter(\n    (match) => match.status === \"resulted\",\n  );\n\n  // Filter based on active tab and search query\n  const getFilteredMatches = () => {\n    let matches = cricketTossMatches;\n\n    // Filter by status based on active tab\n    if (activeTab === \"open\") {\n      matches = openMatches;\n    } else if (activeTab === \"closed\") {\n      matches = closedMatches;\n    } else if (activeTab === \"resulted\") {\n      matches = resultedMatches;\n    }\n\n    // Apply search filter if query exists\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase();\n      matches = matches.filter(\n        (match) =>\n          match.teamA.toLowerCase().includes(query) ||\n          match.teamB.toLowerCase().includes(query) ||\n          (match.description &&\n            match.description.toLowerCase().includes(query)),\n      );\n    }\n\n    return matches;\n  };\n\n  const filteredMatches = getFilteredMatches();\n\n  // Helper function to get match stats\n  const getMatchStats = (matchId: number) => {\n    if (!Array.isArray(cricketMatchStats)) {\n      return {\n        teamA: { totalBets: 0, potentialWin: 0 },\n        teamB: { totalBets: 0, potentialWin: 0 },\n      };\n    }\n    return (\n      cricketMatchStats.find((stat: any) => stat.matchId === matchId) || {\n        teamA: { totalBets: 0, potentialWin: 0 },\n        teamB: { totalBets: 0, potentialWin: 0 },\n      }\n    );\n  };\n\n  // Mutation to create a new cricket toss match\n  const createCricketTossMutation = useMutation({\n    mutationFn: async (values: z.infer<typeof createCricketTossSchema>) => {\n      // Create form data to handle file uploads\n      const formData = new FormData();\n      formData.append(\"teamA\", values.teamA);\n      formData.append(\"teamB\", values.teamB);\n\n      // Combine date and time keeping local timezone like satamatka markets\n      const combinedDateTime = `${values.matchDate}T${values.matchTime}:00`;\n      formData.append(\"matchTime\", combinedDateTime);\n\n      if (values.description)\n        formData.append(\"description\", values.description);\n\n      // Use fixed odds: 2.00 for both teams\n      formData.append(\"oddTeamA\", \"200\");\n      formData.append(\"oddTeamB\", \"200\");\n\n      // Append cover image if provided\n      if (values.coverImage) formData.append(\"coverImage\", values.coverImage);\n\n      // Use fetch directly for FormData\n      const response = await fetch(\"/api/cricket-toss/matches\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(\n          errorData.message || \"Failed to create cricket toss match\",\n        );\n      }\n\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Cricket Toss Match Created\",\n        description: \"The cricket toss match has been created successfully.\",\n      });\n      form.reset();\n      setOpen(false);\n      setCoverImagePreview(null);\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/cricket-toss/matches\"],\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create cricket toss match\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mutation to edit a cricket toss match\n  const editCricketTossMutation = useMutation({\n    mutationFn: async ({\n      id,\n      values,\n    }: {\n      id: number;\n      values: z.infer<typeof editCricketTossSchema>;\n    }) => {\n      // Create form data to handle file uploads\n      const formData = new FormData();\n      formData.append(\"teamA\", values.teamA);\n      formData.append(\"teamB\", values.teamB);\n\n      // Combine date and time keeping local timezone like satamatka markets\n      const combinedDateTime = `${values.matchDate}T${values.matchTime}:00`;\n      formData.append(\"matchTime\", combinedDateTime);\n\n      if (values.description)\n        formData.append(\"description\", values.description);\n\n      // Append cover image if provided\n      if (values.coverImage) formData.append(\"coverImage\", values.coverImage);\n\n      // Use fetch directly for FormData\n      const response = await fetch(`/api/cricket-toss/matches/${id}`, {\n        method: \"PUT\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(\n          errorData.message || \"Failed to update cricket toss match\",\n        );\n      }\n\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Cricket Toss Match Updated\",\n        description: \"The cricket toss match has been updated successfully.\",\n      });\n      editForm.reset();\n      setEditOpen(false);\n      setEditingMatch(null);\n      setCoverImagePreview(null);\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/cricket-toss/matches\"],\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update cricket toss match\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mutation to close betting for a match\n  const closeBettingMutation = useMutation({\n    mutationFn: async (matchId: number) => {\n      // Use fetch directly to make sure we have more control over the request\n      const response = await fetch(\n        `/api/cricket-toss/matches/${matchId}/close`,\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n        },\n      );\n\n      if (!response.ok) {\n        const errorData = await response\n          .json()\n          .catch(() => ({ message: \"Failed to close betting\" }));\n        throw new Error(errorData.message || `HTTP Error: ${response.status}`);\n      }\n\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Betting Closed\",\n        description: \"Betting has been closed for this match.\",\n      });\n      setConfirmCloseOpen(false);\n      setMatchToClose(null);\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/cricket-toss/matches\"],\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to close betting\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mutation to declare result for a match\n  const declareResultMutation = useMutation({\n    mutationFn: async ({\n      matchId,\n      result,\n    }: {\n      matchId: number;\n      result: string;\n    }) => {\n      // Using direct fetch like we did for closeBetting to have more control\n      const response = await fetch(\n        `/api/cricket-toss/matches/${matchId}/result`,\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({ result }),\n        },\n      );\n\n      if (!response.ok) {\n        const errorData = await response\n          .json()\n          .catch(() => ({ message: \"Failed to declare result\" }));\n        throw new Error(errorData.message || `HTTP Error: ${response.status}`);\n      }\n\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Result Declared\",\n        description: \"The result has been declared and payouts processed.\",\n      });\n      setDeclareOpen(false);\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/cricket-toss/matches\"],\n      });\n      if (selectedMatch) {\n        queryClient.invalidateQueries({\n          queryKey: [\"/api/cricket-toss/bets\", selectedMatch.id],\n        });\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to declare result\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Handle form submission for creating a new cricket toss match\n  const onSubmit = (values: z.infer<typeof createCricketTossSchema>) => {\n    createCricketTossMutation.mutate(values);\n  };\n\n  // Handle form submission for editing a cricket toss match\n  const onEditSubmit = (values: z.infer<typeof editCricketTossSchema>) => {\n    if (editingMatch) {\n      editCricketTossMutation.mutate({ id: editingMatch.id, values });\n    }\n  };\n\n  // Handle edit action\n  const handleEditMatch = (match: CricketTossMatch) => {\n    setEditingMatch(match);\n\n    // Parse the match time to get date and time parts\n    const matchDate = new Date(match.matchTime);\n    const dateStr = matchDate.toISOString().split(\"T\")[0];\n    const timeStr = `${matchDate.getHours().toString().padStart(2, \"0\")}:${matchDate.getMinutes().toString().padStart(2, \"0\")}`;\n\n    // Populate the edit form with existing data\n    editForm.reset({\n      teamA: match.teamA,\n      teamB: match.teamB,\n      description: match.description || \"\",\n      matchDate: dateStr,\n      matchTime: timeStr,\n    });\n\n    setEditOpen(true);\n  };\n\n  // Function to handle opening the close betting confirmation dialog\n  const handleCloseBetting = (matchId: number) => {\n    setMatchToClose(matchId);\n    setConfirmCloseOpen(true);\n  };\n\n  // Function to confirm and execute the close betting action\n  const confirmCloseBetting = () => {\n    if (matchToClose) {\n      closeBettingMutation.mutate(matchToClose);\n      // We'll set these in the onSuccess handler to avoid UI race conditions\n    }\n  };\n\n  // Function to handle declaring result for a match\n  const handleDeclareResult = (result: string) => {\n    if (!selectedMatch) return;\n\n    declareResultMutation.mutate({\n      matchId: selectedMatch.id,\n      result,\n    });\n  };\n\n  // Function to format odds for display (converts from integer to decimal representation)\n  const formatOdds = (odds: number) => {\n    return (odds / 100).toFixed(2);\n  };\n\n  // Function to get the status badge for a match\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"open\":\n        return <Badge className=\"bg-green-500\">Open</Badge>;\n      case \"closed\":\n        return <Badge className=\"bg-yellow-500\">Closed</Badge>;\n      case \"resulted\":\n        return <Badge className=\"bg-blue-500\">Resulted</Badge>;\n      default:\n        return <Badge>{status}</Badge>;\n    }\n  };\n\n  // Format the team name based on the prediction value\n  const formatPrediction = (prediction: string, match: CricketTossMatch) => {\n    if (prediction === \"team_a\") return match.teamA;\n    if (prediction === \"team_b\") return match.teamB;\n    return prediction;\n  };\n\n  return (\n    <DashboardLayout title=\"Cricket Toss Management\">\n      <div className=\"mb-6\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <div className=\"flex items-center text-muted-foreground\">\n            <Calendar className=\"h-5 w-5 mr-2\" />\n            <span>{dateString}</span>\n          </div>\n\n          <Button\n            onClick={() => setOpen(true)}\n            className=\"bg-gradient-to-r from-blue-600 to-indigo-600\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Match\n          </Button>\n        </div>\n        <p className=\"text-muted-foreground\">\n          Manage cricket toss matches, declare results, and create new matches\n        </p>\n      </div>\n\n      {/* Search and filter bar */}\n      <div className=\"flex items-center justify-between mb-6 gap-4 flex-wrap\">\n        <div className=\"relative flex items-center flex-1 min-w-[200px]\">\n          <Search className=\"absolute left-3 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search matches...\"\n            className=\"pl-10\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n          />\n        </div>\n      </div>\n\n      {/* Tab navigation */}\n      <Tabs defaultValue=\"all\" value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"mb-6 grid w-full grid-cols-4\">\n          <TabsTrigger value=\"all\" className=\"flex items-center justify-center\">\n            <AlertCircle className=\"h-4 w-4 mr-2\" />\n            <span>All ({cricketTossMatches.length})</span>\n          </TabsTrigger>\n          <TabsTrigger\n            value=\"open\"\n            className=\"flex items-center justify-center\"\n          >\n            <Clock className=\"h-4 w-4 mr-2\" />\n            <span>Open ({openMatches.length})</span>\n          </TabsTrigger>\n          <TabsTrigger\n            value=\"closed\"\n            className=\"flex items-center justify-center\"\n          >\n            <X className=\"h-4 w-4 mr-2\" />\n            <span>Closed ({closedMatches.length})</span>\n          </TabsTrigger>\n          <TabsTrigger\n            value=\"resulted\"\n            className=\"flex items-center justify-center\"\n          >\n            <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n            <span>Resulted ({resultedMatches.length})</span>\n          </TabsTrigger>\n        </TabsList>\n\n        {/* All tabs content */}\n        <TabsContent value={activeTab} className=\"space-y-6\">\n          {isLoading ? (\n            <div className=\"flex justify-center p-8\">\n              Loading cricket toss matches...\n            </div>\n          ) : filteredMatches.length > 0 ? (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Match</TableHead>\n                  <TableHead>Match Time</TableHead>\n                  <TableHead>Team A Bets</TableHead>\n                  <TableHead>Team B Bets</TableHead>\n                  <TableHead>Result</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredMatches.map((match: CricketTossMatch) => {\n                  const matchStats = getMatchStats(match.id);\n                  return (\n                    <TableRow key={match.id}>\n                      <TableCell>\n                        <div className=\"flex flex-col\">\n                          <div className=\"flex justify-between items-center\">\n                            <span className=\"font-medium\">\n                              {match.teamA} vs {match.teamB}\n                            </span>\n                          </div>\n                          {match.description && (\n                            <div className=\"text-xs text-gray-500 mt-1\">\n                              {match.description}\n                            </div>\n                          )}\n                          {match.coverImage && (\n                            <div className=\"w-full mt-2\">\n                              <img\n                                src={match.coverImage}\n                                alt={`${match.teamA} vs ${match.teamB}`}\n                                className=\"w-full h-12 object-cover rounded-md\"\n                              />\n                            </div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {(() => {\n                          const timeString = match.matchTime\n                            .replace(\"T\", \" \")\n                            .replace(\".000Z\", \"\")\n                            .replace(\"Z\", \"\");\n                          const localDate = new Date(timeString);\n                          return localDate.toLocaleString(\"en-IN\", {\n                            year: \"numeric\",\n                            month: \"short\",\n                            day: \"numeric\",\n                            hour: \"numeric\",\n                            minute: \"2-digit\",\n                            hour12: true,\n                          });\n                        })()}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex flex-col space-y-1\">\n                          <div className=\"text-sm font-medium\">\n                            {match.teamA}\n                          </div>\n                          <div className=\"text-xs text-muted-foreground\">\n                            {matchStats.teamA.totalBets} bets  \n                            {(matchStats.teamA.potentialWin / 100)?.toFixed(\n                              2,\n                            ) || \"0.00\"}{\" \"}\n                            potential\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex flex-col space-y-1\">\n                          <div className=\"text-sm font-medium\">\n                            {match.teamB}\n                          </div>\n                          <div className=\"text-xs text-muted-foreground\">\n                            {matchStats.teamB.totalBets} bets  \n                            {(matchStats.teamB.potentialWin / 100)?.toFixed(\n                              2,\n                            ) || \"0.00\"}{\" \"}\n                            potential\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {match.result === \"pending\" ? (\n                          \"Pending\"\n                        ) : match.result === \"team_a\" ? (\n                          <span className=\"font-medium text-green-600\">\n                            {match.teamA}\n                          </span>\n                        ) : match.result === \"team_b\" ? (\n                          <span className=\"font-medium text-green-600\">\n                            {match.teamB}\n                          </span>\n                        ) : (\n                          match.result\n                        )}\n                      </TableCell>\n                      <TableCell>{getStatusBadge(match.status)}</TableCell>\n                      <TableCell>\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\">\n                              <MoreVertical className=\"h-4 w-4\" />\n                              <span className=\"sr-only\">Actions</span>\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuLabel>Actions</DropdownMenuLabel>\n\n                            <DropdownMenuSeparator />\n\n                            {/* Edit option - only available for non-resulted matches */}\n                            {match.status !== \"resulted\" && (\n                              <DropdownMenuItem\n                                onClick={() => handleEditMatch(match)}\n                              >\n                                <Calendar className=\"mr-2 h-4 w-4\" />\n                                Edit Match\n                              </DropdownMenuItem>\n                            )}\n\n                            {match.status === \"open\" && (\n                              <DropdownMenuItem\n                                onClick={() => handleCloseBetting(match.id)}\n                              >\n                                <X className=\"mr-2 h-4 w-4\" />\n                                Close Betting\n                              </DropdownMenuItem>\n                            )}\n\n                            {match.status === \"closed\" && (\n                              <DropdownMenuItem\n                                onClick={() => {\n                                  setSelectedMatch(match);\n                                  setDeclareOpen(true);\n                                }}\n                              >\n                                <Check className=\"mr-2 h-4 w-4\" />\n                                Declare Result\n                              </DropdownMenuItem>\n                            )}\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          ) : (\n            <div className=\"p-8 text-center\">\n              <p className=\"text-gray-500 mb-4\">\n                No cricket toss matches found for this filter.\n              </p>\n              <p className=\"text-sm text-gray-400\">\n                Try another filter or create a new match.\n              </p>\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n\n      {/* Dialog for creating new match */}\n      <Dialog\n        open={open}\n        onOpenChange={(isOpen) => {\n          setOpen(isOpen);\n          if (!isOpen) {\n            setCoverImagePreview(null);\n          }\n        }}\n      >\n        <DialogContent className=\"sm:max-w-[600px]\">\n          <DialogHeader>\n            <DialogTitle>Create Cricket Toss Match</DialogTitle>\n          </DialogHeader>\n          <div className=\"max-h-[80vh] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-primary scrollbar-track-transparent\">\n            <Form {...form}>\n              <form\n                onSubmit={form.handleSubmit(onSubmit)}\n                className=\"space-y-4\"\n              >\n                {/* Two column layout for team names */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"teamA\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Team A</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"Enter team A name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"teamB\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Team B</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"Enter team B name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description (Optional)</FormLabel>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder=\"Enter match description\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Two column layout for date and time */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"matchDate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Match Date</FormLabel>\n                        <FormControl>\n                          <Input\n                            {...field}\n                            type=\"date\"\n                            min={new Date().toISOString().split(\"T\")[0]}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"matchTime\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Match Time</FormLabel>\n                        <FormControl>\n                          <select\n                            className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                            {...field}\n                          >\n                            <option value=\"\">Select time</option>\n                            {Array.from({ length: 24 })\n                              .map((_, hour) =>\n                                Array.from({ length: 4 }).map((_, minute) => {\n                                  const h = hour;\n                                  const m = minute * 15;\n                                  const timeValue = `${h.toString().padStart(2, \"0\")}:${m.toString().padStart(2, \"0\")}`;\n                                  const displayHour =\n                                    h % 12 === 0 ? 12 : h % 12;\n                                  const ampm = h < 12 ? \"AM\" : \"PM\";\n                                  const displayTime = `${displayHour}:${m.toString().padStart(2, \"0\")} ${ampm}`;\n                                  return (\n                                    <option key={timeValue} value={timeValue}>\n                                      {displayTime}\n                                    </option>\n                                  );\n                                }),\n                              )\n                              .flat()}\n                          </select>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"coverImage\"\n                  render={({ field: { value, onChange, ...field } }) => (\n                    <FormItem>\n                      <FormLabel>Cover Banner Image (Optional)</FormLabel>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          type=\"file\"\n                          accept=\"image/*\"\n                          onChange={(e) => {\n                            const file = e.target.files?.[0];\n                            if (file) {\n                              onChange(file);\n                              // Create a preview URL for the selected image\n                              const reader = new FileReader();\n                              reader.onload = (e) => {\n                                setCoverImagePreview(\n                                  e.target?.result as string,\n                                );\n                              };\n                              reader.readAsDataURL(file);\n                            }\n                          }}\n                        />\n                      </FormControl>\n                      {coverImagePreview && (\n                        <div className=\"mt-2\">\n                          <img\n                            src={coverImagePreview}\n                            alt=\"Cover Image Preview\"\n                            className=\"w-full h-32 object-cover rounded-md border border-gray-200\"\n                          />\n                        </div>\n                      )}\n                      <FormDescription>\n                        Upload a banner image for this match\n                      </FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setOpen(false)}\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createCricketTossMutation.isPending}\n                  >\n                    {createCricketTossMutation.isPending\n                      ? \"Creating...\"\n                      : \"Create Match\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog for editing a cricket toss match */}\n      <Dialog open={editOpen && !!editingMatch} onOpenChange={setEditOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] flex flex-col\">\n          <DialogHeader className=\"flex-shrink-0\">\n            <DialogTitle>Edit Cricket Toss Match</DialogTitle>\n          </DialogHeader>\n          <div className=\"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-primary/30 scrollbar-track-transparent py-4\">\n            <Form {...editForm}>\n              <form\n                onSubmit={editForm.handleSubmit(onEditSubmit)}\n                className=\"space-y-6\"\n              >\n                {/* Team Names */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={editForm.control}\n                    name=\"teamA\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Team A</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"Enter team A name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={editForm.control}\n                    name=\"teamB\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Team B</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"Enter team B name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={editForm.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description (Optional)</FormLabel>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder=\"Enter match description\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Two column layout for date and time */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={editForm.control}\n                    name=\"matchDate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Match Date</FormLabel>\n                        <FormControl>\n                          <Input\n                            {...field}\n                            type=\"date\"\n                            min={new Date().toISOString().split(\"T\")[0]}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={editForm.control}\n                    name=\"matchTime\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Match Time</FormLabel>\n                        <FormControl>\n                          <select\n                            className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                            {...field}\n                          >\n                            <option value=\"\">Select time</option>\n                            {Array.from({ length: 24 })\n                              .map((_, hour) =>\n                                Array.from({ length: 4 }).map((_, minute) => {\n                                  const h = hour;\n                                  const m = minute * 15;\n                                  const timeValue = `${h.toString().padStart(2, \"0\")}:${m.toString().padStart(2, \"0\")}`;\n                                  const displayHour =\n                                    h % 12 === 0 ? 12 : h % 12;\n                                  const ampm = h < 12 ? \"AM\" : \"PM\";\n                                  const displayTime = `${displayHour}:${m.toString().padStart(2, \"0\")} ${ampm}`;\n                                  return (\n                                    <option key={timeValue} value={timeValue}>\n                                      {displayTime}\n                                    </option>\n                                  );\n                                }),\n                              )\n                              .flat()}\n                          </select>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={editForm.control}\n                  name=\"coverImage\"\n                  render={({ field: { value, onChange, ...field } }) => (\n                    <FormItem>\n                      <FormLabel>Cover Banner Image (Optional)</FormLabel>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          type=\"file\"\n                          accept=\"image/*\"\n                          onChange={(e) => {\n                            const file = e.target.files?.[0];\n                            onChange(file);\n\n                            // Preview the image\n                            if (file) {\n                              const reader = new FileReader();\n                              reader.onload = (e) => {\n                                setCoverImagePreview(\n                                  e.target?.result as string,\n                                );\n                              };\n                              reader.readAsDataURL(file);\n                            }\n                          }}\n                        />\n                      </FormControl>\n                      {coverImagePreview && (\n                        <div className=\"mt-2\">\n                          <img\n                            src={coverImagePreview}\n                            alt=\"Cover Image Preview\"\n                            className=\"w-full h-32 object-cover rounded-md border border-gray-200\"\n                          />\n                        </div>\n                      )}\n                      <FormDescription>\n                        Upload a new banner image for this match (optional)\n                      </FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => {\n                      setEditOpen(false);\n                      setEditingMatch(null);\n                      setCoverImagePreview(null);\n                    }}\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={editCricketTossMutation.isPending}\n                  >\n                    {editCricketTossMutation.isPending\n                      ? \"Updating...\"\n                      : \"Update Match\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog for declaring result */}\n      <Dialog\n        open={declareOpen && !!selectedMatch}\n        onOpenChange={setDeclareOpen}\n      >\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Declare Cricket Toss Result</DialogTitle>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <p className=\"mb-4\">\n              Select the winner for {selectedMatch?.teamA} vs{\" \"}\n              {selectedMatch?.teamB}:\n            </p>\n            {selectedMatch?.coverImage && (\n              <div className=\"mb-4\">\n                <img\n                  src={selectedMatch.coverImage}\n                  alt={`${selectedMatch.teamA} vs ${selectedMatch.teamB}`}\n                  className=\"w-full h-32 object-cover rounded-md\"\n                />\n              </div>\n            )}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <Button\n                onClick={() => handleDeclareResult(\"team_a\")}\n                className=\"h-16 flex flex-col items-center justify-center gap-2\"\n              >\n                <span>{selectedMatch?.teamA} Wins</span>\n              </Button>\n              <Button\n                onClick={() => handleDeclareResult(\"team_b\")}\n                className=\"h-16 flex flex-col items-center justify-center gap-2\"\n              >\n                <span>{selectedMatch?.teamB} Wins</span>\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Confirmation dialog for closing betting */}\n      <Dialog open={confirmCloseOpen} onOpenChange={setConfirmCloseOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Close Betting</DialogTitle>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <p>Are you sure you want to close betting for this match?</p>\n            <p className=\"text-sm text-muted-foreground mt-2\">\n              This will prevent players from placing new bets on this match.\n            </p>\n          </div>\n          <div className=\"flex justify-end gap-2 mt-4\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setConfirmCloseOpen(false);\n                setMatchToClose(null);\n              }}\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"default\"\n              onClick={confirmCloseBetting}\n              disabled={closeBettingMutation.isPending}\n            >\n              {closeBettingMutation.isPending ? \"Closing...\" : \"Close Betting\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":44806,"size_tokens":null},"project-prd.md":{"content":"# KingGames Platform - Product Requirements Document (PRD)\n\n## 1. Introduction\n\n### 1.1 Purpose\nThis document outlines the complete product requirements for the KingGames Platform, a comprehensive online gaming and betting platform. It serves as the definitive reference for current and future development, detailing all features, user roles, game types, and technical specifications.\n\n### 1.2 Scope\nThe KingGames Platform is a full-featured online gaming ecosystem that includes multiple betting games, user management with various roles, wallet functionality, and administrative tools. The platform offers a responsive web interface accessible across all devices.\n\n### 1.3 Product Vision\nKingGames aims to provide a secure, engaging, and fair online gaming experience with transparent odds and robust user management. The platform targets users interested in casual games of chance and skill, with special focus on various betting formats.\n\n## 2. User Roles and Permissions\n\n### 2.1 Role Hierarchy\nThe platform implements a three-tier role system:\n\n1. **Admin**\n   - Full system access\n   - Can create subadmins and manage all users\n   - Can configure game settings, odds, and commission rates\n   - Has access to all financial transactions and reports\n\n2. **Subadmin**\n   - Limited administrative rights\n   - Can create and manage players assigned to them\n   - Can set custom commission rates and odds for their players\n   - Can process deposits and withdrawals for their players\n   - Cannot access system-wide settings or other subadmins' data\n\n3. **Player**\n   - End-user of the platform\n   - Can place bets in available games\n   - Can request deposits and withdrawals\n   - Can view their personal game history and transaction records\n   - Always assigned to a subadmin or directly to an admin\n\n### 2.2 Permission Details\n\n#### Admin Permissions\n- User Management: Create, edit, block, unblock any user\n- Financial Operations: Process all deposit/withdrawal requests\n- Game Management: Create, update, and resolve games\n- System Configuration: Change system settings, odds, commission rates\n- Reports: Access all financial and game reports\n- Subadmin Management: Assign and manage subadmins\n\n#### Subadmin Permissions\n- Player Management: Create, edit, block, unblock players assigned to them\n- Limited Financial Operations: Process deposits/withdrawals for their players\n- Game Configuration: Set custom odds for their players\n- Commission Configuration: Set commission rates for specific games\n- Reports: Access reports for their players only\n- Cannot access or modify other subadmins' settings or players\n\n#### Player Permissions\n- Profile Management: Update personal details and password\n- Financial Requests: Request deposits and withdrawals\n- Game Participation: Place bets in available games\n- View History: Access personal game and transaction history\n- Cannot access any admin functions or other players' data\n\n## 3. Game Types and Mechanics\n\n### 3.1 Coin Flip Game\n- **Description**: A simple heads/tails prediction game\n- **Mechanics**:\n  - Player selects heads or tails\n  - Player places a bet amount (minimum 10)\n  - System flips a coin with animated visuals\n  - Win pays 1.9x the bet amount (5% platform fee)\n  - Dynamic win probability system based on user history:\n    - New users get enhanced 60% win rate for first few games\n    - Standard users get 50% win rate\n    - Users on win streaks (3+ consecutive wins) get reduced 25% win rate\n    - Users on loss streaks (3+ consecutive losses) get enhanced 55% win rate\n    - System caps maximum win probability at 35% for high-volume players\n  - Sound effects for coin flip action and wins (optional muting)\n  - Detailed bet history with outcome visualization\n\n### 3.2 Cricket Toss Game\n- **Description**: Betting on cricket match toss outcomes\n- **Mechanics**:\n  - Admin creates toss events with team details, image, time, and odds\n  - Players bet on which team will win the toss\n  - Admin resolves the toss result after the actual event\n  - Payouts are based on odds set for each team (typically 1.9x)\n  - Multiple active toss events can run simultaneously\n  - Game state management: Creation  Open for Betting  Closed  Resulted\n\n### 3.3 Team Match Betting\n- **Description**: Betting on sports match outcomes\n- **Mechanics**:\n  - Admin creates match events with teams, odds, and details\n  - Players can bet on Team A, Team B, or Draw outcome\n  - Dynamic odds system reflecting real-world probabilities\n  - Bet timing restrictions (must place before match start)\n  - Result validation and payout processing by admin\n  - Support for multiple sports categories\n  - Advanced exposure management for calculating potential liability\n\n### 3.4 Satamatka Game\n- **Description**: Traditional Indian lottery-style numbers game\n- **Mechanics**:\n  - Multiple game formats:\n    - Single (bet on a single digit 0-9)\n    - Jodi (bet on a pair of digits 00-99)\n    - Patti (bet on specific three-digit combinations)\n    - CP/SP (bet on opening/closing digit combinations)\n    - Cross/Crossing (complex pattern betting across numbers)\n  - Market-based system with open/close times\n  - Different odds for different bet types (Single: 9x, Jodi: 90x, etc.)\n  - Admin creates markets with time windows\n  - Admin declares results for open/close phases\n  - Support for running multiple markets simultaneously\n  - Custom validation for each bet type with pattern matching\n\n## 4. Wallet and Financial System\n\n### 4.1 Wallet Features\n- **Balance Management**:\n  - Every user has a digital wallet with real-time balance\n  - Balance updated immediately after game results\n  - Support for positive and negative adjustments by admins\n  - Protection against negative balances during betting\n\n- **Deposit System**:\n  - Players can request deposits via UPI or bank transfer\n  - Multi-step verification process\n  - Admin/subadmin approval workflow\n  - Transaction records with status tracking\n  - Support for automatic and manual verification\n\n- **Withdrawal System**:\n  - Players can request balance withdrawals\n  - Configurable minimum/maximum withdrawal limits\n  - Admin/subadmin approval workflow\n  - Bank account or UPI-based withdrawals\n  - Status tracking with notifications\n\n### 4.2 Financial Reports\n- **Transaction History**:\n  - Complete record of all financial movements\n  - Filtering by transaction type, user, date range\n  - Export functionality for data analysis\n  - Balance reconciliation tools for admins\n\n- **Game Financial Reports**:\n  - Profit/loss reports by game type\n  - Time-period analysis (daily, weekly, monthly)\n  - Player performance tracking\n  - Exposure and liability reporting\n\n- **Commission Reports**:\n  - Detailed tracking of subadmin commissions\n  - Commission calculation based on configured rates\n  - Settlement tracking and history\n  - Time-period analysis and projections\n\n### 4.3 Commission System\n- **Configuration**:\n  - Game-specific commission rates\n  - Subadmin-specific commission rates\n  - Tiered commission structure possibility\n  - Automatic calculation based on player activity\n\n- **Settlement**:\n  - Manual or scheduled commission settlements\n  - Settlement records and history\n  - Balance transfers with verification\n  - Dispute resolution mechanism\n\n## 5. User Management Features\n\n### 5.1 User Creation and Assignment\n- Admin can create subadmins with configuration\n- Subadmins can create players assigned to themselves\n- Admin can reassign players between subadmins\n- User profile data with contact information\n- Unique username requirements and validation\n\n### 5.2 User Status Management\n- Active/inactive user status tracking\n- User blocking with reason documentation\n- Temporary suspension capabilities\n- Login attempt monitoring and security\n- Password reset and account recovery processes\n\n### 5.3 User Profile Features\n- Personal information management\n- Password change functionality\n- Contact information updates\n- Account activity logs\n- Preference settings for notifications\n\n### 5.4 User Details Page\n- Comprehensive view of user information\n- Transaction history with filtering\n- Bet history with detailed game information\n- Active bets monitoring\n- Financial summary statistics\n- User relationship mapping (subadmin connections)\n\n## 6. Game Administration\n\n### 6.1 Game Configuration\n- Game-specific settings and parameters\n- Odds configuration for each game type\n- Time window settings for scheduled games\n- Game visibility and availability controls\n- Result declaration interfaces\n\n### 6.2 Result Management\n- Manual result entry for toss and match games\n- Result verification processes\n- Automatic payout calculation\n- Dispute handling mechanisms\n- Result broadcasting to users\n\n### 6.3 Risk Management\n- Betting limits configuration\n- Maximum exposure controls\n- Automatic liability calculations\n- High-risk bet flagging\n- Pattern detection for suspicious activity\n\n## 7. Front-End Features\n\n### 7.1 User Interface\n- Responsive design for all devices\n- Dark/light theme support\n- Accessible interface elements\n- Optimized layouts for different games\n- Intuitive navigation system\n- Real-time updates for game status\n\n### 7.2 Game Interfaces\n- **Coin Flip**:\n  - 3D animated coin with realistic physics\n  - Bet selection interface with quick amount buttons\n  - Result visualization with win/loss popups\n  - Sound effects with muting option\n  - Recent history visualization\n\n- **Cricket Toss**:\n  - Team selection interface with logos\n  - Odds display with potential winnings calculation\n  - Timer for upcoming toss events\n  - Result announcement visuals\n  - Active and past toss event lists\n\n- **Team Match**:\n  - Team selection with match details\n  - Multiple betting options (Team A, B, Draw)\n  - Dynamic odds display\n  - Match timing and status indicators\n  - Result tracking and visualization\n\n- **Satamatka**:\n  - Market selection interface\n  - Multiple bet type options\n  - Number selection interface\n  - Market timing indicators\n  - Result history visualization\n  - Pattern selection tools for complex bets\n\n### 7.3 User Dashboard\n- Balance display with quick deposit option\n- Recent bets summary\n- Active bets status tracking\n- Personal statistics and performance\n- Notifications and announcements\n- Quick access to popular games\n\n### 7.4 Admin Dashboard\n- Real-time platform statistics\n- User management shortcuts\n- Financial summary with alerts\n- Recent activity logs\n- Quick access to pending approvals\n- System health indicators\n\n## 8. Backend Architecture\n\n### 8.1 API Structure\n- RESTful API design with consistent endpoints\n- Authentication and authorization middleware\n- Rate limiting for security\n- Comprehensive error handling\n- Structured response formats\n- Documentation with Swagger/OpenAPI\n\n### 8.2 Database Design\n- Relational database with PostgreSQL\n- Key entities:\n  - Users (with role-based structure)\n  - Games (with game-specific data)\n  - Transactions (financial records)\n  - Bets (user game interactions)\n  - Settings (system configuration)\n  - Markets (for scheduled games)\n  - Teams and Matches (for sports betting)\n- Optimized indexing for performance\n- Referential integrity with foreign keys\n- Transaction support for data consistency\n\n### 8.3 Security Features\n- Role-based access control (RBAC)\n- Password hashing with bcrypt\n- JWT-based authentication\n- Session management with timeouts\n- Input validation on all endpoints\n- Protection against common attacks (CSRF, XSS)\n- Rate limiting against brute force attempts\n- Audit logging for sensitive actions\n\n### 8.4 Real-time Features\n- WebSocket support for live updates\n- Real-time balance updates\n- Game status notifications\n- Admin action broadcasting\n- Connection state management\n- Fallback mechanisms for offline operation\n\n## 9. Probability and Fairness System\n\n### 9.1 Dynamic Win Rate Management\n- Player-specific win rate calculation\n- Session-based analysis for streaks\n- New player advantage system\n- Anti-streak mechanisms for fairness\n- Win rate caps for responsible gaming\n- Configurable parameters for probability tuning\n\n### 9.2 Random Number Generation\n- Cryptographically secure RNG implementation\n- Verifiable fairness with seed publishing\n- Distribution validation for statistical fairness\n- Independent result generation for each game\n- Audit mechanisms for result verification\n\n### 9.3 Odds Management\n- Dynamic odds calculation based on real probabilities\n- House edge configuration by game type\n- Subadmin-specific odds adjustments\n- Player-specific discounts on odds\n- Market-based odds fluctuation for sports betting\n\n## 10. Implementation Technologies\n\n### 10.1 Frontend\n- React.js with TypeScript\n- TanStack Query for API state management\n- Framer Motion for animations\n- Tailwind CSS for styling\n- Shadcn UI component library\n- Responsive design with mobile-first approach\n- React Hook Form for form validation\n- Zod for schema validation\n\n### 10.2 Backend\n- Express.js with TypeScript\n- Drizzle ORM for database operations\n- PostgreSQL for data storage\n- Passport.js for authentication\n- WebSockets for real-time features\n- Server-side rendering capabilities\n- Caching strategies for performance\n- Background job processing for scheduled tasks\n\n### 10.3 Deployment\n- Production build optimization\n- Environment-based configuration\n- Continuous integration and deployment\n- Replit deployment configuration\n- Database migration framework\n- Backup and recovery procedures\n- Monitoring and logging infrastructure\n\n## 11. Responsible Gaming Features\n\n### 11.1 Betting Limits\n- Session betting limits configuration\n- Daily/weekly/monthly deposit limits\n- Loss limits with cooling periods\n- Self-exclusion capabilities\n- Enforced break periods after extended play\n\n### 11.2 Monitoring Tools\n- Pattern detection for problem gambling\n- Activity alerts for unusual behavior\n- Voluntary self-assessment tools\n- Play time tracking and notifications\n- Deposit frequency monitoring\n\n### 11.3 Information Resources\n- Responsible gaming guidelines\n- Self-help resources and links\n- Risk awareness information\n- Customer support contact options\n- Age verification reminders\n\n## 12. Feature Roadmap and Priorities\n\n### 12.1 Core Features (Phase 1)\n- [x] User authentication system\n- [x] Basic user roles and permissions\n- [x] Coin Flip game implementation\n- [x] Simple wallet system\n- [x] Admin dashboard basics\n- [x] Transaction history tracking\n\n### 12.2 Enhanced Features (Phase 2)\n- [x] Cricket Toss game\n- [x] Advanced wallet with deposit/withdrawal\n- [x] Subadmin role implementation\n- [x] Commission system basics\n- [x] Improved user management\n- [x] Enhanced game history tracking\n- [x] Basic reporting tools\n\n### 12.3 Advanced Features (Phase 3)\n- [x] Satamatka game implementation\n- [x] Team Match betting\n- [x] Advanced commission system\n- [x] Custom odds and discounts\n- [x] Enhanced financial reporting\n- [x] User relationship management\n- [x] Comprehensive user details page\n\n### 12.4 Future Enhancements (Phase 4)\n- [ ] Additional game types\n- [ ] Multi-language support\n- [ ] Enhanced security features\n- [ ] Mobile app development\n- [ ] Advanced analytics dashboard\n- [ ] Marketing and retention tools\n- [ ] API access for partners\n- [ ] Affiliate management system\n\n## 13. Technical Specifications\n\n### 13.1 Performance Requirements\n- Page load time < 2 seconds\n- API response time < 500ms\n- Support for 1000+ concurrent users\n- Game animation smoothness at 60fps\n- Database query optimization for high volumes\n- Efficient caching strategy for repeat queries\n- Minimal memory footprint for client devices\n\n### 13.2 Compatibility Requirements\n- Browser support: Latest 2 versions of Chrome, Firefox, Safari, Edge\n- Mobile device support: iOS 14+, Android 8+\n- Responsive design breakpoints: 320px to 1920px\n- Touch input optimization for mobile devices\n- Keyboard accessibility for desktop\n- Low bandwidth considerations for rural areas\n- Offline mode support for basic functionality\n\n### 13.3 Security Requirements\n- HTTPS enforcement with TLS 1.2+\n- Regular security audits and penetration testing\n- Sensitive data encryption in transit and at rest\n- Session management with secure cookies\n- CSRF protection on all forms\n- Input validation and sanitization\n- Rate limiting for authentication attempts\n- Regular security patches and updates\n\n## 14. Conclusion\n\nThis Product Requirements Document outlines the comprehensive features, architecture, and technical specifications for the KingGames Platform. It serves as the definitive reference for current and future development. As the platform evolves, this document should be updated to reflect new requirements and implemented features.\n\n---\n\n## Appendix A: Feature Checklist\n\n### User Management\n- [x] User registration\n- [x] Role-based permissions\n- [x] User blocking/unblocking\n- [x] Password management\n- [x] Profile management\n- [x] User relationship hierarchy\n- [x] User details page with history\n- [x] Activity logging\n\n### Games\n- [x] Coin Flip game\n- [x] Cricket Toss game\n- [x] Team Match betting\n- [x] Satamatka game\n- [x] Game history tracking\n- [x] Result management\n- [x] Game configuration\n- [x] Dynamic probability system\n\n### Financial System\n- [x] Wallet management\n- [x] Deposit requests\n- [x] Withdrawal processing\n- [x] Transaction history\n- [x] Commission calculation\n- [x] Financial reporting\n- [x] Balance adjustments\n- [x] Payment verification\n\n### Admin Tools\n- [x] User management dashboard\n- [x] Game management interfaces\n- [x] Financial approval workflows\n- [x] System configuration\n- [x] Report generation\n- [x] Audit logging\n- [x] Market management\n- [x] Odds configuration\n\n### Technical Features\n- [x] Responsive UI\n- [x] Real-time updates\n- [x] Secure authentication\n- [x] Database optimization\n- [x] Error handling\n- [x] Performance optimization\n- [x] Browser compatibility\n- [x] Mobile device support","path":null,"size_bytes":17826,"size_tokens":null},"client/src/components/game-card.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { Play, Trophy, ArrowRight } from \"lucide-react\";\nimport { \n  Card, \n  CardContent, \n  CardDescription, \n  CardFooter, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useEffect, useState } from \"react\";\n\ninterface GameCardProps {\n  id: string;\n  title: string;\n  description: string;\n  imageBg: string;\n  path: string;\n  popularity?: \"high\" | \"medium\" | \"low\" | \"upcoming\";\n  winRate?: number;\n  comingSoon?: boolean;\n  imageUrl?: string; // For direct image URL (backward compatibility)\n  gameType?: \"market\" | \"sports\" | \"cricket\" | \"coinflip\" | \"sportsexchange\" | string; // Game type for automatic image selection\n}\n\nexport default function GameCard({ \n  id, \n  title, \n  description, \n  imageBg, \n  path,\n  popularity = \"medium\",\n  winRate,\n  comingSoon = false,\n  imageUrl,\n  gameType\n}: GameCardProps) {\n  const [_, setLocation] = useLocation();\n  const { user } = useAuth() || {};\n  const [gameCardImage, setGameCardImage] = useState<string | null>(null);\n  \n  // Fetch game card image based on game type\n  useEffect(() => {\n    // If a direct imageUrl is provided, use that (for backward compatibility)\n    if (imageUrl) {\n      setGameCardImage(imageUrl);\n      return;\n    }\n    \n    // If no gameType provided, use the default image background\n    if (!gameType) return;\n    \n    // Fetch the appropriate game card image\n    console.log(`Fetching game card image for type: ${gameType}`);\n    fetch(`/api/gamecards?gameType=${gameType}`)\n      .then(res => res.json())\n      .then(data => {\n        console.log(`Game card API response for ${gameType}:`, data);\n        if (data && data.length > 0) {\n          // Use the first image for this game type\n          const imageUrl = data[0].url;\n          console.log(`Setting game card image URL for ${gameType}:`, imageUrl);\n          setGameCardImage(imageUrl);\n        } else {\n          console.log(`No images found for game type: ${gameType}`);\n        }\n      })\n      .catch(err => {\n        console.error(`Error fetching image for ${gameType} game card:`, err);\n      });\n  }, [gameType, imageUrl]);\n\n  const getPopularityBadge = () => {\n    switch (popularity) {\n      case \"high\":\n        return (\n          <Badge variant=\"outline\" className=\"bg-indigo-900/30 text-indigo-300 border-indigo-500/30\">\n            Popular\n          </Badge>\n        );\n      case \"medium\":\n        return (\n          <Badge variant=\"outline\" className=\"bg-blue-900/30 text-blue-300 border-blue-500/30\">\n            Trending\n          </Badge>\n        );\n      case \"upcoming\":\n        return (\n          <Badge variant=\"outline\" className=\"bg-purple-900/30 text-purple-300 border-purple-500/30\">\n            Upcoming\n          </Badge>\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Card className=\"overflow-hidden h-full transition-all duration-200 hover:shadow-lg border-slate-800 bg-slate-900/70 backdrop-blur-sm\">\n      <div \n        className=\"h-40 bg-cover bg-center relative\"\n        style={{ backgroundImage: gameCardImage ? `url(${gameCardImage})` : imageUrl ? `url(${imageUrl})` : imageBg }}\n      >\n        <div className=\"h-full w-full bg-gradient-to-b from-transparent to-black/80 flex items-end p-4\">\n          <div>\n            <h3 className=\"text-xl font-bold text-white mb-1\">{title}</h3>\n            <div className=\"mb-2 flex gap-2\">\n              {popularity !== \"low\" && getPopularityBadge()}\n              \n              {comingSoon && (\n                <Badge variant=\"outline\" className=\"bg-orange-900/30 text-orange-300 border-orange-500/30\">\n                  Coming Soon\n                </Badge>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <CardContent className=\"p-4\">\n        <p className=\"text-sm text-muted-foreground line-clamp-2\">{description}</p>\n        \n        {winRate !== undefined && (\n          <div className=\"flex items-center mt-3 mb-1\">\n            <Trophy className=\"h-4 w-4 text-blue-400 mr-1.5\" />\n            <span className=\"text-sm font-medium text-blue-100\">Win rate: {winRate}%</span>\n          </div>\n        )}\n      </CardContent>\n      \n      <CardFooter className=\"p-4 pt-0 gap-2\">\n        <Button \n          className={`w-full ${\n            comingSoon \n              ? \"bg-gray-700 hover:bg-gray-600 cursor-not-allowed\" \n              : \"bg-gradient-to-r from-indigo-800 to-blue-600 hover:from-indigo-700 hover:to-blue-500\"\n          }`}\n          onClick={() => {\n            // For Coming Soon games, do nothing\n            if (comingSoon) return;\n            \n            // If user is logged in, go to the game or dashboard\n            // If not, redirect to auth page\n            if (user) {\n              setLocation(path);\n            } else {\n              setLocation(\"/auth\");\n            }\n          }}\n        >\n          {comingSoon ? (\n            <span>Coming Soon</span>\n          ) : (\n            <>\n              <Play className=\"h-4 w-4 mr-2\" />\n              {user ? \"Play Now\" : \"Login to Play\"}\n            </>\n          )}\n        </Button>\n      </CardFooter>\n    </Card>\n  );\n}","path":null,"size_bytes":5295,"size_tokens":null},"client/src/components/confirm-dialog.tsx":{"content":"import React from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { AlertCircle } from \"lucide-react\";\n\ninterface ConfirmDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: () => void;\n  title: string;\n  description: string;\n  confirmText?: string;\n  cancelText?: string;\n  variant?: \"default\" | \"destructive\";\n}\n\nexport default function ConfirmDialog({\n  isOpen,\n  onClose,\n  onConfirm,\n  title,\n  description,\n  confirmText = \"Confirm\",\n  cancelText = \"Cancel\",\n  variant = \"destructive\"\n}: ConfirmDialogProps) {\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent>\n        <DialogHeader>\n          <div className=\"flex items-center gap-2\">\n            <AlertCircle className={variant === \"destructive\" ? \"text-red-500\" : \"text-primary\"} />\n            <DialogTitle>{title}</DialogTitle>\n          </div>\n          <DialogDescription>{description}</DialogDescription>\n        </DialogHeader>\n        <DialogFooter className=\"flex justify-between\">\n          <Button \n            variant=\"outline\" \n            onClick={onClose}\n          >\n            {cancelText}\n          </Button>\n          <Button\n            variant={variant}\n            onClick={() => {\n              onConfirm();\n              onClose();\n            }}\n          >\n            {confirmText}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":1557,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":7974,"size_tokens":null},"fix-market3-crossing-bets.ts":{"content":"/**\n * This script specifically fixes the Satamatka crossing bets for market ID 3\n * It will update any crossing bets that should be wins but are showing as losses\n */\n\nimport { db } from './server/db';\nimport { eq, and } from 'drizzle-orm';\nimport { games, SatamatkaGameMode } from './shared/schema';\nimport { storage } from './server/storage';\n\nasync function fixMarket3CrossingBets() {\n  try {\n    console.log('Starting to fix crossing bets for market ID 3...');\n    \n    // Market ID 3 has the close result of \"01\"\n    const marketId = 3;\n    \n    // Get the market details to confirm\n    const market = await storage.getSatamatkaMarket(marketId);\n    if (!market) {\n      console.error(`Market with ID ${marketId} not found`);\n      return;\n    }\n    \n    console.log(`Processing market: ${market.name} (ID: ${marketId})`);\n    console.log(`Result: ${market.closeResult}`);\n    \n    if (!market.closeResult) {\n      console.error('Market does not have a close result set');\n      return;\n    }\n    \n    const resultToCheck = market.closeResult;\n    console.log(`Checking bets against result: ${resultToCheck}`);\n    \n    // Get all crossing games for this market\n    const crossingGames = await db.select()\n      .from(games)\n      .where(\n        and(\n          eq(games.marketId, marketId),\n          eq(games.gameMode, SatamatkaGameMode.CROSSING)\n        )\n      );\n    \n    console.log(`Found ${crossingGames.length} crossing games to check`);\n    \n    // Process each game to check if it should be a win\n    for (const game of crossingGames) {\n      console.log(`\\nChecking game ID ${game.id} with prediction: ${game.prediction}`);\n      \n      // For Crossing, check if the prediction matches the result in any order\n      const digits = game.prediction.replace(/[^0-9,]/g, '').split(',');\n      \n      // Extract all possible crossing combinations from the digits\n      const crossingCombinations = [];\n      for (let i = 0; i < digits.length; i++) {\n        for (let j = 0; j < digits.length; j++) {\n          if (i !== j) {\n            crossingCombinations.push(digits[i] + digits[j]);\n          }\n        }\n      }\n      \n      // Check both normal and reverse ordering of the result\n      const reverseResult = resultToCheck.length === 2 ? resultToCheck[1] + resultToCheck[0] : resultToCheck;\n      \n      console.log(`  Digits: ${digits.join(', ')}`);\n      console.log(`  Possible crossings: ${crossingCombinations.join(', ')}`);\n      console.log(`  Result: ${resultToCheck} (or reverse: ${reverseResult})`);\n      \n      // Determine if this should be a win\n      const shouldBeWin = crossingCombinations.includes(resultToCheck) || crossingCombinations.includes(reverseResult);\n      \n      console.log(`  Should be win: ${shouldBeWin}, Current result: ${game.result}`);\n      \n      // If the game should be a win but is marked as loss, update it\n      if (shouldBeWin && game.result === 'loss') {\n        console.log(`  FIXING: Game ID ${game.id} should be a win`);\n        \n        // Get appropriate odds for satamatka_crossing\n        let gameTypeOdds = await db.select()\n          .from('game_odds')\n          .where(\n            and(\n              eq('game_odds.gameType', 'satamatka_crossing'),\n              eq('game_odds.setByAdmin', true)\n            )\n          );\n        \n        let oddValue = gameTypeOdds.length > 0 ? gameTypeOdds[0].oddValue : 950000; // Default to 95x if not found\n        \n        console.log(`  Using odds value: ${oddValue/10000}x`);\n        \n        // Calculate payout (betAmount is stored in paisa)\n        const payout = Math.round(game.betAmount * (oddValue / 10000));\n        \n        // Update the game result to win and set payout\n        const [updatedGame] = await db.update(games)\n          .set({ result: 'win', payout })\n          .where(eq(games.id, game.id))\n          .returning();\n        \n        // Now update the user's balance to add the payout amount\n        const user = await storage.getUser(game.userId);\n        if (user) {\n          const newBalance = user.balance + payout;\n          await storage.updateUserBalance(user.id, newBalance);\n          console.log(`  Updated user ${user.username} balance: ${user.balance/100}  ${newBalance/100} rupees (+${payout/100})`);\n        }\n        \n        console.log(`   Fixed game ID ${game.id}: Changed to win, Payout: ${payout/100} rupees`);\n      } else if (shouldBeWin && game.result === 'win') {\n        console.log(`   Game ID ${game.id} is already correctly marked as a win`);\n      } else if (!shouldBeWin && game.result === 'loss') {\n        console.log(`   Game ID ${game.id} is correctly marked as a loss`);\n      }\n    }\n    \n    console.log('\\nCompleted fixing crossing bets!');\n  } catch (error) {\n    console.error('Error fixing crossing bets:', error);\n  }\n}\n\nfixMarket3CrossingBets().catch(err => console.error('Error:', err));","path":null,"size_bytes":4884,"size_tokens":null},"create-admin.ts":{"content":"/**\n * Script to create an admin user\n */\nimport { pool } from './server/db';\n\nasync function createAdminUser() {\n  try {\n    console.log('Creating admin user...');\n    \n    // Create admin user with direct SQL\n    const client = await pool.connect();\n    \n    try {\n      await client.query('BEGIN');\n      \n      // Check if admin already exists\n      const checkResult = await client.query('SELECT id FROM users WHERE username = $1', ['admin']);\n      \n      if (checkResult.rowCount === 0) {\n        // Admin doesn't exist, create one\n        // Use a default bcrypt hash for 'admin123' (you can generate this with bcrypt online tools)\n        const hashedPassword = '$2b$10$mA.DloIkTdF5DY3vX2Oz/OCNECnUb9SAj1h/HP0skvGQFPKpOBcZS';\n        \n        await client.query(`\n          INSERT INTO users (username, password, email, mobile, role, balance) \n          VALUES ($1, $2, $3, $4, $5, $6)\n        `, ['admin', hashedPassword, 'admin@example.com', '1234567890', 'admin', 0]);\n        \n        console.log('Admin user created successfully');\n      } else {\n        console.log('Admin user already exists');\n      }\n      \n      await client.query('COMMIT');\n    } catch (err) {\n      await client.query('ROLLBACK');\n      throw err;\n    } finally {\n      client.release();\n    }\n    \n  } catch (error) {\n    console.error('Error creating admin user:', error);\n  } finally {\n    // Close the pool\n    await pool.end();\n  }\n}\n\ncreateAdminUser();","path":null,"size_bytes":1447,"size_tokens":null},"create-admin-with-scrypt.js":{"content":"// This script creates an admin user with a crypto.scrypt password hash format that matches the application's authentication system\n\nimport { pool } from './server/db.js';\nimport { scrypt, randomBytes } from 'crypto';\nimport { promisify } from 'util';\n\n// Promisify scrypt\nconst scryptAsync = promisify(scrypt);\n\n// Function to hash password with crypto.scrypt\nasync function hashPassword(password) {\n  const salt = randomBytes(16).toString('hex');\n  const derivedKey = await scryptAsync(password, salt, 64);\n  return `${derivedKey.toString('hex')}.${salt}`;\n}\n\nasync function createAdmin() {\n  try {\n    console.log('Creating admin with scrypt password...');\n    \n    // Generate a scrypt hash for 'admin123'\n    const hashedPassword = await hashPassword('admin123');\n    console.log('Generated hash:', hashedPassword);\n    \n    // Connect to database\n    const client = await pool.connect();\n    \n    try {\n      // First delete any existing admin user\n      await client.query(`DELETE FROM users WHERE username = 'admin'`);\n      \n      // Insert the new admin user\n      const result = await client.query(`\n        INSERT INTO users (username, password, email, mobile, role, balance, is_blocked)\n        VALUES ('admin', $1, 'admin@example.com', '1234567890', 'admin', 0, false)\n        RETURNING id, username\n      `, [hashedPassword]);\n      \n      console.log('Created new admin account:', result.rows[0]);\n      console.log('You can now login with:');\n      console.log('Username: admin');\n      console.log('Password: admin123');\n    } finally {\n      client.release();\n    }\n  } catch (error) {\n    console.error('Error creating admin:', error);\n  }\n}\n\n// Run the script\ncreateAdmin();","path":null,"size_bytes":1695,"size_tokens":null},"client/src/pages/subadmin-settings-page.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { getQueryFn, apiRequest } from \"@/lib/queryClient\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { UserRole } from \"@shared/schema\";\n\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { \n  Card, \n  CardContent, \n  CardDescription, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { \n  Tabs, \n  TabsContent, \n  TabsList, \n  TabsTrigger \n} from \"@/components/ui/tabs\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { AlertCircle, ArrowLeft, Percent, Save, Info, Check } from \"lucide-react\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\n\n// Define types for the API responses\ninterface Subadmin {\n  id: number;\n  username: string;\n  role: string;\n  balance: number;\n  createdAt?: string;\n}\n\ninterface CommissionItem {\n  id?: number;\n  subadminId: number;\n  gameType: string;\n  commissionRate: number;\n}\n\ninterface GameOdd {\n  id?: number;\n  gameType: string;\n  oddValue: number;\n  setByAdmin: boolean;\n  subadminId?: number;\n}\n\ninterface UserDiscount {\n  id?: number;\n  userId: number;\n  subadminId: number;\n  gameType: string;\n  discountRate: number;\n}\n\ninterface Player {\n  id: number;\n  username: string;\n  role: string;\n  balance: number;\n  assignedTo?: number;\n  createdAt?: string;\n}\n\ninterface DepositCommission {\n  subadminId: number;\n  commissionRate: number;\n  isActive: boolean;\n}\n\n// Form schema for the commission form\nconst commissionFormSchema = z.object({\n  cricketToss: z.coerce.number().min(0).max(100),\n  coinFlip: z.coerce.number().min(0).max(100),\n  satamatkaJodi: z.coerce.number().min(0).max(100),\n  satamatkaHarf: z.coerce.number().min(0).max(100),\n  satamatkaOddEven: z.coerce.number().min(0).max(100),\n  satamatkaCrossing: z.coerce.number().min(0).max(100),\n});\n\n// Form schema for the odds form\nconst oddsFormSchema = z.object({\n  // Team match fields removed\n  cricketToss: z.coerce.number().min(1),\n  coinFlip: z.coerce.number().min(1),\n  satamatkaJodi: z.coerce.number().min(1),\n  satamatkaHarf: z.coerce.number().min(1),\n  satamatkaOddEven: z.coerce.number().min(1),\n  satamatkaCrossing: z.coerce.number().min(1),\n});\n\n// Form schema for the discount form\nconst discountFormSchema = z.object({\n  // teamMatch field removed\n  cricketToss: z.coerce.number().min(0).max(100),\n  coinFlip: z.coerce.number().min(0).max(100),\n  satamatkaJodi: z.coerce.number().min(0).max(100),\n  satamatkaHarf: z.coerce.number().min(0).max(100),\n  satamatkaOddEven: z.coerce.number().min(0).max(100),\n  satamatkaCrossing: z.coerce.number().min(0).max(100),\n});\n\ntype CommissionFormValues = z.infer<typeof commissionFormSchema>;\ntype OddsFormValues = z.infer<typeof oddsFormSchema>;\ntype DiscountFormValues = z.infer<typeof discountFormSchema>;\n\nexport default function SubadminSettingsPage() {\n  const { user } = useAuth();\n  const [location] = useLocation();\n  const queryParams = new URLSearchParams(location.split('?')[1] || '');\n  \n  // If no ID is provided in the URL, use the current logged-in user's ID (for subadmin viewing their own settings)\n  const subadminId = queryParams.get('id') \n    ? parseInt(queryParams.get('id') || '0') \n    : user?.role === 'subadmin' ? user.id : null;\n    \n  const queryClient = useQueryClient();\n  const [activeTab, setActiveTab] = useState(\"commission\");\n\n  // This could be a userId for setting discounts on users under a subadmin\n  const userId = queryParams.get('userId') ? parseInt(queryParams.get('userId') || '0') : null;\n  const [selectedPlayerId, setSelectedPlayerId] = useState<number | null>(userId);\n\n  // Get subadmin details\n  const { data, isLoading: isLoadingSubadmin } = useQuery<Subadmin>({\n    queryKey: ['/api/users', subadminId],\n    enabled: !!subadminId,\n  });\n  \n  // Ensure proper typing for the subadmin data\n  const subadmin = data as Subadmin | undefined;\n\n  // Get commission settings for games\n  const { data: commissions, isLoading: isLoadingCommissions } = useQuery({\n    queryKey: [`/api/commissions/subadmin/${subadminId}`],\n    enabled: !!subadminId,\n  });\n  \n  // Get deposit commission rate (fixed commission on admin-subadmin transactions)\n  const { data: depositCommission, isLoading: isLoadingDepositCommission } = useQuery<DepositCommission>({\n    queryKey: ['/api/deposit-commission'],\n    enabled: !!subadminId && user?.role === 'subadmin',\n  });\n  \n  // Get admin game odds\n  const { data: adminOdds, isLoading: isLoadingAdminOdds } = useQuery({\n    queryKey: ['/api/odds/admin'],\n    enabled: !!subadminId,\n  });\n  \n  // Get subadmin game odds\n  const { data: subadminOdds, isLoading: isLoadingSubadminOdds } = useQuery({\n    queryKey: [`/api/game-odds/subadmin/${subadminId}`],\n    enabled: !!subadminId,\n  });\n  \n  // Get players assigned to this subadmin\n  const { data: players, isLoading: isLoadingPlayers } = useQuery({\n    queryKey: ['/api/users', { assignedTo: subadminId }],\n    enabled: !!subadminId && activeTab === \"discounts\",\n  });\n  \n  // Get player discounts if a player is selected\n  const { data: playerDiscounts, isLoading: isLoadingPlayerDiscounts } = useQuery({\n    queryKey: ['/api/discounts/user', selectedPlayerId, subadminId],\n    enabled: !!selectedPlayerId && !!subadminId,\n  });\n\n  // Form for commission settings\n  const commissionForm = useForm<CommissionFormValues>({\n    resolver: zodResolver(commissionFormSchema),\n    defaultValues: {\n      cricketToss: 0,\n      coinFlip: 0,\n      satamatkaJodi: 0,\n      satamatkaHarf: 0,\n      satamatkaOddEven: 0,\n      satamatkaCrossing: 0,\n    }\n  });\n  \n  // Form for game odds settings\n  const oddsForm = useForm<OddsFormValues>({\n    resolver: zodResolver(oddsFormSchema),\n    defaultValues: {\n      cricketToss: 1.9,\n      coinFlip: 1.9,\n      satamatkaJodi: 9,\n      satamatkaHarf: 9,\n      satamatkaOddEven: 1.9,\n      satamatkaCrossing: 9,\n    }\n  });\n  \n  // Form for player discount settings\n  const discountForm = useForm<DiscountFormValues>({\n    resolver: zodResolver(discountFormSchema),\n    defaultValues: {\n      cricketToss: 0,\n      coinFlip: 0,\n      satamatkaJodi: 0,\n      satamatkaHarf: 0,\n      satamatkaOddEven: 0,\n      satamatkaCrossing: 0,\n    }\n  });\n\n  // Update commission mutation\n  const updateCommissionMutation = useMutation({\n    mutationFn: async (values: CommissionFormValues) => {\n      const response = await fetch('/api/commissions/subadmin/' + subadminId, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          commissions: [\n            { gameType: 'cricket_toss', commissionRate: values.cricketToss },\n            { gameType: 'coin_flip', commissionRate: values.coinFlip },\n            { gameType: 'satamatka_jodi', commissionRate: values.satamatkaJodi },\n            { gameType: 'satamatka_harf', commissionRate: values.satamatkaHarf },\n            { gameType: 'satamatka_odd_even', commissionRate: values.satamatkaOddEven },\n            { gameType: 'satamatka_crossing', commissionRate: values.satamatkaCrossing },\n          ]\n        }),\n        credentials: 'include'\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to update commission settings');\n      }\n      \n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/commissions/subadmin/${subadminId}`] });\n      toast({\n        title: \"Commission settings updated\",\n        variant: \"success\",\n        duration: 3000,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update commission settings\",\n        description: error.message,\n        variant: \"destructive\",\n        duration: 5000,\n      });\n    }\n  });\n  \n  // Update game odds mutation\n  const updateOddsMutation = useMutation({\n    mutationFn: async (values: OddsFormValues) => {\n      const response = await fetch('/api/game-odds/subadmin/' + subadminId, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          odds: [\n            // Multiply values by 10000 before sending to server\n            { gameType: 'cricket_toss', oddValue: Math.round(values.cricketToss * 10000) },\n            { gameType: 'coin_flip', oddValue: Math.round(values.coinFlip * 10000) },\n            { gameType: 'satamatka_jodi', oddValue: Math.round(values.satamatkaJodi * 10000) },\n            { gameType: 'satamatka_harf', oddValue: Math.round(values.satamatkaHarf * 10000) },\n            { gameType: 'satamatka_odd_even', oddValue: Math.round(values.satamatkaOddEven * 10000) },\n            { gameType: 'satamatka_crossing', oddValue: Math.round(values.satamatkaCrossing * 10000) },\n          ]\n        }),\n        credentials: 'include'\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to update game odds settings');\n      }\n      \n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/game-odds/subadmin/${subadminId}`] });\n      toast({\n        title: \"Game odds settings updated\",\n        variant: \"success\",\n        duration: 3000,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update game odds settings\",\n        description: error.message,\n        variant: \"destructive\",\n        duration: 5000,\n      });\n    }\n  });\n  \n  // Update player discount mutation\n  const updateDiscountMutation = useMutation({\n    mutationFn: async (values: DiscountFormValues) => {\n      if (!selectedPlayerId) {\n        throw new Error('No player selected');\n      }\n      \n      const response = await fetch(`/api/discounts/user/${selectedPlayerId}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          subadminId,\n          discounts: [\n            { gameType: 'cricket_toss', discountRate: values.cricketToss },\n            { gameType: 'coin_flip', discountRate: values.coinFlip },\n            { gameType: 'satamatka_jodi', discountRate: values.satamatkaJodi },\n            { gameType: 'satamatka_harf', discountRate: values.satamatkaHarf },\n            { gameType: 'satamatka_odd_even', discountRate: values.satamatkaOddEven },\n            { gameType: 'satamatka_crossing', discountRate: values.satamatkaCrossing },\n          ]\n        }),\n        credentials: 'include'\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to update player discount settings');\n      }\n      \n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/discounts/user', selectedPlayerId, subadminId] });\n      toast({\n        title: \"Player discount settings updated\",\n        variant: \"success\",\n        duration: 3000,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update player discount settings\",\n        description: error.message,\n        variant: \"destructive\",\n        duration: 5000,\n      });\n    }\n  });\n\n  // Handle commission form submission\n  const onSubmitCommission = (values: CommissionFormValues) => {\n    updateCommissionMutation.mutate(values);\n  };\n  \n  // Handle odds form submission\n  const onSubmitOdds = (values: OddsFormValues) => {\n    updateOddsMutation.mutate(values);\n  };\n  \n  // Handle discount form submission\n  const onSubmitDiscount = (values: DiscountFormValues) => {\n    updateDiscountMutation.mutate(values);\n  };\n  \n  // Helper function to format game types for display\n  const formatGameType = (gameType: string): string => {\n    switch (gameType) {\n      case 'cricket_toss':\n        return 'Cricket Toss';\n      case 'coin_flip':\n        return 'Coin Flip';\n      case 'satamatka_jodi':\n        return 'Jodi (Pair)';\n      case 'satamatka_harf':\n        return 'Harf';\n      case 'satamatka_odd_even':\n        return 'Odd/Even';\n      case 'satamatka_crossing':\n        return 'Crossing';\n      default:\n        return gameType.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase());\n    }\n  };\n  \n  // Helper function to get commission for a specific game type\n  const getCommissionForGameType = (gameType: string): number => {\n    if (!commissions || !Array.isArray(commissions)) return 0;\n    const commission = commissions.find((c: any) => c.gameType === gameType);\n    return commission ? commission.commissionRate : 0;\n  };\n  \n  // Helper function to get maximum allowed discount based on commission percentage\n  const getMaxDiscount = (gameType: string): number => {\n    if (!commissions || !Array.isArray(commissions)) return 0;\n    \n    const commission = Array.isArray(commissions) ? commissions.find((c: CommissionItem) => c.gameType === gameType) : null;\n    return commission ? commission.commissionRate / 100 : 0;\n  };\n\n  // Set form values when commissions data is loaded\n  useEffect(() => {\n    if (commissions && Array.isArray(commissions) && commissions.length > 0) {\n      const formValues: any = {\n        cricketToss: 0,\n        coinFlip: 0,\n        satamatkaJodi: 0,\n        satamatkaHarf: 0,\n        satamatkaOddEven: 0,\n        satamatkaCrossing: 0,\n      };\n\n      commissions.forEach((commission: any) => {\n        if (commission.gameType === 'cricket_toss') {\n          formValues.cricketToss = commission.commissionRate / 100;\n        } else if (commission.gameType === 'coin_flip') {\n          formValues.coinFlip = commission.commissionRate / 100;\n        } else if (commission.gameType === 'satamatka_jodi') {\n          formValues.satamatkaJodi = commission.commissionRate / 100;\n        } else if (commission.gameType === 'satamatka_harf') {\n          formValues.satamatkaHarf = commission.commissionRate / 100;\n        } else if (commission.gameType === 'satamatka_odd_even') {\n          formValues.satamatkaOddEven = commission.commissionRate / 100;\n        } else if (commission.gameType === 'satamatka_crossing') {\n          formValues.satamatkaCrossing = commission.commissionRate / 100;\n        }\n      });\n\n      commissionForm.reset(formValues);\n    }\n  }, [commissions, commissionForm]);\n  \n  // Set form values when odds data is loaded\n  useEffect(() => {\n    if (subadminOdds && Array.isArray(subadminOdds) && subadminOdds.length > 0) {\n      const formValues: any = {\n        cricketToss: 1.9,\n        coinFlip: 1.9,\n        satamatkaJodi: 9,\n        satamatkaHarf: 9,\n        satamatkaOddEven: 1.9,\n        satamatkaCrossing: 9,\n      };\n\n      subadminOdds.forEach((odd: any) => {\n        if (odd.gameType === 'cricket_toss') {\n          formValues.cricketToss = (odd.oddValue / 10000);\n        } else if (odd.gameType === 'coin_flip') {\n          formValues.coinFlip = (odd.oddValue / 10000);\n        } else if (odd.gameType === 'satamatka_jodi') {\n          formValues.satamatkaJodi = (odd.oddValue / 10000);\n        } else if (odd.gameType === 'satamatka_harf') {\n          formValues.satamatkaHarf = (odd.oddValue / 10000);\n        } else if (odd.gameType === 'satamatka_odd_even') {\n          formValues.satamatkaOddEven = (odd.oddValue / 10000);\n        } else if (odd.gameType === 'satamatka_crossing') {\n          formValues.satamatkaCrossing = (odd.oddValue / 10000);\n        }\n      });\n\n      oddsForm.reset(formValues);\n    }\n  }, [subadminOdds, oddsForm]);\n  \n  // Set form values when player discount data is loaded\n  useEffect(() => {\n    if (playerDiscounts && Array.isArray(playerDiscounts) && playerDiscounts.length > 0 && selectedPlayerId) {\n      const formValues: any = {\n        teamMatch: 0,\n        cricketToss: 0,\n        coinFlip: 0,\n        satamatkaJodi: 0,\n        satamatkaHarf: 0,\n        satamatkaOddEven: 0,\n        satamatkaCrossing: 0,\n      };\n\n      playerDiscounts.forEach((discount: any) => {\n        if (discount.gameType === 'team_match') {\n          formValues.teamMatch = discount.discountRate;\n        } else if (discount.gameType === 'cricket_toss') {\n          formValues.cricketToss = discount.discountRate;\n        } else if (discount.gameType === 'coin_flip') {\n          formValues.coinFlip = discount.discountRate;\n        } else if (discount.gameType === 'satamatka_jodi') {\n          formValues.satamatkaJodi = discount.discountRate;\n        } else if (discount.gameType === 'satamatka_harf') {\n          formValues.satamatkaHarf = discount.discountRate;\n        } else if (discount.gameType === 'satamatka_odd_even') {\n          formValues.satamatkaOddEven = discount.discountRate;\n        } else if (discount.gameType === 'satamatka_crossing') {\n          formValues.satamatkaCrossing = discount.discountRate;\n        }\n      });\n\n      discountForm.reset(formValues);\n    }\n  }, [playerDiscounts, discountForm, selectedPlayerId]);\n\n  return (\n    <DashboardLayout activeTab={user?.role === 'admin' ? 'subadmins' : 'settings'}>\n      {user?.role === 'admin' && (\n        <div className=\"mb-4\">\n          <Button variant=\"outline\" onClick={() => window.history.back()}>\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to Subadmins List\n          </Button>\n        </div>\n      )}\n      \n      {isLoadingSubadmin ? (\n        <div className=\"flex justify-center py-4\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n        </div>\n      ) : subadmin ? (\n        <Card>\n          <CardHeader>\n            <CardTitle>\n              {user?.role === 'admin' && subadmin?.username ? `Settings for ${subadmin.username}` : 'Settings'}\n            </CardTitle>\n            <CardDescription>\n              Manage account settings, commission rates, and game odds\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Tabs value={activeTab} onValueChange={setActiveTab}>\n              <TabsList className=\"mb-4\">\n                <TabsTrigger value=\"commission\">\n                  My Commission Rates\n                </TabsTrigger>\n                <TabsTrigger value=\"odds\">\n                  My Game Odds\n                </TabsTrigger>\n              </TabsList>\n              \n              <TabsContent value=\"commission\">\n                {isLoadingCommissions || isLoadingDepositCommission ? (\n                  <div className=\"flex justify-center py-4\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                  </div>\n                ) : (\n                  <div className=\"space-y-6\">\n                    <Alert>\n                      <Info className=\"h-5 w-5\" />\n                      <AlertTitle>Commission Rates</AlertTitle>\n                      <AlertDescription>\n                        Commission rates determine how much of the player's bets you earn. These rates are set by the administrator.\n                      </AlertDescription>\n                    </Alert>\n                    \n                    <div className=\"space-y-6\">\n                      <div>\n                        <h3 className=\"text-lg font-medium mb-4\">Your Commission Structure</h3>\n                        \n                        {commissions && Array.isArray(commissions) ? (\n                          <Card className=\"bg-muted/20\">\n                            <CardHeader className=\"pb-2\">\n                              <CardTitle className=\"text-base\">Deposit Commission from Admin</CardTitle>\n                              <CardDescription>\n                                Your commission percentage when admin deposits funds to your account\n                              </CardDescription>\n                            </CardHeader>\n                            <CardContent>\n                              <div className=\"flex flex-col space-y-4\">\n                                <div className=\"flex items-center justify-between border-b pb-2\">\n                                  <span className=\"text-muted-foreground\">Base Commission Rate:</span>\n                                  <span className=\"text-xl font-bold text-primary\">\n                                    {depositCommission ? (depositCommission.commissionRate / 100).toFixed(2) : \"0.00\"}%\n                                  </span>\n                                </div>\n                                \n                                <div className=\"bg-muted/40 p-4 rounded-md\">\n                                  <h4 className=\"font-semibold mb-2\">How Commissions Work</h4>\n                                  <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                                    <li className=\"flex items-start\">\n                                      <Check className=\"h-4 w-4 mr-2 mt-0.5 text-green-500\" />\n                                      You receive commission at the rate set by admin when funds are deposited to your account\n                                    </li>\n                                    <li className=\"flex items-start\">\n                                      <Check className=\"h-4 w-4 mr-2 mt-0.5 text-green-500\" />\n                                      Commission applies to admin-subadmin fund transfers only, not to player transactions\n                                    </li>\n                                    <li className=\"flex items-start\">\n                                      <Check className=\"h-4 w-4 mr-2 mt-0.5 text-green-500\" />\n                                      Commission is automatically calculated and added to your balance during deposits\n                                    </li>\n                                    <li className=\"flex items-start\">\n                                      <Check className=\"h-4 w-4 mr-2 mt-0.5 text-green-500\" />\n                                      Your players' bets and payouts do not affect your commission rate\n                                    </li>\n                                  </ul>\n                                </div>\n                              </div>\n                            </CardContent>\n                          </Card>\n                        ) : (\n                          <div className=\"p-4 border rounded-md\">\n                            <p className=\"text-center text-muted-foreground\">\n                              No commission rates have been set by the administrator yet.\n                            </p>\n                          </div>\n                        )}\n                      </div>\n                      \n                      <Alert variant=\"default\" className=\"bg-muted\">\n                        <AlertCircle className=\"h-5 w-5\" />\n                        <AlertTitle>Important Information</AlertTitle>\n                        <AlertDescription>\n                          <ul className=\"list-disc pl-5 space-y-1 mt-2\">\n                            <li>Your commission rate applies only to deposits from admin to your account</li>\n                            <li>Example: If your rate is {depositCommission ? (depositCommission.commissionRate / 100).toFixed(2) : \"0.00\"}% and admin adds 1000, you receive {depositCommission ? (1000 + 1000 * depositCommission.commissionRate / 10000).toFixed(0) : \"1000\"}</li>\n                            <li>Player deposits and withdrawals do not generate commission for you</li>\n                            <li>Commission rates are set by the administrator and cannot be changed by subadmins</li>\n                          </ul>\n                        </AlertDescription>\n                      </Alert>\n                    </div>\n                  </div>\n                )}\n              </TabsContent>\n              \n              <TabsContent value=\"odds\">\n                {isLoadingAdminOdds || isLoadingSubadminOdds ? (\n                  <div className=\"flex justify-center py-4\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                  </div>\n                ) : (\n                  <div className=\"space-y-6\">\n                    <Alert>\n                      <Info className=\"h-5 w-5\" />\n                      <AlertTitle>Game Odds</AlertTitle>\n                      <AlertDescription>\n                        Game odds determine payouts for player bets. These odds apply ONLY to players assigned to you and have no effect on other subadmins or unassigned players. The platform default odds (set by the administrator) apply to all other players.\n                      </AlertDescription>\n                    </Alert>\n                    \n                    <div className=\"space-y-6\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <div>\n                          <h3 className=\"text-lg font-medium mb-4\">Platform Default Odds</h3>\n                          {isLoadingAdminOdds ? (\n                            <Card className=\"bg-muted/30\">\n                              <CardContent className=\"p-6 flex justify-center\">\n                                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                              </CardContent>\n                            </Card>\n                          ) : adminOdds && Array.isArray(adminOdds) && adminOdds.length > 0 ? (\n                            <Card className=\"bg-muted/30\">\n                              <CardContent className=\"pt-6\">\n                                <div className=\"space-y-2\">\n                                  {adminOdds\n                                    .filter((odd: GameOdd) => \n                                      odd.gameType !== 'team_match' && \n                                      odd.gameType !== 'team_match_draw'\n                                    )\n                                    .map((odd: GameOdd) => (\n                                    <div key={odd.gameType} className=\"flex justify-between items-center border-b pb-2 last:border-0\">\n                                      <span className=\"font-medium\">{formatGameType(odd.gameType)}</span>\n                                      <span className=\"text-lg font-mono font-bold\">{(odd.oddValue).toFixed(2)}x</span>\n                                    </div>\n                                  ))}\n                                </div>\n                              </CardContent>\n                            </Card>\n                          ) : (\n                            <div className=\"p-4 border rounded-md\">\n                              <p className=\"text-center text-muted-foreground\">\n                                No game odds have been set by the administrator yet.\n                              </p>\n                            </div>\n                          )}\n                        </div>\n                        \n                        <div>\n                          <h3 className=\"text-lg font-medium mb-4\">Your Players' Game Odds</h3>\n                          {isLoadingSubadminOdds ? (\n                            <Card className=\"bg-muted/30\">\n                              <CardContent className=\"p-6 flex justify-center\">\n                                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                              </CardContent>\n                            </Card>\n                          ) : subadminOdds && Array.isArray(subadminOdds) && subadminOdds.length > 0 ? (\n                            <Card className=\"bg-muted/30\">\n                              <CardContent className=\"pt-6\">\n                                <div className=\"space-y-2\">\n                                  {subadminOdds\n                                    .filter((odd: GameOdd) => \n                                      odd.gameType !== 'team_match' && \n                                      odd.gameType !== 'team_match_draw'\n                                    )\n                                    .map((odd: GameOdd) => (\n                                    <div key={odd.gameType} className=\"flex justify-between items-center border-b pb-2 last:border-0\">\n                                      <span className=\"font-medium\">{formatGameType(odd.gameType)}</span>\n                                      <span className=\"text-lg font-mono font-bold\">{odd.oddValue.toFixed(2)}x</span>\n                                    </div>\n                                  ))}\n                                </div>\n                              </CardContent>\n                            </Card>\n                          ) : (\n                            <div className=\"p-4 border rounded-md\">\n                              <p className=\"text-center text-muted-foreground\">\n                                No game odds have been set for your account yet.\n                              </p>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                      \n                      {/* Notice for subadmins about new odds permission rules */}\n                      {user?.role === UserRole.SUBADMIN && (\n                        <div className=\"mt-6 border rounded-lg p-4 bg-card\">\n                          <Alert>\n                            <AlertCircle className=\"h-4 w-4\" />\n                            <AlertTitle>Game Odds Configuration Change</AlertTitle>\n                            <AlertDescription>\n                              Game odds can now only be set by the platform administrator. Please contact the administrator if you need to adjust game odds for your players.\n                            </AlertDescription>\n                          </Alert>\n                        </div>\n                      )}\n                      \n                      {/* Game odds edit form - only for admins */}\n                      {user?.role === UserRole.ADMIN && (\n                        <div className=\"mt-6 border rounded-lg p-4 bg-card\">\n                          <h3 className=\"text-lg font-medium mb-4\">Edit Subadmin Game Odds</h3>\n                          <p className=\"text-sm text-muted-foreground mb-4\">\n                            Modify the odds that apply to this subadmin's assigned players. If odds are set higher than the platform defaults, any losses will be covered by the subadmin's account.\n                          </p>\n                          \n                          {/* Platform default odds vs custom subadmin odds comparison */}\n                          <div className=\"mb-6 grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div className=\"bg-purple-950 p-4 rounded-lg\">\n                              <h4 className=\"text-lg font-medium mb-4 text-white\">Platform Default Odds</h4>\n                              <div className=\"space-y-0\">\n                                {isLoadingAdminOdds ? (\n                                  <div className=\"py-3 text-center text-white\">\n                                    <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-white mx-auto\"></div>\n                                    <p className=\"mt-2\">Loading odds...</p>\n                                  </div>\n                                ) : (\n                                  <>\n                                    {Array.isArray(adminOdds) && adminOdds\n                                      .filter((odd: GameOdd) => \n                                        odd.gameType !== 'team_match' && \n                                        odd.gameType !== 'team_match_draw'\n                                      )\n                                      .map((odd: GameOdd) => (\n                                        <div key={odd.gameType} className=\"flex justify-between items-center py-3 border-b border-purple-800 last:border-0\">\n                                          <span className=\"text-white\">{formatGameType(odd.gameType)}</span>\n                                          <span className=\"text-lg font-mono font-bold text-white\">\n                                            {odd.oddValue.toFixed(2)}x\n                                          </span>\n                                        </div>\n                                      ))\n                                    }\n                                    {(!adminOdds || !Array.isArray(adminOdds) || adminOdds.length === 0) && (\n                                      <div className=\"py-3 text-center text-white\">\n                                        No platform odds found\n                                      </div>\n                                    )}\n                                  </>\n                                )}\n                              </div>\n                            </div>\n                            \n                            <div className=\"bg-purple-950 p-4 rounded-lg\">\n                              <h4 className=\"text-lg font-medium mb-4 text-white\">Your Players' Game Odds</h4>\n                              <div className=\"space-y-0\">\n                                {isLoadingSubadminOdds ? (\n                                  <div className=\"py-3 text-center text-white\">\n                                    <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-white mx-auto\"></div>\n                                    <p className=\"mt-2\">Loading odds...</p>\n                                  </div>\n                                ) : (\n                                  <>\n                                    {Array.isArray(subadminOdds) && subadminOdds\n                                      .filter((odd: GameOdd) => \n                                        odd.gameType !== 'team_match' && \n                                        odd.gameType !== 'team_match_draw'\n                                      )\n                                      .map((odd: GameOdd) => (\n                                        <div key={odd.gameType} className=\"flex justify-between items-center py-3 border-b border-purple-800 last:border-0\">\n                                          <span className=\"text-white\">{formatGameType(odd.gameType)}</span>\n                                          <span className=\"text-lg font-mono font-bold text-white\">\n                                            {odd.oddValue.toFixed(2)}x\n                                          </span>\n                                        </div>\n                                      ))\n                                    }\n                                    {(!subadminOdds || !Array.isArray(subadminOdds) || subadminOdds.length === 0) && (\n                                      <div className=\"py-3 text-center text-white\">\n                                        No subadmin odds found\n                                      </div>\n                                    )}\n                                  </>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                          \n                          {/* Notice for odds change */}\n                          <div className=\"my-4 p-4 border border-primary/20 rounded-lg bg-primary/5\">\n                            <div className=\"flex items-start space-x-2\">\n                              <Info className=\"h-5 w-5 text-primary mt-0.5\" />\n                              <div>\n                                <h4 className=\"text-md font-semibold mb-1\">Game Odds Configuration</h4>\n                                <p className=\"text-sm text-muted-foreground\">\n                                  You can configure custom odds for this subadmin. When setting custom odds, remember that:\n                                </p>\n                                <ul className=\"list-disc pl-5 mt-2 space-y-1 text-sm text-muted-foreground\">\n                                  <li>Platform default odds are applied to all subadmins by default</li>\n                                  <li>Customizing odds only affects players assigned to this specific subadmin</li>\n                                  <li>Subadmin odds are displayed to players with a <strong>divided factor</strong> compared to platform odds</li>\n                                </ul>\n                              </div>\n                            </div>\n                          </div>\n                          \n                          <Form {...oddsForm}>\n                            <form onSubmit={oddsForm.handleSubmit(onSubmitOdds)} className=\"space-y-4\">\n                              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                                \n                                <FormField\n                                  control={oddsForm.control}\n                                  name=\"cricketToss\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>Cricket Toss</FormLabel>\n                                      <FormControl>\n                                        <Input type=\"number\" step=\"0.01\" min=\"1.0\" {...field} />\n                                      </FormControl>\n                                      <FormDescription className=\"text-xs\">\n                                        Platform default: 1.90x | Player view: 0.02x\n                                      </FormDescription>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                \n                                <FormField\n                                  control={oddsForm.control}\n                                  name=\"coinFlip\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>Coin Flip</FormLabel>\n                                      <FormControl>\n                                        <Input type=\"number\" step=\"0.01\" min=\"1.0\" {...field} />\n                                      </FormControl>\n                                      <FormDescription className=\"text-xs\">\n                                        Platform default: 1.95x | Player view: 0.02x\n                                      </FormDescription>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                \n                                <FormField\n                                  control={oddsForm.control}\n                                  name=\"satamatkaJodi\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>Jodi (Pair)</FormLabel>\n                                      <FormControl>\n                                        <Input type=\"number\" step=\"0.01\" min=\"1.0\" {...field} />\n                                      </FormControl>\n                                      <FormDescription className=\"text-xs\">\n                                        Platform default: 90.00x | Player view: 0.90x\n                                      </FormDescription>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                \n                                <FormField\n                                  control={oddsForm.control}\n                                  name=\"satamatkaHarf\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>Harf</FormLabel>\n                                      <FormControl>\n                                        <Input type=\"number\" step=\"0.01\" min=\"1.0\" {...field} />\n                                      </FormControl>\n                                      <FormDescription className=\"text-xs\">\n                                        Platform default: 9.00x | Player view: 0.09x\n                                      </FormDescription>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                \n                                <FormField\n                                  control={oddsForm.control}\n                                  name=\"satamatkaOddEven\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>Odd/Even</FormLabel>\n                                      <FormControl>\n                                        <Input type=\"number\" step=\"0.01\" min=\"1.0\" {...field} />\n                                      </FormControl>\n                                      <FormDescription className=\"text-xs\">\n                                        Platform default: 1.90x | Player view: 0.02x\n                                      </FormDescription>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                \n                                <FormField\n                                  control={oddsForm.control}\n                                  name=\"satamatkaCrossing\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>Crossing Bet</FormLabel>\n                                      <FormControl>\n                                        <Input type=\"number\" step=\"0.01\" min=\"1.0\" {...field} />\n                                      </FormControl>\n                                      <FormDescription className=\"text-xs\">\n                                        Platform default: 95.00x | Player view: 0.95x\n                                      </FormDescription>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                              </div>\n                              \n                              <div className=\"flex justify-end\">\n                                <Button \n                                  type=\"submit\" \n                                  disabled={updateOddsMutation.isPending}\n                                  className=\"flex items-center gap-2\"\n                                >\n                                  {updateOddsMutation.isPending && <div className=\"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full\"></div>}\n                                  <Save className=\"h-4 w-4 mr-1\" /> Save Custom Odds\n                                </Button>\n                              </div>\n                            </form>\n                          </Form>\n                        </div>\n                      )}\n                      \n                      <Alert variant=\"default\" className=\"bg-muted mt-4\">\n                        <AlertCircle className=\"h-5 w-5\" />\n                        <AlertTitle>Important Notes</AlertTitle>\n                        <AlertDescription>\n                          <ul className=\"list-disc pl-5 space-y-1\">\n                            <li><strong>IMPORTANT:</strong> These odds ONLY affect players assigned directly to you.</li>\n                            <li>Players assigned to other subadmins or directly to the administrator will use the Platform Default Odds instead.</li>\n                            <li>If you set odds higher than the platform defaults, any losses will be covered by your account balance.</li>\n                            <li>Setting odds higher than platform defaults increases player payouts but reduces your profit margin.</li>\n                          </ul>\n                        </AlertDescription>\n                      </Alert>\n                    </div>\n                  </div>\n                )}\n              </TabsContent>\n              \n              {/* Removed Player Discounts & Odds tab - this functionality exists in user management player list */}\n            </Tabs>\n          </CardContent>\n        </Card>\n      ) : (\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertTitle>Error</AlertTitle>\n          <AlertDescription>\n            Subadmin not found. Please check the ID and try again.\n          </AlertDescription>\n        </Alert>\n      )}\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":45473,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\nimport { format } from \"date-fns\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n/**\n * Format a date string or Date object into a readable format with Indian timezone\n * @param dateString Date string or Date object\n * @param formatStr Optional format string (defaults to \"MMM dd, yyyy h:mm a\")\n * @returns Formatted date string in IST\n */\nexport function formatDate(dateString: string | Date, formatStr: string = \"MMM dd, yyyy h:mm a\") {\n  try {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    \n    // Convert to Indian Standard Time (IST)\n    const istDate = new Date(date.toLocaleString(\"en-US\", {timeZone: \"Asia/Kolkata\"}));\n    \n    return format(istDate, formatStr);\n  } catch (error) {\n    console.error(\"Error formatting date:\", error);\n    return typeof dateString === 'string' ? dateString : dateString.toString();\n  }\n}\n\n/**\n * Format a number as currency\n * @param amount Amount to format\n * @param currency Currency code (defaults to INR)\n * @returns Formatted currency string\n */\nexport function formatCurrency(amount: number, currency: string = \"INR\") {\n  try {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency,\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(amount);\n  } catch (error) {\n    console.error(\"Error formatting currency:\", error);\n    return amount.toString();\n  }\n}\n","path":null,"size_bytes":1522,"size_tokens":null},"client/src/pages/reset-zone-page.tsx":{"content":"import { useState } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { \n  Card, \n  CardContent, \n  CardDescription, \n  CardFooter, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { \n  AlertTriangle, \n  Trash2, \n  RefreshCw,\n  DatabaseBackup,\n  Wallet,\n  AlertCircle\n} from \"lucide-react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Alert,\n  AlertDescription,\n  AlertTitle,\n} from \"@/components/ui/alert\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { UserRole } from \"@/lib/types\";\n\nexport default function ResetZonePage() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [confirmationCode, setConfirmationCode] = useState(\"\");\n  const [confirmDialogOpen, setConfirmDialogOpen] = useState(false);\n  const [resetType, setResetType] = useState<\"all\" | \"games\" | \"transactions\" | \"balance\">(\"all\");\n  const [isLoading, setIsLoading] = useState(false);\n  \n  // Ensure this page is only accessible by admins\n  if (user?.role !== UserRole.ADMIN) {\n    return (\n      <DashboardLayout title=\"Access Denied\">\n        <div className=\"flex flex-col items-center justify-center h-[80vh]\">\n          <AlertTriangle className=\"h-16 w-16 text-red-500 mb-4\" />\n          <h1 className=\"text-2xl font-bold text-red-500\">Access Denied</h1>\n          <p className=\"text-slate-400 mt-2\">You do not have permission to access this page.</p>\n        </div>\n      </DashboardLayout>\n    );\n  }\n  \n  const handleReset = async () => {\n    if (confirmationCode !== \"RESET_CONFIRM\") {\n      toast({\n        title: \"Invalid confirmation code\",\n        description: \"Please type RESET_CONFIRM to proceed with system reset\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    try {\n      setIsLoading(true);\n      const response = await apiRequest(\n        \"POST\",\n        \"/api/admin/reset-system\",\n        {\n          resetType,\n          confirmationCode,\n        }\n      );\n      \n      const responseData = await response.json();\n      \n      toast({\n        title: \"Reset Successful\",\n        description: responseData.message,\n      });\n      \n      // Clear confirmation code after successful reset\n      setConfirmationCode(\"\");\n      setConfirmDialogOpen(false);\n    } catch (error: any) {\n      toast({\n        title: \"Reset Failed\",\n        description: error.message || \"An error occurred during the reset process\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  \n  const openConfirmDialog = (type: \"all\" | \"games\" | \"transactions\" | \"balance\") => {\n    setResetType(type);\n    setConfirmDialogOpen(true);\n  };\n  \n  return (\n    <DashboardLayout title=\"Reset Zone\">\n      <div className=\"mb-6\">\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertTitle>Warning: Destructive Actions</AlertTitle>\n          <AlertDescription>\n            This area contains system reset options that will permanently delete data. These actions cannot be undone.\n            Use with extreme caution and only when necessary.\n          </AlertDescription>\n        </Alert>\n      </div>\n      \n      <Tabs defaultValue=\"reset\">\n        <TabsList className=\"mb-6\">\n          <TabsTrigger value=\"reset\">Reset Options</TabsTrigger>\n        </TabsList>\n        \n        <TabsContent value=\"reset\">\n          <div className=\"grid gap-6 md:grid-cols-2\">\n            <Card className=\"border-red-800 bg-slate-900\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center text-red-500\">\n                  <Trash2 className=\"mr-2 h-5 w-5\" />\n                  Reset Everything\n                </CardTitle>\n                <CardDescription>\n                  Reset all system data including games, markets, matches, transactions, and user balances\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-slate-400 mb-4\">\n                  This will delete all game data, transaction history, and reset all user balances to zero (except admin).\n                  All records will be permanently removed from the system.\n                </p>\n              </CardContent>\n              <CardFooter>\n                <Button \n                  variant=\"destructive\" \n                  onClick={() => openConfirmDialog(\"all\")}\n                >\n                  Reset All Data\n                </Button>\n              </CardFooter>\n            </Card>\n            \n            <Card className=\"border-amber-800 bg-slate-900\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center text-amber-500\">\n                  <RefreshCw className=\"mr-2 h-5 w-5\" />\n                  Reset Games Only\n                </CardTitle>\n                <CardDescription>\n                  Reset only game data including markets and matches\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-slate-400 mb-4\">\n                  This will delete all game data, including Satamatka markets and team matches,\n                  while preserving user accounts, balances and transaction history.\n                </p>\n              </CardContent>\n              <CardFooter>\n                <Button \n                  variant=\"default\"\n                  className=\"bg-amber-800 hover:bg-amber-700 text-white\"\n                  onClick={() => openConfirmDialog(\"games\")}\n                >\n                  Reset Games\n                </Button>\n              </CardFooter>\n            </Card>\n            \n            <Card className=\"border-blue-800 bg-slate-900\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center text-blue-500\">\n                  <DatabaseBackup className=\"mr-2 h-5 w-5\" />\n                  Reset Transactions\n                </CardTitle>\n                <CardDescription>\n                  Reset all transactions and set user balances to zero\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-slate-400 mb-4\">\n                  This will delete all transaction history and reset all user balances to zero (except admin).\n                  Game data will be preserved.\n                </p>\n              </CardContent>\n              <CardFooter>\n                <Button \n                  variant=\"default\"\n                  className=\"bg-blue-800 hover:bg-blue-700 text-white\"\n                  onClick={() => openConfirmDialog(\"transactions\")}\n                >\n                  Reset Transactions\n                </Button>\n              </CardFooter>\n            </Card>\n            \n            <Card className=\"border-purple-800 bg-slate-900\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center text-purple-500\">\n                  <Wallet className=\"mr-2 h-5 w-5\" />\n                  Reset Balances\n                </CardTitle>\n                <CardDescription>\n                  Reset all user balances to zero (except admin)\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-slate-400 mb-4\">\n                  This will reset all user balances to zero (except admin).\n                  All game data and transaction history will be preserved.\n                </p>\n              </CardContent>\n              <CardFooter>\n                <Button \n                  variant=\"default\" \n                  className=\"bg-purple-800 hover:bg-purple-700 text-white\"\n                  onClick={() => openConfirmDialog(\"balance\")}\n                >\n                  Reset Balances\n                </Button>\n              </CardFooter>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n      \n      <Dialog open={confirmDialogOpen} onOpenChange={setConfirmDialogOpen}>\n        <DialogContent className=\"bg-slate-900 text-white border-slate-700\">\n          <DialogHeader>\n            <DialogTitle className=\"text-red-500 flex items-center\">\n              <AlertTriangle className=\"h-5 w-5 mr-2\" />\n              Confirm System Reset\n            </DialogTitle>\n            <DialogDescription className=\"text-slate-300\">\n              You are about to perform a {resetType === \"all\" ? \"complete system reset\" : `${resetType} reset`}.\n              This action is irreversible and will permanently delete data.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"my-4\">\n            <p className=\"text-sm text-slate-300 mb-2\">Type <span className=\"font-bold text-red-400\">RESET_CONFIRM</span> to proceed:</p>\n            <Input \n              type=\"text\"\n              placeholder=\"RESET_CONFIRM\"\n              value={confirmationCode}\n              onChange={(e) => setConfirmationCode(e.target.value)}\n              className=\"bg-slate-800 border-slate-700 text-white\"\n            />\n          </div>\n          \n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setConfirmDialogOpen(false)}\n              disabled={isLoading}\n            >\n              Cancel\n            </Button>\n            <Button \n              variant=\"destructive\" \n              onClick={handleReset}\n              disabled={isLoading}\n            >\n              {isLoading ? \"Processing...\" : \"Confirm Reset\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":10006,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"import * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1739,"size_tokens":null},"removed_files/client/admin-cricket-toss-page.tsx":{"content":"import { useState, Fragment } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getQueryFn, apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { format, parseISO } from \"date-fns\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { \n  Card, \n  CardContent, \n  CardDescription, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { \n  Form, \n  FormControl, \n  FormDescription, \n  FormField, \n  FormItem, \n  FormLabel, \n  FormMessage \n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useForm } from \"react-hook-form\";\nimport * as z from \"zod\";\nimport { \n  Calendar, \n  Search, \n  Plus,\n  Clock, \n  CheckCircle2, \n  AlertCircle,\n  X,\n  Edit,\n  Filter\n} from \"lucide-react\";\nimport { GiCricketBat } from \"react-icons/gi\";\nimport { \n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { GameType, TeamMatchResult } from \"@shared/schema\";\n\n// Type for Cricket Toss Game\ntype CricketTossGame = {\n  id: number;\n  userId: number;\n  gameType: string;\n  betAmount: number;\n  prediction: string;\n  status: string;\n  result: string | null;\n  payout: number;\n  createdAt: string;\n  gameData: {\n    teamA: string;\n    teamB: string;\n    tossTime: string;\n    description: string;\n    oddTeamA: number;\n    oddTeamB: number;\n    imageUrl?: string;\n    status?: string; // \"open\" | \"closed\"\n    openTime?: string;\n    closeTime?: string;\n  };\n};\n\n// Define the props for the cricket toss table component\ninterface CricketTossTableProps {\n  games: CricketTossGame[];\n  isLoading: boolean;\n  handleEditGame: (game: CricketTossGame) => void;\n  handleDeclareResult: (game: CricketTossGame) => void;\n  handleChangeStatus: (game: CricketTossGame) => void;\n  formatDate: (date: string | undefined) => string;\n  StatusBadge: React.FC<{ result: string | null }>;\n  getResultDisplay: (result: string | null, game: CricketTossGame) => string;\n}\n\n// Form schema for declaring toss results\nconst resultFormSchema = z.object({\n  result: z.string().min(1, \"Result is required\")\n});\n\n// Form schema for changing game status\nconst statusFormSchema = z.object({\n  status: z.enum([\"open\", \"closed\"], {\n    required_error: \"Status is required\"\n  })\n});\n\n// Form schema for creating/editing cricket toss games\nconst tossGameFormSchema = z.object({\n  teamA: z.string().min(2, \"Team A name must be at least 2 characters\"),\n  teamB: z.string().min(2, \"Team B name must be at least 2 characters\"),\n  description: z.string().optional(),\n  tossDate: z.string().min(1, \"Toss date is required\"),\n  tossTime: z.string().min(1, \"Toss time is required\"),\n  imageUrl: z.string().optional(),\n});\n\nexport default function AdminCricketTossPage() {\n  const { user } = useAuth();\n  const [activeTab, setActiveTab] = useState(\"all\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isAddGameOpen, setIsAddGameOpen] = useState(false);\n  const [editingGame, setEditingGame] = useState<CricketTossGame | null>(null);\n  const [declareResultGame, setDeclareResultGame] = useState<CricketTossGame | null>(null);\n  const queryClient = useQueryClient();\n\n  // Form for result declaration\n  const resultForm = useForm<z.infer<typeof resultFormSchema>>({\n    resolver: zodResolver(resultFormSchema),\n    defaultValues: {\n      result: \"\",\n    },\n  });\n\n  // Form for add/edit game\n  const gameForm = useForm<z.infer<typeof tossGameFormSchema>>({\n    resolver: zodResolver(tossGameFormSchema),\n    defaultValues: {\n      teamA: \"\",\n      teamB: \"\",\n      description: \"\",\n      tossDate: format(new Date(), \"yyyy-MM-dd\"),\n      tossTime: \"12:00\",\n      imageUrl: \"\",\n    },\n  });\n\n  // Mock data for Cricket Toss games (replace with API calls later)\n  const mockGames: CricketTossGame[] = [\n    {\n      id: 1,\n      userId: 1,\n      gameType: GameType.CRICKET_TOSS,\n      betAmount: 0,\n      prediction: \"\",\n      status: \"open\",\n      result: null,\n      payout: 0,\n      createdAt: \"2025-04-17T10:30:00\",\n      gameData: {\n        teamA: \"India\",\n        teamB: \"Australia\",\n        tossTime: \"2025-04-20T14:00:00\",\n        description: \"T20 World Cup 2025\",\n        oddTeamA: 180,\n        oddTeamB: 220,\n        imageUrl: \"/images/india-vs-australia.svg\"\n      }\n    },\n    {\n      id: 2,\n      userId: 1,\n      gameType: GameType.CRICKET_TOSS,\n      betAmount: 0,\n      prediction: \"\",\n      status: \"open\",\n      result: null,\n      payout: 0,\n      createdAt: \"2025-04-16T09:15:00\",\n      gameData: {\n        teamA: \"England\",\n        teamB: \"New Zealand\",\n        tossTime: \"2025-04-18T15:30:00\",\n        description: \"Test Match Day 1\",\n        oddTeamA: 200,\n        oddTeamB: 200,\n        imageUrl: \"/images/england-vs-nz.svg\"\n      }\n    },\n    {\n      id: 3,\n      userId: 1,\n      gameType: GameType.CRICKET_TOSS,\n      betAmount: 0,\n      prediction: \"\",\n      status: \"resulted\",\n      result: \"team_a\",\n      payout: 0,\n      createdAt: \"2025-04-14T11:20:00\",\n      gameData: {\n        teamA: \"Pakistan\",\n        teamB: \"South Africa\",\n        tossTime: \"2025-04-15T13:00:00\",\n        description: \"ODI Series Match 2\",\n        oddTeamA: 210,\n        oddTeamB: 190,\n        imageUrl: \"/images/pakistan-vs-sa.svg\"\n      }\n    }\n  ];\n\n  // Query for all cricket toss games (from both APIs for backward compatibility)\n  const { data: legacyGames = [], isLoading: isLoadingLegacyGames } = useQuery<CricketTossGame[]>({\n    queryKey: [\"/api/cricket-toss\"],\n    queryFn: getQueryFn({ on401: \"throw\" }),\n    enabled: !!user,\n  });\n  \n  // Query for standalone cricket toss games (new API)\n  const { data: standaloneGames = [], isLoading: isLoadingStandaloneGames } = useQuery<CricketTossGame[]>({\n    queryKey: [\"/api/cricket-toss-games\"],\n    queryFn: getQueryFn({ on401: \"throw\" }),\n    enabled: !!user,\n  });\n  \n  // Combine both data sources with unique keys by adding a source identifier\n  const allGames = [\n    ...legacyGames.map(game => ({ ...game, source: 'legacy' })),\n    ...standaloneGames.map(game => ({ ...game, source: 'standalone' }))\n  ];\n  const isLoadingGames = isLoadingLegacyGames || isLoadingStandaloneGames;\n\n  // Filter games by result status\n  const openGames = allGames.filter(game => \n    (game.result === null || game.result === \"\" || game.result === \"pending\"));\n  const resultedGames = allGames.filter(game => \n    (game.result === \"team_a\" || game.result === \"team_b\"));\n  const closedGames = allGames.filter(game => \n    (game.result !== null && game.result !== \"\" && game.result !== \"pending\" && \n     game.result !== \"team_a\" && game.result !== \"team_b\"));\n\n  // Get games for current tab\n  const getGamesForTab = () => {\n    switch (activeTab) {\n      case \"open\": return openGames;\n      case \"closed\": return closedGames;\n      case \"resulted\": return resultedGames;\n      default: return allGames;\n    }\n  };\n\n  // Filter games by search query\n  const filteredGames = getGamesForTab().filter(game => {\n    // If search query is empty, return all games\n    if (searchQuery === \"\") return true;\n    \n    // If no gameData, still show it in the results but only when search is empty\n    if (!game.gameData) return false;\n    \n    // Otherwise, filter by team names and description\n    return game.gameData.teamA.toLowerCase().includes(searchQuery.toLowerCase()) || \n    game.gameData.teamB.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    game.gameData.description?.toLowerCase().includes(searchQuery.toLowerCase());\n  });\n\n  // Format date for display\n  const formatDate = (dateString: string | undefined) => {\n    if (!dateString) return \"N/A\";\n    try {\n      return format(parseISO(dateString), \"MMM d, yyyy h:mm a\");\n    } catch (error) {\n      console.error(\"Error formatting date:\", error);\n      return \"Invalid date\";\n    }\n  };\n\n  // Handle opening edit game dialog\n  const handleEditGame = (game: CricketTossGame) => {\n    if (!game.gameData) return;\n    \n    setEditingGame(game);\n    \n    try {\n      // Add safe handling of date parsing for toss time\n      let tossDate = new Date();\n      let tossTimeStr = \"12:00\";\n      \n      if (game.gameData.tossTime) {\n        const parsedDate = parseISO(game.gameData.tossTime);\n        tossDate = parsedDate;\n        tossTimeStr = format(parsedDate, \"HH:mm\");\n      }\n      \n      gameForm.reset({\n        teamA: game.gameData.teamA,\n        teamB: game.gameData.teamB,\n        description: game.gameData.description || \"\",\n        tossDate: format(tossDate, \"yyyy-MM-dd\"),\n        tossTime: tossTimeStr,\n        imageUrl: game.gameData.imageUrl || \"\",\n      });\n    } catch (error) {\n      console.error(\"Error parsing game data:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load game data for editing. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  // Handle opening declare result dialog\n  const handleDeclareResult = (game: CricketTossGame) => {\n    try {\n      setDeclareResultGame(game);\n      resultForm.reset({ result: game.result || \"\" });\n    } catch (error) {\n      console.error(\"Error handling declare result:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to open result declaration dialog. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n  \n  // Handle closing a match\n  const handleCloseMatch = (game: CricketTossGame) => {\n    try {\n      // Check if this is a standalone cricket toss game and use the appropriate API\n      const isStandalone = isStandaloneTossGame(game);\n      \n      // Confirm with the user before closing the match\n      if (confirm(`Are you sure you want to close the match between ${game.gameData.teamA} and ${game.gameData.teamB}? This will prevent further betting.`)) {\n        updateTossStatus.mutate({\n          id: game.id,\n          status: \"closed\",\n          isStandalone: isStandalone\n        });\n      }\n    } catch (error) {\n      console.error(\"Error closing match:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to close the match. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  // Helper to identify standalone cricket toss games vs legacy games\n  const isStandaloneTossGame = (game: CricketTossGame): boolean => {\n    // Games fetched from the new API are identifiable by source\n    // This is a heuristic - we'd need a more reliable way to identify in production\n    if ((game as any).matchId !== undefined) {\n      return !(game as any).matchId;\n    }\n    // Default to true for new games\n    return true;\n  };\n\n  // Mutation for declaring toss result\n  const updateTossResult = useMutation({\n    mutationFn: ({ id, result, isStandalone }: { id: number, result: string, isStandalone: boolean }) => {\n      // Use the appropriate API endpoint based on game type\n      const endpoint = isStandalone \n        ? `/api/cricket-toss-games/${id}/result` // New standalone endpoint\n        : `/api/cricket-toss/${id}/result`;      // Legacy endpoint\n        \n      return apiRequest(\n        'PATCH',\n        endpoint,\n        { result }\n      );\n    },\n    onSuccess: () => {\n      setDeclareResultGame(null);\n      resultForm.reset();\n      // Invalidate both query keys to ensure all data is updated\n      queryClient.invalidateQueries({ queryKey: [\"/api/cricket-toss\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cricket-toss-games\"] });\n      toast({\n        title: \"Result declared\",\n        description: \"Toss result has been declared successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to declare result. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Mutation for updating game status (close/open)\n  const updateTossStatus = useMutation({\n    mutationFn: ({ id, status, isStandalone }: { id: number, status: string, isStandalone: boolean }) => {\n      // Use the appropriate API endpoint based on game type\n      const endpoint = isStandalone \n        ? `/api/cricket-toss-games/${id}/status` // New standalone endpoint\n        : `/api/cricket-toss/${id}/status`;      // Legacy endpoint\n        \n      return apiRequest(\n        'PATCH',\n        endpoint,\n        { status }\n      );\n    },\n    onSuccess: () => {\n      // Invalidate both query keys to ensure all data is updated\n      queryClient.invalidateQueries({ queryKey: [\"/api/cricket-toss\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cricket-toss-games\"] });\n      toast({\n        title: \"Status updated\",\n        description: \"Match status has been updated successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update status. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Handle submit for declaring result\n  const onSubmitResult = (data: z.infer<typeof resultFormSchema>) => {\n    if (declareResultGame) {\n      // Check if this is a standalone cricket toss game and use the appropriate API\n      const isStandalone = isStandaloneTossGame(declareResultGame);\n      \n      updateTossResult.mutate({ \n        id: declareResultGame.id, \n        result: data.result,\n        isStandalone: isStandalone\n      });\n    }\n  };\n\n  // Mutation for creating a standalone cricket toss game\n  const createTossGame = useMutation({\n    mutationFn: (data: any) => {\n      // Use the new standalone endpoint\n      return apiRequest(\n        'POST',\n        '/api/cricket-toss-games', // New standalone endpoint\n        data\n      );\n    },\n    onSuccess: () => {\n      setIsAddGameOpen(false);\n      gameForm.reset();\n      // Invalidate both query keys to ensure all data is updated\n      queryClient.invalidateQueries({ queryKey: [\"/api/cricket-toss\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cricket-toss-games\"] });\n      toast({\n        title: \"Game created\",\n        description: \"New Cricket Toss game has been created successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create game. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Mutation for updating a cricket toss game\n  const updateTossGame = useMutation({\n    mutationFn: ({ id, data }: { id: number, data: any }) => {\n      return apiRequest(\n        'PATCH',\n        `/api/cricket-toss-games/${id}`,\n        data\n      );\n    },\n    onSuccess: () => {\n      setEditingGame(null);\n      gameForm.reset();\n      // Invalidate both query keys to ensure all data is updated\n      queryClient.invalidateQueries({ queryKey: [\"/api/cricket-toss\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cricket-toss-games\"] });\n      toast({\n        title: \"Game updated\",\n        description: \"Cricket Toss game has been updated successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update game. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Handle submit for adding/editing game\n  const onSubmitGame = (formData: z.infer<typeof tossGameFormSchema>) => {\n    // Combine date and time into a single ISO string for tossTime\n    const { \n      tossDate, tossTime, \n      ...restData \n    } = formData;\n    \n    // Convert toss time to ISO string\n    const combinedTossDateTime = `${tossDate}T${tossTime}:00`;\n    \n    // Create the data object with combined date/time\n    const data = {\n      ...restData,\n      tossTime: combinedTossDateTime,\n      // Use toss time for open/close time as well - admin will manage these manually\n      openTime: combinedTossDateTime,\n      closeTime: combinedTossDateTime,\n    };\n    \n    if (editingGame) {\n      // Update existing game\n      updateTossGame.mutate({ \n        id: editingGame.id, \n        data: data\n      });\n    } else {\n      // Create a new cricket toss game\n      createTossGame.mutate(data);\n    }\n  };\n\n  // Prepare to add a new game\n  const handleAddGame = () => {\n    setIsAddGameOpen(true);\n    \n    // Get today's date for the form fields\n    const todayFormatted = format(new Date(), \"yyyy-MM-dd\");\n    \n    gameForm.reset({\n      teamA: \"\",\n      teamB: \"\",\n      description: \"\",\n      tossDate: todayFormatted,\n      tossTime: \"12:00\",\n      imageUrl: \"\",\n    });\n  };\n\n  // Status badge component based on result field\n  const StatusBadge = ({ result }: { result: string | null }) => {\n    let color = \"\";\n    let statusText = \"\";\n    \n    if (result === null || result === \"\" || result === \"pending\") {\n      color = \"bg-green-500 hover:bg-green-600\";\n      statusText = \"Open\";\n    } else if (result === \"team_a\" || result === \"team_b\") {\n      color = \"bg-blue-500 hover:bg-blue-600\";\n      statusText = \"Resulted\";\n    } else {\n      color = \"bg-yellow-500 hover:bg-yellow-600\";\n      statusText = \"Closed\";\n    }\n    \n    return (\n      <Badge className={color}>\n        {statusText}\n      </Badge>\n    );\n  };\n\n  // Get result display\n  const getResultDisplay = (result: string | null, game: CricketTossGame) => {\n    if (result === null || result === \"\" || result === \"pending\") return \"Pending\";\n    if (result === \"team_a\") {\n      return game.gameData ? game.gameData.teamA : \"Team A\";\n    }\n    if (result === \"team_b\") {\n      return game.gameData ? game.gameData.teamB : \"Team B\";\n    }\n    return result;\n  };\n\n  // Get today's date for display\n  const today = new Date();\n  const dateString = format(today, \"EEEE, MMMM d, yyyy\");\n\n  return (\n    <DashboardLayout title=\"Cricket Toss Management\">\n      <div className=\"mb-6\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <div className=\"flex items-center text-muted-foreground\">\n            <Calendar className=\"h-5 w-5 mr-2\" />\n            <span>{dateString}</span>\n          </div>\n          \n          <div className=\"flex gap-2\">\n            <Button onClick={handleAddGame} className=\"bg-gradient-to-r from-blue-600 to-indigo-600\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Cricket Toss Game\n            </Button>\n          </div>\n        </div>\n        <p className=\"text-muted-foreground\">\n          Create and manage Cricket Toss games for users to bet on which team will win the toss\n        </p>\n      </div>\n\n      {/* Search and filter bar */}\n      <div className=\"flex items-center justify-between mb-6 gap-4 flex-wrap\">\n        <div className=\"relative flex items-center flex-1 min-w-[200px]\">\n          <Search className=\"absolute left-3 h-4 w-4 text-muted-foreground\" />\n          <Input \n            placeholder=\"Search games...\" \n            className=\"pl-10\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n          />\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"all\" value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"mb-6 grid w-full grid-cols-4\">\n          <TabsTrigger value=\"all\" className=\"flex items-center justify-center\">\n            <AlertCircle className=\"h-4 w-4 mr-2\" />\n            <span>All ({allGames.length})</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"open\" className=\"flex items-center justify-center\">\n            <Clock className=\"h-4 w-4 mr-2\" />\n            <span>Open ({openGames.length})</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"closed\" className=\"flex items-center justify-center\">\n            <X className=\"h-4 w-4 mr-2\" />\n            <span>Closed ({closedGames.length})</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"resulted\" className=\"flex items-center justify-center\">\n            <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n            <span>Resulted ({resultedGames.length})</span>\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"all\" className=\"space-y-6\">\n          <CricketTossTable \n            games={filteredGames} \n            isLoading={isLoadingGames}\n            handleEditGame={handleEditGame}\n            handleDeclareResult={handleDeclareResult}\n            handleChangeStatus={handleCloseMatch}\n            formatDate={formatDate}\n            StatusBadge={StatusBadge}\n            getResultDisplay={getResultDisplay}\n          />\n        </TabsContent>\n        \n        <TabsContent value=\"open\" className=\"space-y-6\">\n          <CricketTossTable \n            games={filteredGames} \n            isLoading={isLoadingGames}\n            handleEditGame={handleEditGame}\n            handleDeclareResult={handleDeclareResult}\n            handleChangeStatus={handleCloseMatch}\n            formatDate={formatDate}\n            StatusBadge={StatusBadge}\n            getResultDisplay={getResultDisplay}\n          />\n        </TabsContent>\n        \n        <TabsContent value=\"closed\" className=\"space-y-6\">\n          <CricketTossTable \n            games={filteredGames} \n            isLoading={isLoadingGames}\n            handleEditGame={handleEditGame}\n            handleDeclareResult={handleDeclareResult}\n            handleChangeStatus={handleCloseMatch}\n            formatDate={formatDate}\n            StatusBadge={StatusBadge}\n            getResultDisplay={getResultDisplay}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"resulted\" className=\"space-y-6\">\n          <CricketTossTable \n            games={filteredGames} \n            isLoading={isLoadingGames}\n            handleEditGame={handleEditGame}\n            handleDeclareResult={handleDeclareResult}\n            handleChangeStatus={handleCloseMatch}\n            formatDate={formatDate}\n            StatusBadge={StatusBadge}\n            getResultDisplay={getResultDisplay}\n          />\n        </TabsContent>\n      </Tabs>\n\n      {/* Declare Result Dialog */}\n      <Dialog open={!!declareResultGame} onOpenChange={(open) => !open && setDeclareResultGame(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Declare Toss Result</DialogTitle>\n            <DialogDescription>\n              {declareResultGame && declareResultGame.gameData ? (\n                <span>\n                  Select which team won the toss: {declareResultGame.gameData.teamA} vs {declareResultGame.gameData.teamB}.\n                </span>\n              ) : (\n                <span>\n                  Select which team won the toss for Game #{declareResultGame?.id}.\n                </span>\n              )}\n            </DialogDescription>\n          </DialogHeader>\n          \n          <Form {...resultForm}>\n            <form onSubmit={resultForm.handleSubmit(onSubmitResult)} className=\"space-y-4\">\n              <FormField\n                control={resultForm.control}\n                name=\"result\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Toss Winner</FormLabel>\n                    <Select \n                      onValueChange={field.onChange} \n                      defaultValue={field.value}\n                    >\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select winner\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value={TeamMatchResult.TEAM_A}>\n                          {declareResultGame?.gameData ? `${declareResultGame.gameData.teamA} Won the Toss` : \"Team A Won the Toss\"}\n                        </SelectItem>\n                        <SelectItem value={TeamMatchResult.TEAM_B}>\n                          {declareResultGame?.gameData ? `${declareResultGame.gameData.teamB} Won the Toss` : \"Team B Won the Toss\"}\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <DialogFooter>\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  onClick={() => setDeclareResultGame(null)}\n                >\n                  Cancel\n                </Button>\n                <Button \n                  type=\"submit\"\n                >\n                  Declare Result\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Add/Edit Cricket Toss Game Dialog */}\n      <Dialog \n        open={isAddGameOpen || !!editingGame} \n        onOpenChange={(open) => {\n          if (!open) {\n            setIsAddGameOpen(false);\n            setEditingGame(null);\n          }\n        }}\n      >\n        <DialogContent className=\"max-w-xl max-h-[90vh] overflow-y-auto scrollbar-thin scrollbar-thumb-primary scrollbar-track-secondary\">\n          <DialogHeader>\n            <DialogTitle>{editingGame ? \"Edit Cricket Toss Game\" : \"Add New Cricket Toss Game\"}</DialogTitle>\n            <DialogDescription>\n              {editingGame \n                ? \"Edit the details of the existing Cricket Toss game.\" \n                : \"Fill in the details to create a new Cricket Toss game.\"}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...gameForm}>\n            <form onSubmit={gameForm.handleSubmit(onSubmitGame)} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <FormField\n                  control={gameForm.control}\n                  name=\"teamA\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Team A</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"e.g. Mumbai Indians\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={gameForm.control}\n                  name=\"teamB\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Team B</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"e.g. Chennai Super Kings\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              \n              <FormField\n                control={gameForm.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Description (Optional)</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"e.g. IPL 2025 Match #12\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              {/* Toss Date and Time Selection */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <FormField\n                  control={gameForm.control}\n                  name=\"tossDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Toss Date</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"date\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={gameForm.control}\n                  name=\"tossTime\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Toss Time</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"time\" \n                          step=\"60\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              \n              {/* Note: Open/Close buttons removed since admin manages these manually */}\n              \n              {/* Banner Image Selection */}\n              <div className=\"space-y-4\">\n                <div className=\"flex flex-col space-y-1.5\">\n                  <Label>Match Banner Image</Label>\n                  <div className=\"flex items-center space-x-4 mt-2\">\n                    <div className=\"flex-1\">\n                      <FormField\n                        control={gameForm.control}\n                        name=\"imageUrl\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormControl>\n                              <Input \n                                placeholder=\"Image URL\" \n                                {...field} \n                                value={field.value || \"\"}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                    <div className=\"flex-none\">\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={() => {\n                          // Show file picker and handle upload\n                          const fileInput = document.createElement('input');\n                          fileInput.type = 'file';\n                          fileInput.accept = 'image/*';\n                          \n                          fileInput.onchange = async (e) => {\n                            const file = (e.target as HTMLInputElement).files?.[0];\n                            if (!file) return;\n                            \n                            // Create form data for upload\n                            const formData = new FormData();\n                            formData.append('matchBannerImage', file);\n                            \n                            try {\n                              // Upload the file\n                              const response = await fetch('/api/upload/match-banner', {\n                                method: 'POST',\n                                body: formData,\n                              });\n                              \n                              if (!response.ok) {\n                                const errorData = await response.json();\n                                throw new Error(errorData.error || 'Failed to upload image');\n                              }\n                              \n                              const data = await response.json();\n                              \n                              if (data.imageUrl) {\n                                // Set the image URL in the form\n                                gameForm.setValue('imageUrl', data.imageUrl);\n                                toast({\n                                  title: \"Image uploaded\",\n                                  description: \"Banner image has been uploaded successfully\",\n                                });\n                              }\n                            } catch (error) {\n                              console.error('Error uploading image:', error);\n                              toast({\n                                title: \"Upload failed\",\n                                description: error instanceof Error ? error.message : 'Failed to upload image',\n                                variant: \"destructive\"\n                              });\n                            }\n                          };\n                          \n                          fileInput.click();\n                        }}\n                      >\n                        Upload Image\n                      </Button>\n                    </div>\n                  </div>\n                  {gameForm.watch('imageUrl') && (\n                    <div className=\"mt-4\">\n                      <p className=\"text-sm font-medium mb-2\">Preview:</p>\n                      <div className=\"relative w-full h-40 overflow-hidden rounded-md border border-input\">\n                        <img \n                          src={gameForm.watch('imageUrl')} \n                          alt=\"Match Banner Preview\" \n                          className=\"w-full h-full object-cover\"\n                          onError={(e) => {\n                            (e.target as HTMLImageElement).src = \"https://placehold.co/600x400?text=Image+Not+Found\";\n                          }}\n                        />\n                      </div>\n                    </div>\n                  )}\n                  <p className=\"text-sm text-muted-foreground mt-2\">\n                    Upload a banner image for the cricket toss game (optional)\n                  </p>\n                </div>\n              </div>\n              \n              <DialogFooter>\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  onClick={() => {\n                    setIsAddGameOpen(false);\n                    setEditingGame(null);\n                  }}\n                >\n                  Cancel\n                </Button>\n                <Button type=\"submit\">\n                  {editingGame ? \"Update Game\" : \"Create Game\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}\n\n// Cricket Toss Table Component\n\nfunction CricketTossTable({ \n  games, \n  isLoading,\n  handleEditGame,\n  handleDeclareResult,\n  handleChangeStatus,\n  formatDate,\n  StatusBadge,\n  getResultDisplay\n}: {\n  games: CricketTossGame[];\n  isLoading: boolean;\n  handleEditGame: (game: CricketTossGame) => void;\n  handleDeclareResult: (game: CricketTossGame) => void;\n  handleChangeStatus: (game: CricketTossGame) => void;\n  formatDate: (date: string | undefined) => string;\n  StatusBadge: React.FC<{ result: string | null }>;\n  getResultDisplay: (result: string | null, game: CricketTossGame) => string;\n}) {\n  \n  if (isLoading) {\n    return (\n      <div className=\"space-y-3\">\n        <Skeleton className=\"w-full h-12\" />\n        <Skeleton className=\"w-full h-12\" />\n        <Skeleton className=\"w-full h-12\" />\n      </div>\n    );\n  }\n  \n  if (games.length === 0) {\n    return (\n      <div className=\"text-center py-12 border rounded-lg bg-background\">\n        <GiCricketBat className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n        <p className=\"text-xl font-medium\">No Cricket Toss games found</p>\n        <p className=\"text-muted-foreground mt-1\">\n          Create a new Cricket Toss game to get started\n        </p>\n      </div>\n    );\n  }\n\n  // Check if any games have gameData property - if at least one has it, we'll show the full table\n  const hasAnyGameData = games.some((game: CricketTossGame) => game.gameData);\n\n  return (\n    <div className=\"border rounded-lg overflow-hidden\">\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead>Teams</TableHead>\n            <TableHead>Toss Time</TableHead>\n            <TableHead>Open/Close Time</TableHead>\n            <TableHead>Status</TableHead>\n            <TableHead>Result</TableHead>\n            <TableHead className=\"text-right\">Actions</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {games.map((game: CricketTossGame) => (\n            <TableRow key={`${game.id}-${(game as any).source || 'default'}`}>\n              <TableCell>\n                {game.gameData ? (\n                  <>\n                    <div className=\"font-medium\">\n                      {game.gameData.teamA} vs {game.gameData.teamB}\n                    </div>\n                    {game.gameData.description && (\n                      <div className=\"text-xs text-muted-foreground mt-1\">\n                        {game.gameData.description}\n                      </div>\n                    )}\n                  </>\n                ) : (\n                  <div className=\"font-medium\">\n                    Game #{game.id}\n                  </div>\n                )}\n              </TableCell>\n              <TableCell>{game.gameData ? formatDate(game.gameData.tossTime) : formatDate(game.createdAt)}</TableCell>\n              <TableCell>\n                {game.gameData ? (\n                  <div className=\"text-xs\">\n                    <div>Open: {game.gameData.openTime ? formatDate(game.gameData.openTime) : \"Same as toss\"}</div>\n                    <div>Close: {game.gameData.closeTime ? formatDate(game.gameData.closeTime) : \"Same as toss\"}</div>\n                  </div>\n                ) : '-'}\n              </TableCell>\n\n              <TableCell>\n                <StatusBadge result={game.result} />\n              </TableCell>\n              <TableCell className=\"font-medium\">\n                {getResultDisplay(game.result, game)}\n              </TableCell>\n              <TableCell className=\"text-right\">\n                <div className=\"flex justify-end space-x-2\">\n                  {game.gameData && (\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={() => handleEditGame(game)}\n                      disabled={!(game.result === null || game.result === \"\" || game.result === \"pending\")}\n                    >\n                      <Edit className=\"h-4 w-4 mr-1\" />\n                      Edit\n                    </Button>\n                  )}\n                  \n                  {/* Close Match Button - Only shown for open matches */}\n                  {(game.result === null || game.result === \"\" || game.result === \"pending\") && (\n                    <Button \n                      variant=\"secondary\"\n                      size=\"sm\" \n                      onClick={() => handleChangeStatus(game)}\n                    >\n                      <X className=\"h-4 w-4 mr-1\" />\n                      Close Match\n                    </Button>\n                  )}\n                  \n                  <Button \n                    variant={(game.result === \"team_a\" || game.result === \"team_b\") ? \"outline\" : \"default\"}\n                    size=\"sm\" \n                    onClick={() => handleDeclareResult(game)}\n                    disabled={!(game.result === null || game.result === \"\" || game.result === \"pending\")}\n                  >\n                    <CheckCircle2 className=\"h-4 w-4 mr-1\" />\n                    {(game.result === \"team_a\" || game.result === \"team_b\") ? \"Update Result\" : \"Declare Result\"}\n                  </Button>\n                </div>\n              </TableCell>\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}","path":null,"size_bytes":39933,"size_tokens":null},"client/src/components/home/DatabaseHeroSlider.tsx":{"content":"import { useState, useEffect, useCallback } from 'react';\nimport { useLocation } from 'wouter';\nimport { useQuery } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport useEmblaCarousel from 'embla-carousel-react';\nimport { ChevronLeft, ChevronRight } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\ntype HeroImage = {\n  filename: string;\n  url: string;\n};\n\nexport function DatabaseHeroSlider() {\n  const [_, setLocation] = useLocation();\n  const [emblaRef, emblaApi] = useEmblaCarousel({ loop: true });\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const [scrollSnaps, setScrollSnaps] = useState<number[]>([]);\n  \n  // Fetch hero slider images from the backend\n  const { data: heroImages = [] } = useQuery<HeroImage[]>({\n    queryKey: ['/api/herosliders'],\n    queryFn: () => apiRequest('GET', '/api/herosliders')\n      .then(res => res.json()),\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n  \n  const scrollPrev = useCallback(() => {\n    if (emblaApi) emblaApi.scrollPrev();\n  }, [emblaApi]);\n\n  const scrollNext = useCallback(() => {\n    if (emblaApi) emblaApi.scrollNext();\n  }, [emblaApi]);\n\n  const scrollTo = useCallback(\n    (index: number) => {\n      if (emblaApi) emblaApi.scrollTo(index);\n    },\n    [emblaApi]\n  );\n\n  const onSelect = useCallback(() => {\n    if (!emblaApi) return;\n    setSelectedIndex(emblaApi.selectedScrollSnap());\n  }, [emblaApi]);\n\n  useEffect(() => {\n    if (!emblaApi) return;\n    onSelect();\n    setScrollSnaps(emblaApi.scrollSnapList());\n    emblaApi.on('select', onSelect);\n    return () => {\n      emblaApi.off('select', onSelect);\n    };\n  }, [emblaApi, onSelect]);\n\n  // Auto-play functionality\n  useEffect(() => {\n    if (!emblaApi || heroImages.length <= 1) return;\n    \n    const intervalId = setInterval(() => {\n      emblaApi.scrollNext();\n    }, 5000); // 5 seconds interval\n\n    // Clear interval when user interacts with the carousel\n    const onInteractionStarted = () => {\n      clearInterval(intervalId);\n    };\n    \n    emblaApi.on('pointerDown', onInteractionStarted);\n    \n    return () => {\n      clearInterval(intervalId);\n      if (emblaApi) {\n        emblaApi.off('pointerDown', onInteractionStarted);\n      }\n    };\n  }, [emblaApi, heroImages.length]);\n\n  // If no hero images, don't render anything\n  if (heroImages.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"relative\">\n      <div className=\"overflow-hidden\" ref={emblaRef}>\n        <div className=\"flex h-[300px] sm:h-[400px] md:h-[500px] lg:h-[600px]\">\n          {heroImages.map((image) => (\n            <div \n              key={image.filename} \n              className=\"flex-[0_0_100%] min-w-0 relative\"\n            >\n              <div className=\"absolute inset-0\">\n                <img \n                  src={image.url} \n                  alt=\"Hero slider image\" \n                  className=\"w-full h-full object-cover\"\n                />\n                <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end pb-16 sm:items-center\">\n                  <div className=\"container mx-auto px-4 md:px-8\">\n                    <div className=\"max-w-md\">\n                      <Button \n                        className=\"bg-primary hover:bg-primary/90 text-white py-2 px-6\"\n                        onClick={() => setLocation(\"/auth\")}\n                      >\n                        Start Betting Now\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n      \n      {/* Navigation buttons - only show if more than one slide */}\n      {heroImages.length > 1 && (\n        <>\n          <button \n            onClick={scrollPrev}\n            className=\"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white rounded-full p-1 sm:p-2 transition-all\"\n            aria-label=\"Previous slide\"\n          >\n            <ChevronLeft className=\"w-4 h-4 sm:w-6 sm:h-6\" />\n          </button>\n          <button \n            onClick={scrollNext}\n            className=\"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white rounded-full p-1 sm:p-2 transition-all\"\n            aria-label=\"Next slide\"\n          >\n            <ChevronRight className=\"w-4 h-4 sm:w-6 sm:h-6\" />\n          </button>\n          \n          {/* Dots indicators */}\n          <div className=\"absolute bottom-2 sm:bottom-4 left-0 right-0 flex justify-center\">\n            <div className=\"flex space-x-1.5 sm:space-x-2\">\n              {scrollSnaps.map((_, index) => (\n                <button\n                  key={index}\n                  onClick={() => scrollTo(index)}\n                  className={`w-2 h-2 sm:w-3 sm:h-3 rounded-full transition-all ${\n                    index === selectedIndex\n                      ? 'bg-white scale-100'\n                      : 'bg-white/50 scale-75'\n                  }`}\n                  aria-label={`Go to slide ${index + 1}`}\n                />\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}","path":null,"size_bytes":5199,"size_tokens":null},"create-fresh-admin.js":{"content":"import { db } from './server/db.js';\nimport { users } from './shared/schema.js';\nimport { UserRole } from './shared/schema.js';\nimport bcryptjs from 'bcryptjs';\n\nasync function createFreshAdmin() {\n  try {\n    console.log('Creating fresh admin account...');\n    \n    // Hash the password\n    const salt = await bcryptjs.genSalt(10);\n    const hashedPassword = await bcryptjs.hash('admin123', salt);\n    \n    // Insert new admin\n    const result = await db.insert(users)\n      .values({\n        username: 'admin',\n        password: hashedPassword,\n        email: 'admin@example.com',\n        mobile: '1234567890',\n        role: UserRole.ADMIN,\n        balance: 0,\n        isBlocked: false\n      })\n      .returning();\n    \n    console.log('Created new admin account:', result[0]);\n    console.log('You can now login with:');\n    console.log('Username: admin');\n    console.log('Password: admin123');\n  } catch (error) {\n    console.error('Error creating admin account:', error);\n  }\n}\n\ncreateFreshAdmin().catch(console.error);","path":null,"size_bytes":1025,"size_tokens":null},"setup-db.js":{"content":"import pg from 'pg';\nimport dotenv from 'dotenv';\n\nconst { Pool } = pg;\ndotenv.config();\n\n// Ensure DATABASE_URL is available from environment variables\nconst dbUrl = process.env.DATABASE_URL;\nif (!dbUrl) {\n  console.error('DATABASE_URL environment variable is not set.');\n  process.exit(1);\n}\n\n// Create a connection pool\nconst pool = new Pool({\n  connectionString: dbUrl,\n});\n\n// SQL to create tables\nconst createTableQueries = [\n  `\n  CREATE TABLE IF NOT EXISTS users (\n    id SERIAL PRIMARY KEY,\n    username TEXT NOT NULL UNIQUE,\n    password TEXT NOT NULL,\n    role TEXT NOT NULL DEFAULT 'player',\n    balance INTEGER NOT NULL DEFAULT 0,\n    assigned_to INTEGER REFERENCES users(id),\n    is_blocked BOOLEAN NOT NULL DEFAULT false\n  )\n  `,\n  `\n  CREATE TABLE IF NOT EXISTS satamatka_markets (\n    id SERIAL PRIMARY KEY,\n    name TEXT NOT NULL,\n    type TEXT NOT NULL,\n    open_time TIMESTAMP NOT NULL,\n    close_time TIMESTAMP NOT NULL,\n    open_result TEXT,\n    close_result TEXT,\n    status TEXT NOT NULL DEFAULT 'open',\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n  )\n  `,\n  `\n  CREATE TABLE IF NOT EXISTS team_matches (\n    id SERIAL PRIMARY KEY,\n    team_a TEXT NOT NULL,\n    team_b TEXT NOT NULL,\n    category TEXT NOT NULL DEFAULT 'cricket',\n    description TEXT,\n    match_time TIMESTAMP NOT NULL,\n    result TEXT NOT NULL DEFAULT 'pending',\n    odd_team_a INTEGER NOT NULL DEFAULT 200,\n    odd_team_b INTEGER NOT NULL DEFAULT 200,\n    odd_draw INTEGER DEFAULT 300,\n    status TEXT NOT NULL DEFAULT 'open',\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n  )\n  `,\n  `\n  CREATE TABLE IF NOT EXISTS games (\n    id SERIAL PRIMARY KEY,\n    user_id INTEGER NOT NULL REFERENCES users(id),\n    game_type TEXT NOT NULL DEFAULT 'coin_flip',\n    bet_amount INTEGER NOT NULL,\n    prediction TEXT NOT NULL,\n    result TEXT,\n    payout INTEGER NOT NULL DEFAULT 0,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    market_id INTEGER REFERENCES satamatka_markets(id),\n    match_id INTEGER REFERENCES team_matches(id),\n    game_mode TEXT,\n    game_data JSONB\n  )\n  `,\n  `\n  CREATE TABLE IF NOT EXISTS wallet_requests (\n    id SERIAL PRIMARY KEY,\n    user_id INTEGER NOT NULL REFERENCES users(id),\n    amount INTEGER NOT NULL,\n    request_type TEXT NOT NULL,\n    payment_mode TEXT NOT NULL,\n    payment_details JSON NOT NULL,\n    status TEXT NOT NULL DEFAULT 'pending',\n    proof_image_url TEXT,\n    notes TEXT,\n    reviewed_by INTEGER REFERENCES users(id),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n  )\n  `,\n  `\n  CREATE TABLE IF NOT EXISTS transactions (\n    id SERIAL PRIMARY KEY,\n    user_id INTEGER NOT NULL REFERENCES users(id),\n    amount INTEGER NOT NULL,\n    performed_by INTEGER NOT NULL REFERENCES users(id),\n    request_id INTEGER REFERENCES wallet_requests(id),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n  )\n  `,\n  `\n  CREATE TABLE IF NOT EXISTS system_settings (\n    id SERIAL PRIMARY KEY,\n    setting_type TEXT NOT NULL,\n    setting_key TEXT NOT NULL,\n    setting_value TEXT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n  )\n  `,\n  `\n  CREATE TABLE IF NOT EXISTS subadmin_commissions (\n    id SERIAL PRIMARY KEY,\n    subadmin_id INTEGER REFERENCES users(id) ON DELETE CASCADE NOT NULL,\n    game_type TEXT NOT NULL,\n    commission_rate INTEGER NOT NULL,\n    is_active BOOLEAN DEFAULT TRUE NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n  )\n  `,\n  `\n  CREATE TABLE IF NOT EXISTS user_discounts (\n    id SERIAL PRIMARY KEY,\n    subadmin_id INTEGER REFERENCES users(id) ON DELETE CASCADE NOT NULL,\n    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE NOT NULL,\n    game_type TEXT NOT NULL,\n    discount_rate INTEGER NOT NULL,\n    is_active BOOLEAN DEFAULT TRUE NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n  )\n  `,\n  `\n  CREATE TABLE IF NOT EXISTS game_odds (\n    id SERIAL PRIMARY KEY,\n    game_type TEXT NOT NULL,\n    odd_value INTEGER NOT NULL,\n    set_by_admin BOOLEAN DEFAULT TRUE NOT NULL,\n    subadmin_id INTEGER REFERENCES users(id) ON DELETE CASCADE,\n    is_active BOOLEAN DEFAULT TRUE NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n  )\n  `\n];\n\n// Insert default admin user\nconst insertAdminQuery = `\nINSERT INTO users (username, password, role, balance)\nVALUES ('admin', '$2b$10$1hPrOk0BNl1gk4MzKKBVROnWBk9AWBGxIE/JrTBPPiKLVH0Fdb9zy', 'admin', 1000000)\nON CONFLICT (username) DO NOTHING;\n`;\n\nasync function setupDatabase() {\n  const client = await pool.connect();\n  \n  try {\n    // Start transaction\n    await client.query('BEGIN');\n    console.log('Starting database setup...');\n    \n    // Create tables\n    for (const query of createTableQueries) {\n      await client.query(query);\n      console.log('Table created successfully');\n    }\n    \n    // Insert admin user\n    await client.query(insertAdminQuery);\n    console.log('Admin user created (if not exists)');\n    \n    // Commit transaction\n    await client.query('COMMIT');\n    console.log('Database setup completed successfully');\n  } catch (error) {\n    // Rollback transaction on error\n    await client.query('ROLLBACK');\n    console.error('Error setting up database:', error);\n    process.exit(1);\n  } finally {\n    // Release client\n    client.release();\n    // Close pool\n    pool.end();\n  }\n}\n\n// Run setup\nsetupDatabase();","path":null,"size_bytes":5636,"size_tokens":null},"fix-market-pending-bets.js":{"content":"/**\n * This script fixes pending bets for a market that has already had results declared\n * Use this when you see bets in \"pending\" status even after the market result has been set\n */\n\nconst { Client } = require('pg');\nrequire('dotenv').config();\n\nasync function fixPendingBets() {\n  try {\n    // Get the market ID from command line\n    const args = process.argv.slice(2);\n    if (args.length === 0) {\n      console.error('Please provide a market ID');\n      console.error('Usage: node fix-market-pending-bets.js <marketId>');\n      process.exit(1);\n    }\n    \n    const marketId = parseInt(args[0]);\n    if (isNaN(marketId)) {\n      console.error('Invalid market ID. Please provide a valid number.');\n      process.exit(1);\n    }\n    \n    console.log(`Processing pending bets for market ID ${marketId}...`);\n    \n    // Connect to the database\n    const client = new Client({\n      connectionString: process.env.DATABASE_URL,\n      ssl: { rejectUnauthorized: false }\n    });\n    \n    await client.connect();\n    console.log('Connected to database');\n    \n    // Get the market data\n    const marketResult = await client.query(\n      'SELECT * FROM satamatka_markets WHERE id = $1',\n      [marketId]\n    );\n    \n    if (marketResult.rows.length === 0) {\n      console.error(`Market with ID ${marketId} not found.`);\n      await client.end();\n      process.exit(1);\n    }\n    \n    const market = marketResult.rows[0];\n    \n    if (!market.close_result) {\n      console.error(`Market with ID ${marketId} does not have a close result.`);\n      await client.end();\n      process.exit(1);\n    }\n    \n    console.log(`Market info: ${market.name}, Close Result: ${market.close_result}`);\n    \n    // Get all pending games for this market\n    const pendingGamesResult = await client.query(\n      'SELECT * FROM games WHERE market_id = $1 AND result = $2',\n      [marketId, 'pending']\n    );\n    \n    const pendingGames = pendingGamesResult.rows;\n    console.log(`Found ${pendingGames.length} pending games to process.`);\n    \n    if (pendingGames.length === 0) {\n      console.log('No pending bets to process.');\n      await client.end();\n      process.exit(0);\n    }\n    \n    // Get game odds from database\n    const gameOddsResult = await client.query(\n      'SELECT * FROM game_odds WHERE set_by_admin = true'\n    );\n    \n    // Create a map for easy access to odds\n    const oddsMap = {\n      'satamatka_jodi': 900000, // Default 90x\n      'satamatka_harf': 90000,  // Default 9x\n      'satamatka_crossing': 900000, // Default 90x\n      'satamatka_odd_even': 19000  // Default 1.9x\n    };\n    \n    // Update odds map with values from the database\n    for (const odds of gameOddsResult.rows) {\n      if (odds.game_type && odds.odd_value) {\n        oddsMap[odds.game_type] = odds.odd_value;\n      }\n    }\n    \n    console.log('Using odds values:', oddsMap);\n    \n    // Process each pending game\n    let processedCount = 0;\n    let winnersCount = 0;\n    \n    for (const game of pendingGames) {\n      console.log(`Processing game ID ${game.id}, mode: ${game.game_mode}, prediction: ${game.prediction}`);\n      \n      let isWinner = false;\n      let payout = 0;\n      const closeResult = market.close_result;\n      \n      // Game mode specific win conditions\n      if (game.game_mode === 'jodi' && game.prediction === closeResult) {\n        // For Jodi mode, prediction must match closeResult exactly\n        isWinner = true;\n        payout = Math.round(game.bet_amount * (oddsMap['satamatka_jodi'] / 10000));\n      } \n      else if (game.game_mode === 'harf') {\n        // For Harf, check if digit matches position\n        const firstDigit = closeResult[0]; \n        const secondDigit = closeResult[1];\n        \n        // Handle different Harf prediction formats (A0, B1, etc.)\n        let harfDigit = game.prediction;\n        let isLeftDigit = false;\n        let isRightDigit = false;\n        \n        // Handle formatted predictions like A0, A1, B0, B1\n        if (game.prediction.startsWith('A')) {\n          harfDigit = game.prediction.substring(1);\n          isLeftDigit = true;\n        } else if (game.prediction.startsWith('B')) {\n          harfDigit = game.prediction.substring(1);\n          isRightDigit = true;\n        } else if (game.prediction.startsWith('L')) {\n          harfDigit = game.prediction.substring(1);\n          isLeftDigit = true;\n        } else if (game.prediction.startsWith('R')) {\n          harfDigit = game.prediction.substring(1);\n          isRightDigit = true;\n        }\n        \n        // Check if the prediction matches the appropriate position\n        if (\n          (isLeftDigit && harfDigit === firstDigit) || \n          (isRightDigit && harfDigit === secondDigit) ||\n          // For single digit predictions without position indicator\n          (!isLeftDigit && !isRightDigit && (game.prediction === firstDigit || game.prediction === secondDigit))\n        ) {\n          isWinner = true;\n          payout = Math.round(game.bet_amount * (oddsMap['satamatka_harf'] / 10000));\n        }\n      }\n      else if (game.game_mode === 'crossing') {\n        // For Crossing, check if the prediction matches the result in any order\n        // Clean and prepare prediction digits - handle different prediction formats\n        let digits = [];\n        if (game.prediction.includes(',')) {\n          // Format: \"0,1,2\"\n          digits = game.prediction.replace(/[^0-9,]/g, '').split(',').map(d => d.trim());\n        } else {\n          // Format: \"012\" or other formats without commas\n          digits = game.prediction.replace(/[^0-9]/g, '').split('');\n        }\n        \n        // Extract the actual crossing combinations from the digits\n        // Crossing means any combination of the digits in any order\n        const crossingCombinations = [];\n        for (let i = 0; i < digits.length; i++) {\n          for (let j = 0; j < digits.length; j++) {\n            if (i !== j) {\n              crossingCombinations.push(digits[i] + digits[j]);\n            }\n          }\n        }\n        \n        // Check if the prediction exactly matches the result\n        // or the player's crossing combination includes the result\n        if (game.prediction === closeResult || crossingCombinations.includes(closeResult)) {\n          isWinner = true;\n          payout = Math.round(game.bet_amount * (oddsMap['satamatka_crossing'] / 10000));\n        }\n        \n        console.log(`  Crossing combinations: ${crossingCombinations.join(',')}`);\n        console.log(`  Result: ${closeResult}, Is winner: ${isWinner}`);\n      }\n      else if (game.game_mode === 'odd_even') {\n        // For Odd-Even, check if prediction matches the result's parity\n        const resultNumber = parseInt(closeResult, 10);\n        const isOdd = resultNumber % 2 !== 0;\n        \n        if ((isOdd && game.prediction === 'odd') || (!isOdd && game.prediction === 'even')) {\n          isWinner = true;\n          payout = Math.round(game.bet_amount * (oddsMap['satamatka_odd_even'] / 10000));\n        }\n      }\n      \n      // Update the game result and payout\n      const result = isWinner ? 'win' : 'loss';\n      \n      await client.query(\n        'UPDATE games SET result = $1, payout = $2 WHERE id = $3',\n        [result, isWinner ? payout : 0, game.id]\n      );\n      \n      console.log(`  Updated game result: ${result}, Payout: ${payout/100} rupees`);\n      \n      // If it's a win, update the user's balance\n      if (isWinner) {\n        const userResult = await client.query(\n          'SELECT * FROM users WHERE id = $1',\n          [game.user_id]\n        );\n        \n        if (userResult.rows.length > 0) {\n          const user = userResult.rows[0];\n          const newBalance = user.balance + payout;\n          \n          await client.query(\n            'UPDATE users SET balance = $1 WHERE id = $2',\n            [newBalance, user.id]\n          );\n          \n          console.log(`  Updated user ${user.username} balance: ${user.balance/100}  ${newBalance/100} rupees`);\n          winnersCount++;\n        }\n      }\n      \n      processedCount++;\n    }\n    \n    console.log(`Processed ${processedCount} pending games.`);\n    console.log(`Found ${winnersCount} winning bets.`);\n    console.log('Done!');\n    \n    // Close the database connection\n    await client.end();\n  } catch (error) {\n    console.error('Error processing pending bets:', error);\n    process.exit(1);\n  }\n}\n\nfixPendingBets().catch(err => console.error('Error executing script:', err));","path":null,"size_bytes":8453,"size_tokens":null},"client/src/pages/admin-market-management-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getQueryFn, apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { format, parseISO } from \"date-fns\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { \n  Form, \n  FormControl, \n  FormDescription, \n  FormField, \n  FormItem, \n  FormLabel, \n  FormMessage \n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useForm } from \"react-hook-form\";\nimport * as z from \"zod\";\nimport { \n  Calendar, \n  Clock, \n  Timer, \n  CheckCircle2, \n  AlertCircle,\n  Plus,\n  MoreVertical,\n  Edit,\n  X,\n  Check,\n  Search,\n  Filter,\n  PauseCircle,\n  Play,\n  Info,\n  Undo2\n} from \"lucide-react\";\n\n// Interface for market data\ninterface SatamatkaMarket {\n  id: number;\n  name: string;\n  type: string;\n  coverImage?: string;\n  marketDate: string;\n  openTime: string;\n  closeTime: string;\n  resultTime: string;\n  openResult?: string;\n  closeResult?: string;\n  status: string;\n  createdAt: string;\n  isRecurring?: boolean;\n  recurrencePattern?: string;\n  nextOpenTime?: string;\n  nextCloseTime?: string;\n}\n\n// Form schema for declaring results\nconst resultFormSchema = z.object({\n  result: z.string()\n    .min(2, \"Result must be at least 2 characters\")\n    .max(2, \"Result must be exactly 2 characters\")\n    .regex(/^[0-9]{2}$/, \"Result must be a two-digit number (00-99)\")\n});\n\n// Form schema for creating/editing markets\nconst marketFormSchema = z.object({\n  name: z.string().min(3, \"Name must be at least 3 characters\"),\n  type: z.string().optional().default(\"gali\"), // Default type is 'gali' since all markets follow this style\n  coverImage: z.string().optional(),\n  marketDate: z.string().min(1, \"Date is required\"),\n  openTime: z.string().min(5, \"Open time is required\"),\n  closeTime: z.string().min(5, \"Close time is required\"),\n  resultTime: z.string().min(5, \"Result time is required\"),\n});\n\n// Market Betting Stats Component\nfunction MarketBettingStats({ marketId, status }: { marketId: number; status: string }) {\n  const { data: marketGames = [] } = useQuery({\n    queryKey: [`/api/satamatka/markets/${marketId}/games`],\n    enabled: status === \"open\" || status === \"closed\",\n  });\n\n  if (status === \"waiting\" || status === \"resulted\") {\n    return (\n      <div className=\"text-sm text-slate-400\">\n        {status === \"waiting\" ? \"Not started\" : \"Completed\"}\n      </div>\n    );\n  }\n\n  // Calculate stats for active/closed markets\n  const activeBets = marketGames.filter(game => game.result === \"pending\").length;\n  const totalBetAmount = marketGames\n    .filter(game => game.result === \"pending\")\n    .reduce((sum, game) => sum + (game.betAmount || 0), 0);\n\n  // Calculate potential win based on game modes and odds\n  const potentialWin = marketGames\n    .filter(game => game.result === \"pending\")\n    .reduce((sum, game) => {\n      const betAmount = game.betAmount || 0;\n      let multiplier = 1;\n      \n      // Estimate multipliers based on game mode\n      switch (game.gameMode) {\n        case \"jodi\": multiplier = 90; break;\n        case \"harf\": multiplier = 9; break;\n        case \"crossing\": multiplier = 95; break;\n        case \"odd_even\": multiplier = 1.9; break;\n        default: multiplier = 1;\n      }\n      \n      return sum + (betAmount * multiplier);\n    }, 0);\n\n  if (activeBets === 0) {\n    return (\n      <div className=\"text-sm text-slate-400\">\n        No active bets\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"text-sm\">\n      <div className=\"flex items-center gap-2 mb-1\">\n        <span className=\"font-semibold text-blue-600\">{activeBets}</span>\n        <span className=\"text-slate-600\">bets</span>\n      </div>\n      <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n        <span>{(totalBetAmount / 100).toLocaleString()}</span>\n        <span className=\"text-slate-400\"></span>\n        <span className=\"text-orange-600 font-medium\">{(potentialWin / 100).toLocaleString()}</span>\n      </div>\n    </div>\n  );\n}\n\nexport default function AdminMarketManagementPage() {\n  const { user } = useAuth();\n  const [activeTab, setActiveTab] = useState(\"all\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isAddMarketOpen, setIsAddMarketOpen] = useState(false);\n  const [editingMarket, setEditingMarket] = useState<SatamatkaMarket | null>(null);\n  const [declareResultMarket, setDeclareResultMarket] = useState<SatamatkaMarket | null>(null);\n  const [isTemplateSelectOpen, setIsTemplateSelectOpen] = useState(false);\n  const [selectedTemplate, setSelectedTemplate] = useState<SatamatkaMarket | null>(null);\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\n  const [marketToDelete, setMarketToDelete] = useState<SatamatkaMarket | null>(null);\n  const queryClient = useQueryClient();\n\n  // Form for result declaration\n  const resultForm = useForm<z.infer<typeof resultFormSchema>>({\n    resolver: zodResolver(resultFormSchema),\n    defaultValues: {\n      result: \"\",\n    },\n  });\n\n  // Form for add/edit market\n  const marketForm = useForm<z.infer<typeof marketFormSchema>>({\n    resolver: zodResolver(marketFormSchema),\n    defaultValues: {\n      name: \"\",\n      type: \"\",\n      coverImage: \"\",\n      marketDate: format(new Date(), \"yyyy-MM-dd\"),\n      openTime: \"\",\n      closeTime: \"\",\n      resultTime: \"\",\n    },\n  });\n\n  // Query for all markets\n  const { data: allMarkets = [], isLoading: isLoadingAll } = useQuery<SatamatkaMarket[]>({\n    queryKey: [\"/api/satamatka/markets\"],\n    queryFn: getQueryFn({ on401: \"throw\" }),\n    enabled: !!user,\n  });\n\n  // Mutations for market operations\n  const updateMarketStatus = useMutation({\n    mutationFn: async ({ id, status }: { id: number; status: string }) => {\n      return apiRequest(\"PATCH\", `/api/satamatka/markets/${id}/status`, { status });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/satamatka/markets\"] });\n      toast({\n        title: \"Market updated\",\n        description: \"Market status has been updated successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update market\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMarketResult = useMutation({\n    mutationFn: async ({ id, result }: { id: number; result: string }) => {\n      // Determine if this is the open or close result based on market status\n      const market = declareResultMarket;\n      \n      if (!market) {\n        throw new Error(\"Market not found\");\n      }\n      \n      // If market is open, set the openResult\n      // If market is closed or waiting_result, set the closeResult\n      if (market.status === \"open\") {\n        return apiRequest(\"PATCH\", `/api/satamatka/markets/${id}/results`, { \n          openResult: result \n        });\n      } else if (market.status === \"closed\" || market.status === \"waiting_result\") {\n        return apiRequest(\"PATCH\", `/api/satamatka/markets/${id}/results`, { \n          closeResult: result \n        });\n      } else {\n        throw new Error(\"Market status does not allow result declaration\");\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/satamatka/markets\"] });\n      setDeclareResultMarket(null);\n      resultForm.reset();\n      \n      // Automatically update the status to resulted and switch tabs\n      if (declareResultMarket) {\n        updateMarketStatus.mutate({ id: declareResultMarket.id, status: \"resulted\" });\n        setTimeout(() => setActiveTab(\"resulted\"), 300); // Switch to Resulted tab\n      }\n      \n      toast({\n        title: \"Result declared\",\n        description: \"Market result has been declared and status updated to resulted\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to declare result\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createMarket = useMutation({\n    mutationFn: async (data: z.infer<typeof marketFormSchema>) => {\n      // Combine date and time fields into ISO strings\n      const marketDate = data.marketDate;\n      \n      // Create proper datetime strings by combining date with time\n      const openTimeISO = combineDateTime(marketDate, data.openTime);\n      const closeTimeISO = combineDateTime(marketDate, data.closeTime);\n      const resultTimeISO = combineDateTime(marketDate, data.resultTime);\n      \n      // Set initial market status to \"waiting\" to ensure manual activation flow\n      const marketData = {\n        ...data,\n        openTime: openTimeISO,\n        closeTime: closeTimeISO,\n        resultTime: resultTimeISO,\n        status: \"waiting\" // All markets start in waiting status\n      };\n      \n      console.log(\"Submitting market data:\", marketData);\n      return apiRequest(\"POST\", \"/api/satamatka/markets\", marketData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/satamatka/markets\"] });\n      setIsAddMarketOpen(false);\n      setSelectedTemplate(null);\n      marketForm.reset();\n      \n      // Automatically switch to the \"waiting\" tab to see new market\n      setActiveTab(\"waiting\");\n      \n      toast({\n        title: \"Market created\",\n        description: \"New market has been created successfully. It's in 'Upcoming' status and must be manually opened for betting.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to create market\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMarket = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: z.infer<typeof marketFormSchema> }) => {\n      // Combine date and time fields into ISO strings for updates\n      const marketDate = data.marketDate;\n      \n      // Create proper datetime strings by combining date with time\n      const openTimeISO = combineDateTime(marketDate, data.openTime);\n      const closeTimeISO = combineDateTime(marketDate, data.closeTime);\n      const resultTimeISO = combineDateTime(marketDate, data.resultTime);\n      \n      // Prepare the data with proper datetime formats\n      const marketData = {\n        ...data,\n        openTime: openTimeISO,\n        closeTime: closeTimeISO,\n        resultTime: resultTimeISO\n      };\n      \n      console.log(\"Updating market data:\", marketData);\n      return apiRequest(\"PATCH\", `/api/satamatka/markets/${id}`, marketData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/satamatka/markets\"] });\n      setEditingMarket(null);\n      marketForm.reset();\n      toast({\n        title: \"Market updated\",\n        description: \"Market has been updated successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update market\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n  \n  // Delete market mutation\n  const deleteMarket = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/satamatka/markets/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/satamatka/markets\"] });\n      setMarketToDelete(null);\n      setDeleteConfirmOpen(false);\n      toast({\n        title: \"Market template removed\",\n        description: \"The market template has been successfully removed\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to remove market template\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Filter markets by status\n  const waitingMarkets = allMarkets.filter(market => market.status === \"waiting\");\n  const openMarkets = allMarkets.filter(market => market.status === \"open\");\n  const closedMarkets = allMarkets.filter(market => market.status === \"closed\");\n  const resultedMarkets = allMarkets.filter(market => market.status === \"resulted\");\n\n  // Get markets for current tab\n  const getMarketsForTab = () => {\n    switch (activeTab) {\n      case \"waiting\": return waitingMarkets;\n      case \"open\": return openMarkets;\n      case \"closed\": return closedMarkets;\n      case \"resulted\": return resultedMarkets;\n      default: return allMarkets;\n    }\n  };\n\n  // Filter markets by search query\n  const filteredMarkets = getMarketsForTab().filter(market => \n    market.name.toLowerCase().includes(searchQuery.toLowerCase()) || \n    market.type.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  // Format date for display\n  const formatDate = (dateString: string) => {\n    return format(parseISO(dateString), \"MMM d, yyyy h:mm a\");\n  };\n\n  // Handle opening edit market dialog\n  const handleEditMarket = (market: SatamatkaMarket) => {\n    setEditingMarket(market);\n    marketForm.reset({\n      name: market.name,\n      type: market.type,\n      coverImage: market.coverImage || \"\",\n      marketDate: format(parseISO(market.marketDate || market.openTime), \"yyyy-MM-dd\"),\n      openTime: format(parseISO(market.openTime), \"HH:mm\"),\n      closeTime: format(parseISO(market.closeTime), \"HH:mm\"),\n      resultTime: market.resultTime ? format(parseISO(market.resultTime), \"HH:mm\") : format(parseISO(market.closeTime), \"HH:mm\"),\n    });\n  };\n\n  // Handle opening declare result dialog\n  const handleDeclareResult = (market: SatamatkaMarket) => {\n    setDeclareResultMarket(market);\n    resultForm.reset({ result: \"\" });\n  };\n\n  // Handle submit for declaring result\n  const onSubmitResult = (data: z.infer<typeof resultFormSchema>) => {\n    if (declareResultMarket) {\n      updateMarketResult.mutate({ id: declareResultMarket.id, result: data.result });\n    }\n  };\n\n  // Handle submit for adding/editing market\n  const onSubmitMarket = (data: z.infer<typeof marketFormSchema>) => {\n    if (editingMarket) {\n      // When editing, preserve the original status\n      updateMarket.mutate({ id: editingMarket.id, data });\n    } else {\n      // When creating new, the mutation will set status to \"waiting\"\n      createMarket.mutate(data);\n      \n      // Show informative toast about manual activation\n      toast({\n        title: \"Reminder\",\n        description: \"Remember to manually open the market when you're ready for betting to begin.\",\n        duration: 8000,\n      });\n    }\n  };\n\n  // Prepare to add a new market\n  const handleAddMarket = () => {\n    // First open the template selection dialog, not directly the add market dialog\n    setIsTemplateSelectOpen(true);\n    setSelectedTemplate(null);\n    \n    // Reset form values to defaults - if user selects \"Create from Scratch\"\n    marketForm.reset({\n      name: \"\",\n      type: \"gali\", // Default to gali style \n      coverImage: \"\",\n      marketDate: format(new Date(), \"yyyy-MM-dd\"),\n      openTime: \"\",\n      closeTime: \"\",\n      resultTime: \"\",\n    });\n  };\n\n  // Status badge component\n  const StatusBadge = ({ status }: { status: string }) => {\n    let color = \"\";\n    let displayText = status.replace('_', ' ');\n    let icon = null;\n    \n    switch (status) {\n      case \"waiting\":\n        color = \"bg-purple-500 hover:bg-purple-600\";\n        displayText = \"Upcoming\";\n        icon = <PauseCircle className=\"h-3 w-3 mr-1\" />;\n        break;\n      case \"open\":\n        color = \"bg-green-500 hover:bg-green-600\";\n        displayText = \"Active\";\n        icon = <Play className=\"h-3 w-3 mr-1\" />;\n        break;\n      case \"closed\":\n        color = \"bg-yellow-500 hover:bg-yellow-600\";\n        displayText = \"Waiting Results\";\n        icon = <X className=\"h-3 w-3 mr-1\" />;\n        break;\n      case \"resulted\":\n        color = \"bg-blue-500 hover:bg-blue-600\";\n        displayText = \"Resulted\";\n        icon = <Check className=\"h-3 w-3 mr-1\" />;\n        break;\n      case \"waiting_result\":\n        color = \"bg-yellow-500 hover:bg-yellow-600\";\n        displayText = \"Waiting Results\";\n        icon = <X className=\"h-3 w-3 mr-1\" />;\n        break;\n      default:\n        color = \"bg-slate-500 hover:bg-slate-600\";\n    }\n    \n    return (\n      <Badge className={`${color} flex items-center`}>\n        {icon}\n        {displayText}\n      </Badge>\n    );\n  };\n\n  // Helper function to combine date and time strings\n  const combineDateTime = (dateStr: string, timeStr: string): string => {\n    if (!dateStr || !timeStr) return \"\";\n    \n    // Parse the date and time strings\n    const [year, month, day] = dateStr.split('-').map(Number);\n    const [hours, minutes] = timeStr.split(':').map(Number);\n    \n    // Create a new date with the combined date and time\n    const date = new Date(year, month - 1, day, hours, minutes);\n    \n    // Return as ISO string\n    return date.toISOString();\n  };\n  \n  // Get today's date for display\n  const today = new Date();\n  const dateString = format(today, \"EEEE, MMMM d, yyyy\");\n\n  return (\n    <DashboardLayout title=\"Market Management\">\n      <div className=\"mb-6\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <div className=\"flex items-center text-muted-foreground\">\n            <Calendar className=\"h-5 w-5 mr-2\" />\n            <span>{dateString}</span>\n          </div>\n          \n          <Button \n            onClick={() => setIsTemplateSelectOpen(true)} \n            className=\"bg-gradient-to-r from-blue-600 to-indigo-600\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Market\n          </Button>\n        </div>\n        <p className=\"text-muted-foreground\">\n          Manage all markets, declare results, and create new markets\n        </p>\n      </div>\n\n      {/* Search and filter bar */}\n      <div className=\"flex items-center justify-between mb-6 gap-4 flex-wrap\">\n        <div className=\"relative flex items-center flex-1 min-w-[200px]\">\n          <Search className=\"absolute left-3 h-4 w-4 text-muted-foreground\" />\n          <Input \n            placeholder=\"Search markets...\" \n            className=\"pl-10\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n          />\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"waiting\" value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"mb-6 h-auto w-full grid grid-cols-2 md:grid-cols-5 gap-1 p-1\">\n          <TabsTrigger value=\"waiting\" className=\"flex items-center justify-center text-xs md:text-sm py-2 px-1 md:px-3\">\n            <PauseCircle className=\"h-4 w-4 mr-1 md:mr-2 flex-shrink-0\" />\n            <span className=\"hidden sm:inline\">Upcoming</span>\n            <span className=\"sm:hidden\">Up</span>\n            <span className=\"ml-1\">({waitingMarkets.length})</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"open\" className=\"flex items-center justify-center text-xs md:text-sm py-2 px-1 md:px-3\">\n            <Clock className=\"h-4 w-4 mr-1 md:mr-2 flex-shrink-0\" />\n            <span className=\"hidden sm:inline\">Active</span>\n            <span className=\"sm:hidden\">Act</span>\n            <span className=\"ml-1\">({openMarkets.length})</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"closed\" className=\"flex items-center justify-center text-xs md:text-sm py-2 px-1 md:px-3 col-span-2 md:col-span-1\">\n            <Timer className=\"h-4 w-4 mr-1 md:mr-2 flex-shrink-0\" />\n            <span className=\"hidden sm:inline\">Waiting Results</span>\n            <span className=\"sm:hidden\">Results</span>\n            <span className=\"ml-1\">({closedMarkets.length})</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"resulted\" className=\"flex items-center justify-center text-xs md:text-sm py-2 px-1 md:px-3\">\n            <CheckCircle2 className=\"h-4 w-4 mr-1 md:mr-2 flex-shrink-0\" />\n            <span className=\"hidden sm:inline\">Resulted</span>\n            <span className=\"sm:hidden\">Done</span>\n            <span className=\"ml-1\">({resultedMarkets.length})</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"all\" className=\"flex items-center justify-center text-xs md:text-sm py-2 px-1 md:px-3\">\n            <AlertCircle className=\"h-4 w-4 mr-1 md:mr-2 flex-shrink-0\" />\n            <span>All</span>\n            <span className=\"ml-1\">({allMarkets.length})</span>\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"all\" className=\"space-y-6\">\n          <MarketTable \n            markets={filteredMarkets} \n            isLoading={isLoadingAll}\n            handleEditMarket={handleEditMarket}\n            handleDeclareResult={handleDeclareResult}\n            updateMarketStatus={updateMarketStatus}\n            formatDate={formatDate}\n            StatusBadge={StatusBadge}\n            setActiveTab={setActiveTab}\n          />\n        </TabsContent>\n        \n        <TabsContent value=\"waiting\" className=\"space-y-6\">\n          <MarketTable \n            markets={filteredMarkets} \n            isLoading={isLoadingAll}\n            handleEditMarket={handleEditMarket}\n            handleDeclareResult={handleDeclareResult}\n            updateMarketStatus={updateMarketStatus}\n            formatDate={formatDate}\n            StatusBadge={StatusBadge}\n            setActiveTab={setActiveTab}\n          />\n        </TabsContent>\n        \n        <TabsContent value=\"open\" className=\"space-y-6\">\n          <MarketTable \n            markets={filteredMarkets} \n            isLoading={isLoadingAll}\n            handleEditMarket={handleEditMarket}\n            handleDeclareResult={handleDeclareResult}\n            updateMarketStatus={updateMarketStatus}\n            formatDate={formatDate}\n            StatusBadge={StatusBadge}\n            setActiveTab={setActiveTab}\n          />\n        </TabsContent>\n        \n        <TabsContent value=\"closed\" className=\"space-y-6\">\n          <MarketTable \n            markets={filteredMarkets} \n            isLoading={isLoadingAll}\n            handleEditMarket={handleEditMarket}\n            handleDeclareResult={handleDeclareResult}\n            updateMarketStatus={updateMarketStatus}\n            formatDate={formatDate}\n            StatusBadge={StatusBadge}\n            setActiveTab={setActiveTab}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"resulted\" className=\"space-y-6\">\n          <MarketTable \n            markets={filteredMarkets} \n            isLoading={isLoadingAll}\n            handleEditMarket={handleEditMarket}\n            handleDeclareResult={handleDeclareResult}\n            updateMarketStatus={updateMarketStatus}\n            formatDate={formatDate}\n            StatusBadge={StatusBadge}\n            setActiveTab={setActiveTab}\n          />\n        </TabsContent>\n      </Tabs>\n\n      {/* Declare Result Dialog */}\n      <Dialog open={!!declareResultMarket} onOpenChange={(open) => !open && setDeclareResultMarket(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Declare Final Result</DialogTitle>\n            <DialogDescription>\n              Enter the final result for {declareResultMarket?.name}. \n              Results should be a two-digit number from 00 to 99.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <Form {...resultForm}>\n            <form onSubmit={resultForm.handleSubmit(onSubmitResult)} className=\"space-y-4\">\n              <FormField\n                control={resultForm.control}\n                name=\"result\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Final Result</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"e.g. 42\" maxLength={2} />\n                    </FormControl>\n                    <FormDescription>\n                      Enter a two-digit number (00-99).\n                      <div className=\"mt-1 text-amber-500\">\n                        Note: Declaring the final result will finalize the market and set its status to \"resulted\".\n                      </div>\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <DialogFooter>\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  onClick={() => setDeclareResultMarket(null)}\n                >\n                  Cancel\n                </Button>\n                <Button \n                  type=\"submit\" \n                  disabled={updateMarketResult.isPending}\n                >\n                  {updateMarketResult.isPending ? \"Saving...\" : \"Declare Result\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Template Selection Dialog */}\n      <Dialog open={isTemplateSelectOpen} onOpenChange={setIsTemplateSelectOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Create New Market</DialogTitle>\n            <DialogDescription>\n              Select a previous market to use as a template or create from scratch\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div className=\"mb-4\">\n              <h3 className=\"text-md font-semibold mb-2\">Previous Markets</h3>\n              <div className=\"grid gap-3 max-h-[60vh] overflow-y-auto\">\n                {allMarkets.length === 0 ? (\n                  <p className=\"text-muted-foreground\">No previous markets found</p>\n                ) : (\n                  allMarkets.map(market => (\n                    <div \n                      key={market.id} \n                      className=\"border rounded-md p-3 hover:bg-accent/50 cursor-pointer flex justify-between items-center\"\n                      onClick={() => {\n                        setSelectedTemplate(market);\n                        setIsTemplateSelectOpen(false);\n                        setIsAddMarketOpen(true);\n                        marketForm.reset({\n                          name: market.name,\n                          type: market.type || \"gali\",\n                          coverImage: market.coverImage || \"\",\n                          marketDate: format(new Date(), \"yyyy-MM-dd\"),\n                          openTime: format(parseISO(market.openTime), \"HH:mm\"),\n                          closeTime: format(parseISO(market.closeTime), \"HH:mm\"),\n                          resultTime: market.resultTime ? format(parseISO(market.resultTime), \"HH:mm\") : format(parseISO(market.closeTime), \"HH:mm\"),\n                        });\n                      }}\n                    >\n                      <div>\n                        <p className=\"font-medium\">{market.name}</p>\n                        <div className=\"text-sm text-muted-foreground\">\n                          <span>Opens: {format(parseISO(market.openTime), \"h:mm a\")}</span>\n                          <span className=\"mx-2\">|</span>\n                          <span>Closes: {format(parseISO(market.closeTime), \"h:mm a\")}</span>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            setSelectedTemplate(market);\n                            setIsTemplateSelectOpen(false);\n                            setIsAddMarketOpen(true);\n                            marketForm.reset({\n                              name: market.name,\n                              type: market.type || \"gali\",\n                              coverImage: market.coverImage || \"\",\n                              marketDate: format(new Date(), \"yyyy-MM-dd\"),\n                              openTime: format(parseISO(market.openTime), \"HH:mm\"),\n                              closeTime: format(parseISO(market.closeTime), \"HH:mm\"),\n                              resultTime: market.resultTime ? format(parseISO(market.resultTime), \"HH:mm\") : format(parseISO(market.closeTime), \"HH:mm\"),\n                            });\n                          }}\n                        >\n                          Use Template\n                        </Button>\n                        <Button\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            setMarketToDelete(market);\n                            setDeleteConfirmOpen(true);\n                          }}\n                        >\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </div>\n            \n            <DialogFooter>\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => setIsTemplateSelectOpen(false)}\n              >\n                Cancel\n              </Button>\n              <Button \n                type=\"button\" \n                onClick={() => {\n                  setSelectedTemplate(null);\n                  setIsTemplateSelectOpen(false);\n                  setIsAddMarketOpen(true);\n                  marketForm.reset({\n                    name: \"\",\n                    type: \"gali\",\n                    coverImage: \"\",\n                    marketDate: format(new Date(), \"yyyy-MM-dd\"),\n                    openTime: \"\",\n                    closeTime: \"\",\n                    resultTime: \"\",\n                  });\n                }}\n              >\n                Create from Scratch\n              </Button>\n            </DialogFooter>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Add/Edit Market Dialog */}\n      <Dialog \n        open={isAddMarketOpen || !!editingMarket} \n        onOpenChange={(open) => {\n          if (!open) {\n            setIsAddMarketOpen(false);\n            setEditingMarket(null);\n          }\n        }}\n      >\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{editingMarket ? \"Edit Market\" : \"Add New Market\"}</DialogTitle>\n            <DialogDescription>\n              {editingMarket \n                ? \"Edit the details of the existing market.\" \n                : selectedTemplate\n                  ? `Using template: \"${selectedTemplate.name}\". New market will be created in \"waiting\" status.`\n                  : \"Fill in the details to create a new market. The market will start in waiting status and must be manually activated.\"}\n            </DialogDescription>\n          </DialogHeader>\n          \n          <Form {...marketForm}>\n            <form onSubmit={marketForm.handleSubmit(onSubmitMarket)} className=\"space-y-4\">\n              <FormField\n                control={marketForm.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Market Name</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"e.g. Dishawar Morning\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              {/* Market Type removed as it's not needed - all markets follow the gali style */}\n              \n              <FormField\n                control={marketForm.control}\n                name=\"coverImage\"\n                render={({ field }) => (\n                  <FormItem className=\"space-y-3\">\n                    <FormLabel>Cover Banner Image</FormLabel>\n                    <FormControl>\n                      <div className=\"flex flex-col gap-3\">\n                        {field.value ? (\n                          <div className=\"relative w-full h-40 rounded-md overflow-hidden border\">\n                            <img \n                              src={field.value} \n                              alt=\"Market banner preview\" \n                              className=\"w-full h-full object-cover\"\n                            />\n                            <Button\n                              type=\"button\"\n                              variant=\"destructive\"\n                              size=\"icon\"\n                              className=\"absolute top-2 right-2 h-6 w-6 rounded-full\"\n                              onClick={() => field.onChange(\"\")}\n                            >\n                              <X className=\"h-3 w-3\" />\n                            </Button>\n                          </div>\n                        ) : null}\n                        \n                        {!field.value && (\n                          <div className=\"flex items-center\">\n                            <Input \n                              type=\"file\" \n                              accept=\"image/*\"\n                              onChange={async (e) => {\n                                const file = e.target.files?.[0];\n                                if (!file) return;\n                                \n                                // Create form data for upload\n                                const formData = new FormData();\n                                formData.append('marketBannerImage', file);\n                                \n                                try {\n                                  // Upload the image\n                                  const response = await fetch('/api/upload/market-banner', {\n                                    method: 'POST',\n                                    body: formData,\n                                    credentials: 'include'\n                                  });\n                                  \n                                  if (!response.ok) {\n                                    throw new Error('Image upload failed');\n                                  }\n                                  \n                                  const data = await response.json();\n                                  \n                                  // Set the image URL to the form field\n                                  field.onChange(data.imageUrl);\n                                } catch (error) {\n                                  console.error('Error uploading image:', error);\n                                  toast({\n                                    title: \"Upload Failed\",\n                                    description: \"There was an error uploading the image. Please try again.\",\n                                    variant: \"destructive\"\n                                  });\n                                } finally {\n                                  // Clear the file input\n                                  e.target.value = '';\n                                }\n                              }}\n                              className=\"w-full\"\n                            />\n                          </div>\n                        )}\n                      </div>\n                    </FormControl>\n                    <FormDescription>\n                      Upload a banner image for the market display (optional)\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={marketForm.control}\n                name=\"marketDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Market Date</FormLabel>\n                    <FormControl>\n                      <Input {...field} type=\"date\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <div className=\"grid grid-cols-3 gap-4\">\n                <FormField\n                  control={marketForm.control}\n                  name=\"openTime\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Open Time</FormLabel>\n                      <FormControl>\n                        <select \n                          className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                          {...field}\n                        >\n                          <option value=\"\">Select time</option>\n                          {Array.from({ length: 24 }).map((_, hour) => (\n                            Array.from({ length: 4 }).map((_, minute) => {\n                              const h = hour;\n                              const m = minute * 15;\n                              const timeValue = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;\n                              const displayHour = h % 12 === 0 ? 12 : h % 12;\n                              const ampm = h < 12 ? 'AM' : 'PM';\n                              const displayTime = `${displayHour}:${m.toString().padStart(2, '0')} ${ampm}`;\n                              return (\n                                <option key={timeValue} value={timeValue}>\n                                  {displayTime}\n                                </option>\n                              );\n                            })\n                          ))}\n                        </select>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={marketForm.control}\n                  name=\"closeTime\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Close Time</FormLabel>\n                      <FormControl>\n                        <select \n                          className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                          {...field}\n                        >\n                          <option value=\"\">Select time</option>\n                          {Array.from({ length: 24 }).map((_, hour) => (\n                            Array.from({ length: 4 }).map((_, minute) => {\n                              const h = hour;\n                              const m = minute * 15;\n                              const timeValue = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;\n                              const displayHour = h % 12 === 0 ? 12 : h % 12;\n                              const ampm = h < 12 ? 'AM' : 'PM';\n                              const displayTime = `${displayHour}:${m.toString().padStart(2, '0')} ${ampm}`;\n                              return (\n                                <option key={timeValue} value={timeValue}>\n                                  {displayTime}\n                                </option>\n                              );\n                            })\n                          ))}\n                        </select>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={marketForm.control}\n                  name=\"resultTime\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Result Time</FormLabel>\n                      <FormControl>\n                        <select \n                          className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                          {...field}\n                        >\n                          <option value=\"\">Select time</option>\n                          {Array.from({ length: 24 }).map((_, hour) => (\n                            Array.from({ length: 4 }).map((_, minute) => {\n                              const h = hour;\n                              const m = minute * 15;\n                              const timeValue = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;\n                              const displayHour = h % 12 === 0 ? 12 : h % 12;\n                              const ampm = h < 12 ? 'AM' : 'PM';\n                              const displayTime = `${displayHour}:${m.toString().padStart(2, '0')} ${ampm}`;\n                              return (\n                                <option key={timeValue} value={timeValue}>\n                                  {displayTime}\n                                </option>\n                              );\n                            })\n                          ))}\n                        </select>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              \n\n              \n              <DialogFooter>\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  onClick={() => {\n                    setIsAddMarketOpen(false);\n                    setEditingMarket(null);\n                  }}\n                >\n                  Cancel\n                </Button>\n                <Button \n                  type=\"submit\" \n                  disabled={createMarket.isPending || updateMarket.isPending}\n                >\n                  {createMarket.isPending || updateMarket.isPending \n                    ? \"Saving...\" \n                    : editingMarket ? \"Update Market\" : \"Create Market\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Market Template Confirmation Dialog */}\n      <Dialog open={deleteConfirmOpen} onOpenChange={setDeleteConfirmOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>Remove Market Template</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to remove this market template?\n              {marketToDelete && (\n                <div className=\"mt-2 p-2 border rounded bg-muted\">\n                  <div className=\"font-semibold\">{marketToDelete.name}</div>\n                  <div className=\"text-sm text-muted-foreground mt-1\">\n                    <span>Opens: {format(parseISO(marketToDelete.openTime), \"h:mm a\")}</span>\n                    <span className=\"mx-2\">|</span>\n                    <span>Closes: {format(parseISO(marketToDelete.closeTime), \"h:mm a\")}</span>\n                  </div>\n                </div>\n              )}\n              This action cannot be undone.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setDeleteConfirmOpen(false);\n                setMarketToDelete(null);\n              }}\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={() => {\n                if (marketToDelete) {\n                  deleteMarket.mutate(marketToDelete.id);\n                }\n              }}\n              disabled={deleteMarket.isPending}\n            >\n              {deleteMarket.isPending ? 'Removing...' : 'Remove Template'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}\n\ninterface MarketTableProps {\n  markets: SatamatkaMarket[];\n  isLoading: boolean;\n  handleEditMarket: (market: SatamatkaMarket) => void;\n  handleDeclareResult: (market: SatamatkaMarket) => void;\n  updateMarketStatus: any;\n  formatDate: (date: string) => string;\n  StatusBadge: React.FC<{ status: string }>;\n  setActiveTab: (tab: string) => void;\n}\n\n// Market Table Component\nfunction MarketTable({ \n  markets, \n  isLoading,\n  handleEditMarket,\n  handleDeclareResult,\n  updateMarketStatus,\n  formatDate,\n  StatusBadge,\n  setActiveTab\n}: MarketTableProps) {\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <div key={i} className=\"p-4 border rounded-lg\">\n            <Skeleton className=\"h-6 w-1/3 mb-2\" />\n            <Skeleton className=\"h-4 w-1/2 mb-2\" />\n            <Skeleton className=\"h-4 w-1/4\" />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  if (markets.length === 0) {\n    return (\n      <div className=\"text-center py-10 border rounded-lg\">\n        <h3 className=\"text-lg font-medium\">No markets found</h3>\n        <p className=\"text-muted-foreground mt-2\">Try adjusting your filters or search query.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"border rounded-lg overflow-hidden\">\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead>Market</TableHead>\n            <TableHead>Active Bets</TableHead>\n            <TableHead>Open Time</TableHead>\n            <TableHead>Close Time</TableHead>\n            <TableHead>Result</TableHead>\n            <TableHead>Status</TableHead>\n            <TableHead className=\"text-right\">Actions</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {markets.map((market) => (\n            <TableRow key={market.id}>\n              <TableCell>\n                <div className=\"flex items-center gap-3\">\n                  {market.coverImage ? (\n                    <div className=\"h-10 w-16 rounded overflow-hidden\">\n                      <img \n                        src={market.coverImage} \n                        alt={market.name} \n                        className=\"h-full w-full object-cover\"\n                      />\n                    </div>\n                  ) : (\n                    <div className=\"h-10 w-16 rounded bg-slate-200 flex items-center justify-center text-slate-400 text-xs\">\n                      No Image\n                    </div>\n                  )}\n                  <span className=\"font-medium\">{market.name}</span>\n                </div>\n              </TableCell>\n              <TableCell>\n                <MarketBettingStats marketId={market.id} status={market.status} />\n              </TableCell>\n              <TableCell>{formatDate(market.openTime)}</TableCell>\n              <TableCell>{formatDate(market.closeTime)}</TableCell>\n              <TableCell>\n                {market.openResult ? (\n                  <span className=\"px-2 py-1 bg-indigo-100 text-indigo-800 rounded font-mono font-bold\">\n                    {market.openResult}\n                  </span>\n                ) : (\n                  <span className=\"text-slate-400\">-</span>\n                )}\n              </TableCell>\n              <TableCell>\n                <StatusBadge status={market.status} />\n              </TableCell>\n              <TableCell className=\"text-right\">\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" size=\"icon\">\n                      <MoreVertical className=\"h-4 w-4\" />\n                      <span className=\"sr-only\">Actions</span>\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\">\n                    <DropdownMenuLabel>Market Management</DropdownMenuLabel>\n                    \n                    <DropdownMenuSeparator />\n                    \n                    <DropdownMenuItem onClick={() => handleEditMarket(market)}>\n                      <Edit className=\"mr-2 h-4 w-4\" />\n                      Edit Market Details\n                    </DropdownMenuItem>\n                    \n                    {/* Market Status Management Section */}\n                    <DropdownMenuSeparator />\n                    <DropdownMenuLabel className=\"text-xs text-muted-foreground\">Status Controls</DropdownMenuLabel>\n                    \n                    {/* Status-specific actions */}\n                    \n                    {/* Upcoming  Active transition */}\n                    {market.status === \"waiting\" && (\n                      <DropdownMenuItem \n                        onClick={() => {\n                          updateMarketStatus.mutate({ id: market.id, status: \"open\" });\n                          setTimeout(() => setActiveTab(\"open\"), 300); // Switch to Active tab\n                        }}\n                        className=\"text-green-600 font-medium\"\n                      >\n                        <Play className=\"mr-2 h-4 w-4\" />\n                        Open for Betting\n                      </DropdownMenuItem>\n                    )}\n                    \n                    {/* Active  Closed transition */}\n                    {market.status === \"open\" && (\n                      <DropdownMenuItem \n                        onClick={() => {\n                          updateMarketStatus.mutate({ id: market.id, status: \"closed\" });\n                          setTimeout(() => setActiveTab(\"closed\"), 300); // Switch to Closed tab\n                        }}\n                        className=\"text-amber-600 font-medium\"\n                      >\n                        <X className=\"mr-2 h-4 w-4\" />\n                        Close Betting\n                      </DropdownMenuItem>\n                    )}\n                    \n                    {/* Closed  Resulted transition */}\n                    {market.status === \"closed\" && (\n                      <DropdownMenuItem \n                        onClick={() => handleDeclareResult(market)}\n                        className=\"text-blue-600 font-medium\"\n                      >\n                        <CheckCircle2 className=\"mr-2 h-4 w-4\" />\n                        Declare Result\n                      </DropdownMenuItem>\n                    )}\n                    \n                    {/* No actions for resulted markets */}\n                    {market.status === \"resulted\" && (\n                      <DropdownMenuItem disabled className=\"text-muted-foreground\">\n                        <Info className=\"mr-2 h-4 w-4\" />\n                        No actions available\n                      </DropdownMenuItem>\n                    )}\n                    \n                    {/* Admin override options (for corrections) */}\n                    {(market.status === \"closed\" || market.status === \"open\") && (\n                      <>\n                        <DropdownMenuSeparator />\n                        <DropdownMenuLabel className=\"text-xs text-muted-foreground\">Advanced Controls</DropdownMenuLabel>\n                        {market.status === \"closed\" && (\n                          <DropdownMenuItem \n                            onClick={() => {\n                              updateMarketStatus.mutate({ id: market.id, status: \"open\" });\n                              setTimeout(() => setActiveTab(\"open\"), 300);\n                            }}\n                            className=\"text-yellow-600 font-medium\"\n                          >\n                            <Undo2 className=\"mr-2 h-4 w-4\" />\n                            Revert to Active\n                          </DropdownMenuItem>\n                        )}\n                        {market.status === \"open\" && (\n                          <DropdownMenuItem \n                            onClick={() => {\n                              updateMarketStatus.mutate({ id: market.id, status: \"waiting\" });\n                              setTimeout(() => setActiveTab(\"waiting\"), 300);\n                            }}\n                            className=\"text-yellow-600 font-medium\"\n                          >\n                            <Undo2 className=\"mr-2 h-4 w-4\" />\n                            Revert to Upcoming\n                          </DropdownMenuItem>\n                        )}\n                      </>\n                    )}\n                    \n\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              </TableCell>\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}","path":null,"size_bytes":53795,"size_tokens":null},"add-missing-storage-functions.ts":{"content":"// This script adds missing storage functions to storage.ts\nimport fs from 'fs';\n\nfunction addMissingFunctions() {\n  try {\n    console.log(\"Adding missing storage functions...\");\n    \n    // Read the storage.ts file\n    const storageFile = fs.readFileSync('./server/storage.ts', 'utf8');\n    \n    // Functions to add\n    const functionsToAdd = [\n      {\n        name: \"getGamesByUserId\",\n        code: `\n  async getGamesByUserId(userId: number): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(eq(games.userId, userId))\n      .orderBy(desc(games.createdAt));\n  }`\n      },\n      {\n        name: \"getGame\",\n        code: `\n  async getGame(id: number): Promise<Game | undefined> {\n    const [game] = await db.select()\n      .from(games)\n      .where(eq(games.id, id))\n      .limit(1);\n    return game;\n  }`\n      },\n      {\n        name: \"createGame\",\n        code: `\n  async createGame(insertGame: InsertGame): Promise<Game> {\n    const [game] = await db.insert(games)\n      .values(insertGame)\n      .returning();\n    return game;\n  }`\n      },\n      {\n        name: \"getGamesByUserIds\",\n        code: `\n  async getGamesByUserIds(userIds: number[]): Promise<Game[]> {\n    if (!userIds.length) return [];\n    return await db.select()\n      .from(games)\n      .where(drizzleIn(games.userId, userIds))\n      .orderBy(desc(games.createdAt));\n  }`\n      },\n      {\n        name: \"getAllGames\",\n        code: `\n  async getAllGames(limit?: number): Promise<Game[]> {\n    let query = db.select()\n      .from(games)\n      .orderBy(desc(games.createdAt));\n\n    if (limit) {\n      query = query.limit(limit);\n    }\n\n    return await query;\n  }`\n      },\n      {\n        name: \"getRecentGames\",\n        code: `\n  async getRecentGames(userId: number, limit?: number): Promise<Game[]> {\n    let query = db.select()\n      .from(games)\n      .where(eq(games.userId, userId))\n      .orderBy(desc(games.createdAt));\n\n    if (limit) {\n      query = query.limit(limit);\n    }\n\n    return await query;\n  }`\n      },\n      {\n        name: \"updateGameStatus\",\n        code: `\n  async updateGameStatus(gameId: number, status: string): Promise<Game | undefined> {\n    const [game] = await db.update(games)\n      .set({ status })\n      .where(eq(games.id, gameId))\n      .returning();\n    return game;\n  }`\n      },\n      {\n        name: \"updateGameResult\",\n        code: `\n  async updateGameResult(gameId: number, result: string, payout?: number): Promise<Game | undefined> {\n    const updateData: { result: string; payout?: number } = { result };\n    if (payout !== undefined) {\n      updateData.payout = payout;\n    }\n    \n    const [game] = await db.update(games)\n      .set(updateData)\n      .where(eq(games.id, gameId))\n      .returning();\n    return game;\n  }`\n      }\n    ];\n    \n    // Find a good insertion point - right after the last implemented function\n    const insertionPointRegex = /(async getUsersByAssignedTo\\([^)]*\\)[^{]*{[\\s\\S]*?})/;\n    const match = insertionPointRegex.exec(storageFile);\n    \n    if (!match) {\n      console.log(\"Couldn't find a suitable insertion point\");\n      return;\n    }\n    \n    // Get index right after the last implemented function\n    const insertionIndex = match.index + match[1].length;\n    \n    // Create the code to insert\n    const codeToInsert = functionsToAdd.map(func => func.code).join('\\n');\n    \n    // Insert the new functions\n    const updatedFile = \n      storageFile.slice(0, insertionIndex) + \n      codeToInsert + \n      storageFile.slice(insertionIndex);\n    \n    // Fix import for drizzleIn if needed\n    let finalUpdatedFile = updatedFile;\n    if (updatedFile.includes('drizzleIn(') && !updatedFile.includes('drizzleIn,')) {\n      finalUpdatedFile = updatedFile.replace(\n        /import { (.*?) } from 'drizzle-orm';/,\n        \"import { $1, drizzleIn } from 'drizzle-orm';\"\n      );\n    }\n    \n    // Check if 'in as drizzleIn' is in the imports and replace it if so\n    if (finalUpdatedFile.includes('in as drizzleIn')) {\n      finalUpdatedFile = finalUpdatedFile.replace(\n        'in as drizzleIn',\n        'drizzleIn'\n      );\n    }\n    \n    // Write the updated file\n    fs.writeFileSync('./server/storage.ts', finalUpdatedFile);\n    console.log(\"Added missing storage functions to storage.ts\");\n    \n  } catch (error) {\n    console.error(\"Error adding missing functions:\", error);\n  }\n}\n\naddMissingFunctions();","path":null,"size_bytes":4391,"size_tokens":null},"client/src/components/game-history-table.tsx":{"content":"import { formatDistanceToNow } from \"date-fns\";\nimport { GameOutcome } from \"@shared/schema\";\nimport { \n  Card, \n  CardContent, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { useLocation } from \"wouter\";\nimport { formatCurrency, formatProfitLoss } from \"@/lib/format-utils\";\n\ninterface Game {\n  id: number;\n  userId: number;\n  gameType: string;\n  betAmount: number;\n  prediction: string;\n  result: string;\n  payout: number;\n  balanceAfter?: number;\n  createdAt: string;\n  marketId?: number;\n  matchId?: number;\n  gameMode?: string;\n  gameData?: any;\n  // These would be joined from related tables\n  market?: {\n    id: number;\n    name: string;\n    type: string;\n  };\n  match?: {\n    id: number;\n    teamA: string;\n    teamB: string;\n    category: string;\n  };\n}\n\ninterface GameHistoryTableProps {\n  games: Game[];\n  showFullHistory?: boolean;\n}\n\nexport default function GameHistoryTable({ games, showFullHistory = false }: GameHistoryTableProps) {\n  const [_, setLocation] = useLocation();\n  \n  // Display only the most recent 10 games unless showFullHistory is true\n  const displayGames = showFullHistory ? games : games.slice(0, 10);\n  \n  // Format timestamp to relative time\n  const formatTime = (timestamp: string) => {\n    try {\n      return formatDistanceToNow(new Date(timestamp), { addSuffix: true });\n    } catch (e) {\n      return \"Unknown time\";\n    }\n  };\n\n  return (\n    <Card className=\"bg-slate-900/70 rounded-xl shadow-xl border border-slate-800\">\n      <CardHeader>\n        <CardTitle className=\"text-xl font-bold text-slate-200\">\n          {showFullHistory ? \"Game History\" : \"Recent Games\"}\n        </CardTitle>\n      </CardHeader>\n      \n      <CardContent>\n        <div className=\"overflow-x-auto\">\n          <Table>\n            <TableHeader>\n              <TableRow className=\"border-slate-800\">\n                <TableHead className=\"text-slate-400\">Time</TableHead>\n                <TableHead className=\"text-slate-400\">Game Type</TableHead>\n                <TableHead className=\"text-slate-400\">Market/Match</TableHead>\n                <TableHead className=\"text-slate-400\">Bet Amount</TableHead>\n                <TableHead className=\"text-slate-400\">Prediction</TableHead>\n                <TableHead className=\"text-slate-400\">Result</TableHead>\n                <TableHead className=\"text-slate-400\">Profit/Loss</TableHead>\n                <TableHead className=\"text-slate-400\">Balance</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {displayGames.length === 0 ? (\n                <TableRow className=\"border-slate-800\">\n                  <TableCell colSpan={8} className=\"text-center py-4 text-slate-500\">\n                    No games played yet\n                  </TableCell>\n                </TableRow>\n              ) : (\n                displayGames.map((game) => {\n                  // Helper function to format game type\n                  const formatGameType = (gameType: string) => {\n                    switch(gameType) {\n                      case 'coin_flip': return 'Coin Flip';\n                      case 'satamatka': return 'Satamatka';\n                      // Team Match game type removed\n                      case 'cricket_toss': return 'Cricket Toss';\n                      default: return gameType.replace(/_/g, ' ');\n                    }\n                  };\n                  \n                  // Helper function to format game mode\n                  const formatGameMode = (gameMode?: string) => {\n                    if (!gameMode) return '';\n                    switch(gameMode) {\n                      case 'jodi': return 'Jodi';\n                      case 'harf': return 'Harf';\n                      case 'crossing': return 'Crossing';\n                      case 'odd_even': return 'Odd/Even';\n                      default: return gameMode.replace(/_/g, ' ');\n                    }\n                  };\n                  \n                  // Helper function to get market or match info\n                  const getMarketOrMatchInfo = (game: Game) => {\n                    if (game.gameType === 'satamatka') {\n                      // For Satamatka games, clearly show the market name and game mode\n                      if (game.market) {\n                        const marketName = game.market.name || game.market.type || 'Satamatka Market';\n                        const gameModeName = game.gameMode ? formatGameMode(game.gameMode) : '';\n                        return `${marketName}${gameModeName ? ` (${gameModeName})` : ''}`;\n                      } else {\n                        // If market info is missing, provide a fallback with game mode\n                        return `Satamatka ${game.gameMode ? `(${formatGameMode(game.gameMode)})` : ''}`;\n                      }\n                    /* Team Match games section removed */\n                    } else if (game.gameType === 'cricket_toss') {\n                      // For Cricket Toss games with gameData\n                      if (game.gameData && game.gameData.teamA && game.gameData.teamB) {\n                        return `${game.gameData.teamA} vs ${game.gameData.teamB}`;\n                      } else if (game.match) {\n                        return `${game.match.teamA} vs ${game.match.teamB}`;\n                      } else {\n                        return 'Cricket Toss';\n                      }\n                    } else if (game.gameType === 'coin_flip') {\n                      return 'Coin Flip Game';\n                    } else {\n                      return '-';\n                    }\n                  };\n\n                  // Get the appropriate badge colors for prediction/result\n                  const getBadgeClass = (value: string, gameType: string) => {\n                    if (gameType === 'coin_flip') {\n                      return value === GameOutcome.HEADS\n                        ? \"bg-purple-900/30 text-purple-300 border-purple-500/30\"\n                        : \"bg-cyan-900/30 text-cyan-300 border-cyan-500/30\";\n                    } else if (gameType === 'cricket_toss') {\n                      if (value === 'team_a') return \"bg-indigo-900/30 text-indigo-300 border-indigo-500/30\";\n                      if (value === 'team_b') return \"bg-pink-900/30 text-pink-300 border-pink-500/30\";\n                      if (value === 'draw') return \"bg-amber-900/30 text-amber-300 border-amber-500/30\";\n                    }\n                    // Default for satamatka and other types\n                    return \"bg-teal-900/30 text-teal-300 border-teal-500/30\";\n                  };\n\n                  // Format prediction display\n                  const formatPrediction = (prediction: string, game: Game) => {\n                    // Team match games section removed\n                    \n                    // For cricket toss games, display the actual team name\n                    if (game.gameType === 'cricket_toss') {\n                      if (prediction === 'team_a') {\n                        // Try to get team name from game data or match data\n                        if (game.gameData?.teamA) return game.gameData.teamA;\n                        if (game.match?.teamA) return game.match.teamA;\n                        return 'Team A';\n                      }\n                      if (prediction === 'team_b') {\n                        // Try to get team name from game data or match data\n                        if (game.gameData?.teamB) return game.gameData.teamB;\n                        if (game.match?.teamB) return game.match.teamB;\n                        return 'Team B';\n                      }\n                      if (prediction === 'draw') return 'Draw';\n                    }\n                    \n                    // For satamatka games, format numbers properly\n                    if (game.gameType === 'satamatka') {\n                      // If game mode is present, format accordingly\n                      if (game.gameMode === 'jodi') {\n                        // Jodi is typically a 2-digit number\n                        return prediction.padStart(2, '0');\n                      } else if (game.gameMode === 'harf') {\n                        // Harf is typically a single digit\n                        return prediction;\n                      } else if (game.gameMode === 'odd_even') {\n                        // Convert 'odd' or 'even' to proper case\n                        return prediction.charAt(0).toUpperCase() + prediction.slice(1);\n                      } else if (game.gameMode === 'crossing') {\n                        return prediction;\n                      }\n                    }\n                    \n                    // Default return the prediction as is\n                    return prediction;\n                  };\n                  \n                  return (\n                    <TableRow key={game.id} className=\"hover:bg-slate-800/50 transition-colors border-slate-800\">\n                      <TableCell className=\"whitespace-nowrap text-sm text-slate-400\">\n                        {formatTime(game.createdAt)}\n                      </TableCell>\n                      <TableCell className=\"whitespace-nowrap text-sm\">\n                        <Badge variant=\"outline\" className=\"bg-slate-800/80 text-slate-300 border-slate-700\">\n                          {formatGameType(game.gameType)}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"whitespace-nowrap text-xs text-slate-300\">\n                        {getMarketOrMatchInfo(game)}\n                      </TableCell>\n                      <TableCell className=\"whitespace-nowrap text-sm text-slate-300\">\n                        {formatCurrency(game.betAmount, game.gameType)}\n                      </TableCell>\n                      <TableCell className=\"whitespace-nowrap\">\n                        <Badge variant=\"outline\" className={getBadgeClass(game.prediction, game.gameType)}>\n                          {formatPrediction(game.prediction, game)}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"whitespace-nowrap\">\n                        {game.result ? (\n                          <Badge variant=\"outline\" className={getBadgeClass(game.result, game.gameType)}>\n                            {formatPrediction(game.result, game)}\n                          </Badge>\n                        ) : (\n                          <Badge variant=\"outline\" className=\"bg-gray-800 text-gray-400 border-gray-700\">\n                            Pending\n                          </Badge>\n                        )}\n                      </TableCell>\n                      <TableCell className={`whitespace-nowrap text-sm ${\n                        game.result === null || game.result === 'pending' \n                          ? \"text-amber-400\" // Pending games in amber/yellow\n                          : (\n                              game.gameType === 'cricket_toss' && game.prediction === game.result\n                              ? \"text-teal-400\" // Win in green\n                              : (game.payout > 0 ? \"text-teal-400\" : \"text-rose-400\")\n                            ) // Loss in red\n                      }`}>\n                        {formatProfitLoss(game.betAmount, game.payout, game.gameType, game.result)}\n                      </TableCell>\n                      <TableCell className=\"whitespace-nowrap text-sm text-green-400\">\n                        {game.balanceAfter !== undefined && game.balanceAfter !== null ? formatCurrency(game.balanceAfter, game.gameType) : \"-\"}\n                      </TableCell>\n                    </TableRow>\n                  );\n                })\n              )}\n            </TableBody>\n          </Table>\n        </div>\n        \n        {!showFullHistory && games.length > 0 && (\n          <div className=\"mt-6 text-center\">\n            <Button \n              variant=\"link\" \n              className=\"text-blue-400 hover:text-blue-300\"\n              onClick={() => setLocation(\"/game-history\")}\n            >\n              View All History\n            </Button>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":12439,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/pages/user-management-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport ConfirmDialog from \"@/components/confirm-dialog\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { UserRole } from \"@shared/schema\";\nimport { useLocation } from \"wouter\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { \n  Ban, \n  CheckCircle, \n  User,\n  IndianRupee, \n  DollarSign, \n  PlusCircle, \n  MinusCircle,\n  Edit,\n  Key,\n  Info,\n  Clock,\n  BarChart,\n  ArrowDown,\n  ArrowUp,\n  Coins,\n  History,\n  FileText,\n  RefreshCw,\n  UserPlus,\n  Loader2,\n  MessageSquare,\n  Percent,\n  ChevronLeft,\n  ChevronRight,\n  Trash2,\n  AlertCircle,\n  Save,\n  Trash,\n  CreditCard\n} from \"lucide-react\";\n\nexport default function UserManagementPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [_, navigate] = useLocation();\n  const [selectedUser, setSelectedUser] = useState<any>(null);\n  const [amount, setAmount] = useState<number>(0);\n  const [remark, setRemark] = useState<string>(\"\");\n  const [username, setUsername] = useState<string>(\"\");\n  const [password, setPassword] = useState<string>(\"\");\n  const [isAddFundsDialogOpen, setIsAddFundsDialogOpen] = useState(false);\n  const [isRemoveFundsDialogOpen, setIsRemoveFundsDialogOpen] = useState(false);\n  const [isEditUserDialogOpen, setIsEditUserDialogOpen] = useState(false);\n  const [isUserDetailsDialogOpen, setIsUserDetailsDialogOpen] = useState(false);\n  const [isCreateUserDialogOpen, setIsCreateUserDialogOpen] = useState(false);\n  const [isCommissionDialogOpen, setIsCommissionDialogOpen] = useState(false);\n  const [isDepositDiscountDialogOpen, setIsDepositDiscountDialogOpen] = useState(false);\n  const [detailsTab, setDetailsTab] = useState(\"transactions\");\n  const [commissionRate, setCommissionRate] = useState<number>(0);\n  const [depositDiscountRate, setDepositDiscountRate] = useState<number>(0);\n  const [selectedGameType, setSelectedGameType] = useState<string>(\"satamatka_jodi\");\n  const [selectedSubadminCommissionRate, setSelectedSubadminCommissionRate] = useState<number | null>(null);\n  const [isResetAccountDialogOpen, setIsResetAccountDialogOpen] = useState(false);\n  const [resetConfirmationText, setResetConfirmationText] = useState(\"\");\n  const [startingBalance, setStartingBalance] = useState<string>(\"\");\n  \n  // Pagination states\n  const [transactionsPage, setTransactionsPage] = useState(1);\n  const [betsPage, setBetsPage] = useState(1);\n  const [activeBetsPage, setActiveBetsPage] = useState(1);\n  const [itemsPerPage] = useState(10);\n  \n  // Define the schema for creating a new user\n  const createUserSchema = z.object({\n    username: z.string().min(3, \"Username must be at least 3 characters\"),\n    email: z.string().email(\"Please enter a valid email address\"),\n    mobile: z.string().min(10, \"Mobile number must be at least 10 digits\").max(15, \"Mobile number cannot exceed 15 digits\"),\n    password: z.string().min(6, \"Password must be at least 6 characters\"),\n    confirmPassword: z.string().min(6, \"Confirm password must be at least 6 characters\"),\n    rewardCommission: z.string().optional(),\n  }).refine(data => data.password === data.confirmPassword, {\n    message: \"Passwords do not match\",\n    path: [\"confirmPassword\"],\n  });\n  \n  // Create user form\n  const createUserForm = useForm<z.infer<typeof createUserSchema>>({\n    resolver: zodResolver(createUserSchema),\n    defaultValues: {\n      username: \"\",\n      email: \"\",\n      mobile: \"\",\n      password: \"\",\n      confirmPassword: \"\",\n      rewardCommission: \"0\",\n    },\n  });\n\n  // Search and filter states\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [roleFilter, setRoleFilter] = useState<string | null>(null);\n\n  // Fetch users\n  const { data: users = [], isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/users\"],\n    enabled: !!user,\n  });\n  \n  // Filter users based on search term and role filter\n  const filteredUsers = Array.isArray(users) ? users.filter((user: any) => {\n    const matchesSearch = user.username.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesRole = roleFilter === null || user.role === roleFilter;\n    return matchesSearch && matchesRole;\n  }) : [];\n  \n  // Fetch user transactions\n  const { data: userTransactions = [], isLoading: isLoadingTransactions } = useQuery({\n    queryKey: [\"/api/transactions\", selectedUser?.id],\n    queryFn: async () => {\n      if (!selectedUser) return [];\n      const res = await apiRequest(\"GET\", `/api/transactions/${selectedUser.id}`);\n      return await res.json();\n    },\n    enabled: !!selectedUser && isUserDetailsDialogOpen && detailsTab === \"transactions\",\n  });\n  \n  // Fetch user games\n  const { data: userGames = [], isLoading: isLoadingGames } = useQuery({\n    queryKey: [\"/api/games\", selectedUser?.id],\n    queryFn: async () => {\n      if (!selectedUser) return [];\n      const res = await apiRequest(\"GET\", `/api/games/${selectedUser.id}`);\n      return await res.json();\n    },\n    enabled: !!selectedUser && isUserDetailsDialogOpen && detailsTab === \"bets\",\n  });\n  \n  // Fetch active bets (pending games) for the selected user\n  const { data: userActiveBets = [], isLoading: isLoadingActiveBets } = useQuery({\n    queryKey: [\"/api/games/pending\", selectedUser?.id],\n    queryFn: async () => {\n      if (!selectedUser) return [];\n      \n      // Get all games for this user\n      const res = await apiRequest(\"GET\", `/api/games/${selectedUser.id}`);\n      const allGames = await res.json();\n      \n      // Debug log to see what games we have\n      console.log(\"All games for user:\", allGames);\n      \n      // Better pending game detection - include both empty strings and \"pending\" status\n      const activeBets = allGames.filter((game: any) => {\n        const isPending = !game.result || \n                         game.result === \"\" || \n                         game.result === \"pending\" ||\n                         (game.game_data && game.game_data.status === \"open\");\n                         \n        console.log(`Game ${game.id} (${game.gameType}) - Result: \"${game.result}\" - isPending: ${isPending}`);\n        return isPending;\n      });\n      \n      console.log(\"Active bets filtered:\", activeBets.length);\n      return activeBets;\n    },\n    enabled: !!selectedUser && isUserDetailsDialogOpen && detailsTab === \"active-bets\",\n  });\n  \n  // Fetch user commissions (for subadmins) or discounts (for players)\n  const { data: userCommissions = [], isLoading: isLoadingCommissions } = useQuery({\n    queryKey: [\"/api/commissions\", selectedUser?.id, selectedUser?.role],\n    queryFn: async () => {\n      if (!selectedUser) return [];\n      \n      // If the selected user is a subadmin, get their commission rates\n      if (selectedUser.role === UserRole.SUBADMIN) {\n        const res = await apiRequest(\"GET\", `/api/commissions/subadmin/${selectedUser.id}`);\n        return await res.json();\n      }\n      \n      // If the selected user is a player and current user is a subadmin, get player discounts\n      if (selectedUser.role === UserRole.PLAYER && user?.role === UserRole.SUBADMIN) {\n        const res = await apiRequest(\"GET\", `/api/discounts/user/${selectedUser.id}`);\n        return await res.json();\n      }\n      \n      return [];\n    },\n    enabled: !!selectedUser && isCommissionDialogOpen,\n  });\n  \n  // Fetch player deposit discount\n  const { data: depositDiscount, isLoading: isLoadingDepositDiscount } = useQuery({\n    queryKey: [\"/api/subadmin/deposit-discount\", selectedUser?.id],\n    queryFn: async () => {\n      if (!selectedUser || selectedUser.role !== UserRole.PLAYER || user?.role !== UserRole.SUBADMIN) return null;\n      \n      const res = await apiRequest(\"GET\", `/api/subadmin/deposit-discount/${selectedUser.id}`);\n      return await res.json();\n    },\n    enabled: !!selectedUser && isDepositDiscountDialogOpen && \n             selectedUser.role === UserRole.PLAYER && user?.role === UserRole.SUBADMIN,\n  });\n\n  // Block user mutation\n  const blockUserMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      const res = await apiRequest(\"PATCH\", `/api/users/${userId}/block`, {});\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"User blocked\",\n        description: \"The user has been blocked successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to block user\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Unblock user mutation\n  const unblockUserMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      const res = await apiRequest(\"PATCH\", `/api/users/${userId}/unblock`, {});\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"User unblocked\",\n        description: \"The user has been unblocked successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to unblock user\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update balance mutation\n  const updateBalanceMutation = useMutation({\n    mutationFn: async ({ userId, amount, description }: { userId: number; amount: number; description?: string }) => {\n      const res = await apiRequest(\"PATCH\", `/api/users/${userId}/balance`, { amount, description });\n      return await res.json();\n    },\n    onSuccess: () => {\n      // Invalidate both the users list and current user's info to update UI immediately\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      setAmount(0);\n      setRemark(\"\");\n      setIsAddFundsDialogOpen(false);\n      setIsRemoveFundsDialogOpen(false);\n      toast({\n        title: \"Balance updated\",\n        description: \"The user's balance has been updated successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update balance\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Edit user mutation\n  const editUserMutation = useMutation({\n    mutationFn: async ({ userId, username, password }: { userId: number; username?: string; password?: string }) => {\n      const res = await apiRequest(\"PATCH\", `/api/users/${userId}/edit`, { username, password });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setIsEditUserDialogOpen(false);\n      setUsername(\"\");\n      setPassword(\"\");\n      toast({\n        title: \"User updated\",\n        description: \"The user's information has been updated successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update user\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n  \n  // Delete user mutation\n  const deleteUserMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      return apiRequest(\"DELETE\", `/api/users/${userId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      // Force refetch to update the UI\n      queryClient.refetchQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"User Deleted\",\n        description: \"User has been deleted successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error Deleting User\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Delete confirmation state\n  const [isDeleteConfirmOpen, setIsDeleteConfirmOpen] = useState(false);\n  const [userToDelete, setUserToDelete] = useState<number | null>(null);\n\n  // Handle delete user\n  const handleDeleteUser = (userId: number) => {\n    setUserToDelete(userId);\n    setIsDeleteConfirmOpen(true);\n  };\n  \n  // Confirm delete user\n  const confirmDeleteUser = () => {\n    if (userToDelete) {\n      deleteUserMutation.mutate(userToDelete);\n      setUserToDelete(null);\n    }\n  };\n  \n  // Reset account mutation\n  const resetAccountMutation = useMutation({\n    mutationFn: async ({userId, resetType}: {userId: number, resetType: string}) => {\n      const response = await apiRequest(\"POST\", \"/api/users/reset-account\", {userId, resetType});\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || \"Failed to reset account\");\n      }\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      \n      // Also invalidate stats and other related data\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/games\"] });\n      \n      toast({\n        title: \"Account Reset Successfully\",\n        description: `${selectedUser?.username}'s account has been reset to a fresh state.`,\n      });\n      setIsResetAccountDialogOpen(false);\n      setResetConfirmationText(\"\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error Resetting Account\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Handle reset account\n  const handleResetAccount = () => {\n    if (!selectedUser || resetConfirmationText !== \"RESET\") return;\n    \n    const resetType = selectedUser.role === UserRole.SUBADMIN ? \"subadmin\" : \"player\";\n    resetAccountMutation.mutate({\n      userId: selectedUser.id,\n      resetType: resetType\n    });\n  };\n\n  // Create user mutation\n  const createUserMutation = useMutation({\n    mutationFn: async (data: Omit<z.infer<typeof createUserSchema>, \"confirmPassword\">) => {\n      // Convert reward commission from percentage to basis points (e.g., 5% = 500)\n      const rewardCommission = data.rewardCommission \n        ? Math.round(parseFloat(data.rewardCommission) * 100)\n        : 0;\n      \n      return apiRequest(\"POST\", \"/api/register\", {\n        username: data.username,\n        email: data.email,\n        mobile: data.mobile,\n        password: data.password,\n        role: UserRole.PLAYER,\n        rewardCommission\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"User Created\",\n        description: \"New user has been created and assigned to you successfully\",\n      });\n      setIsCreateUserDialogOpen(false);\n      createUserForm.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error Creating User\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Set deposit discount mutation\n  const setDepositDiscountMutation = useMutation({\n    mutationFn: async ({ userId, discountRate }: { userId: number; discountRate: number }) => {\n      // Only subadmins can set discounts and only for players\n      if (user?.role !== UserRole.SUBADMIN) {\n        throw new Error(\"Only subadmins can set deposit discounts\");\n      }\n      \n      // Get user details to verify it's a player\n      const userRes = await apiRequest(\"GET\", `/api/users/${userId}`);\n      const userData = await userRes.json();\n      \n      if (userData.role !== UserRole.PLAYER) {\n        throw new Error(\"Deposit discounts can only be set for players\");\n      }\n      \n      const res = await apiRequest(\"POST\", `/api/subadmin/deposit-discount/${userId}`, { \n        discountRate \n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/subadmin/deposit-discount\", selectedUser?.id] });\n      setIsDepositDiscountDialogOpen(false);\n      toast({\n        title: \"Deposit discount updated\",\n        description: \"The deposit discount has been updated successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update deposit discount\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n  \n  // Set commission/discount mutation\n  const setCommissionMutation = useMutation({\n    mutationFn: async ({ \n      userId, \n      gameType, \n      rate, \n      isSubadmin \n    }: { \n      userId: number; \n      gameType: string; \n      rate: number;\n      isSubadmin: boolean;\n    }) => {\n      // For subadmins, use the commission endpoint\n      if (isSubadmin) {\n        const res = await apiRequest(\"POST\", \"/api/commissions/subadmin\", {\n          subadminId: userId,\n          gameType,\n          commissionRate: Math.round(rate * 100) // Convert percentage to basis points (5% = 500)\n        });\n        return await res.json();\n      }\n      \n      // For players, use the discount endpoint\n      const res = await apiRequest(\"POST\", \"/api/discounts/user\", {\n        userId,\n        gameType,\n        discountRate: Math.round(rate * 100) // Convert percentage to basis points (5% = 500)\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/commissions\", selectedUser?.id, selectedUser?.role] });\n      setIsCommissionDialogOpen(false);\n      setCommissionRate(0);\n      toast({\n        title: selectedUser?.role === UserRole.SUBADMIN ? \"Commission Updated\" : \"Discount Updated\",\n        description: `${selectedUser?.role === UserRole.SUBADMIN ? \"Commission\" : \"Discount\"} rate has been updated successfully`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: `Failed to update ${selectedUser?.role === UserRole.SUBADMIN ? \"commission\" : \"discount\"}`,\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleBlockUser = (userId: number) => {\n    blockUserMutation.mutate(userId);\n  };\n\n  const handleUnblockUser = (userId: number) => {\n    unblockUserMutation.mutate(userId);\n  };\n\n  const handleAddFunds = () => {\n    if (!selectedUser || amount <= 0) return;\n    \n    // Save starting balance to localStorage if provided\n    if (startingBalance) {\n      localStorage.setItem(`startingBalance_${selectedUser.id}`, startingBalance);\n    }\n    \n    // Convert dollar amount to cents (multiply by 100)\n    updateBalanceMutation.mutate({ \n      userId: selectedUser.id, \n      amount: amount * 100,\n      description: remark ? remark : `Funds added by ${user?.username}`\n    });\n  };\n\n  const handleRemoveFunds = () => {\n    if (!selectedUser || amount <= 0) return;\n    \n    // Save starting balance to localStorage if provided\n    if (startingBalance) {\n      localStorage.setItem(`startingBalance_${selectedUser.id}`, startingBalance);\n    }\n    \n    // Convert dollar amount to cents (multiply by 100)\n    updateBalanceMutation.mutate({ \n      userId: selectedUser.id, \n      amount: -amount * 100,\n      description: remark ? remark : `Funds deducted by ${user?.username}`\n    });\n  };\n\n  const handleEditUser = () => {\n    if (!selectedUser) return;\n    const updatedFields: { username?: string; password?: string } = {};\n    \n    // Only admins can update usernames - subadmins can only update passwords\n    if (user?.role === UserRole.ADMIN && username.trim()) {\n      updatedFields.username = username;\n    }\n    \n    if (password.trim()) {\n      updatedFields.password = password;\n    }\n    \n    if (Object.keys(updatedFields).length === 0) {\n      toast({\n        title: \"No changes made\",\n        description: user?.role === UserRole.ADMIN \n          ? \"Please enter a new username or password\" \n          : \"Please enter a new password\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    editUserMutation.mutate({ \n      userId: selectedUser.id, \n      ...updatedFields \n    });\n  };\n\n  // Fetch deposit commission rate for a subadmin\n  const fetchDepositCommissionRate = async (subadminId: number) => {\n    try {\n      if (user?.role === UserRole.ADMIN) {\n        const response = await apiRequest(\"GET\", `/api/admin/deposit-commissions/${subadminId}`);\n        const data = await response.json();\n        if (data && data.commissionRate !== undefined) {\n          return data.commissionRate / 100; // Convert from basis points to percentage\n        }\n      }\n      return null;\n    } catch (error) {\n      console.error(\"Error fetching commission rate:\", error);\n      return null;\n    }\n  };\n\n  // Fetch player deposit discount rate for a player\n  const fetchPlayerDepositDiscount = async (playerId: number) => {\n    try {\n      if (user?.role === UserRole.SUBADMIN) {\n        const response = await apiRequest(\"GET\", `/api/subadmin/deposit-discount/${playerId}`);\n        const data = await response.json();\n        if (data && data.discountRate !== undefined) {\n          return data.discountRate;\n        }\n      }\n      return 0;\n    } catch (error) {\n      console.error(\"Error fetching player deposit discount:\", error);\n      return 0;\n    }\n  };\n\n  const openAddFundsDialog = async (targetUser: any) => {\n    setSelectedUser(targetUser);\n    setAmount(0);\n    setRemark(\"\");\n    \n    // Load saved starting balance from localStorage\n    const savedStartingBalance = localStorage.getItem(`startingBalance_${targetUser.id}`);\n    if (savedStartingBalance) {\n      setStartingBalance(savedStartingBalance);\n    } else {\n      setStartingBalance(\"\");\n    }\n    \n    // If admin is opening dialog for a subadmin, fetch the commission rate\n    if (targetUser?.role === UserRole.SUBADMIN && user?.role === UserRole.ADMIN) {\n      const commissionRate = await fetchDepositCommissionRate(targetUser.id);\n      setSelectedSubadminCommissionRate(commissionRate);\n      setDepositDiscountRate(0);\n    } \n    // If subadmin is opening dialog for a player, fetch the deposit discount\n    else if (targetUser?.role === UserRole.PLAYER && user?.role === UserRole.SUBADMIN) {\n      const discountRate = await fetchPlayerDepositDiscount(targetUser.id);\n      setSelectedSubadminCommissionRate(null);\n      setDepositDiscountRate(discountRate);\n    } else {\n      setSelectedSubadminCommissionRate(null);\n      setDepositDiscountRate(0);\n    }\n    \n    setIsAddFundsDialogOpen(true);\n  };\n\n  const openRemoveFundsDialog = async (targetUser: any) => {\n    setSelectedUser(targetUser);\n    setAmount(0);\n    setRemark(\"\");\n    \n    // Load saved starting balance from localStorage\n    const savedStartingBalance = localStorage.getItem(`startingBalance_${targetUser.id}`);\n    if (savedStartingBalance) {\n      setStartingBalance(savedStartingBalance);\n    } else {\n      setStartingBalance(\"\");\n    }\n    \n    // If admin is opening dialog for a subadmin, fetch the commission rate\n    if (targetUser?.role === UserRole.SUBADMIN && user?.role === UserRole.ADMIN) {\n      const commissionRate = await fetchDepositCommissionRate(targetUser.id);\n      setSelectedSubadminCommissionRate(commissionRate);\n    } else {\n      setSelectedSubadminCommissionRate(null);\n    }\n    \n    setIsRemoveFundsDialogOpen(true);\n  };\n\n  const openEditUserDialog = (user: any) => {\n    setSelectedUser(user);\n    setUsername(\"\");\n    setPassword(\"\");\n    setIsEditUserDialogOpen(true);\n  };\n  \n  // Pagination helpers\n  const getPageCount = (totalItems: number) => Math.ceil(totalItems / itemsPerPage);\n  \n  const getPaginatedItems = (items: any[], page: number) => {\n    const startIndex = (page - 1) * itemsPerPage;\n    const endIndex = startIndex + itemsPerPage;\n    return items.slice(startIndex, endIndex);\n  };\n  \n  // Reset pagination when tab changes\n  useEffect(() => {\n    setTransactionsPage(1);\n    setBetsPage(1);\n    setActiveBetsPage(1);\n  }, [detailsTab]);\n  \n  const openUserDetailsDialog = (user: any) => {\n    // Navigate to the user details page instead of opening a modal\n    navigate(`/users/${user.id}`);\n  };\n  \n  // State for deposit commission dialog\n  const [isDepositCommissionDialogOpen, setIsDepositCommissionDialogOpen] = useState(false);\n  const [depositCommissionRate, setDepositCommissionRate] = useState<number>(0);\n\n  const openDepositCommissionDialog = async (user: any) => {\n    // Only for subadmins\n    if (user.role !== UserRole.SUBADMIN) {\n      toast({\n        title: \"Action not allowed\",\n        description: \"Deposit commission can only be set for subadmins\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    setSelectedUser(user);\n    setDepositCommissionRate(0);\n    setIsDepositCommissionDialogOpen(true);\n    \n    // Fetch the current deposit commission rate for this subadmin\n    try {\n      const res = await apiRequest(\"GET\", `/api/subadmin/${user.id}/deposit-commission`);\n      const data = await res.json();\n      if (data && data.commissionRate !== undefined) {\n        setDepositCommissionRate(data.commissionRate / 100); // Convert from basis points to percentage\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch deposit commission:\", error);\n    }\n  };\n  \n  const handleSetDepositCommission = () => {\n    if (!selectedUser || depositCommissionRate < 0 || depositCommissionRate > 100) return;\n    \n    // Convert percentage to basis points (e.g., 5% -> 500)\n    const rateInBasisPoints = Math.round(depositCommissionRate * 100);\n    \n    apiRequest(\"POST\", `/api/subadmin/${selectedUser.id}/deposit-commission`, {\n      commissionRate: rateInBasisPoints\n    })\n    .then(() => {\n      setIsDepositCommissionDialogOpen(false);\n      toast({\n        title: \"Deposit Commission Updated\",\n        description: `Deposit commission for ${selectedUser.username} has been updated successfully.`,\n      });\n    })\n    .catch(error => {\n      toast({\n        title: \"Error\",\n        description: `Failed to update deposit commission: ${error.message}`,\n        variant: \"destructive\",\n      });\n    });\n  };\n\n  const openCommissionDialog = async (user: any) => {\n    setSelectedUser(user);\n    setCommissionRate(0);\n    setSelectedGameType(\"satamatka_jodi\");\n    setIsCommissionDialogOpen(true);\n    \n    // Fetch current commission rates if this is a subadmin\n    if (user.role === UserRole.SUBADMIN) {\n      try {\n        const res = await apiRequest(\"GET\", `/api/commissions/subadmin/${user.id}`);\n        const commissions = await res.json();\n        \n        // Find the commission for the selected game type\n        const commission = commissions.find((c: any) => c.gameType === selectedGameType);\n        if (commission) {\n          setCommissionRate(commission.commissionRate / 100); // Convert from basis points to percentage\n        }\n      } catch (error) {\n        console.error(\"Failed to fetch subadmin commissions:\", error);\n      }\n    }\n  };\n  \n  const openDepositDiscountDialog = async (user: any) => {\n    // Only allow setting deposit discount for players\n    if (user.role !== UserRole.PLAYER) {\n      toast({\n        title: \"Action not allowed\",\n        description: \"Deposit discount can only be set for players\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    setSelectedUser(user);\n    setDepositDiscountRate(0);\n    setIsDepositDiscountDialogOpen(true);\n    \n    // Fetch the current deposit discount for this user\n    try {\n      const res = await apiRequest(\"GET\", `/api/subadmin/deposit-discount/${user.id}`);\n      const data = await res.json();\n      if (data && data.discountRate !== undefined) {\n        setDepositDiscountRate(data.discountRate / 100); // Convert from basis points to percentage\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch deposit discount:\", error);\n    }\n  };\n  \n  const handleSetDepositDiscount = () => {\n    if (!selectedUser || depositDiscountRate < 0 || depositDiscountRate > 100) return;\n    \n    setDepositDiscountMutation.mutate({\n      userId: selectedUser.id,\n      discountRate: depositDiscountRate // Send the direct percentage value (0-100)\n    });\n  };\n  \n  const handleSetCommission = () => {\n    if (!selectedUser || commissionRate < 0) return;\n    \n    setCommissionMutation.mutate({\n      userId: selectedUser.id,\n      gameType: selectedGameType,\n      rate: commissionRate,\n      isSubadmin: selectedUser.role === UserRole.SUBADMIN\n    });\n  };\n  \n  // Handle create user form submission\n  const handleCreateUser = (data: z.infer<typeof createUserSchema>) => {\n    const { confirmPassword, ...userData } = data;\n    createUserMutation.mutate(userData);\n  };\n\n  return (\n    <DashboardLayout title=\"User Management\">\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <CardTitle>User Management</CardTitle>\n              <CardDescription>\n                Manage player accounts, balances, and status\n              </CardDescription>\n            </div>\n            \n            {/* Add User Button - Shown for Admins and Subadmins */}\n            {(user?.role === UserRole.ADMIN || user?.role === UserRole.SUBADMIN) && (\n              <Button\n                onClick={() => setIsCreateUserDialogOpen(true)}\n                className=\"bg-gradient-to-r from-primary to-blue-500 hover:from-primary/90 hover:to-blue-500/90\"\n              >\n                <UserPlus className=\"h-4 w-4 mr-2\" />\n                Add User\n              </Button>\n            )}\n          </div>\n          \n          {/* Search and Filter Controls */}\n          <div className=\"mt-4 flex flex-col sm:flex-row gap-4\">\n            <div className=\"relative flex-1\">\n              <Input\n                type=\"text\"\n                placeholder=\"Search by username...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n              <svg \n                xmlns=\"http://www.w3.org/2000/svg\" \n                className=\"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground\" \n                fill=\"none\" \n                viewBox=\"0 0 24 24\" \n                stroke=\"currentColor\"\n              >\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n              </svg>\n            </div>\n            \n            <div className=\"w-full sm:w-48\">\n              <Select \n                value={roleFilter || \"\"} \n                onValueChange={(value) => setRoleFilter(value === \"\" ? null : value)}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Filter by role\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\" \">All Roles</SelectItem>\n                  <SelectItem value={UserRole.ADMIN}>Admin</SelectItem>\n                  <SelectItem value={UserRole.SUBADMIN}>Subadmin</SelectItem>\n                  <SelectItem value={UserRole.PLAYER}>Player</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto custom-horizontal-scrollbar\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Username</TableHead>\n                    <TableHead>Role</TableHead>\n                    <TableHead>CR</TableHead>\n                    <TableHead>Balance</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredUsers.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={5} className=\"text-center py-4\">\n                        No users found\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    filteredUsers.map((tableUser: any) => (\n                      <TableRow key={tableUser.id}>\n                        <TableCell className=\"font-medium\">\n                          <div className=\"flex items-center gap-2\">\n                            <User className=\"h-4 w-4\" />\n                            {tableUser.username}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={\n                            tableUser.role === UserRole.ADMIN \n                              ? \"default\" \n                              : tableUser.role === UserRole.SUBADMIN \n                                ? \"outline\" \n                                : \"secondary\"\n                          }>\n                            {tableUser.role}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          {(() => {\n                            // Get credit reference from localStorage\n                            const creditRef = localStorage.getItem(`startingBalance_${tableUser.id}`);\n                            return creditRef ? `${creditRef}` : '-';\n                          })()}\n                        </TableCell>\n                        <TableCell>{(tableUser.balance / 100).toFixed(2)}</TableCell>\n                        <TableCell>\n                          {tableUser.isBlocked ? (\n                            <Badge variant=\"destructive\">Blocked</Badge>\n                          ) : (\n                            <Badge variant=\"outline\" className=\"bg-green-500/10 text-green-500 border-green-500/20\">\n                              Active\n                            </Badge>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex space-x-2\">\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => openAddFundsDialog(tableUser)}\n                              title=\"Add funds\"\n                            >\n                              <PlusCircle className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => openRemoveFundsDialog(tableUser)}\n                              title=\"Remove funds\"\n                            >\n                              <MinusCircle className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => openEditUserDialog(tableUser)}\n                              title=\"Edit user\"\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => openUserDetailsDialog(tableUser)}\n                              title=\"View details\"\n                              className=\"text-blue-500 border-blue-500/20 hover:bg-blue-500/10\"\n                            >\n                              <Info className=\"h-4 w-4\" />\n                            </Button>\n                            {/* Show deposit commission button for subadmins - only when logged in as admin */}\n                            {tableUser.role === UserRole.SUBADMIN && user?.role === UserRole.ADMIN && (\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => openDepositCommissionDialog(tableUser)}\n                                title=\"Set Deposit Commission\"\n                                className=\"text-purple-500 border-purple-500/20 hover:bg-purple-500/10\"\n                              >\n                                <IndianRupee className=\"h-4 w-4\" />\n                              </Button>\n                            )}\n                            \n                            {/* Show deposit discount button only for players regardless of who is logged in */}\n                            {tableUser.role === \"player\" && (\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => openDepositDiscountDialog(tableUser)}\n                                title=\"Set Deposit Discount\"\n                                className=\"text-purple-500 border-purple-500/20 hover:bg-purple-500/10\"\n                              >\n                                <Percent className=\"h-4 w-4\" />\n                              </Button>\n                            )}\n                            {/* Don't show block/unblock buttons for admin users */}\n                            {tableUser.role !== UserRole.ADMIN && (\n                              tableUser.isBlocked ? (\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => handleUnblockUser(tableUser.id)}\n                                  className=\"text-green-500 border-green-500/20 hover:bg-green-500/10\"\n                                  title=\"Unblock user\"\n                                >\n                                  <CheckCircle className=\"h-4 w-4\" />\n                                </Button>\n                              ) : (\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => handleBlockUser(tableUser.id)}\n                                  className=\"text-red-500 border-red-500/20 hover:bg-red-500/10\"\n                                  title=\"Block user\"\n                                >\n                                  <Ban className=\"h-4 w-4\" />\n                                </Button>\n                              )\n                            )}\n                            \n                            {/* Delete button - Only for admins or for subadmins' players, never for admin users */}\n                            {(tableUser.role !== UserRole.ADMIN && \n                             (user?.role === UserRole.ADMIN || \n                              (user?.role === UserRole.SUBADMIN && \n                               tableUser.assignedTo === user?.id && \n                               tableUser.role === UserRole.PLAYER))) && (\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => handleDeleteUser(tableUser.id)}\n                                className=\"text-red-500 border-red-500/20 hover:bg-red-500/10\"\n                                title=\"Delete user\"\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            )}\n                            \n                            {/* Reset button - Admin can reset any subadmin/player, Subadmin can reset only their players */}\n                            {(tableUser.role !== UserRole.ADMIN && \n                             ((user?.role === UserRole.ADMIN) || \n                              (user?.role === UserRole.SUBADMIN && \n                               tableUser.assignedTo === user?.id && \n                               tableUser.role === UserRole.PLAYER))) && (\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  setSelectedUser(tableUser);\n                                  setIsResetAccountDialogOpen(true);\n                                  setResetConfirmationText(\"\");\n                                }}\n                                className=\"bg-orange-500/10 text-orange-500 border-orange-500/20 hover:bg-orange-500/20\"\n                                title=\"Reset account\"\n                              >\n                                <RefreshCw className=\"h-4 w-4\" />\n                              </Button>\n                            )}\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n      \n      {/* Add Funds Dialog */}\n      <Dialog open={isAddFundsDialogOpen} onOpenChange={setIsAddFundsDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Add Funds</DialogTitle>\n            <DialogDescription>\n              Add funds to {selectedUser?.username}'s account\n              {selectedUser && (\n                <span className=\"block mt-2 text-sm font-medium text-blue-600\">\n                  Current Balance: {selectedUser.balance / 100}\n                </span>\n              )}\n              {user?.role === UserRole.ADMIN && selectedUser?.role === UserRole.SUBADMIN && (\n                <span className=\"block mt-2 text-sm font-medium text-yellow-600\">\n                  Note: Commission rate of {selectedSubadminCommissionRate !== null ? `${selectedSubadminCommissionRate}%` : \"...\"} applies to this transfer\n                </span>\n              )}\n              {user?.role === UserRole.SUBADMIN && selectedUser?.role === UserRole.PLAYER && depositDiscountRate > 0 && (\n                <span className=\"block mt-2 text-sm font-medium text-green-600\">\n                  Note: Deposit discount of {depositDiscountRate}% applies to this player\n                </span>\n              )}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4 space-y-4\">\n            <div>\n              <Label htmlFor=\"amount\">Amount</Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <IndianRupee className=\"h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  value={amount}\n                  onChange={(e) => setAmount(Number(e.target.value))}\n                  placeholder=\"Amount in rupees\"\n                  min=\"0\"\n                  step=\"1\"\n                />\n              </div>\n              {user?.role === UserRole.ADMIN && selectedUser?.role === UserRole.SUBADMIN && selectedSubadminCommissionRate !== null && amount > 0 && (\n                <div className=\"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-md text-sm\">\n                  <p className=\"text-yellow-800\">\n                    <span className=\"font-medium\">Commission calculation:</span> \n                    <br />\n                    Subadmin receives: {amount.toFixed(2)}\n                    <br />\n                    Admin pays: {((amount * selectedSubadminCommissionRate) / 100).toFixed(2)} ({selectedSubadminCommissionRate}% of {amount.toFixed(2)})\n                  </p>\n                </div>\n              )}\n              \n              {user?.role === UserRole.SUBADMIN && selectedUser?.role === UserRole.PLAYER && depositDiscountRate > 0 && amount > 0 && (\n                <div className=\"mt-2 p-2 bg-green-50 border border-green-200 rounded-md text-sm\">\n                  <p className=\"text-green-800\">\n                    <span className=\"font-medium\">Discount calculation:</span> \n                    <br />\n                    Base amount: {amount.toFixed(2)}\n                    <br />\n                    Bonus ({depositDiscountRate}%): {((amount * depositDiscountRate) / 100).toFixed(2)}\n                    <br />\n                    <span className=\"font-medium\">Player receives: {(amount + (amount * depositDiscountRate) / 100).toFixed(2)}</span>\n                  </p>\n                </div>\n              )}\n            </div>\n            \n            {/* Credit Balance Reference Field */}\n            <div>\n              <Label htmlFor=\"starting-balance\">Credit Balance Reference (Optional)</Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <IndianRupee className=\"h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"starting-balance\"\n                  type=\"number\"\n                  value={startingBalance}\n                  onChange={(e) => setStartingBalance(e.target.value)}\n                  placeholder=\"Starting balance for reference only\"\n                  min=\"0\"\n                  step=\"1\"\n                />\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                This is for your reference only. It doesn't affect the actual transaction.\n              </p>\n            </div>\n            \n            <div>\n              <Label htmlFor=\"remark\">Remark (Optional)</Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <MessageSquare className=\"h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"remark\"\n                  type=\"text\"\n                  value={remark}\n                  onChange={(e) => setRemark(e.target.value)}\n                  placeholder=\"Add a remark for this transaction\"\n                />\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => {\n              setIsAddFundsDialogOpen(false);\n              setRemark(\"\");\n            }}>\n              Cancel\n            </Button>\n            <Button onClick={handleAddFunds} disabled={amount <= 0 || updateBalanceMutation.isPending}>\n              {updateBalanceMutation.isPending ? \"Processing...\" : \"Add Funds\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Remove Funds Dialog */}\n      <Dialog open={isRemoveFundsDialogOpen} onOpenChange={setIsRemoveFundsDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Remove Funds</DialogTitle>\n            <DialogDescription>\n              Remove funds from {selectedUser?.username}'s account\n              {selectedUser && (\n                <span className=\"block mt-2 text-sm font-medium text-blue-600\">\n                  Current Balance: {selectedUser.balance / 100}\n                </span>\n              )}\n              {user?.role === UserRole.ADMIN && selectedUser?.role === UserRole.SUBADMIN && (\n                <span className=\"block mt-2 text-sm font-medium text-yellow-600\">\n                  Note: Commission rate of {selectedSubadminCommissionRate !== null ? `${selectedSubadminCommissionRate}%` : \"...\"} applies to this withdrawal\n                </span>\n              )}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4 space-y-4\">\n            <div>\n              <Label htmlFor=\"remove-amount\">Amount</Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <IndianRupee className=\"h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"remove-amount\"\n                  type=\"number\"\n                  value={amount}\n                  onChange={(e) => setAmount(Number(e.target.value))}\n                  placeholder=\"Amount in rupees\"\n                  min=\"0\"\n                  max={selectedUser ? selectedUser.balance / 100 : 0}\n                  step=\"1\"\n                />\n              </div>\n              {user?.role === UserRole.ADMIN && selectedUser?.role === UserRole.SUBADMIN && selectedSubadminCommissionRate !== null && amount > 0 && (\n                <div className=\"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-md text-sm\">\n                  <p className=\"text-yellow-800\">\n                    <span className=\"font-medium\">Commission calculation:</span> \n                    <br />\n                    Subadmin pays: {amount.toFixed(2)}\n                    <br />\n                    Admin receives: {((amount * selectedSubadminCommissionRate) / 100).toFixed(2)} ({selectedSubadminCommissionRate}% of {amount.toFixed(2)})\n                  </p>\n                </div>\n              )}\n            </div>\n            {/* Credit Balance Reference Field */}\n            <div>\n              <Label htmlFor=\"remove-starting-balance\">Credit Balance Reference (Optional)</Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <IndianRupee className=\"h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"remove-starting-balance\"\n                  type=\"number\"\n                  value={startingBalance}\n                  onChange={(e) => setStartingBalance(e.target.value)}\n                  placeholder=\"Starting balance for reference only\"\n                />\n              </div>\n              <p className=\"mt-1 text-xs text-muted-foreground\">\n                This is just for your reference and doesn't affect the transaction\n              </p>\n            </div>\n\n            <div>\n              <Label htmlFor=\"remove-remark\">Remark (Optional)</Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <MessageSquare className=\"h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"remove-remark\"\n                  type=\"text\"\n                  value={remark}\n                  onChange={(e) => setRemark(e.target.value)}\n                  placeholder=\"Add a remark for this transaction\"\n                />\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => {\n              setIsRemoveFundsDialogOpen(false);\n              setRemark(\"\");\n            }}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleRemoveFunds} \n              disabled={amount <= 0 || updateBalanceMutation.isPending || (selectedUser && amount > selectedUser.balance / 100)}\n              variant=\"destructive\"\n            >\n              {updateBalanceMutation.isPending ? \"Processing...\" : \"Remove Funds\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit User Dialog */}\n      <Dialog open={isEditUserDialogOpen} onOpenChange={setIsEditUserDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit User</DialogTitle>\n            <DialogDescription>\n              {user?.role === UserRole.ADMIN \n                ? `Update ${selectedUser?.username}'s account information`\n                : `Update ${selectedUser?.username}'s password`}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4 space-y-4\">\n            {/* Username field - only visible to admins */}\n            {user?.role === UserRole.ADMIN && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username\">Username</Label>\n                <div className=\"flex items-center gap-2\">\n                  <User className=\"h-5 w-5 text-muted-foreground\" />\n                  <Input\n                    id=\"username\"\n                    value={username}\n                    onChange={(e) => setUsername(e.target.value)}\n                    placeholder=\"New username\"\n                  />\n                </div>\n              </div>\n            )}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Password</Label>\n              <div className=\"flex items-center gap-2\">\n                <Key className=\"h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  placeholder=\"New password\"\n                />\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsEditUserDialogOpen(false)}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleEditUser} \n              disabled={\n                (user?.role === UserRole.ADMIN \n                  ? (!username.trim() && !password.trim()) \n                  : !password.trim()\n                ) || editUserMutation.isPending\n              }\n            >\n              {editUserMutation.isPending ? \"Processing...\" : \"Update User\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Create User Dialog */}\n      <Dialog open={isCreateUserDialogOpen} onOpenChange={setIsCreateUserDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Create New User</DialogTitle>\n            <DialogDescription>\n              Create a new player account that will be assigned to you.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <Form {...createUserForm}>\n            <form onSubmit={createUserForm.handleSubmit(handleCreateUser)} className=\"space-y-4\">\n              <FormField\n                control={createUserForm.control}\n                name=\"username\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Username</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter username\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={createUserForm.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input type=\"email\" placeholder=\"Enter email address\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={createUserForm.control}\n                name=\"mobile\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Mobile Number</FormLabel>\n                    <FormControl>\n                      <Input type=\"tel\" placeholder=\"Enter mobile number\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={createUserForm.control}\n                name=\"password\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Password</FormLabel>\n                    <FormControl>\n                      <Input type=\"password\" placeholder=\"Enter password\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={createUserForm.control}\n                name=\"confirmPassword\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Confirm Password</FormLabel>\n                    <FormControl>\n                      <Input type=\"password\" placeholder=\"Confirm password\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={createUserForm.control}\n                name=\"rewardCommission\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Reward Commission (%)</FormLabel>\n                    <FormControl>\n                      <div className=\"flex items-center gap-2\">\n                        <Input \n                          type=\"number\" \n                          placeholder=\"e.g., 5.00\" \n                          step=\"0.01\"\n                          min=\"0\"\n                          max=\"100\"\n                          {...field} \n                          data-testid=\"input-create-user-reward-commission\"\n                        />\n                        <span className=\"text-muted-foreground\">%</span>\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setIsCreateUserDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={createUserMutation.isPending}>\n                  {createUserMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Create User\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Deposit Discount Dialog */}\n      {/* Reset Account Dialog */}\n      <Dialog open={isResetAccountDialogOpen} onOpenChange={setIsResetAccountDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-center\">Reset Account</DialogTitle>\n            <DialogDescription className=\"text-center\">\n              {selectedUser && (\n                <>\n                  Reset account for <span className=\"font-semibold\">{selectedUser.username}</span>\n                  {selectedUser.role === UserRole.SUBADMIN && (\n                    <span> (subadmin) and all players assigned to them</span>\n                  )}\n                  {selectedUser.role === UserRole.PLAYER && (\n                    <span> (player)</span>\n                  )}\n                </>\n              )}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"p-4 space-y-4\">\n            <div className=\"bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-md text-yellow-800 dark:text-yellow-200 text-sm\">\n              <p className=\"font-medium mb-2\">This will:</p>\n              <ul className=\"list-disc pl-5 space-y-1\">\n                <li>Reset account balance to zero</li>\n                <li>Delete all transaction history</li>\n                <li>Clear all game play history</li>\n                {selectedUser?.role === UserRole.SUBADMIN && (\n                  <li>Reset all players assigned to this subadmin</li>\n                )}\n              </ul>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"resetConfirmation\">\n                Type <span className=\"font-semibold\">RESET</span> to confirm\n              </Label>\n              <Input \n                id=\"resetConfirmation\"\n                value={resetConfirmationText}\n                onChange={(e) => setResetConfirmationText(e.target.value)}\n                placeholder=\"RESET\"\n              />\n            </div>\n          </div>\n          \n          <DialogFooter className=\"flex-col sm:flex-row sm:justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setIsResetAccountDialogOpen(false)}\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleResetAccount}\n              disabled={resetConfirmationText !== \"RESET\"}\n            >\n              Reset Account\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Delete Confirmation Dialog */}\n      <ConfirmDialog\n        isOpen={isDeleteConfirmOpen}\n        onClose={() => setIsDeleteConfirmOpen(false)}\n        onConfirm={confirmDeleteUser}\n        title=\"Delete User\"\n        description=\"Are you sure you want to delete this user? This action cannot be undone.\"\n        confirmText=\"Delete\"\n        cancelText=\"Cancel\"\n        variant=\"destructive\"\n      />\n      \n      <Dialog open={isDepositDiscountDialogOpen} onOpenChange={setIsDepositDiscountDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Set Deposit Discount Rate</DialogTitle>\n            <DialogDescription>\n              Set deposit discount rate for {selectedUser?.username}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4 space-y-4\">\n            <div>\n              <Label htmlFor=\"deposit-discount-rate\">Deposit Discount Rate (%)</Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <Percent className=\"h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"deposit-discount-rate\"\n                  type=\"number\"\n                  value={depositDiscountRate}\n                  onChange={(e) => setDepositDiscountRate(Number(e.target.value))}\n                  placeholder=\"Rate in percentage\"\n                  min=\"0\"\n                  max=\"100\"\n                />\n              </div>\n              <p className=\"text-sm text-muted-foreground mt-2\">\n                This discount will be applied when you add funds to this player's account.\n              </p>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsDepositDiscountDialogOpen(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleSetDepositDiscount}>\n              Save\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Deposit Commission Dialog for Subadmins */}\n      <Dialog open={isDepositCommissionDialogOpen} onOpenChange={setIsDepositCommissionDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Deposit Commission Settings</DialogTitle>\n            <DialogDescription>\n              Configure deposit commission rate for {selectedUser?.username}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4 space-y-4\">\n            <div className=\"bg-secondary/50 p-4 rounded-lg space-y-2\">\n              <div className=\"flex items-center gap-2\">\n                <AlertCircle className=\"h-5 w-5 text-primary\" />\n                <span className=\"font-medium\">Important information</span>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                This commission rate determines the percentage applied during fund transfers between admin and subadmin:\n              </p>\n              <ul className=\"list-disc pl-5 text-sm text-muted-foreground space-y-1\">\n                <li>When admin adds funds to subadmin: Full amount goes to subadmin but only commission percentage is deducted from admin.</li>\n                <li>When admin removes funds from subadmin: Full amount is removed from subadmin but only commission percentage is added to admin.</li>\n              </ul>\n            </div>\n            \n            <div>\n              <Label htmlFor=\"deposit-commission-rate\">Deposit Commission Rate</Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <Input\n                  id=\"deposit-commission-rate\"\n                  type=\"number\"\n                  value={depositCommissionRate}\n                  onChange={(e) => setDepositCommissionRate(Number(e.target.value))}\n                  placeholder=\"0\"\n                  min=\"0\"\n                  max=\"100\"\n                />\n                <span className=\"text-muted-foreground\">%</span>\n              </div>\n              <p className=\"text-sm text-muted-foreground mt-2\">\n                Set the commission rate between 0% and 100%.\n              </p>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsDepositCommissionDialogOpen(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleSetDepositCommission} className=\"flex items-center gap-2\">\n              <Save className=\"h-4 w-4\" />\n              Save Commission Settings\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Commission Dialog */}\n      <Dialog open={isCommissionDialogOpen} onOpenChange={setIsCommissionDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>\n              {selectedUser?.role === UserRole.SUBADMIN ? \"Set Commission Rate\" : \"Set Discount Rate\"}\n            </DialogTitle>\n            <DialogDescription>\n              {selectedUser?.role === UserRole.SUBADMIN \n                ? `Set commission rates for ${selectedUser?.username}` \n                : `Set discount rates for ${selectedUser?.username}`}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4 space-y-4\">\n            <div>\n              <Label htmlFor=\"game-type\">Game Type</Label>\n              <Select value={selectedGameType} onValueChange={setSelectedGameType}>\n                <SelectTrigger className=\"w-full mt-2\">\n                  <SelectValue placeholder=\"Select game type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"satamatka_jodi\">Satamatka - Jodi</SelectItem>\n                  <SelectItem value=\"satamatka_harf\">Satamatka - Harf</SelectItem>\n                  <SelectItem value=\"satamatka_crossing\">Satamatka - Crossing</SelectItem>\n                  <SelectItem value=\"satamatka_odd_even\">Satamatka - Odd Even</SelectItem>\n                  <SelectItem value=\"cricket_toss\">Cricket Toss</SelectItem>\n                  <SelectItem value=\"team_match\">Team Match</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"commission-rate\">\n                {selectedUser?.role === UserRole.SUBADMIN ? \"Commission Rate (%)\" : \"Discount Rate (%)\"}\n              </Label>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <Percent className=\"h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"commission-rate\"\n                  type=\"number\"\n                  value={commissionRate}\n                  onChange={(e) => setCommissionRate(Number(e.target.value))}\n                  placeholder=\"Rate in percentage\"\n                  min=\"0\"\n                  max=\"100\"\n                  step=\"0.01\"\n                />\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                {selectedUser?.role === UserRole.SUBADMIN \n                  ? \"Commission is calculated as a percentage of player's betting amount.\"\n                  : \"Discount reduces the player's betting amount, increasing potential winnings.\"}\n              </p>\n            </div>\n            \n            {/* Display existing commission/discount rates if available */}\n            {!isLoadingCommissions && userCommissions.length > 0 && (\n              <div className=\"mt-4\">\n                <h4 className=\"text-sm font-medium mb-2\">Current Rates:</h4>\n                <div className=\"space-y-1\">\n                  {userCommissions.map((commission: any) => (\n                    <div key={commission.id} className=\"flex justify-between text-sm\">\n                      <span>{commission.gameType.replace('_', ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase())}</span>\n                      <span className=\"font-medium\">{(commission.commissionRate / 100).toFixed(2)}%</span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsCommissionDialogOpen(false)}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleSetCommission} \n              disabled={commissionRate < 0 || commissionRate > 100 || setCommissionMutation.isPending}\n            >\n              {setCommissionMutation.isPending ? \"Processing...\" : \"Save Rate\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n      \n      {/* User Details Dialog */}\n      <Dialog \n        open={isUserDetailsDialogOpen} \n        onOpenChange={setIsUserDetailsDialogOpen}\n      >\n        <DialogContent className=\"max-w-[95vw] w-[95vw] md:max-w-[90vw] md:w-[90vw] max-h-[90vh] overflow-hidden flex flex-col\">\n          <DialogHeader>\n            <DialogTitle>User Details: {selectedUser?.username}</DialogTitle>\n            <DialogDescription>\n              View transaction history, bet history, and active bets\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"w-full flex-1 flex flex-col overflow-hidden\">\n            <div className=\"grid grid-cols-3 border-b mb-4 w-full\">\n              <button \n                type=\"button\"\n                className={`px-1 sm:px-4 py-2 flex items-center justify-center gap-1 sm:gap-2 ${detailsTab === \"transactions\" ? \"border-b-2 border-primary font-medium\" : \"\"}`}\n                onClick={() => setDetailsTab(\"transactions\")}\n              >\n                <History className=\"h-4 w-4 flex-shrink-0\" />\n                <span className=\"text-xs sm:text-sm truncate\">Transactions</span>\n              </button>\n              <button \n                type=\"button\"\n                className={`px-1 sm:px-4 py-2 flex items-center justify-center gap-1 sm:gap-2 ${detailsTab === \"bets\" ? \"border-b-2 border-primary font-medium\" : \"\"}`}\n                onClick={() => setDetailsTab(\"bets\")}\n              >\n                <FileText className=\"h-4 w-4 flex-shrink-0\" />\n                <span className=\"text-xs sm:text-sm truncate\">Bet History</span>\n              </button>\n              <button \n                type=\"button\"\n                className={`px-1 sm:px-4 py-2 flex items-center justify-center gap-1 sm:gap-2 ${detailsTab === \"active-bets\" ? \"border-b-2 border-primary font-medium\" : \"\"}`}\n                onClick={() => setDetailsTab(\"active-bets\")}\n              >\n                <BarChart className=\"h-4 w-4 flex-shrink-0\" />\n                <span className=\"text-xs sm:text-sm truncate\">Active Bets</span>\n              </button>\n            </div>\n            \n            <div className=\"flex-1 overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-800/30 overflow-x-auto custom-horizontal-scrollbar\">\n              {/* Transactions Tab */}\n              {detailsTab === \"transactions\" && (\n                <div className=\"py-4\">\n                  {isLoadingTransactions ? (\n                    <div className=\"flex justify-center py-8\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : userTransactions.length === 0 ? (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      No transaction history found\n                    </div>\n                  ) : (\n                    <>\n                      <div className=\"overflow-x-auto custom-horizontal-scrollbar\">\n                        <Table>\n                          <TableHeader>\n                            <TableRow>\n                              <TableHead className=\"whitespace-nowrap\">Date</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Type</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Amount</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Description</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {getPaginatedItems(userTransactions, transactionsPage).map((transaction: any) => (\n                              <TableRow key={transaction.id}>\n                                <TableCell className=\"whitespace-nowrap\">\n                                  {new Date(transaction.createdAt).toLocaleString()}\n                                </TableCell>\n                                <TableCell>\n                                  <Badge variant={transaction.amount > 0 ? \"outline\" : \"secondary\"}>\n                                    <div className=\"flex items-center gap-1\">\n                                      {transaction.amount > 0 ? (\n                                        <ArrowUp className=\"h-3 w-3 text-green-500\" />\n                                      ) : (\n                                        <ArrowDown className=\"h-3 w-3 text-red-500\" />\n                                      )}\n                                      {transaction.amount > 0 ? \"Deposit\" : \"Withdrawal\"}\n                                    </div>\n                                  </Badge>\n                                </TableCell>\n                                <TableCell className={transaction.amount > 0 ? \"text-green-500\" : \"text-red-500\"}>\n                                  {transaction.amount > 0 ? \"+\" : \"\"}{(transaction.amount / 100).toFixed(2)}\n                                </TableCell>\n                                <TableCell>{transaction.description || \"Balance update\"}</TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </div>\n                      \n                      {/* Pagination Controls */}\n                      {userTransactions.length > itemsPerPage && (\n                        <div className=\"flex items-center justify-center mt-4 gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setTransactionsPage(p => Math.max(1, p - 1))}\n                            disabled={transactionsPage === 1}\n                          >\n                            <ChevronLeft className=\"h-4 w-4\" />\n                          </Button>\n                          <span className=\"text-sm\">\n                            Page {transactionsPage} of {getPageCount(userTransactions.length)}\n                          </span>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setTransactionsPage(p => Math.min(getPageCount(userTransactions.length), p + 1))}\n                            disabled={transactionsPage === getPageCount(userTransactions.length)}\n                          >\n                            <ChevronRight className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n              )}\n              \n              {/* Bet History Tab */}\n              {detailsTab === \"bets\" && (\n                <div className=\"py-4\">\n                  {isLoadingGames ? (\n                    <div className=\"flex justify-center py-8\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : userGames.length === 0 ? (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      No bet history found\n                    </div>\n                  ) : (\n                    <>\n                      <div className=\"overflow-x-auto custom-horizontal-scrollbar\">\n                        <Table>\n                          <TableHeader>\n                            <TableRow>\n                              <TableHead className=\"whitespace-nowrap\">Date</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Game</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Bet Amount</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Prediction</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Result</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Payout</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {getPaginatedItems(userGames, betsPage).map((game: any) => (\n                              <TableRow key={game.id}>\n                                <TableCell className=\"whitespace-nowrap\">\n                                  {new Date(game.createdAt).toLocaleString()}\n                                </TableCell>\n                                <TableCell className=\"capitalize\">\n                                  {game.gameType?.replace(/_/g, ' ') || \"Coin Flip\"}\n                                </TableCell>\n                                <TableCell>{(game.betAmount / 100).toFixed(2)}</TableCell>\n                                <TableCell>{game.prediction}</TableCell>\n                                <TableCell>{game.result || \"Pending\"}</TableCell>\n                                <TableCell className={(game.payout || 0) > 0 ? \"text-green-500\" : \"text-red-500\"}>\n                                  {(game.payout || 0) > 0 ? `+${(game.payout / 100).toFixed(2)}` : \"0.00\"}\n                                </TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </div>\n                      \n                      {/* Pagination Controls */}\n                      {userGames.length > itemsPerPage && (\n                        <div className=\"flex items-center justify-center mt-4 gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setBetsPage(p => Math.max(1, p - 1))}\n                            disabled={betsPage === 1}\n                          >\n                            <ChevronLeft className=\"h-4 w-4\" />\n                          </Button>\n                          <span className=\"text-sm\">\n                            Page {betsPage} of {getPageCount(userGames.length)}\n                          </span>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setBetsPage(p => Math.min(getPageCount(userGames.length), p + 1))}\n                            disabled={betsPage === getPageCount(userGames.length)}\n                          >\n                            <ChevronRight className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n              )}\n              \n              {/* Active Bets Tab */}\n              {detailsTab === \"active-bets\" && (\n                <div className=\"py-4\">\n                  {isLoadingActiveBets ? (\n                    <div className=\"flex justify-center py-8\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : userActiveBets.length === 0 ? (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      No active bets found\n                    </div>\n                  ) : (\n                    <>\n                      <div className=\"overflow-x-auto custom-horizontal-scrollbar\">\n                        <Table>\n                          <TableHeader>\n                            <TableRow>\n                              <TableHead className=\"whitespace-nowrap\">Date</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Game</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Bet Amount</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Prediction</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Game Details</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">Status</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {getPaginatedItems(userActiveBets, activeBetsPage).map((game: any) => (\n                              <TableRow key={game.id} className=\"bg-slate-800/10 hover:bg-slate-800/30\">\n                                <TableCell className=\"whitespace-nowrap\">\n                                  {new Date(game.createdAt).toLocaleString()}\n                                </TableCell>\n                                <TableCell>\n                                  <Badge variant=\"outline\" className=\"capitalize\">\n                                    {game.gameType.replace(/_/g, ' ')}\n                                  </Badge>\n                                </TableCell>\n                                <TableCell className=\"font-medium\">\n                                  {(game.betAmount / 100).toFixed(2)}\n                                </TableCell>\n                                <TableCell>\n                                  {game.gameType === 'cricket_toss' || game.gameType === 'team_match' ? (\n                                    <>\n                                      {game.prediction === 'team_a' && (game.game_data || game.match) ? (\n                                        <Badge className=\"bg-green-600\">\n                                          {game.game_data?.teamA || game.match?.teamA}\n                                        </Badge>\n                                      ) : game.prediction === 'team_b' && (game.game_data || game.match) ? (\n                                        <Badge className=\"bg-blue-600\">\n                                          {game.game_data?.teamB || game.match?.teamB}\n                                        </Badge>\n                                      ) : (\n                                        <span className=\"capitalize\">{game.prediction}</span>\n                                      )}\n                                    </>\n                                  ) : (\n                                    <span className=\"capitalize\">{game.prediction}</span>\n                                  )}\n                                </TableCell>\n                                <TableCell>\n                                  {(game.gameType === 'cricket_toss' || game.gameType === 'team_match') && (game.game_data || game.match) && (\n                                    <div className=\"text-xs space-y-1\">\n                                      <div>\n                                        <Badge variant=\"secondary\" className=\"mb-1\">Match</Badge> {game.game_data?.teamA || game.match?.teamA} vs {game.game_data?.teamB || game.match?.teamB}\n                                      </div>\n                                    </div>\n                                  )}\n                                  {game.gameType === 'coinflip' && (\n                                    <span className=\"capitalize text-xs\">\n                                      <Badge variant=\"secondary\">{game.prediction}</Badge>\n                                    </span>\n                                  )}\n                                  {game.gameType.includes('satamatka') && game.market_id && (\n                                    <div className=\"text-xs\">\n                                      <Badge variant=\"secondary\">Market ID: {game.market_id}</Badge>\n                                    </div>\n                                  )}\n                                </TableCell>\n                                <TableCell>\n                                  <Badge variant=\"secondary\" className=\"flex items-center gap-1 whitespace-nowrap\">\n                                    <Clock className=\"h-3 w-3 animate-pulse text-yellow-500\" />\n                                    Pending\n                                  </Badge>\n                                </TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </div>\n                      \n                      {/* Pagination Controls */}\n                      {userActiveBets.length > itemsPerPage && (\n                        <div className=\"flex items-center justify-center mt-4 gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setActiveBetsPage(p => Math.max(1, p - 1))}\n                            disabled={activeBetsPage === 1}\n                          >\n                            <ChevronLeft className=\"h-4 w-4\" />\n                          </Button>\n                          <span className=\"text-sm\">\n                            Page {activeBetsPage} of {getPageCount(userActiveBets.length)}\n                          </span>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setActiveBetsPage(p => Math.min(getPageCount(userActiveBets.length), p + 1))}\n                            disabled={activeBetsPage === getPageCount(userActiveBets.length)}\n                          >\n                            <ChevronRight className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n          \n          <DialogFooter className=\"mt-2\">\n            <Button variant=\"outline\" onClick={() => setIsUserDetailsDialogOpen(false)}>\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":88007,"size_tokens":null},"remove-cricket-toss-data.js":{"content":"/**\n * This script removes all cricket toss game data from the database.\n * It's part of the process of removing the cricket toss feature from the platform.\n */\n\nimport pg from 'pg';\nimport 'dotenv/config';\n\nconst { Pool } = pg;\n\nasync function connectToDatabase() {\n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n  });\n\n  try {\n    await pool.query('SELECT NOW()');\n    console.log('Database connection established');\n    return pool;\n  } catch (err) {\n    console.error('Error connecting to the database:', err);\n    process.exit(1);\n  }\n}\n\nasync function removeCricketTossData(pool) {\n  const client = await pool.connect();\n  try {\n    await client.query('BEGIN');\n\n    // 1. Check how many cricket toss games exist\n    const gameCountResult = await client.query(\n      \"SELECT COUNT(*) FROM games WHERE game_type = 'cricket_toss'\"\n    );\n    const gameCount = parseInt(gameCountResult.rows[0].count);\n    console.log(`Found ${gameCount} cricket toss games to remove`);\n\n    if (gameCount > 0) {\n      // 2. Get details of the games for logging\n      const gameDetails = await client.query(\n        \"SELECT id, user_id, bet_amount, prediction, result, created_at FROM games WHERE game_type = 'cricket_toss'\"\n      );\n      console.log('Games to be removed:');\n      gameDetails.rows.forEach(game => {\n        console.log(`- Game #${game.id} created on ${game.created_at}`);\n      });\n\n      // 3. Remove the cricket toss games\n      const deleteResult = await client.query(\n        \"DELETE FROM games WHERE game_type = 'cricket_toss' RETURNING id\"\n      );\n      console.log(`Deleted ${deleteResult.rowCount} cricket toss games`);\n    }\n\n    // 4. Remove cricket_toss from game_odds if they exist\n    const oddsResult = await client.query(\n      \"DELETE FROM game_odds WHERE game_type = 'cricket_toss' RETURNING id\"\n    );\n    console.log(`Deleted ${oddsResult.rowCount} cricket toss odds settings`);\n\n    // 5. Remove cricket_toss from subadmin_commissions if they exist\n    const commissionsResult = await client.query(\n      \"DELETE FROM subadmin_commissions WHERE game_type = 'cricket_toss' RETURNING id\"\n    );\n    console.log(`Deleted ${commissionsResult.rowCount} cricket toss commission settings`);\n\n    // 6. Remove any cricket_toss related settings from system_settings if they exist\n    const settingsResult = await client.query(\n      \"DELETE FROM system_settings WHERE setting_key LIKE '%cricket_toss%' RETURNING id\"\n    );\n    console.log(`Deleted ${settingsResult.rowCount} cricket toss system settings`);\n\n    // 7. Check for user_discounts with cricket_toss and remove them\n    const discountsResult = await client.query(\n      \"DELETE FROM user_discounts WHERE game_type = 'cricket_toss' RETURNING id\"\n    );\n    console.log(`Deleted ${discountsResult.rowCount} cricket toss user discounts`);\n\n    await client.query('COMMIT');\n    console.log('Cricket toss data cleanup completed successfully');\n  } catch (err) {\n    await client.query('ROLLBACK');\n    console.error('Error removing cricket toss data:', err);\n    throw err;\n  } finally {\n    client.release();\n  }\n}\n\nasync function main() {\n  let pool;\n  try {\n    pool = await connectToDatabase();\n    await removeCricketTossData(pool);\n    console.log('Cricket toss data cleanup completed');\n  } catch (err) {\n    console.error('Error in cleanup process:', err);\n    process.exit(1);\n  } finally {\n    if (pool) {\n      await pool.end();\n    }\n  }\n}\n\nmain();","path":null,"size_bytes":3461,"size_tokens":null},"add-test-games.js":{"content":"/**\n * This script adds test game data to help test profit/loss calculations\n * It will create sample coin flip games with predefined outcomes\n */\n\nimport 'dotenv/config';\nimport pg from 'pg';\nconst { Pool } = pg;\n\nasync function addTestGames() {\n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n  });\n\n  try {\n    console.log('Connecting to database...');\n    const client = await pool.connect();\n    \n    try {\n      console.log('Starting transaction...');\n      await client.query('BEGIN');\n\n      // First, get a list of player users\n      const usersResult = await client.query(`\n        SELECT id, username, role \n        FROM users \n        WHERE role = 'player' AND assigned_to IS NOT NULL\n      `);\n      \n      if (usersResult.rows.length === 0) {\n        console.log('No player users found with an assigned subadmin.');\n        return;\n      }\n      \n      console.log(`Found ${usersResult.rows.length} player users.`);\n      \n      // Get the latest balance for each user (should be 0 after reset)\n      const players = [];\n      for (const user of usersResult.rows) {\n        const balanceResult = await client.query(`\n          SELECT balance FROM users WHERE id = $1\n        `, [user.id]);\n        \n        players.push({\n          ...user,\n          balance: balanceResult.rows[0].balance\n        });\n        \n        console.log(`Player ${user.username} (ID: ${user.id}) has balance: ${balanceResult.rows[0].balance}`);\n      }\n      \n      // Add credits to each player first\n      for (const player of players) {\n        const creditAmount = 1000000; // 10,000.00\n        await client.query(`\n          UPDATE users SET balance = balance + $1 WHERE id = $2\n        `, [creditAmount, player.id]);\n        \n        // Record the transaction\n        await client.query(`\n          INSERT INTO transactions \n          (user_id, amount, description, performed_by, balance_after, created_at)\n          VALUES ($1, $2, $3, $4, $5, NOW())\n        `, [player.id, creditAmount, 'Deposit for testing', player.id, creditAmount]);\n        \n        console.log(`Added ${creditAmount} to player ${player.username}`);\n      }\n      \n      // Now create some test games for each player\n      const initialBalance = 1000000; // Initial balance after deposit\n      for (const player of players) {\n        let currentBalance = initialBalance; // Starting with the deposit\n        \n        // Create 5 winning games\n        for (let i = 0; i < 5; i++) {\n          const betAmount = 50000; // 500.00\n          currentBalance -= betAmount; // Deduct bet amount\n          const payout = 95000; // 950.00 (win)\n          currentBalance += payout; // Add payout for wins\n          \n          console.log(`Creating winning game for ${player.username}, bet: ${betAmount}, payout: ${payout}, balance: ${currentBalance}`);\n          \n          await client.query(`\n            INSERT INTO games\n            (user_id, game_type, bet_amount, prediction, result, payout, balance_after, created_at)\n            VALUES ($1, $2, $3, $4, $5, $6, $7, NOW() - INTERVAL '${5-i} hours')\n          `, [player.id, 'coin_flip', betAmount, 'heads', 'win', payout, currentBalance]);\n        }\n        \n        // Create 5 losing games\n        for (let i = 0; i < 5; i++) {\n          const betAmount = 40000; // 400.00\n          currentBalance -= betAmount; // Deduct bet amount\n          const payout = 0; // 0.00 (loss)\n          \n          console.log(`Creating losing game for ${player.username}, bet: ${betAmount}, payout: ${payout}, balance: ${currentBalance}`);\n          \n          await client.query(`\n            INSERT INTO games\n            (user_id, game_type, bet_amount, prediction, result, payout, balance_after, created_at)\n            VALUES ($1, $2, $3, $4, $5, $6, $7, NOW() - INTERVAL '${i} hours')\n          `, [player.id, 'coin_flip', betAmount, 'tails', 'loss', payout, currentBalance]);\n        }\n      }\n      \n      await client.query('COMMIT');\n      console.log('Transaction committed successfully!');\n    } catch (err) {\n      await client.query('ROLLBACK');\n      console.error('Error occurred, transaction rolled back:', err);\n      throw err;\n    } finally {\n      client.release();\n    }\n  } catch (err) {\n    console.error('Database connection error:', err);\n  } finally {\n    await pool.end();\n    console.log('Done. Pool has ended.');\n  }\n}\n\naddTestGames()\n  .then(() => console.log('Test games have been added successfully.'))\n  .catch(err => console.error('Failed to add test games:', err));","path":null,"size_bytes":4542,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/pages/game-history-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport GameHistoryTable from \"@/components/game-history-table\";\nimport { format, subDays, isWithinInterval, parseISO } from \"date-fns\";\nimport { DateRange } from \"react-day-picker\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n  CardFooter,\n} from \"@/components/ui/card\";\nimport {\n  Select,\n  SelectContent,\n  SelectGroup,\n  SelectItem,\n  SelectLabel,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Pagination,\n  PaginationContent,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n} from \"@/components/ui/pagination\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { DateRangePicker } from \"@/components/date-range-picker\";\nimport { Search, Filter, X, Calendar, ArrowDownUp } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\nimport { Calendar as CalendarComponent } from \"@/components/ui/calendar\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\n\n\n\nexport default function GameHistoryPage() {\n  const { user } = useAuth();\n  \n  // Import Game type from the game-history-table component\n  type Game = React.ComponentProps<typeof GameHistoryTable>['games'][number];\n  \n  // State for filters\n  const [gameTypeFilter, setGameTypeFilter] = useState<string>(\"all\");\n  const [resultFilter, setResultFilter] = useState<string>(\"all\");\n  const [searchTerm, setSearchTerm] = useState<string>(\"\");\n  const [dateRange, setDateRange] = useState<DateRange>({\n    from: undefined,\n    to: undefined,\n  });\n  \n  // Pagination state\n  const [currentPage, setCurrentPage] = useState<number>(1);\n  const [itemsPerPage, setItemsPerPage] = useState<number>(10);\n  \n  // Sort state\n  const [sortBy, setSortBy] = useState<string>(\"newest\");\n  \n  // Filter presets\n  const [activePreset, setActivePreset] = useState<string>(\"all\");\n  \n\n\n  // Fetch all games for the user\n  const { data: games = [], isLoading } = useQuery<Game[]>({\n    queryKey: [\"/api/games/my-history\"],\n    enabled: !!user,\n  });\n  \n  // Helper function to format game type\n  const formatGameType = (gameType: string) => {\n    switch(gameType) {\n      case 'coin_flip': return 'Coin Flip';\n      case 'satamatka': return 'Satamatka';\n      // team_match case removed\n      case 'cricket_toss': return 'Cricket Toss';\n      default: return gameType.replace(/_/g, ' ');\n    }\n  };\n  \n  // Get unique game types from the data\n  const uniqueGameTypes: string[] = [];\n  games.forEach(game => {\n    if (!uniqueGameTypes.includes(game.gameType)) {\n      uniqueGameTypes.push(game.gameType);\n    }\n  });\n  const gameTypes = uniqueGameTypes;\n  \n  // Apply filters to games\n  const filteredGames = games.filter(game => {\n    // Game type filter\n    if (gameTypeFilter !== \"all\" && game.gameType !== gameTypeFilter) return false;\n    \n    // Result filter (win/loss)\n    if (resultFilter === \"wins\" && game.payout <= 0) return false;\n    if (resultFilter === \"losses\" && game.payout > 0) return false;\n    \n    // Search filter - check prediction, result, market/match name\n    if (searchTerm) {\n      const marketName = \n        game.market?.name?.toLowerCase() || \n        game.match?.teamA?.toLowerCase() || \n        game.match?.teamB?.toLowerCase() || \n        game.gameData?.teamA?.toLowerCase() || \n        game.gameData?.teamB?.toLowerCase() || '';\n      \n      const searchLower = searchTerm.toLowerCase();\n      const gameTypeMatches = formatGameType(game.gameType).toLowerCase().includes(searchLower);\n      const predictionMatches = game.prediction.toLowerCase().includes(searchLower);\n      const resultMatches = game.result?.toLowerCase()?.includes(searchLower);\n      const marketMatches = marketName.includes(searchLower);\n      \n      if (!gameTypeMatches && !predictionMatches && !resultMatches && !marketMatches) return false;\n    }\n    \n    // Date range filter\n    if (dateRange.from && dateRange.to) {\n      try {\n        // Parse the game date\n        const gameDate = new Date(game.createdAt);\n        \n        // Get game date components\n        const gameYear = gameDate.getFullYear();\n        const gameMonth = gameDate.getMonth();\n        const gameDay = gameDate.getDate();\n        \n        // Get from date components\n        const fromYear = dateRange.from.getFullYear();\n        const fromMonth = dateRange.from.getMonth();\n        const fromDay = dateRange.from.getDate();\n        \n        // Get to date components\n        const toYear = dateRange.to.getFullYear();\n        const toMonth = dateRange.to.getMonth();\n        const toDay = dateRange.to.getDate();\n        \n        // Convert to timestamps for start of days\n        const gameTimestamp = new Date(gameYear, gameMonth, gameDay).getTime();\n        const fromTimestamp = new Date(fromYear, fromMonth, fromDay).getTime();\n        const toTimestamp = new Date(toYear, toMonth, toDay).getTime();\n        \n        // Compare dates by day only (ignoring time)\n        const isInRange = gameTimestamp >= fromTimestamp && gameTimestamp <= toTimestamp;\n        \n        if (!isInRange) {\n          return false;\n        }\n      } catch (e) {\n        // If date parsing fails, include the game anyway\n        console.error(\"Date parsing error:\", e);\n      }\n    }\n    \n    return true;\n  });\n  \n  // Sort the filtered games\n  const sortedGames = [...filteredGames].sort((a, b) => {\n    switch (sortBy) {\n      case \"newest\":\n        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\n      case \"oldest\":\n        return new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime();\n      case \"amount-high\":\n        return b.betAmount - a.betAmount;\n      case \"amount-low\":\n        return a.betAmount - b.betAmount;\n      case \"profit-high\":\n        return (b.payout - b.betAmount) - (a.payout - a.betAmount);\n      case \"profit-low\":\n        return (a.payout - a.betAmount) - (b.payout - b.betAmount);\n      default:\n        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\n    }\n  });\n  \n  // Calculate pagination\n  const totalPages = Math.ceil(sortedGames.length / itemsPerPage);\n  const startIndex = (currentPage - 1) * itemsPerPage;\n  const paginatedGames = sortedGames.slice(startIndex, startIndex + itemsPerPage);\n  \n  // Effect to reset pagination when filters change\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [gameTypeFilter, resultFilter, searchTerm, dateRange, sortBy]);\n  \n  // Handle preset filters\n  const handlePresetChange = (preset: string) => {\n    setActivePreset(preset);\n    \n    if (preset === \"today\") {\n      // Get current date in the correct format\n      const currentDate = new Date();\n      const year = currentDate.getFullYear();\n      const month = currentDate.getMonth();\n      const day = currentDate.getDate();\n      \n      // Create start of today (midnight)\n      const startOfToday = new Date(year, month, day, 0, 0, 0);\n      \n      // Create end of today (23:59:59)\n      const endOfToday = new Date(year, month, day, 23, 59, 59, 999);\n      \n      setDateRange({\n        from: startOfToday,\n        to: endOfToday\n      });\n      console.log('Setting today date range:', { startOfToday, endOfToday });\n      setGameTypeFilter(\"all\");\n      setResultFilter(\"all\");\n    } else if (preset === \"yesterday\") {\n      const yesterday = subDays(new Date(), 1);\n      yesterday.setHours(0, 0, 0, 0);  // Set to start of day\n      \n      setDateRange({\n        from: yesterday,\n        to: yesterday\n      });\n      setGameTypeFilter(\"all\");\n      setResultFilter(\"all\");\n    } else if (preset === \"last7days\") {\n      const today = new Date();\n      today.setHours(23, 59, 59, 999);  // Set to end of day\n      \n      const weekAgo = subDays(new Date(), 7);\n      weekAgo.setHours(0, 0, 0, 0);  // Set to start of day\n      \n      setDateRange({\n        from: weekAgo,\n        to: today\n      });\n      setGameTypeFilter(\"all\");\n      setResultFilter(\"all\");\n    } else if (preset === \"last30days\") {\n      const today = new Date();\n      today.setHours(23, 59, 59, 999);  // Set to end of day\n      \n      const monthAgo = subDays(new Date(), 30);\n      monthAgo.setHours(0, 0, 0, 0);  // Set to start of day\n      \n      setDateRange({\n        from: monthAgo,\n        to: today\n      });\n      setGameTypeFilter(\"all\");\n      setResultFilter(\"all\");\n    } else if (preset === \"coinflip\") {\n      setDateRange({\n        from: undefined,\n        to: undefined\n      });\n      setGameTypeFilter(\"coin_flip\");\n      setResultFilter(\"all\");\n    } else if (preset === \"wins\") {\n      setDateRange({\n        from: undefined,\n        to: undefined\n      });\n      setGameTypeFilter(\"all\");\n      setResultFilter(\"wins\");\n    } else if (preset === \"losses\") {\n      setDateRange({\n        from: undefined,\n        to: undefined\n      });\n      setGameTypeFilter(\"all\");\n      setResultFilter(\"losses\");\n    } else {\n      // All games\n      setDateRange({\n        from: undefined,\n        to: undefined\n      });\n      setGameTypeFilter(\"all\");\n      setResultFilter(\"all\");\n    }\n  };\n  \n  // Reset all filters\n  const resetAllFilters = () => {\n    setActivePreset(\"all\");\n    setGameTypeFilter(\"all\");\n    setResultFilter(\"all\");\n    setSearchTerm(\"\");\n    setDateRange({\n      from: undefined,\n      to: undefined\n    });\n    setSortBy(\"newest\");\n  };\n  \n  return (\n    <DashboardLayout title=\"Game History\">\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <CardDescription>\n            View your comprehensive betting history and results from all games\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n\n          \n          {/* Filter heading */}\n          <div className=\"mb-6\">\n            <h3 className=\"text-lg font-medium mb-2\">Filter Your Game History</h3>\n            <p className=\"text-sm text-slate-400\">Use the options below to find specific games</p>\n          </div>\n          \n          {/* Filter Controls */}\n          <div className=\"mb-6 grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n            {/* Search */}\n            <div className=\"relative\">\n              <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-slate-500\" />\n              <Input\n                type=\"text\"\n                placeholder=\"Search games...\"\n                className=\"pl-9 bg-slate-950/50 border-slate-800\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n              />\n              {searchTerm && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"absolute right-0 top-0 h-9 w-9 text-slate-500 hover:text-slate-400\"\n                  onClick={() => setSearchTerm(\"\")}\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              )}\n            </div>\n            \n            {/* Game Type Filter */}\n            <Select value={gameTypeFilter} onValueChange={setGameTypeFilter}>\n              <SelectTrigger className=\"bg-slate-950/50 border-slate-800\">\n                <SelectValue placeholder=\"Game Type\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectGroup>\n                  <SelectLabel>Game Type</SelectLabel>\n                  <SelectItem value=\"all\">All Games</SelectItem>\n                  {gameTypes.map(type => (\n                    <SelectItem key={type} value={type}>\n                      {formatGameType(type)}\n                    </SelectItem>\n                  ))}\n                </SelectGroup>\n              </SelectContent>\n            </Select>\n            \n            {/* Result Filter (Win/Loss) */}\n            <Select value={resultFilter} onValueChange={setResultFilter}>\n              <SelectTrigger className=\"bg-slate-950/50 border-slate-800\">\n                <SelectValue placeholder=\"Result\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectGroup>\n                  <SelectLabel>Result</SelectLabel>\n                  <SelectItem value=\"all\">All Results</SelectItem>\n                  <SelectItem value=\"wins\">Wins Only</SelectItem>\n                  <SelectItem value=\"losses\">Losses Only</SelectItem>\n                </SelectGroup>\n              </SelectContent>\n            </Select>\n            \n            {/* Date Range Picker */}\n            <div>\n              <DateRangePicker\n                date={dateRange}\n                onDateChange={(range) => range && setDateRange(range)}\n                className=\"bg-slate-950/50 border-slate-800\"\n              />\n            </div>\n          </div>\n          \n          {/* Sort and Reset */}\n          <div className=\"flex flex-wrap justify-between items-center mb-4 gap-2\">\n            <div className=\"flex items-center\">\n              <div className=\"flex items-center gap-2\">\n                <ArrowDownUp className=\"h-4 w-4 text-slate-400\" />\n                <Label htmlFor=\"sort-by\" className=\"text-sm text-slate-400\">Sort by:</Label>\n              </div>\n              \n              <Select value={sortBy} onValueChange={setSortBy}>\n                <SelectTrigger id=\"sort-by\" className=\"w-[180px] ml-2 bg-slate-950/50 border-slate-800\">\n                  <SelectValue placeholder=\"Sort Order\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectGroup>\n                    <SelectItem value=\"newest\">Newest First</SelectItem>\n                    <SelectItem value=\"oldest\">Oldest First</SelectItem>\n                    <SelectItem value=\"amount-high\">Highest Amount</SelectItem>\n                    <SelectItem value=\"amount-low\">Lowest Amount</SelectItem>\n                    <SelectItem value=\"profit-high\">Highest Profit</SelectItem>\n                    <SelectItem value=\"profit-low\">Lowest Profit</SelectItem>\n                  </SelectGroup>\n                </SelectContent>\n              </Select>\n            </div>\n            \n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={resetAllFilters}\n              className=\"border-slate-700\"\n            >\n              <X className=\"h-4 w-4 mr-1\" /> Reset Filters\n            </Button>\n          </div>\n          \n          {/* Applied Filter Chips */}\n          {(gameTypeFilter !== \"all\" || resultFilter !== \"all\" || searchTerm || dateRange.from) && (\n            <div className=\"flex flex-wrap gap-2 mb-4\">\n              {gameTypeFilter !== \"all\" && (\n                <Badge \n                  variant=\"outline\" \n                  className=\"px-2 py-1 bg-blue-900/30 text-blue-300 border-blue-500/30 flex items-center gap-1\"\n                >\n                  Game: {formatGameType(gameTypeFilter)}\n                  <Button \n                    variant=\"ghost\" \n                    size=\"icon\"\n                    className=\"h-4 w-4 p-0 ml-1 text-blue-300 hover:text-blue-200 hover:bg-transparent\"\n                    onClick={() => setGameTypeFilter(\"all\")}\n                  >\n                    <X className=\"h-3 w-3\" />\n                  </Button>\n                </Badge>\n              )}\n              \n              {resultFilter !== \"all\" && (\n                <Badge \n                  variant=\"outline\" \n                  className={`px-2 py-1 ${\n                    resultFilter === \"wins\" \n                      ? \"bg-green-900/30 text-green-300 border-green-500/30\" \n                      : \"bg-red-900/30 text-red-300 border-red-500/30\"\n                  } flex items-center gap-1`}\n                >\n                  {resultFilter === \"wins\" ? \"Wins Only\" : \"Losses Only\"}\n                  <Button \n                    variant=\"ghost\" \n                    size=\"icon\"\n                    className={`h-4 w-4 p-0 ml-1 ${\n                      resultFilter === \"wins\" \n                        ? \"text-green-300 hover:text-green-200\" \n                        : \"text-red-300 hover:text-red-200\"\n                    } hover:bg-transparent`}\n                    onClick={() => setResultFilter(\"all\")}\n                  >\n                    <X className=\"h-3 w-3\" />\n                  </Button>\n                </Badge>\n              )}\n              \n              {searchTerm && (\n                <Badge \n                  variant=\"outline\" \n                  className=\"px-2 py-1 bg-purple-900/30 text-purple-300 border-purple-500/30 flex items-center gap-1\"\n                >\n                  Search: {searchTerm}\n                  <Button \n                    variant=\"ghost\" \n                    size=\"icon\"\n                    className=\"h-4 w-4 p-0 ml-1 text-purple-300 hover:text-purple-200 hover:bg-transparent\"\n                    onClick={() => setSearchTerm(\"\")}\n                  >\n                    <X className=\"h-3 w-3\" />\n                  </Button>\n                </Badge>\n              )}\n              \n              {dateRange.from && dateRange.to && (\n                <Badge \n                  variant=\"outline\" \n                  className=\"px-2 py-1 bg-amber-900/30 text-amber-300 border-amber-500/30 flex items-center gap-1\"\n                >\n                  <Calendar className=\"h-3 w-3 mr-1\" />\n                  {format(dateRange.from, \"MMM d\")} \n                  {dateRange.to && dateRange.to.getTime() !== dateRange.from.getTime() && (\n                    ` - ${format(dateRange.to, \"MMM d\")}`\n                  )}\n                  <Button \n                    variant=\"ghost\" \n                    size=\"icon\"\n                    className=\"h-4 w-4 p-0 ml-1 text-amber-300 hover:text-amber-200 hover:bg-transparent\"\n                    onClick={() => setDateRange({ from: undefined, to: undefined })}\n                  >\n                    <X className=\"h-3 w-3\" />\n                  </Button>\n                </Badge>\n              )}\n            </div>\n          )}\n          \n          {/* Results count */}\n          <div className=\"text-sm text-slate-400 mb-4\">\n            Showing {paginatedGames.length} of {filteredGames.length} results\n            {filteredGames.length !== games.length && ` (filtered from ${games.length} total)`}\n          </div>\n          \n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <>\n              <GameHistoryTable games={paginatedGames} showFullHistory />\n              \n              {/* Pagination Controls */}\n              {totalPages > 1 && (\n                <div className=\"mt-6\">\n                  <Pagination>\n                    <PaginationContent>\n                      <PaginationItem>\n                        <PaginationPrevious \n                          href=\"#\"\n                          onClick={(e) => {\n                            e.preventDefault();\n                            if (currentPage > 1) setCurrentPage(currentPage - 1);\n                          }}\n                          className={currentPage === 1 ? \"cursor-not-allowed opacity-50\" : \"\"}\n                        />\n                      </PaginationItem>\n                      \n                      {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n                        // For many pages, show a window around current page\n                        let pageNum = i + 1;\n                        if (totalPages > 5) {\n                          if (currentPage <= 3) {\n                            // Show first 5 pages\n                            pageNum = i + 1;\n                          } else if (currentPage >= totalPages - 2) {\n                            // Show last 5 pages\n                            pageNum = totalPages - 4 + i;\n                          } else {\n                            // Show current page in middle\n                            pageNum = currentPage - 2 + i;\n                          }\n                        }\n                        \n                        return (\n                          <PaginationItem key={pageNum}>\n                            <PaginationLink\n                              href=\"#\"\n                              onClick={(e) => {\n                                e.preventDefault();\n                                setCurrentPage(pageNum);\n                              }}\n                              isActive={currentPage === pageNum}\n                            >\n                              {pageNum}\n                            </PaginationLink>\n                          </PaginationItem>\n                        );\n                      })}\n                      \n                      <PaginationItem>\n                        <PaginationNext \n                          href=\"#\"\n                          onClick={(e) => {\n                            e.preventDefault();\n                            if (currentPage < totalPages) setCurrentPage(currentPage + 1);\n                          }}\n                          className={currentPage === totalPages ? \"cursor-not-allowed opacity-50\" : \"\"}\n                        />\n                      </PaginationItem>\n                    </PaginationContent>\n                  </Pagination>\n                </div>\n              )}\n              \n              {/* Items per page selector */}\n              <div className=\"flex justify-end mt-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Label htmlFor=\"items-per-page\" className=\"text-sm text-slate-400\">\n                    Items per page:\n                  </Label>\n                  <Select value={itemsPerPage.toString()} onValueChange={(value) => setItemsPerPage(parseInt(value))}>\n                    <SelectTrigger id=\"items-per-page\" className=\"w-[80px] bg-slate-950/50 border-slate-800\">\n                      <SelectValue placeholder=\"10\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectGroup>\n                        <SelectItem value=\"10\">10</SelectItem>\n                        <SelectItem value=\"25\">25</SelectItem>\n                        <SelectItem value=\"50\">50</SelectItem>\n                        <SelectItem value=\"100\">100</SelectItem>\n                      </SelectGroup>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":22839,"size_tokens":null},"client/src/pages/subadmin-dashboard-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { \n  Users, \n  Wallet, \n  TrendingUp, \n  DollarSign, \n  UserCheck, \n  Calendar, \n  BarChart3,\n  ChevronUp,\n  ChevronDown,\n  History\n} from \"lucide-react\";\n\n// Type definitions for the data returned from API\ninterface SubadminStats {\n  totalProfit: number;\n  totalDeposits: number;\n  totalUsers: number;\n  activeUsers: number;\n}\n\ninterface GameRecord {\n  id: number;\n  userId: number;\n  gameType: string;\n  betAmount: number;\n  prediction: string;\n  result: string;\n  payout: number;\n  createdAt: string;\n}\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { useLocation } from \"wouter\";\n\nexport default function SubadminDashboardPage() {\n  const { user } = useAuth();\n  const [_, setLocation] = useLocation();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  \n  // Get subadmin stats\n  const { data: stats, isLoading: isLoadingStats } = useQuery<SubadminStats>({\n    queryKey: ['/api/subadmin/stats'],\n    refetchInterval: 30000, // Refresh every 30 seconds\n  });\n  \n  // Get recent games\n  const { data: recentGames, isLoading: isLoadingRecentGames } = useQuery<GameRecord[]>({\n    queryKey: ['/api/games/recent'],\n    refetchInterval: 30000, // Refresh every 30 seconds\n  });\n  \n  const formatCurrency = (amount: number) => {\n    // Convert paise to rupees by dividing by 100\n    const amountInRupees = (amount || 0) / 100;\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(amountInRupees);\n  };\n  \n  // Function to determine trend indicator and color\n  const renderTrend = (isPositive: boolean) => {\n    return isPositive ? (\n      <div className=\"flex items-center text-green-600\">\n        <ChevronUp className=\"h-4 w-4 mr-1\" />\n        <span>Up</span>\n      </div>\n    ) : (\n      <div className=\"flex items-center text-red-600\">\n        <ChevronDown className=\"h-4 w-4 mr-1\" />\n        <span>Down</span>\n      </div>\n    );\n  };\n  \n  return (\n    <DashboardLayout title=\"Dashboard\">\n      <div className=\"space-y-6\">\n        \n        {/* Stats Overview */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {isLoadingStats ? (\n            // Loading skeleton for stats cards\n            <>\n              {[...Array(4)].map((_, i) => (\n                <Card key={i} className=\"bg-slate-900/50 animate-pulse\">\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"h-4 w-24 bg-slate-800 rounded\"></div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"h-8 w-36 bg-slate-800 rounded\"></div>\n                    <div className=\"h-3 w-20 bg-slate-800 rounded mt-2\"></div>\n                  </CardContent>\n                </Card>\n              ))}\n            </>\n          ) : stats ? (\n            <>\n              {/* Total Profit Card */}\n              <Card className=\"bg-slate-900/50 border-indigo-500/20 hover:border-indigo-500/50 transition-all\">\n                <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                    Total Profit\n                  </CardTitle>\n                  <DollarSign className=\"h-4 w-4 text-indigo-500\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-cyan-400\">\n                    {formatCurrency(stats.totalProfit)}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    From all player bets\n                  </p>\n                </CardContent>\n                <CardFooter className=\"pt-0\">\n                  {renderTrend(stats.totalProfit > 0)}\n                </CardFooter>\n              </Card>\n              \n              {/* Total Deposits Card */}\n              <Card className=\"bg-slate-900/50 border-purple-500/20 hover:border-purple-500/50 transition-all\">\n                <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                    Total Deposits\n                  </CardTitle>\n                  <Wallet className=\"h-4 w-4 text-purple-500\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-fuchsia-400\">\n                    {formatCurrency(stats.totalDeposits)}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Funds added to user accounts\n                  </p>\n                </CardContent>\n              </Card>\n              \n              {/* Total Users Card */}\n              <Card className=\"bg-slate-900/50 border-blue-500/20 hover:border-blue-500/50 transition-all\">\n                <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                    Total Users\n                  </CardTitle>\n                  <Users className=\"h-4 w-4 text-blue-500\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-teal-400\">\n                    {stats.totalUsers}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Players assigned to you\n                  </p>\n                </CardContent>\n              </Card>\n              \n              {/* Active Users Card */}\n              <Card className=\"bg-slate-900/50 border-green-500/20 hover:border-green-500/50 transition-all\">\n                <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                    Active Users\n                  </CardTitle>\n                  <UserCheck className=\"h-4 w-4 text-green-500\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-green-400 to-emerald-400\">\n                    {stats.activeUsers}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Users who played games\n                  </p>\n                </CardContent>\n                <CardFooter className=\"pt-0\">\n                  <div className=\"text-xs text-muted-foreground\">\n                    {stats.activeUsers > 0 && stats.totalUsers > 0 ? \n                      `${Math.round((stats.activeUsers / stats.totalUsers) * 100)}% engagement` : \n                      '0% engagement'}\n                  </div>\n                </CardFooter>\n              </Card>\n            </>\n          ) : (\n            <div className=\"col-span-4 text-center py-4 text-muted-foreground\">\n              No statistics available\n            </div>\n          )}\n        </div>\n        \n        {/* Quick Action Buttons */}\n        <div className=\"flex flex-wrap gap-2\">\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            className=\"group\"\n            onClick={() => setLocation(\"/users\")}\n          >\n            <Users className=\"h-4 w-4 mr-2 text-indigo-400 group-hover:text-indigo-300\" />\n            Manage Players\n          </Button>\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            className=\"group\"\n            onClick={() => setLocation(\"/settings\")}\n          >\n            <TrendingUp className=\"h-4 w-4 mr-2 text-green-400 group-hover:text-green-300\" />\n            Configure Game Odds\n          </Button>\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            className=\"group\"\n            onClick={() => setLocation(\"/games/history\")}\n          >\n            <History className=\"h-4 w-4 mr-2 text-purple-400 group-hover:text-purple-300\" />\n            Game History\n          </Button>\n        </div>\n        \n        {/* Recent Activities and Reports */}\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"mb-4 bg-slate-800/50\">\n            <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n            <TabsTrigger value=\"recent\">Recent Activity</TabsTrigger>\n          </TabsList>\n          \n          {/* Overview Section */}\n          <TabsContent value=\"overview\">\n            <Card className=\"bg-slate-900/50\">\n              <CardHeader>\n                <CardTitle>Monthly Performance</CardTitle>\n                <CardDescription>\n                  Your profit and player activity summary\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex justify-center py-6 text-muted-foreground\">\n                  <BarChart3 className=\"h-16 w-16 opacity-50\" />\n                </div>\n                <p className=\"text-center text-muted-foreground\">\n                  Detailed performance charts will be available soon\n                </p>\n              </CardContent>\n              <CardFooter className=\"flex justify-end\">\n                <Button variant=\"outline\" size=\"sm\">\n                  View Full Report\n                </Button>\n              </CardFooter>\n            </Card>\n          </TabsContent>\n          \n          {/* Recent Activity Section */}\n          <TabsContent value=\"recent\">\n            <Card className=\"bg-slate-900/50\">\n              <CardHeader>\n                <CardTitle>Recent Games</CardTitle>\n                <CardDescription>\n                  Latest game activities from your players\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {isLoadingRecentGames ? (\n                  <div className=\"space-y-4\">\n                    {[...Array(5)].map((_, i) => (\n                      <div key={i} className=\"flex items-center justify-between border-b border-slate-800 pb-3 last:border-0\">\n                        <div className=\"space-y-1\">\n                          <div className=\"h-4 w-32 bg-slate-800 rounded animate-pulse\"></div>\n                          <div className=\"h-3 w-24 bg-slate-800 rounded animate-pulse\"></div>\n                        </div>\n                        <div className=\"h-5 w-16 bg-slate-800 rounded animate-pulse\"></div>\n                      </div>\n                    ))}\n                  </div>\n                ) : recentGames && recentGames.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {recentGames.map((game) => (\n                      <div key={game.id} className=\"flex items-center justify-between border-b border-slate-800 pb-3 last:border-0\">\n                        <div className=\"space-y-1\">\n                          <div className=\"text-sm font-medium\">{game.gameType.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase())}</div>\n                          <div className=\"text-xs text-muted-foreground\">\n                            User: {game.userId}  {new Date(game.createdAt).toLocaleDateString()}\n                          </div>\n                        </div>\n                        <div className={`font-medium ${game.payout > 0 ? 'text-green-500' : 'text-red-500'}`}>\n                          {game.payout > 0 ? '+' : ''}{formatCurrency(game.payout)}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-10 text-muted-foreground\">\n                    No recent games found\n                  </div>\n                )}\n              </CardContent>\n              <CardFooter className=\"flex justify-end\">\n                <Button variant=\"outline\" size=\"sm\" onClick={() => setLocation(\"/games/history\")}>\n                  View All Games\n                </Button>\n              </CardFooter>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":12720,"size_tokens":null},"client/src/pages/subadmin-management-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport ConfirmDialog from \"@/components/confirm-dialog\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { UserRole } from \"@shared/schema\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useLocation } from \"wouter\";\n\n// UI Components\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n  FormDescription,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Alert, AlertTitle, AlertDescription } from \"@/components/ui/alert\";\n\n// Icons\nimport {\n  UserPlus,\n  Ban,\n  CheckCircle,\n  Settings,\n  Users,\n  X,\n  Percent,\n  Save,\n  Loader2,\n  AlertCircle,\n  Trash2,\n  CreditCard,\n  Unlock,\n  Lock,\n  ChevronLeft,\n  ChevronRight,\n  LogIn,\n} from \"lucide-react\";\n\n// Schema for creating a new subadmin\nconst createSubadminSchema = z.object({\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  email: z.string().email(\"Please enter a valid email address\"),\n  mobile: z.string().min(10, \"Mobile number must be at least 10 digits\").max(15, \"Mobile number cannot exceed 15 digits\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\n// Commission schema for subadmin deposit\nconst commissionSchema = z.object({\n  depositCommissionRate: z.coerce.number().min(0).max(100),\n});\n\n// Game Odds schema for subadmin\nconst gameOddsSchema = z.object({\n  cricketToss: z.coerce.number().min(0),\n  coinFlip: z.coerce.number().min(0),\n  satamatkaJodi: z.coerce.number().min(0),\n  satamatkaHarf: z.coerce.number().min(0),\n  satamatkaOddEven: z.coerce.number().min(0),\n  satamatkaCrossing: z.coerce.number().min(0),\n});\n\n// Schema for creating a new user (player)\nconst createUserSchema = z.object({\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  email: z.string().email(\"Please enter a valid email address\"),\n  mobile: z.string().min(10, \"Mobile number must be at least 10 digits\").max(15, \"Mobile number cannot exceed 15 digits\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n  confirmPassword: z.string().min(6, \"Confirm password must be at least 6 characters\"),\n  rewardCommission: z.string().optional(),\n}).refine(data => data.password === data.confirmPassword, {\n  message: \"Passwords do not match\",\n  path: [\"confirmPassword\"],\n});\n\ntype Commission = z.infer<typeof commissionSchema>;\ntype GameOdds = z.infer<typeof gameOddsSchema>;\n\nexport default function SubadminManagementPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [_, setLocation] = useLocation();\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\n  const [isCreateUserDialogOpen, setIsCreateUserDialogOpen] = useState(false);\n  const [isCommissionDialogOpen, setIsCommissionDialogOpen] = useState(false);\n  const [isGameOddsDialogOpen, setIsGameOddsDialogOpen] = useState(false);\n  const [isViewPlayersDialogOpen, setIsViewPlayersDialogOpen] = useState(false);\n  const [selectedSubadminId, setSelectedSubadminId] = useState<number | null>(null);\n  const [selectedSubadminName, setSelectedSubadminName] = useState<string>(\"\");\n  const [activeTab, setActiveTab] = useState(\"subadmins\");\n  const [playersPage, setPlayersPage] = useState(1);\n  const playersPerPage = 10;\n\n  const form = useForm<z.infer<typeof createSubadminSchema>>({\n    resolver: zodResolver(createSubadminSchema),\n    defaultValues: {\n      username: \"\",\n      email: \"\",\n      mobile: \"\",\n      password: \"\",\n    },\n  });\n  \n  // Create user form\n  const createUserForm = useForm<z.infer<typeof createUserSchema>>({\n    resolver: zodResolver(createUserSchema),\n    defaultValues: {\n      username: \"\",\n      email: \"\",\n      mobile: \"\",\n      password: \"\",\n      confirmPassword: \"\",\n      rewardCommission: \"0\",\n    },\n  });\n\n  // Fetch users that are subadmins\n  const { data: subadmins = [], isLoading } = useQuery({\n    queryKey: [\"/api/users\"],\n    select: (data: any) => data.filter((user: any) => user.role === UserRole.SUBADMIN),\n    enabled: !!user && user.role === UserRole.ADMIN,\n  });\n\n  // Fetch players assigned to selected subadmin for view players modal\n  const { data: subadminPlayers = [], isLoading: isLoadingSubadminPlayers } = useQuery({\n    queryKey: [\"/api/users\", \"subadmin-players\", selectedSubadminId],\n    enabled: isViewPlayersDialogOpen && !!selectedSubadminId,\n    select: (data: any) => {\n      console.log(\"Raw API response for subadmin players modal:\", data);\n      console.log(\"Selected subadmin ID:\", selectedSubadminId);\n      \n      if (!Array.isArray(data)) {\n        console.log(\"Data is not an array:\", typeof data);\n        return [];\n      }\n      \n      const filtered = data.filter((u: any) => {\n        const isPlayer = u.role === UserRole.PLAYER;\n        const isAssigned = u.assignedTo === selectedSubadminId;\n        console.log(`User ${u.username}: role=${u.role}, assignedTo=${u.assignedTo}, isPlayer=${isPlayer}, isAssigned=${isAssigned}`);\n        return isPlayer && isAssigned;\n      });\n      console.log(\"Filtered players for subadmin:\", filtered);\n      return filtered;\n    },\n  });\n\n\n\n  // Create subadmin mutation\n  const createSubadminMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof createSubadminSchema>) => {\n      // Create subadmin without commissions\n      const res = await apiRequest(\"POST\", \"/api/register\", {\n        username: data.username,\n        email: data.email,\n        mobile: data.mobile,\n        password: data.password,\n        role: UserRole.SUBADMIN,\n      });\n      \n      return await res.json();\n    },\n    onSuccess: (newSubadmin) => {\n      // First, close the dialog and reset the form\n      setIsCreateDialogOpen(false);\n      form.reset();\n      \n      // Immediately update the cache with the new subadmin\n      // This ensures the UI shows the new subadmin right away\n      queryClient.setQueryData([\"/api/users\"], (oldData: any) => {\n        // If there's no old data, create a new array with just this subadmin\n        if (!oldData) return [newSubadmin];\n        \n        // Otherwise add the new subadmin to the existing data\n        return [...oldData, newSubadmin];\n      });\n      \n      // Also invalidate and refetch to ensure data is fresh\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      \n      toast({\n        title: \"Subadmin created\",\n        description: \"The subadmin account has been created successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to create subadmin\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Block subadmin mutation\n  const blockSubadminMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      const res = await apiRequest(\"PATCH\", `/api/users/${userId}/block`, {});\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"Subadmin blocked\",\n        description: \"The subadmin has been blocked successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to block subadmin\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Unblock subadmin mutation\n  const unblockSubadminMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      const res = await apiRequest(\"PATCH\", `/api/users/${userId}/unblock`, {});\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"Subadmin unblocked\",\n        description: \"The subadmin has been unblocked successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to unblock subadmin\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n  \n  // Delete subadmin mutation\n  const deleteSubadminMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      return apiRequest(\"DELETE\", `/api/users/${userId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      // Force refetch to update the UI\n      queryClient.refetchQueries({ queryKey: [\"/api/users\"] });\n      toast({\n        title: \"Subadmin Deleted\",\n        description: \"Subadmin has been deleted successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error Deleting Subadmin\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Delete confirmation state\n  const [isDeleteConfirmOpen, setIsDeleteConfirmOpen] = useState(false);\n  const [subadminToDelete, setSubadminToDelete] = useState<number | null>(null);\n\n  // Handle delete subadmin\n  const handleDeleteSubadmin = (userId: number) => {\n    setSubadminToDelete(userId);\n    setIsDeleteConfirmOpen(true);\n  };\n  \n  // Confirm delete subadmin\n  const confirmDeleteSubadmin = () => {\n    if (subadminToDelete) {\n      deleteSubadminMutation.mutate(subadminToDelete);\n      setSubadminToDelete(null);\n    }\n  };\n\n  const onSubmit = (data: z.infer<typeof createSubadminSchema>) => {\n    createSubadminMutation.mutate(data);\n  };\n\n  const handleBlockSubadmin = (userId: number) => {\n    blockSubadminMutation.mutate(userId);\n  };\n\n  const handleUnblockSubadmin = (userId: number) => {\n    unblockSubadminMutation.mutate(userId);\n  };\n  \n  // Login as subadmin mutation\n  const loginAsSubadminMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      const res = await apiRequest(\"POST\", `/api/admin/login-as/${userId}`, {});\n      return await res.json();\n    },\n    onSuccess: (userData) => {\n      toast({\n        title: \"Logged in as subadmin\",\n        description: `You are now logged in as ${userData.username}`,\n      });\n      \n      // Update the current user in the cache\n      queryClient.setQueryData([\"/api/user\"], userData);\n      \n      // Redirect to dashboard\n      setLocation(\"/dashboard\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Login failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n  \n  // Handle login as subadmin\n  const handleLoginAsSubadmin = (userId: number) => {\n    loginAsSubadminMutation.mutate(userId);\n  };\n\n  const openViewPlayersDialog = (subadmin: any) => {\n    setSelectedSubadminId(subadmin.id);\n    setSelectedSubadminName(subadmin.username);\n    setPlayersPage(1); // Reset to first page\n    setIsViewPlayersDialogOpen(true);\n  };\n  \n  // Fetch users that are players assigned to this subadmin\n  const { data: assignedUsers = [], isLoading: isLoadingUsers } = useQuery({\n    queryKey: [\"/api/users\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/users\");\n      console.log(\"API Users response:\", response);\n      return response;\n    },\n    enabled: !!user?.id && user?.role === UserRole.SUBADMIN,\n    select: (data: any) => {\n      console.log(\"Filtering users for subadmin:\", user?.id);\n      const filtered = data.filter((u: any) => {\n        console.log(\"User:\", u.username, \"role:\", u.role, \"assignedTo:\", u.assignedTo);\n        return u.role === UserRole.PLAYER && u.assignedTo === user?.id;\n      });\n      console.log(\"Filtered users:\", filtered);\n      return filtered;\n    },\n  });\n  \n\n  \n  // Create user mutation\n  const createUserMutation = useMutation({\n    mutationFn: async (data: Omit<z.infer<typeof createUserSchema>, \"confirmPassword\">) => {\n      // Convert reward commission from percentage to basis points (e.g., 5% = 500)\n      const rewardCommission = data.rewardCommission \n        ? Math.round(parseFloat(data.rewardCommission) * 100)\n        : 0;\n      \n      return apiRequest(\"POST\", \"/api/register\", {\n        username: data.username,\n        email: data.email,\n        mobile: data.mobile,\n        password: data.password,\n        role: UserRole.PLAYER,\n        assignedTo: user?.id, // Ensure created players are assigned to the current subadmin\n        rewardCommission\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"User Created\",\n        description: \"New user has been created and assigned to you successfully\",\n      });\n      setIsCreateUserDialogOpen(false);\n      createUserForm.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error Creating User\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Handle create user form submission\n  const handleCreateUser = (data: z.infer<typeof createUserSchema>) => {\n    const { confirmPassword, ...userData } = data;\n    createUserMutation.mutate(userData);\n  };\n  \n  // Commission form setup\n  const commissionForm = useForm<Commission>({\n    resolver: zodResolver(commissionSchema),\n    defaultValues: {\n      depositCommissionRate: 0,\n    }\n  });\n  \n  // Get deposit commission settings for a selected subadmin\n  const { data: depositCommission, isLoading: isLoadingCommissions, refetch: refetchCommissions } = useQuery({\n    queryKey: [`/api/admin/deposit-commissions/${selectedSubadminId}`],\n    enabled: !!selectedSubadminId && isCommissionDialogOpen,\n    select: (data: any) => {\n      // Convert commission rate from database format to percentage format for display\n      if (data && typeof data.commissionRate === 'number') {\n        return {\n          ...data,\n          // Using consistent 10000-based system: 1000 = 10%, 2000 = 20%\n          // Divide by 100 to get percentage for display\n          commissionRate: data.commissionRate / 100  // Convert: 2000  20 (for 20%), 1000  10 (for 10%)\n        };\n      }\n      return data;\n    }\n  });\n  \n  // Update deposit commission mutation\n  const updateCommissionMutation = useMutation({\n    mutationFn: async (values: Commission) => {\n      if (!selectedSubadminId) {\n        throw new Error('No subadmin selected');\n      }\n      \n      return apiRequest(\"POST\", `/api/admin/deposit-commissions/${selectedSubadminId}`, {\n        commissionRate: Math.round(values.depositCommissionRate * 100)  // Convert: 20%  2000 for database\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/admin/deposit-commissions/${selectedSubadminId}`] });\n      toast({\n        title: \"Deposit commission updated\",\n        description: `Commission rate for ${selectedSubadminName} has been updated successfully.`,\n        duration: 3000,\n      });\n      setIsCommissionDialogOpen(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update deposit commission\",\n        description: error.message,\n        variant: \"destructive\",\n        duration: 5000,\n      });\n    }\n  });\n  \n  // Handle commission form submission\n  const onSubmitCommission = (values: Commission) => {\n    updateCommissionMutation.mutate(values);\n  };\n  \n  // Set form values when deposit commission data is loaded\n  useEffect(() => {\n    if (isCommissionDialogOpen) {\n      if (depositCommission) {\n        const formValues = {\n          depositCommissionRate: depositCommission.commissionRate, // Already converted in the query\n        };\n        commissionForm.reset(formValues);\n      } else {\n        // Reset to 0 when opening dialog without commission data\n        commissionForm.reset({\n          depositCommissionRate: 0,\n        });\n      }\n    }\n  }, [depositCommission, commissionForm, isCommissionDialogOpen]);\n  \n  // Open commission dialog for a specific subadmin\n  const openCommissionDialog = (subadmin: any) => {\n    setSelectedSubadminId(subadmin.id);\n    setSelectedSubadminName(subadmin.username);\n    setIsCommissionDialogOpen(true);\n    refetchCommissions();\n  };\n  \n  // Game Odds form setup\n  const gameOddsForm = useForm<GameOdds>({\n    resolver: zodResolver(gameOddsSchema),\n    defaultValues: {\n      cricketToss: 0,\n      coinFlip: 0,\n      satamatkaJodi: 0,\n      satamatkaHarf: 0,\n      satamatkaOddEven: 0,\n      satamatkaCrossing: 0,\n    }\n  });\n  \n  // Get game odds settings for a selected subadmin\n  const { data: gameOdds, isLoading: isLoadingGameOdds, refetch: refetchGameOdds } = useQuery({\n    queryKey: [`/api/game-odds/subadmin/${selectedSubadminId}`],\n    enabled: !!selectedSubadminId && isGameOddsDialogOpen\n  });\n  \n  // Update game odds mutation\n  const updateGameOddsMutation = useMutation({\n    mutationFn: async (values: GameOdds) => {\n      if (!selectedSubadminId) {\n        throw new Error('No subadmin selected');\n      }\n      \n      return apiRequest(\"POST\", `/api/game-odds/subadmin/${selectedSubadminId}`, {\n        odds: [\n          { gameType: 'cricket_toss', oddValue: Math.round(values.cricketToss * 10000) },\n          { gameType: 'coin_flip', oddValue: Math.round(values.coinFlip * 10000) },\n          { gameType: 'satamatka_jodi', oddValue: Math.round(values.satamatkaJodi * 10000) },\n          { gameType: 'satamatka_harf', oddValue: Math.round(values.satamatkaHarf * 10000) },\n          { gameType: 'satamatka_odd_even', oddValue: Math.round(values.satamatkaOddEven * 10000) },\n          { gameType: 'satamatka_crossing', oddValue: Math.round(values.satamatkaCrossing * 10000) },\n        ]\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/game-odds/subadmin/${selectedSubadminId}`] });\n      toast({\n        title: \"Game Odds updated\",\n        description: `Game odds for ${selectedSubadminName} have been updated successfully.`,\n        duration: 3000,\n      });\n      setIsGameOddsDialogOpen(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update game odds\",\n        description: error.message,\n        variant: \"destructive\",\n        duration: 5000,\n      });\n    }\n  });\n  \n  // Handle game odds form submission\n  const onSubmitGameOdds = (values: GameOdds) => {\n    updateGameOddsMutation.mutate(values);\n  };\n  \n  // Set form values when game odds data is loaded\n  useEffect(() => {\n    if (gameOdds && Array.isArray(gameOdds) && gameOdds.length > 0) {\n      const formValues: any = {\n        cricketToss: 0,\n        coinFlip: 0,\n        satamatkaJodi: 0,\n        satamatkaHarf: 0,\n        satamatkaOddEven: 0,\n        satamatkaCrossing: 0,\n      };\n\n      console.log(\"Game odds loaded from server:\", gameOdds);\n      \n      gameOdds.forEach((odd: any) => {\n        if (odd.gameType === 'cricket_toss') {\n          formValues.cricketToss = parseFloat(odd.oddValue);\n        } else if (odd.gameType === 'coin_flip') {\n          formValues.coinFlip = parseFloat(odd.oddValue);\n        } else if (odd.gameType === 'satamatka_jodi') {\n          formValues.satamatkaJodi = parseFloat(odd.oddValue);\n        } else if (odd.gameType === 'satamatka_harf') {\n          formValues.satamatkaHarf = parseFloat(odd.oddValue);\n        } else if (odd.gameType === 'satamatka_odd_even') {\n          formValues.satamatkaOddEven = parseFloat(odd.oddValue);\n        } else if (odd.gameType === 'satamatka_crossing') {\n          formValues.satamatkaCrossing = parseFloat(odd.oddValue);\n        }\n      });\n\n      gameOddsForm.reset(formValues);\n    }\n  }, [gameOdds, gameOddsForm]);\n  \n  // Open game odds dialog for a specific subadmin\n  const openGameOddsDialog = (subadmin: any) => {\n    setSelectedSubadminId(subadmin.id);\n    setSelectedSubadminName(subadmin.username);\n    \n    // Reset form to default values first\n    gameOddsForm.reset({\n      cricketToss: 0,\n      coinFlip: 0,\n      satamatkaJodi: 0,\n      satamatkaHarf: 0,\n      satamatkaOddEven: 0,\n      satamatkaCrossing: 0,\n    });\n    \n    // Then open dialog and fetch current values\n    setIsGameOddsDialogOpen(true);\n    \n    // Use a timeout to ensure state updates before refetching\n    setTimeout(() => {\n      refetchGameOdds();\n    }, 100);\n  };\n  \n\n  \n\n    \n\n\n  return (\n    <DashboardLayout title=\"Management\">\n      {user?.role === UserRole.ADMIN && (\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <div className=\"flex justify-between items-center\">\n              <div>\n                <CardTitle>Subadmin Management</CardTitle>\n                <CardDescription>\n                  Create and manage subadmin accounts\n                </CardDescription>\n              </div>\n              <Button\n                onClick={() => setIsCreateDialogOpen(true)}\n                className=\"bg-gradient-to-r from-primary to-blue-500\"\n              >\n                <UserPlus className=\"h-4 w-4 mr-2\" />\n                Create Subadmin\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n              </div>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Username</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {subadmins.length === 0 ? (\n                      <TableRow>\n                        <TableCell colSpan={3} className=\"text-center py-4\">\n                          No subadmins found\n                        </TableCell>\n                      </TableRow>\n                    ) : (\n                      subadmins.map((subadmin: any) => (\n                        <TableRow key={subadmin.id}>\n                          <TableCell className=\"font-medium\">\n                            {subadmin.username}\n                          </TableCell>\n                          <TableCell>\n                            {subadmin.isBlocked ? (\n                              <Badge variant=\"destructive\">Blocked</Badge>\n                            ) : (\n                              <Badge variant=\"outline\" className=\"bg-green-500/10 text-green-500 border-green-500/20\">\n                                Active\n                              </Badge>\n                            )}\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex space-x-2\">\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => openCommissionDialog(subadmin)}\n                                className=\"text-blue-500 border-blue-500/20 hover:bg-blue-500/10\"\n                              >\n                                <Settings className=\"h-4 w-4 mr-2\" />\n                                Commission\n                              </Button>\n                              \n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => openGameOddsDialog(subadmin)}\n                                className=\"text-orange-500 border-orange-500/20 hover:bg-orange-500/10\"\n                              >\n                                <Percent className=\"h-4 w-4 mr-2\" />\n                                Game Odds\n                              </Button>\n                              \n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => openViewPlayersDialog(subadmin)}\n                                className=\"text-purple-500 border-purple-500/20 hover:bg-purple-500/10\"\n                              >\n                                <Users className=\"h-4 w-4 mr-2\" />\n                                View Players\n                              </Button>\n                              \n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => handleLoginAsSubadmin(subadmin.id)}\n                                className=\"text-blue-600 border-blue-600/20 hover:bg-blue-600/10\"\n                              >\n                                <LogIn className=\"h-4 w-4 mr-2\" />\n                                Login as\n                              </Button>\n                              \n                              {subadmin.isBlocked ? (\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => handleUnblockSubadmin(subadmin.id)}\n                                  className=\"text-green-500 border-green-500/20 hover:bg-green-500/10\"\n                                >\n                                  <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                  Unblock\n                                </Button>\n                              ) : (\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => handleBlockSubadmin(subadmin.id)}\n                                  className=\"text-red-500 border-red-500/20 hover:bg-red-500/10\"\n                                >\n                                  <Ban className=\"h-4 w-4 mr-2\" />\n                                  Block\n                                </Button>\n                              )}\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      )}\n      \n      {/* User Management for Subadmins */}\n      {user?.role === UserRole.SUBADMIN && (\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <div className=\"flex justify-between items-center\">\n              <div>\n                <CardTitle>User Management</CardTitle>\n                <CardDescription>\n                  Add and manage your players\n                </CardDescription>\n              </div>\n              <Button\n                onClick={() => setIsCreateUserDialogOpen(true)}\n                className=\"bg-gradient-to-r from-primary to-blue-500\"\n              >\n                <UserPlus className=\"h-4 w-4 mr-2\" />\n                Add User\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {isLoadingUsers ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n              </div>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Username</TableHead>\n                      <TableHead>Balance</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {assignedUsers.length === 0 ? (\n                      <TableRow>\n                        <TableCell colSpan={4} className=\"text-center py-4\">\n                          No users assigned to you. Add a user using the \"Add User\" button.\n                        </TableCell>\n                      </TableRow>\n                    ) : (\n                      assignedUsers.map((player: any) => (\n                        <TableRow key={player.id}>\n                          <TableCell className=\"font-medium\">\n                            {player.username}\n                          </TableCell>\n                          <TableCell>\n                            {player.balance?.toFixed(2) || '0.00'}\n                          </TableCell>\n                          <TableCell>\n                            {player.isBlocked ? (\n                              <Badge variant=\"destructive\">Blocked</Badge>\n                            ) : (\n                              <Badge variant=\"outline\" className=\"bg-green-500/10 text-green-500 border-green-500/20\">\n                                Active\n                              </Badge>\n                            )}\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex space-x-2\">\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  const url = `/subadmin-commission-management?userId=${player.id}`;\n                                  // Use history.push for better SPA navigation without full page reload\n                                  window.history.pushState({}, '', url);\n                                  window.dispatchEvent(new PopStateEvent('popstate'));\n                                }}\n                                className=\"text-blue-500 border-blue-500/20 hover:bg-blue-500/10\"\n                              >\n                                <Settings className=\"h-4 w-4 mr-2\" />\n                                Discount\n                              </Button>\n                              \n                              {player.isBlocked ? (\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => handleUnblockSubadmin(player.id)}\n                                  className=\"text-green-500 border-green-500/20 hover:bg-green-500/10\"\n                                >\n                                  <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                  Unblock\n                                </Button>\n                              ) : (\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => handleBlockSubadmin(player.id)}\n                                  className=\"text-red-500 border-red-500/20 hover:bg-red-500/10\"\n                                >\n                                  <Ban className=\"h-4 w-4 mr-2\" />\n                                  Block\n                                </Button>\n                              )}\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      )}\n      \n      {/* Delete Confirmation Dialog */}\n      <ConfirmDialog\n        isOpen={isDeleteConfirmOpen}\n        onClose={() => setIsDeleteConfirmOpen(false)}\n        onConfirm={confirmDeleteSubadmin}\n        title=\"Delete Subadmin\"\n        description=\"Are you sure you want to delete this subadmin? This will also remove all associated players and data. This action cannot be undone.\"\n        confirmText=\"Delete\"\n        cancelText=\"Cancel\"\n        variant=\"destructive\"\n      />\n      \n      {/* Create Subadmin Dialog */}\n      <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Create Subadmin</DialogTitle>\n            <DialogDescription>\n              Create a new subadmin account with management permissions\n            </DialogDescription>\n          </DialogHeader>\n          \n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4 py-2\">\n              <FormField\n                control={form.control}\n                name=\"username\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Username</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter username\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input type=\"email\" placeholder=\"Enter email address\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={form.control}\n                name=\"mobile\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Mobile</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter mobile number\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={form.control}\n                name=\"password\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Password</FormLabel>\n                    <FormControl>\n                      <Input type=\"password\" placeholder=\"Enter password\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n\n              \n              <DialogFooter className=\"pt-4\">\n                <Button \n                  type=\"submit\" \n                  className=\"w-full bg-gradient-to-r from-primary to-blue-500\"\n                  disabled={createSubadminMutation.isPending}\n                >\n                  {createSubadminMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Creating Subadmin...\n                    </>\n                  ) : (\n                    <>\n                      <UserPlus className=\"mr-2 h-4 w-4\" />\n                      Create Subadmin\n                    </>\n                  )}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Create User Dialog (for subadmins) */}\n      <Dialog open={isCreateUserDialogOpen} onOpenChange={setIsCreateUserDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Create User</DialogTitle>\n            <DialogDescription>\n              Create a new player account that will be assigned to you\n            </DialogDescription>\n          </DialogHeader>\n          \n          <Form {...createUserForm}>\n            <form onSubmit={createUserForm.handleSubmit(handleCreateUser)} className=\"space-y-4 py-2\">\n              <FormField\n                control={createUserForm.control}\n                name=\"username\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Username</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter username\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={createUserForm.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input type=\"email\" placeholder=\"Enter email address\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={createUserForm.control}\n                name=\"mobile\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Mobile</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter mobile number\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={createUserForm.control}\n                name=\"password\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Password</FormLabel>\n                    <FormControl>\n                      <Input type=\"password\" placeholder=\"Enter password\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={createUserForm.control}\n                name=\"confirmPassword\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Confirm Password</FormLabel>\n                    <FormControl>\n                      <Input type=\"password\" placeholder=\"Confirm password\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={createUserForm.control}\n                name=\"rewardCommission\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Reward Commission (%)</FormLabel>\n                    <FormControl>\n                      <div className=\"flex items-center gap-2\">\n                        <Input \n                          type=\"number\" \n                          placeholder=\"e.g., 5.00\" \n                          step=\"0.01\"\n                          min=\"0\"\n                          max=\"100\"\n                          {...field} \n                          data-testid=\"input-create-user-reward-commission\"\n                        />\n                        <span className=\"text-muted-foreground\">%</span>\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <DialogFooter className=\"pt-4\">\n                <Button \n                  type=\"submit\" \n                  className=\"w-full bg-gradient-to-r from-primary to-blue-500\"\n                  disabled={createUserMutation.isPending}\n                >\n                  {createUserMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Creating User...\n                    </>\n                  ) : (\n                    <>\n                      <UserPlus className=\"mr-2 h-4 w-4\" />\n                      Create User\n                    </>\n                  )}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Deposit Commission Settings Dialog */}\n      <Dialog open={isCommissionDialogOpen} onOpenChange={setIsCommissionDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-auto scrollbar-thin scrollbar-thumb-primary scrollbar-track-secondary\">\n          <DialogHeader>\n            <DialogTitle>Deposit Commission Settings</DialogTitle>\n            <DialogDescription>\n              Configure deposit commission rate for {selectedSubadminName}\n            </DialogDescription>\n          </DialogHeader>\n          \n          {isLoadingCommissions ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <>\n              <Alert className=\"my-2\">\n                <AlertCircle className=\"h-4 w-4\" />\n                <AlertTitle>Important information</AlertTitle>\n                <AlertDescription>\n                  <p className=\"text-sm\">\n                    This commission rate determines the percentage applied during fund transfers between\n                    admin and subadmin. You can set any value from 0% to 100%:\n                  </p>\n                  <ul className=\"text-sm list-disc list-inside mt-2 space-y-1\">\n                    <li>When admin adds funds to subadmin: Full amount goes to subadmin but only commission percentage is deducted from admin.</li>\n                    <li>When admin removes funds from subadmin: Full amount is removed from subadmin but only commission percentage is added to admin.</li>\n                    <li>If no custom value is set here, the platform default commission rate will apply.</li>\n                  </ul>\n                </AlertDescription>\n              </Alert>\n              \n              <Form {...commissionForm}>\n                <form onSubmit={commissionForm.handleSubmit(onSubmitCommission)} className=\"space-y-4 py-2\">\n                  <div className=\"grid grid-cols-1 gap-4\">\n                    <FormField\n                      control={commissionForm.control}\n                      name=\"depositCommissionRate\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Deposit Commission Rate</FormLabel>\n                          <div className=\"flex items-center gap-2\">\n                            <FormControl>\n                              <Input type=\"number\" min=\"0\" max=\"100\" step=\"0.1\" {...field} />\n                            </FormControl>\n                            <span>%</span>\n                          </div>\n                          <FormDescription className=\"text-xs\">\n                            Set the commission rate between 0% and 100%.\n                          </FormDescription>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  \n                  <DialogFooter className=\"pt-4\">\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full bg-gradient-to-r from-primary to-blue-500\"\n                      disabled={updateCommissionMutation.isPending}\n                    >\n                      {updateCommissionMutation.isPending ? (\n                        <>\n                          <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                          Saving changes...\n                        </>\n                      ) : (\n                        <>\n                          <Save className=\"mr-2 h-4 w-4\" />\n                          Save Commission Settings\n                        </>\n                      )}\n                    </Button>\n                  </DialogFooter>\n                </form>\n              </Form>\n            </>\n          )}\n        </DialogContent>\n      </Dialog>\n      \n      {/* Game Odds Dialog */}\n      <Dialog open={isGameOddsDialogOpen} onOpenChange={setIsGameOddsDialogOpen}>\n        <DialogContent className=\"sm:max-w-[600px] max-h-[90vh] overflow-auto scrollbar-thin scrollbar-thumb-primary scrollbar-track-secondary\">\n          <DialogHeader>\n            <DialogTitle>Game Odds Settings</DialogTitle>\n            <DialogDescription>\n              Configure game odds for {selectedSubadminName}\n            </DialogDescription>\n          </DialogHeader>\n          \n          {isLoadingGameOdds ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <>\n              <Alert className=\"my-2\">\n                <AlertCircle className=\"h-4 w-4\" />\n                <AlertTitle>Important information</AlertTitle>\n                <AlertDescription>\n                  Game odds determine the payout multiplier for each game type. Higher odds mean larger potential payouts to players.\n                  These settings override platform defaults for this subadmin.\n                </AlertDescription>\n              </Alert>\n              \n              <Form {...gameOddsForm}>\n                <form onSubmit={gameOddsForm.handleSubmit(onSubmitGameOdds)} className=\"space-y-4 py-2\">\n                  {/* Sports Games */}\n                  <div className=\"space-y-3 col-span-2\">\n                    <h3 className=\"text-sm font-medium flex items-center gap-2\">\n                      <Percent className=\"h-4 w-4\" />\n                      Sports Game Odds\n                    </h3>\n                    <Separator />\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    \n                    <FormField\n                      control={gameOddsForm.control}\n                      name=\"cricketToss\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Cricket Toss Odds</FormLabel>\n                          <div className=\"flex items-center gap-2\">\n                            <FormControl>\n                              <Input type=\"number\" min=\"0\" step=\"0.01\" {...field} />\n                            </FormControl>\n                            <span>x</span>\n                          </div>\n                          <FormDescription className=\"text-xs\">\n                            Multiplier for cricket toss bets\n                          </FormDescription>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  \n                  {/* Royal Toss */}\n                  <div className=\"space-y-3 col-span-2 mt-4\">\n                    <h3 className=\"text-sm font-medium flex items-center gap-2\">\n                      <Percent className=\"h-4 w-4\" />\n                      Royal Toss Odds\n                    </h3>\n                    <Separator />\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormField\n                      control={gameOddsForm.control}\n                      name=\"coinFlip\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Royal Toss Odds</FormLabel>\n                          <div className=\"flex items-center gap-2\">\n                            <FormControl>\n                              <Input type=\"number\" min=\"0\" step=\"0.01\" {...field} />\n                            </FormControl>\n                            <span>x</span>\n                          </div>\n                          <FormDescription className=\"text-xs\">\n                            Multiplier for royal toss (coin flip) bets\n                          </FormDescription>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  \n                  {/* Satamatka Game Odds */}\n                  <div className=\"space-y-3 col-span-2 mt-4\">\n                    <h3 className=\"text-sm font-medium flex items-center gap-2\">\n                      <Percent className=\"h-4 w-4\" />\n                      Satamatka Game Odds\n                    </h3>\n                    <Separator />\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormField\n                      control={gameOddsForm.control}\n                      name=\"satamatkaJodi\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Jodi Odds</FormLabel>\n                          <div className=\"flex items-center gap-2\">\n                            <FormControl>\n                              <Input type=\"number\" min=\"0\" step=\"0.01\" {...field} />\n                            </FormControl>\n                            <span>x</span>\n                          </div>\n                          <FormDescription className=\"text-xs\">\n                            Multiplier for Jodi (00-99) bets\n                          </FormDescription>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    \n                    <FormField\n                      control={gameOddsForm.control}\n                      name=\"satamatkaHarf\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Harf Odds</FormLabel>\n                          <div className=\"flex items-center gap-2\">\n                            <FormControl>\n                              <Input type=\"number\" min=\"0\" step=\"0.01\" {...field} />\n                            </FormControl>\n                            <span>x</span>\n                          </div>\n                          <FormDescription className=\"text-xs\">\n                            Multiplier for Harf bets\n                          </FormDescription>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    \n                    <FormField\n                      control={gameOddsForm.control}\n                      name=\"satamatkaOddEven\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Odd-Even Odds</FormLabel>\n                          <div className=\"flex items-center gap-2\">\n                            <FormControl>\n                              <Input type=\"number\" min=\"0\" step=\"0.01\" {...field} />\n                            </FormControl>\n                            <span>x</span>\n                          </div>\n                          <FormDescription className=\"text-xs\">\n                            Multiplier for Odd-Even bets\n                          </FormDescription>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    \n                    <FormField\n                      control={gameOddsForm.control}\n                      name=\"satamatkaCrossing\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Crossing Odds</FormLabel>\n                          <div className=\"flex items-center gap-2\">\n                            <FormControl>\n                              <Input type=\"number\" min=\"0\" step=\"0.01\" {...field} />\n                            </FormControl>\n                            <span>x</span>\n                          </div>\n                          <FormDescription className=\"text-xs\">\n                            Multiplier for Crossing bets\n                          </FormDescription>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  \n                  <DialogFooter className=\"pt-4\">\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full bg-gradient-to-r from-orange-500 to-amber-500\"\n                      disabled={updateGameOddsMutation.isPending}\n                    >\n                      {updateGameOddsMutation.isPending ? (\n                        <>\n                          <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                          Updating Game Odds...\n                        </>\n                      ) : (\n                        <>\n                          <Save className=\"mr-2 h-4 w-4\" />\n                          Save Game Odds\n                        </>\n                      )}\n                    </Button>\n                  </DialogFooter>\n                </form>\n              </Form>\n            </>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* View Players Modal */}\n      <Dialog open={isViewPlayersDialogOpen} onOpenChange={setIsViewPlayersDialogOpen}>\n        <DialogContent className=\"sm:max-w-[900px] max-h-[90vh] flex flex-col\">\n          <DialogHeader>\n            <DialogTitle>Players under {selectedSubadminName}</DialogTitle>\n            <DialogDescription>\n              View all players assigned to this subadmin with their betting details\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-primary/20 scrollbar-track-transparent\">\n            {isLoadingSubadminPlayers ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {subadminPlayers.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <p className=\"text-muted-foreground\">No players assigned to this subadmin</p>\n                </div>\n              ) : (\n                <>\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Username</TableHead>\n                          <TableHead>Balance</TableHead>\n                          <TableHead>Status</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {subadminPlayers\n                          .slice((playersPage - 1) * playersPerPage, playersPage * playersPerPage)\n                          .map((player: any) => (\n                            <TableRow key={player.id}>\n                              <TableCell className=\"font-medium\">\n                                {player.username}\n                              </TableCell>\n                              <TableCell>\n                                {(player.balance / 100)?.toFixed(2) || '0.00'}\n                              </TableCell>\n                              <TableCell>\n                                {player.isBlocked ? (\n                                  <Badge variant=\"destructive\">Blocked</Badge>\n                                ) : (\n                                  <Badge variant=\"outline\" className=\"bg-green-500/10 text-green-500 border-green-500/20\">\n                                    Active\n                                  </Badge>\n                                )}\n                              </TableCell>\n                            </TableRow>\n                          ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                  \n                  {/* Pagination */}\n                  {subadminPlayers.length > playersPerPage && (\n                    <div className=\"flex items-center justify-between\">\n                      <p className=\"text-sm text-muted-foreground\">\n                        Showing {((playersPage - 1) * playersPerPage) + 1} to{' '}\n                        {Math.min(playersPage * playersPerPage, subadminPlayers.length)} of{' '}\n                        {subadminPlayers.length} players\n                      </p>\n                      <div className=\"flex items-center space-x-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setPlayersPage(prev => Math.max(prev - 1, 1))}\n                          disabled={playersPage === 1}\n                        >\n                          <ChevronLeft className=\"h-4 w-4\" />\n                          Previous\n                        </Button>\n                        <span className=\"text-sm\">\n                          Page {playersPage} of {Math.ceil(subadminPlayers.length / playersPerPage)}\n                        </span>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setPlayersPage(prev => Math.min(prev + 1, Math.ceil(subadminPlayers.length / playersPerPage)))}\n                          disabled={playersPage >= Math.ceil(subadminPlayers.length / playersPerPage)}\n                        >\n                          Next\n                          <ChevronRight className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  )}\n                </>\n              )}\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":58297,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"test-storage.ts":{"content":"// Test database storage implementation\nimport { db } from './server/db';\nimport { users, User } from './shared/schema';\nimport { eq } from 'drizzle-orm';\n\nasync function testStorage() {\n  try {\n    console.log(\"===== TESTING STORAGE =====\");\n    \n    // Direct query to users table\n    console.log(\"Querying users table directly...\");\n    const allUsers = await db.select().from(users);\n    console.log(`Found ${allUsers.length} users in database:`);\n    \n    for (const user of allUsers) {\n      console.log(`- ${user.username} (ID: ${user.id}, Role: ${user.role})`);\n    }\n    \n    // Try to get admin user specifically\n    console.log(\"\\nTrying to get admin user directly...\");\n    const adminUser = await db.select().from(users).where(eq(users.username, \"admin\"));\n    \n    if (adminUser.length > 0) {\n      console.log(\"Admin user found directly via query!\");\n      console.log(\"Admin details:\", {\n        id: adminUser[0].id,\n        username: adminUser[0].username,\n        role: adminUser[0].role,\n        passwordStart: adminUser[0].password.substring(0, 20) + '...'\n      });\n    } else {\n      console.log(\"Admin user NOT found directly via query!\");\n    }\n    \n    console.log(\"===== TESTING COMPLETE =====\");\n  } catch (error) {\n    console.error(\"Error testing storage:\", error);\n  } finally {\n    process.exit(0);\n  }\n}\n\ntestStorage();","path":null,"size_bytes":1351,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"import * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":315,"size_tokens":null},"removed_files/client/cricket-toss-game.tsx":{"content":"import React, { useState } from 'react';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from 'date-fns';\nimport { useAuth } from '@/hooks/use-auth';\nimport { apiRequest } from '@/lib/queryClient';\nimport { formatCurrency } from '@/lib/format-utils';\nimport { ChevronRight, RefreshCw } from \"lucide-react\";\nimport { GiCricketBat } from \"react-icons/gi\";\nimport { Badge } from '@/components/ui/badge';\n\n// Type for CricketTossGame\ntype CricketTossGame = {\n  id: number;\n  userId: number;\n  gameType: string;\n  betAmount: number;\n  prediction: string;\n  result: string | null;\n  payout: number;\n  createdAt: string | null;\n  gameData: {\n    teamA: string;\n    teamB: string;\n    description: string;\n    tossTime: string;\n    oddTeamA: number;\n    oddTeamB: number;\n    imageUrl?: string;\n    status: string;\n    openTime?: string;\n    closeTime?: string;\n  };\n};\n\ntype CricketTossGameProps = {\n  match: CricketTossGame;\n  onClose: () => void;\n};\n\nexport default function CricketTossGame({ match, onClose }: CricketTossGameProps) {\n  const [betAmount, setBetAmount] = useState<number>(100 * 100); // Default 100 rupees in paisa\n  const [prediction, setPrediction] = useState<string | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user } = useAuth() || {};\n\n  // Get the API endpoint\n  const getApiEndpoint = () => {\n    return `/api/cricket-toss-games/${match.id}/play`;\n  };\n\n  // Get the match time\n  const getMatchTime = () => {\n    return new Date(match.gameData.tossTime);\n  };\n\n  const placeBetMutation = useMutation({\n    mutationFn: async () => {\n      if (!prediction || betAmount <= 0) {\n        throw new Error(\"Please select a team and enter a valid bet amount\");\n      }\n      \n      // Ensure betAmount is a number\n      const amount = typeof betAmount === 'string' ? parseInt(betAmount, 10) : betAmount;\n      \n      console.log('Submitting bet:', {\n        betOn: prediction,\n        betAmount: amount,\n      });\n      \n      return apiRequest(\n        'POST',\n        getApiEndpoint(),\n        {\n          betOn: prediction,\n          betAmount: amount,\n        }\n      );\n    },\n    meta: {\n      successMessage: \"Bet placed successfully!\"\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/games/my-game-history'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/user'] });\n      \n      toast({\n        title: \"Bet placed successfully!\",\n        description: `You placed ${betAmount/100} on ${getPredictionLabel(prediction || '')}. Good luck!`,\n        variant: \"default\",\n      });\n      \n      onClose();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to place bet. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Helper to get team names\n  const getTeamA = () => {\n    return match.gameData.teamA;\n  };\n\n  const getTeamB = () => {\n    return match.gameData.teamB;\n  };\n\n  // Helper to get odds\n  const getOddTeamA = () => {\n    return match.gameData.oddTeamA;\n  };\n\n  const getOddTeamB = () => {\n    return match.gameData.oddTeamB;\n  };\n\n  const getPredictionLabel = (pred: string) => {\n    switch (pred) {\n      case 'team_a':\n        return getTeamA();\n      case 'team_b':\n        return getTeamB();\n      default:\n        return pred;\n    }\n  };\n\n  const calculatePotentialWin = () => {\n    if (!prediction || betAmount <= 0) return 0;\n    \n    let odds = 0;\n    if (prediction === 'team_a') {\n      odds = getOddTeamA() / 100;\n    } else if (prediction === 'team_b') {\n      odds = getOddTeamB() / 100;\n    }\n    \n    return Math.floor(betAmount * odds);\n  };\n\n  const potentialWin = calculatePotentialWin();\n  const matchTime = getMatchTime();\n  \n  const handleQuickAmount = (amount: number) => {\n    setBetAmount(amount * 100);\n  };\n\n  return (\n    <Card className=\"bg-gray-900 text-white border-gray-800 max-w-md mx-auto\">\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center\">\n            <GiCricketBat className=\"h-5 w-5 mr-2 text-indigo-400\" />\n            <CardTitle>Cricket Toss</CardTitle>\n          </div>\n          <Badge className=\"bg-indigo-600\">Toss Game</Badge>\n        </div>\n        <CardDescription className=\"text-gray-400\">\n          {getTeamA()} vs {getTeamB()} | {format(matchTime, 'MMM dd, h:mm a')}\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"text-center mb-2\">\n          <h3 className=\"text-sm text-gray-400 mb-1\">Select your team</h3>\n        </div>\n        \n        <div className=\"grid grid-cols-2 gap-4\">\n          <Card \n            className={`relative cursor-pointer border ${\n              prediction === 'team_a' \n              ? 'bg-indigo-900/40 border-indigo-500' \n              : 'bg-gray-800 border-gray-700 hover:border-gray-600'\n            } overflow-hidden transition-all`}\n            onClick={() => setPrediction('team_a')}\n          >\n            <div className=\"absolute top-0 right-0 bg-indigo-600 px-2 py-1 text-xs rounded-bl-md\">\n              {(getOddTeamA() / 100).toFixed(2)}x\n            </div>\n            <CardContent className=\"p-6 text-center\">\n              <div className=\"h-16 flex items-center justify-center\">\n                <h3 className=\"text-lg font-bold\">{getTeamA()}</h3>\n              </div>\n              {prediction === 'team_a' && (\n                <Badge className=\"bg-indigo-600 mt-2\">Selected</Badge>\n              )}\n            </CardContent>\n          </Card>\n          \n          <Card \n            className={`relative cursor-pointer border ${\n              prediction === 'team_b' \n              ? 'bg-indigo-900/40 border-indigo-500' \n              : 'bg-gray-800 border-gray-700 hover:border-gray-600'\n            } overflow-hidden transition-all`}\n            onClick={() => setPrediction('team_b')}\n          >\n            <div className=\"absolute top-0 right-0 bg-indigo-600 px-2 py-1 text-xs rounded-bl-md\">\n              {(getOddTeamB() / 100).toFixed(2)}x\n            </div>\n            <CardContent className=\"p-6 text-center\">\n              <div className=\"h-16 flex items-center justify-center\">\n                <h3 className=\"text-lg font-bold\">{getTeamB()}</h3>\n              </div>\n              {prediction === 'team_b' && (\n                <Badge className=\"bg-indigo-600 mt-2\">Selected</Badge>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n        \n        <div className=\"space-y-2 mt-4\">\n          <h3 className=\"text-sm text-gray-400\">Bet Amount</h3>\n          <div className=\"grid grid-cols-3 gap-2\">\n            <Button\n              variant=\"outline\"\n              className={`${betAmount === 10000 ? 'bg-indigo-900/50 border-indigo-500' : ''}`}\n              onClick={() => handleQuickAmount(100)}\n            >\n              100\n            </Button>\n            <Button\n              variant=\"outline\"\n              className={`${betAmount === 50000 ? 'bg-indigo-900/50 border-indigo-500' : ''}`}\n              onClick={() => handleQuickAmount(500)}\n            >\n              500\n            </Button>\n            <Button\n              variant=\"outline\"\n              className={`${betAmount === 100000 ? 'bg-indigo-900/50 border-indigo-500' : ''}`}\n              onClick={() => handleQuickAmount(1000)}\n            >\n              1,000\n            </Button>\n          </div>\n          \n          <Input\n            type=\"number\"\n            value={betAmount / 100}\n            onChange={(e) => setBetAmount(Math.max(0, Number(e.target.value) * 100))}\n            className=\"bg-gray-800 border-gray-700 mt-2\"\n            min={10}\n            max={10000}\n          />\n          <p className=\"text-xs text-gray-400\">Min: 10, Max: 10,000</p>\n        </div>\n        \n        <div className=\"bg-gray-800 p-3 rounded-md space-y-2\">\n          <div className=\"flex justify-between text-sm\">\n            <span className=\"text-gray-400\">Potential win:</span>\n            <span className=\"text-indigo-400 font-bold\">{(potentialWin/100).toFixed(2)}</span>\n          </div>\n          <div className=\"flex justify-between text-sm\">\n            <span className=\"text-gray-400\">Your balance:</span>\n            <span>{user?.balance !== undefined ? `${(user.balance/100).toFixed(2)}` : '-'}</span>\n          </div>\n        </div>\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <Button \n          variant=\"outline\" \n          className=\"bg-gray-800 hover:bg-gray-700 border-gray-700\"\n          onClick={onClose}\n        >\n          Cancel\n        </Button>\n        <Button \n          className=\"bg-indigo-600 hover:bg-indigo-700\"\n          disabled={!prediction || betAmount <= 0 || placeBetMutation.isPending}\n          onClick={() => placeBetMutation.mutate()}\n        >\n          {placeBetMutation.isPending ? (\n            <>\n              <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n              Processing...\n            </>\n          ) : (\n            <>\n              Place Bet <ChevronRight className=\"ml-2 h-4 w-4\" />\n            </>\n          )}\n        </Button>\n      </CardFooter>\n    </Card>\n  );\n}","path":null,"size_bytes":9579,"size_tokens":null},"client/src/pages/risk-management-page.tsx":{"content":"import React, { useState } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { UserRole } from \"@shared/schema\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { \n  Card,\n  CardContent, \n  CardDescription, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { \n  Tabs, \n  TabsContent, \n  TabsList, \n  TabsTrigger \n} from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  AlertTriangle,\n  Activity,\n  TrendingDown,\n  TrendingUp,\n  Users,\n  Target,\n  Loader2,\n  Eye,\n  ChevronLeft,\n  ChevronRight,\n  Search,\n  Filter\n} from \"lucide-react\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { useForm } from \"react-hook-form\";\nimport { Slider } from \"@/components/ui/slider\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface RiskSummary {\n  totalBetAmount: number;\n  potentialLiability: number;\n  potentialProfit: number;\n  exposureAmount: number;\n  activeBets: number;\n  totalBets: number;\n  highRiskBets: number;\n  gameType: string;\n  gameTypeFormatted: string;\n}\n\ninterface DetailedRiskData {\n  userExposure: { [userId: number]: number };\n  marketExposure: { [marketId: number]: number };\n  gameData: any[];\n}\n\ninterface RiskManagementData {\n  summaries: RiskSummary[];\n  detailedData: DetailedRiskData;\n  userInfo: { [userId: string]: { username: string } };\n  marketInfo: { [marketId: string]: { name: string; type: string } };\n  message?: string;\n}\n\n// Interface for user info to display names instead of IDs\ninterface UserInfo {\n  [userId: string]: { username: string };\n}\n\n// Interface for market info to display names instead of IDs\ninterface MarketInfo {\n  [marketId: string]: { name: string; type: string };\n}\n\nfunction LoadingSkeleton() {\n  return (\n    <div className=\"space-y-4\">\n      <Skeleton className=\"h-8 w-1/3\" />\n      <Skeleton className=\"h-4 w-1/4\" />\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mt-6\">\n        <Skeleton className=\"h-32\" />\n        <Skeleton className=\"h-32\" />\n        <Skeleton className=\"h-32\" />\n        <Skeleton className=\"h-32\" />\n      </div>\n    </div>\n  );\n}\n\nexport default function SimplifiedRiskPage() {\n  const { user } = useAuth();\n  const isAdmin = user?.role === UserRole.ADMIN;\n  const isSubadmin = user?.role === UserRole.SUBADMIN;\n  const [activeTab, setActiveTab] = useState('market-game');\n  const [userInfo, setUserInfo] = useState<UserInfo>({});\n  const [marketInfo, setMarketInfo] = useState<MarketInfo>({});\n  const [betTypeFilter, setBetTypeFilter] = useState<string>('all');\n  const [marketFilter, setMarketFilter] = useState<number | 'all'>('all');\n  const [viewMode, setViewMode] = useState<'regular' | 'odd-even' | 'harf'>('regular');\n  \n  // Risk level threshold configuration\n  const [riskThresholds, setRiskThresholds] = useState({\n    high: 1000,\n    medium: 500,\n    low: 100\n  });\n  \n  // Whether risk configuration dialog is open\n  const [riskConfigOpen, setRiskConfigOpen] = useState(false);\n  \n  // Player details modal state\n  const [playerDetailsModal, setPlayerDetailsModal] = useState(false);\n  const [selectedPlayers, setSelectedPlayers] = useState<any[]>([]);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [modalTitle, setModalTitle] = useState('');\n  const playersPerPage = 10;\n  \n  // Subadmin filtering state (only for admin users)\n  const [selectedSubadminId, setSelectedSubadminId] = useState<number | null>(null);\n  const [subadminSearch, setSubadminSearch] = useState('');\n  \n  // Form for risk threshold configuration\n  const riskConfigForm = useForm({\n    defaultValues: {\n      highRisk: riskThresholds.high / 100,\n      mediumRisk: riskThresholds.medium / 100,\n      lowRisk: riskThresholds.low / 100\n    }\n  });\n\n  // Get the appropriate API endpoint based on user role\n  const endpoint = isAdmin ? '/api/risk/admin' : '/api/risk/subadmin';\n\n  // Fetch risk management data\n  const { data, isLoading, error } = useQuery<RiskManagementData>({\n    queryKey: [endpoint, selectedSubadminId],\n    queryFn: async () => {\n      const url = selectedSubadminId ? `${endpoint}?subadminId=${selectedSubadminId}` : endpoint;\n      const response = await apiRequest('GET', url);\n      const data = await response.json();\n      return data as RiskManagementData;\n    },\n    refetchInterval: 60000 // Refetch every minute to keep data fresh\n  });\n\n  // Fetch subadmins list for admin users\n  const { data: subadmins = [], isLoading: isLoadingSubadmins } = useQuery({\n    queryKey: [\"/api/users\"],\n    select: (data: any) => data.filter((user: any) => user.role === UserRole.SUBADMIN),\n    enabled: !!user && user.role === UserRole.ADMIN,\n  });\n  \n  // Fetch game odds for the current user (admin or subadmin)\n  const { data: gameOddsData, isLoading: isLoadingOdds } = useQuery({\n    queryKey: [isAdmin ? '/api/odds/admin' : `/api/game-odds/subadmin/${user?.id}`, user?.id],\n    queryFn: async () => {\n      try {\n        // Use the proper endpoint based on user role\n        // For subadmins, use their specific ID to get their custom odds\n        const endpoint = isAdmin \n          ? '/api/odds/admin' \n          : `/api/game-odds/subadmin/${user?.id}`;\n        \n        console.log(`Fetching game odds from: ${endpoint}`);\n        const response = await apiRequest('GET', endpoint);\n        const data = await response.json();\n        console.log('Retrieved game odds data:', data);\n        return data;\n      } catch (error) {\n        console.error(\"Error fetching game odds:\", error);\n        // Return default odds in case of error\n        return [\n          { gameType: 'satamatka_jodi', oddValue: 95 },\n          { gameType: 'satamatka_odd_even', oddValue: 1.95 },\n          { gameType: 'satamatka_harf', oddValue: 9.5 },\n          { gameType: 'satamatka_single', oddValue: 9.5 }\n        ];\n      }\n    },\n    enabled: !!user,\n  });\n  \n  // Use real user names from the API\n  React.useEffect(() => {\n    if (data?.userInfo) {\n      setUserInfo(data.userInfo);\n    }\n  }, [data]);\n  \n  // Use real market names from the API\n  React.useEffect(() => {\n    if (data?.marketInfo) {\n      setMarketInfo(data.marketInfo);\n    }\n  }, [data]);\n\n  // Function to save risk thresholds\n  const saveRiskThresholds = (values: any) => {\n    // Convert rupees back to database values (multiply by 100)\n    setRiskThresholds({\n      high: values.highRisk * 100,\n      medium: values.mediumRisk * 100,\n      low: values.lowRisk * 100\n    });\n    setRiskConfigOpen(false);\n  };\n\n  // Helper function for risk level badge\n  const getRiskLevelBadge = (level: string) => {\n    if (level === 'high') return <Badge className=\"bg-[#9333EA] text-white\">High</Badge>;\n    if (level === 'medium') return <Badge className=\"bg-[#9333EA] text-white\">Medium</Badge>;\n    if (level === 'low') return <Badge className=\"bg-[#9333EA] text-white\">Low</Badge>;\n    return null;\n  };\n\n  // Function to show player details in modal\n  const showPlayerDetails = (players: any[], title: string) => {\n    setSelectedPlayers(players);\n    setModalTitle(title);\n    setCurrentPage(1);\n    setPlayerDetailsModal(true);\n  };\n\n  // Calculate pagination for player details\n  const totalPages = Math.ceil(selectedPlayers.length / playersPerPage);\n  const startIndex = (currentPage - 1) * playersPerPage;\n  const endIndex = startIndex + playersPerPage;\n  const currentPlayers = selectedPlayers.slice(startIndex, endIndex);\n\n  // Filter subadmins based on search\n  const filteredSubadmins = subadmins.filter((subadmin: any) =>\n    subadmin.username.toLowerCase().includes(subadminSearch.toLowerCase())\n  );\n\n  // Prepare data conditionally but without using hooks\n  let marketGameData = null;\n  let cricketTossData = null;\n  \n  if (data && data.summaries) {\n    marketGameData = data.summaries.find(summary => summary.gameType === 'satamatka');\n    cricketTossData = data.summaries.find(summary => summary.gameType === 'cricket_toss');\n  }\n\n  if (isLoading) {\n    return (\n      <DashboardLayout title=\"Jantri Management\" activeTab=\"risk-management\">\n        <div className=\"p-6\">\n          <LoadingSkeleton />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  if (error) {\n    return (\n      <DashboardLayout title=\"Jantri Management\" activeTab=\"risk-management\">\n        <div className=\"p-6\">\n          <Card className=\"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800\">\n            <CardHeader>\n              <CardTitle className=\"text-red-700 dark:text-red-300 flex items-center\">\n                <AlertTriangle className=\"w-5 h-5 mr-2\" />\n                Error Loading Jantri Management Data\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p>There was a problem loading the jantri management data. Please try again later.</p>\n            </CardContent>\n          </Card>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!data || !data.summaries || data.summaries.length === 0) {\n    return (\n      <DashboardLayout title=\"Jantri Management\" activeTab=\"risk-management\">\n        <div className=\"p-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Jantri Management</CardTitle>\n              <CardDescription>No game data available</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <p>There's currently no data to display. This may be because there are no active games or bets in the system.</p>\n            </CardContent>\n          </Card>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout title=\"Jantri Management\" activeTab=\"risk-management\">\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-xl font-bold\">\n              {isAdmin ? 'Platform-wide Jantri Analysis' : 'Jantri Analysis for Your Players'}\n            </h2>\n            <p className=\"text-muted-foreground\">\n              Monitor and manage Satamatka numbers with comprehensive betting data\n            </p>\n          </div>\n        </div>\n\n        {/* Subadmin Filter Section (Admin Only) */}\n        {isAdmin && (\n          <Card className=\"bg-gradient-to-r from-primary/5 to-primary/10 dark:from-primary/10 dark:to-primary/20 border-primary/20 dark:border-primary/30\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-lg\">\n                <Filter className=\"h-5 w-5\" />\n                Filter by Subadmin\n              </CardTitle>\n              <CardDescription>\n                Filter jantri data by specific subadmin to analyze their players' betting patterns\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex flex-col sm:flex-row gap-4\">\n                {/* Search Input */}\n                <div className=\"relative flex-1\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n                  <Input\n                    placeholder=\"Search subadmins...\"\n                    value={subadminSearch}\n                    onChange={(e) => setSubadminSearch(e.target.value)}\n                    className=\"pl-10\"\n                  />\n                </div>\n                \n                {/* Subadmin Dropdown */}\n                <div className=\"flex-1\">\n                  <Select\n                    value={selectedSubadminId?.toString() || \"all\"}\n                    onValueChange={(value) => {\n                      setSelectedSubadminId(value === \"all\" ? null : parseInt(value));\n                      setSubadminSearch(''); // Clear search when selecting\n                    }}\n                  >\n                    <SelectTrigger className=\"w-full\">\n                      <SelectValue placeholder=\"Select subadmin\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Subadmins</SelectItem>\n                      {filteredSubadmins.map((subadmin: any) => (\n                        <SelectItem key={subadmin.id} value={subadmin.id.toString()}>\n                          {subadmin.username}\n                          {subadmin.isBlocked && (\n                            <Badge variant=\"destructive\" className=\"ml-2 text-xs\">\n                              Blocked\n                            </Badge>\n                          )}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                {/* Clear Filter Button */}\n                {selectedSubadminId && (\n                  <Button \n                    variant=\"outline\" \n                    onClick={() => {\n                      setSelectedSubadminId(null);\n                      setSubadminSearch('');\n                    }}\n                    className=\"shrink-0\"\n                  >\n                    Clear Filter\n                  </Button>\n                )}\n              </div>\n              \n              {/* Selected Subadmin Info */}\n              {selectedSubadminId && (\n                <div className=\"mt-4 p-3 bg-primary/5 dark:bg-primary/10 rounded-lg border border-primary/20 dark:border-primary/30\">\n                  <div className=\"flex items-center gap-2\">\n                    <Users className=\"h-4 w-4\" />\n                    <span className=\"font-medium\">\n                      Viewing data for: {subadmins.find((s: any) => s.id === selectedSubadminId)?.username}\n                    </span>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n        \n        {/* Risk Configuration Dialog */}\n        <Dialog open={riskConfigOpen} onOpenChange={setRiskConfigOpen}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Configure Risk Thresholds</DialogTitle>\n              <DialogDescription>\n                Set the bet amount thresholds for different risk levels. Values are in rupees.\n              </DialogDescription>\n            </DialogHeader>\n            \n            <Form {...riskConfigForm}>\n              <form onSubmit={riskConfigForm.handleSubmit(saveRiskThresholds)} className=\"space-y-4\">\n                <FormField\n                  control={riskConfigForm.control}\n                  name=\"highRisk\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>High Risk Threshold ()</FormLabel>\n                      <FormDescription>\n                        Bets above this amount will be marked as high risk (red)\n                      </FormDescription>\n                      <FormControl>\n                        <div className=\"flex items-center gap-4\">\n                          <Slider\n                            value={[field.value]}\n                            min={100}\n                            max={10000}\n                            step={100}\n                            onValueChange={(vals) => field.onChange(vals[0])}\n                            className=\"flex-1\"\n                          />\n                          <Input\n                            type=\"number\"\n                            value={field.value}\n                            onChange={(e) => field.onChange(parseFloat(e.target.value))}\n                            className=\"w-24\"\n                          />\n                        </div>\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={riskConfigForm.control}\n                  name=\"mediumRisk\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Medium Risk Threshold ()</FormLabel>\n                      <FormDescription>\n                        Bets above this amount but below high risk will be marked as medium risk (orange)\n                      </FormDescription>\n                      <FormControl>\n                        <div className=\"flex items-center gap-4\">\n                          <Slider\n                            value={[field.value]}\n                            min={50}\n                            max={9900}\n                            step={100}\n                            onValueChange={(vals) => field.onChange(vals[0])}\n                            className=\"flex-1\"\n                          />\n                          <Input\n                            type=\"number\"\n                            value={field.value}\n                            onChange={(e) => field.onChange(parseFloat(e.target.value))}\n                            className=\"w-24\"\n                          />\n                        </div>\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={riskConfigForm.control}\n                  name=\"lowRisk\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Low Risk Threshold ()</FormLabel>\n                      <FormDescription>\n                        Bets above this amount but below medium risk will be marked as low risk (blue)\n                      </FormDescription>\n                      <FormControl>\n                        <div className=\"flex items-center gap-4\">\n                          <Slider\n                            value={[field.value]}\n                            min={1}\n                            max={5000}\n                            step={10}\n                            onValueChange={(vals) => field.onChange(vals[0])}\n                            className=\"flex-1\"\n                          />\n                          <Input\n                            type=\"number\"\n                            value={field.value}\n                            onChange={(e) => field.onChange(parseFloat(e.target.value))}\n                            className=\"w-24\"\n                          />\n                        </div>\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                \n                <DialogFooter>\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setRiskConfigOpen(false)}>\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\">Save Changes</Button>\n                </DialogFooter>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n\n        {/* Player Details Modal */}\n        <Dialog open={playerDetailsModal} onOpenChange={setPlayerDetailsModal}>\n          <DialogContent className=\"sm:max-w-4xl max-h-[90vh] flex flex-col\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Users className=\"h-5 w-5\" />\n                {modalTitle}\n              </DialogTitle>\n              <DialogDescription>\n                Player betting details with risk analysis\n              </DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"flex-1 min-h-0\">\n              <ScrollArea className=\"h-[60vh] pr-4\">\n                <div className=\"space-y-4\">\n                  {currentPlayers.map((player, index) => (\n                    <Card key={startIndex + index} className=\"border-l-4 border-l-primary\">\n                      <CardContent className=\"p-4\">\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                          <div>\n                            <h4 className=\"font-semibold text-base mb-2\">\n                              {userInfo[player.userId] ? userInfo[player.userId].username : `Player ${player.userId}`}\n                            </h4>\n                            <div className=\"space-y-1 text-sm text-muted-foreground\">\n                              <div>Player ID: {player.userId}</div>\n                              <div>Market: {marketInfo[player.marketId] ? marketInfo[player.marketId].name : `Market ${player.marketId}`}</div>\n                              <div>Prediction: <span className=\"font-medium text-foreground\">{player.prediction}</span></div>\n                            </div>\n                          </div>\n                          \n                          <div>\n                            <div className=\"space-y-2\">\n                              <div className=\"flex justify-between\">\n                                <span className=\"text-sm\">Bet Amount:</span>\n                                <span className=\"font-semibold\">{(player.betAmount / 100).toFixed(2)}</span>\n                              </div>\n                              <div className=\"flex justify-between\">\n                                <span className=\"text-sm\">Potential Win:</span>\n                                <span className=\"font-semibold text-green-600\">\n                                  {(() => {\n                                    // Determine the appropriate multiplier based on game type and prediction\n                                    let multiplier = 90; // Default fallback\n                                    \n                                    if (gameOddsData && Array.isArray(gameOddsData)) {\n                                      // Determine the game type based on player's bet\n                                      let gameTypeKey = 'satamatka_jodi'; // Default\n                                      \n                                      if (player.gameMode === 'harf' || \n                                          player.prediction?.startsWith('A') || \n                                          player.prediction?.startsWith('B')) {\n                                        gameTypeKey = 'satamatka_harf';\n                                      } else if (player.gameMode === 'oddeven' || \n                                                player.prediction === 'odd' || \n                                                player.prediction === 'even') {\n                                        gameTypeKey = 'satamatka_odd_even';\n                                      } else if (/^\\d{2}$/.test(player.prediction)) {\n                                        gameTypeKey = 'satamatka_jodi';\n                                      }\n                                      \n                                      // Find odds for this game type\n                                      const odds = gameOddsData.find((odd: any) => odd.gameType === gameTypeKey);\n                                      \n                                      if (odds && odds.oddValue !== undefined) {\n                                        // Parse odds value based on format\n                                        if (odds.oddValue >= 100000) {\n                                          multiplier = odds.oddValue / 10000;\n                                        } else if (odds.oddValue >= 10) {\n                                          multiplier = odds.oddValue;\n                                        } else {\n                                          multiplier = odds.oddValue;\n                                        }\n                                      }\n                                    }\n                                    \n                                    return `${((player.betAmount * multiplier) / 100).toFixed(2)}`;\n                                  })()}\n                                </span>\n                              </div>\n                              <div className=\"flex justify-between\">\n                                <span className=\"text-sm\">Bet Type:</span>\n                                <span className=\"text-sm\">{player.gameMode || player.betType || 'jodi'}</span>\n                              </div>\n                            </div>\n                          </div>\n                          \n                          <div className=\"flex flex-col items-end\">\n                            <div className=\"mb-2\">\n                              {(() => {\n                                let riskLevel = 'low';\n                                if (player.betAmount > riskThresholds.high) riskLevel = 'high';\n                                else if (player.betAmount > riskThresholds.medium) riskLevel = 'medium';\n                                return getRiskLevelBadge(riskLevel);\n                              })()}\n                            </div>\n                            <div className=\"text-xs text-muted-foreground\">\n                              Game ID: {player.id}\n                            </div>\n                            <div className=\"text-xs text-muted-foreground\">\n                              Status: {player.result || 'Pending'}\n                            </div>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                  \n                  {currentPlayers.length === 0 && (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      No player data available\n                    </div>\n                  )}\n                </div>\n              </ScrollArea>\n            </div>\n            \n            {/* Pagination */}\n            {totalPages > 1 && (\n              <div className=\"flex items-center justify-between pt-4 border-t\">\n                <div className=\"text-sm text-muted-foreground\">\n                  Showing {startIndex + 1} to {Math.min(endIndex, selectedPlayers.length)} of {selectedPlayers.length} players\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}\n                    disabled={currentPage === 1}\n                  >\n                    <ChevronLeft className=\"h-4 w-4\" />\n                    Previous\n                  </Button>\n                  <span className=\"text-sm\">\n                    Page {currentPage} of {totalPages}\n                  </span>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}\n                    disabled={currentPage === totalPages}\n                  >\n                    Next\n                    <ChevronRight className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            )}\n            \n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setPlayerDetailsModal(false)}>\n                Close\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        <Separator />\n\n        {/* Detailed Analysis Tabs */}\n        <Tabs defaultValue=\"market-game\" className=\"w-full mt-6\" onValueChange={setActiveTab}>\n          <TabsList className=\"grid w-full grid-cols-2 mb-4\">\n            <TabsTrigger value=\"market-game\">Satamatka Analysis</TabsTrigger>\n            <TabsTrigger value=\"cricket-toss\">Cricket Toss Risk</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"market-game\" className=\"mt-0\">\n            \n            {marketGameData && (\n              <>\n                {/* Satamatka Overview Statistics Cards */}\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6\">\n                  <Card className=\"border-primary/20 bg-primary/5\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Total Active Bets\n                      </CardTitle>\n                      <Activity className=\"h-4 w-4 text-primary\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">\n                        {data.detailedData.gameData.filter(game => \n                          game.gameType === 'satamatka' && \n                          (!game.result || game.result === 'pending')\n                        ).length}\n                      </div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        All bet types in Satamatka markets\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card className=\"border-primary/20 bg-primary/5\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Total Potential Win\n                      </CardTitle>\n                      <TrendingUp className=\"h-4 w-4 text-green-500\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">\n                        {(data.detailedData.gameData\n                          .filter(game => \n                            game.gameType === 'satamatka' && \n                            (!game.result || game.result === 'pending')\n                          )\n                          .reduce((sum, game) => sum + ((game.betAmount || 0) * 90), 0) / 100\n                        ).toFixed(2)}\n                      </div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Maximum possible payout\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card className=\"border-primary/20 bg-primary/5\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Total Bet Amount\n                      </CardTitle>\n                      <Target className=\"h-4 w-4 text-orange-500\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">\n                        {(data.detailedData.gameData\n                          .filter(game => \n                            game.gameType === 'satamatka' && \n                            (!game.result || game.result === 'pending')\n                          )\n                          .reduce((sum, game) => sum + (game.betAmount || 0), 0) / 100\n                        ).toFixed(2)}\n                      </div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Total amount wagered\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card className=\"border-primary/20 bg-primary/5\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Unique Active Users\n                      </CardTitle>\n                      <Users className=\"h-4 w-4 text-blue-500\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">\n                        {new Set(data.detailedData.gameData\n                          .filter(game => \n                            game.gameType === 'satamatka' && \n                            (!game.result || game.result === 'pending')\n                          )\n                          .map(game => game.userId)\n                        ).size}\n                      </div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Players with active bets\n                      </p>\n                    </CardContent>\n                  </Card>\n                </div>\n                \n                <Card className=\"mb-6 border-primary/20 bg-primary/5\">\n                  <CardHeader className=\"border-b border-primary/20\">\n                    <CardTitle>Jantri Risk Analysis</CardTitle>\n                    <CardDescription>\n                      View and analyze bets by number, market, and player\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"pt-6\">\n                    <div className=\"space-y-5 mb-6\">\n                      <div className=\"flex flex-wrap items-center gap-4\">\n                        <div className=\"flex items-center space-x-2\">\n                          <span className=\"font-semibold w-24\">Market:</span>\n                          <select \n                            className=\"p-2 border rounded-md w-48 bg-background/70 border-border/60 focus:border-primary/70 focus:ring-1 focus:ring-primary/50\"\n                            value={marketFilter === 'all' ? 'all' : marketFilter.toString()}\n                            onChange={(e) => setMarketFilter(e.target.value === 'all' ? 'all' : parseInt(e.target.value, 10))}\n                          >\n                            <option value=\"all\">All Markets</option>\n                            {Object.entries(marketInfo).map(([id, market]) => (\n                              <option key={id} value={id}>\n                                {market.name} ({market.type})\n                              </option>\n                            ))}\n                          </select>\n                        </div>\n                        \n                        {/* View Selector */}\n                        <div className=\"flex items-center space-x-2\">\n                          <span className=\"font-semibold w-24\">View Mode:</span>\n                          <div className=\"flex flex-wrap items-center gap-2\">\n                            <Badge \n                              className={`cursor-pointer px-3 py-1 ${viewMode === 'regular' && betTypeFilter === 'all' ? 'bg-primary text-primary-foreground' : 'bg-primary/20 hover:bg-primary/30 text-foreground'}`}\n                              onClick={() => {\n                                setViewMode('regular');\n                                setBetTypeFilter('all');\n                              }}\n                            >\n                              All Numbers\n                            </Badge>\n                            <Badge \n                              className={`cursor-pointer px-3 py-1 ${viewMode === 'regular' && betTypeFilter === 'jodi' ? 'bg-primary text-primary-foreground' : 'bg-primary/20 hover:bg-primary/30 text-foreground'}`}\n                              onClick={() => {\n                                setViewMode('regular');\n                                setBetTypeFilter('jodi');\n                              }}\n                            >\n                              Jodi Only\n                            </Badge>\n                            <Badge \n                              className={`cursor-pointer px-3 py-1 ${viewMode === 'odd-even' ? 'bg-primary text-primary-foreground' : 'bg-primary/20 hover:bg-primary/30 text-foreground'}`}\n                              onClick={() => setViewMode('odd-even')}\n                            >\n                              Odd/Even\n                            </Badge>\n                            <Badge \n                              className={`cursor-pointer px-3 py-1 ${viewMode === 'harf' ? 'bg-primary text-primary-foreground' : 'bg-primary/20 hover:bg-primary/30 text-foreground'}`}\n                              onClick={() => setViewMode('harf')}\n                            >\n                              Harf (A0-B9)\n                            </Badge>\n                          </div>\n                        </div>\n                      </div>\n                      \n                      <div className=\"flex flex-wrap items-center gap-3 py-3 px-4 bg-muted/30 rounded-md border border-border/30\">\n                          <div className=\"flex items-center space-x-1\">\n                            <span className=\"inline-block w-3 h-3 rounded-full bg-red-500\"></span>\n                            <span className=\"text-xs\">High Risk ({(riskThresholds.high/100).toFixed(2)}+)</span>\n                          </div>\n                          <div className=\"flex items-center space-x-1\">\n                            <span className=\"inline-block w-3 h-3 rounded-full bg-orange-500\"></span>\n                            <span className=\"text-xs\">Medium Risk ({(riskThresholds.medium/100).toFixed(2)}+)</span>\n                          </div>\n                          <div className=\"flex items-center space-x-1\">\n                            <span className=\"inline-block w-3 h-3 rounded-full bg-blue-500\"></span>\n                            <span className=\"text-xs\">Low Risk (Above 0)</span>\n                          </div>\n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\" \n                            className=\"ml-auto text-xs bg-background/70 hover:bg-background\" \n                            onClick={() => setRiskConfigOpen(true)}\n                          >\n                            Configure Risk Levels\n                          </Button>\n                        </div>\n                    </div>\n                    \n                    {/* Statistics Cards Section */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n                      {(() => {\n                        // Calculate filtered statistics based on current filters\n                        const filteredGames = data.detailedData.gameData.filter(game => {\n                          if (game.gameType !== 'satamatka') return false;\n                          if (game.result && game.result !== 'pending') return false;\n                          if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                          \n                          // Apply bet type filters\n                          if (viewMode === 'regular') {\n                            if (betTypeFilter === 'jodi') {\n                              return game.gameMode === 'jodi';\n                            } else if (betTypeFilter === 'all') {\n                              return true; // Include all regular bet types\n                            }\n                          } else if (viewMode === 'odd-even') {\n                            return game.gameMode === 'odd_even';\n                          } else if (viewMode === 'harf') {\n                            return game.gameMode === 'harf';\n                          }\n                          \n                          return true;\n                        });\n                        \n                        // Calculate totals\n                        const totalBets = filteredGames.length;\n                        const totalBetAmount = filteredGames.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                        const uniqueUsers = new Set(filteredGames.map(game => game.playerId)).size;\n                        \n                        // Calculate potential win based on bet types and odds\n                        const potentialWin = filteredGames.reduce((sum, game) => {\n                          // Default multipliers in case game odds data is unavailable\n                          const defaultMultipliers = {\n                            jodi: 95,\n                            odd_even: 1.95,\n                            harf: 9.5,\n                            single: 9.5,\n                            crossing: 9.5,\n                            default: 9.5\n                          };\n                          \n                          // Initialize with default multiplier based on game mode\n                          let multiplier = defaultMultipliers[game.gameMode as keyof typeof defaultMultipliers] || defaultMultipliers.default;\n                          \n                          // If game odds data is available, use it instead of defaults\n                          if (gameOddsData && Array.isArray(gameOddsData)) {\n                            let gameTypeKey = '';\n                            \n                            // Map game mode to the corresponding game type in the odds data\n                            switch (game.gameMode) {\n                              case 'jodi':\n                                gameTypeKey = 'satamatka_jodi';\n                                break;\n                              case 'odd_even':\n                                gameTypeKey = 'satamatka_odd_even';\n                                break;\n                              case 'harf':\n                                gameTypeKey = 'satamatka_harf';\n                                break;\n                              case 'single':\n                                gameTypeKey = 'satamatka_single';\n                                break;\n                              case 'crossing':\n                                gameTypeKey = 'satamatka_crossing';\n                                break;\n                              default:\n                                gameTypeKey = '';\n                            }\n                            \n                            if (gameTypeKey) {\n                              const odds = gameOddsData.find((odd: any) => odd.gameType === gameTypeKey);\n                              if (odds && odds.oddValue) {\n                                multiplier = odds.oddValue;\n                              }\n                            }\n                          }\n                          \n                          // Calculate potential win amount for this game\n                          return sum + ((game.betAmount || 0) * multiplier);\n                        }, 0);\n                        \n                        return (\n                          <>\n                            {/* Total Active Bet Amount */}\n                            <Card className=\"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border-blue-200 dark:border-blue-700\">\n                              <CardContent className=\"p-4\">\n                                <div className=\"flex items-center justify-between\">\n                                  <div>\n                                    <p className=\"text-sm font-medium text-blue-600 dark:text-blue-400\">Total Bet Amount</p>\n                                    <p className=\"text-2xl font-bold text-blue-800 dark:text-blue-200\">{(totalBetAmount / 100).toFixed(2)}</p>\n                                  </div>\n                                  <div className=\"h-12 w-12 bg-blue-500 rounded-full flex items-center justify-center\">\n                                    <svg className=\"h-6 w-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\" />\n                                    </svg>\n                                  </div>\n                                </div>\n                              </CardContent>\n                            </Card>\n                            \n                            {/* Potential Win */}\n                            <Card className=\"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 border-green-200 dark:border-green-700\">\n                              <CardContent className=\"p-4\">\n                                <div className=\"flex items-center justify-between\">\n                                  <div>\n                                    <p className=\"text-sm font-medium text-green-600 dark:text-green-400\">Potential Win</p>\n                                    <p className=\"text-2xl font-bold text-green-800 dark:text-green-200\">{(potentialWin / 100).toFixed(2)}</p>\n                                  </div>\n                                  <div className=\"h-12 w-12 bg-green-500 rounded-full flex items-center justify-center\">\n                                    <svg className=\"h-6 w-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\" />\n                                    </svg>\n                                  </div>\n                                </div>\n                              </CardContent>\n                            </Card>\n                            \n                            {/* Total Active Users */}\n                            <Card className=\"bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 border-purple-200 dark:border-purple-700\">\n                              <CardContent className=\"p-4\">\n                                <div className=\"flex items-center justify-between\">\n                                  <div>\n                                    <p className=\"text-sm font-medium text-purple-600 dark:text-purple-400\">Active Users</p>\n                                    <p className=\"text-2xl font-bold text-purple-800 dark:text-purple-200\">{uniqueUsers}</p>\n                                  </div>\n                                  <div className=\"h-12 w-12 bg-purple-500 rounded-full flex items-center justify-center\">\n                                    <svg className=\"h-6 w-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\" />\n                                    </svg>\n                                  </div>\n                                </div>\n                              </CardContent>\n                            </Card>\n                            \n                            {/* Total Bet Count */}\n                            <Card className=\"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 border-orange-200 dark:border-orange-700\">\n                              <CardContent className=\"p-4\">\n                                <div className=\"flex items-center justify-between\">\n                                  <div>\n                                    <p className=\"text-sm font-medium text-orange-600 dark:text-orange-400\">Total Bets</p>\n                                    <p className=\"text-2xl font-bold text-orange-800 dark:text-orange-200\">{totalBets}</p>\n                                  </div>\n                                  <div className=\"h-12 w-12 bg-orange-500 rounded-full flex items-center justify-center\">\n                                    <svg className=\"h-6 w-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\n                                    </svg>\n                                  </div>\n                                </div>\n                              </CardContent>\n                            </Card>\n                          </>\n                        );\n                      })()}\n                    </div>\n                    \n                    <ScrollArea className=\"h-[600px]\">\n                      {viewMode === 'odd-even' ? (\n                        <div className=\"p-4\">\n                          <h3 className=\"text-lg font-bold mb-4\">Odd/Even Risk Management</h3>\n                          <div className=\"grid grid-cols-2 gap-6\">\n                            {/* Odd Numbers Section */}\n                            <Card>\n                              <CardHeader>\n                                <CardTitle className=\"text-base\">Odd Bet Type</CardTitle>\n                              </CardHeader>\n                              <CardContent>\n                                {(() => {\n                                  // Filter games specifically for \"odd\" bet type in odd_even game mode\n                                  const oddGames = data.detailedData.gameData.filter(game => {\n                                    if (game.gameType !== 'satamatka') return false;\n                                    if (game.result && game.result !== 'pending') return false;\n                                    if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                                    \n                                    // Look for games specifically with \"odd\" bet type in odd_even game mode\n                                    return game.gameMode === 'odd_even' && game.prediction === 'odd';\n                                  });\n                                  \n                                  // Get game odds from context if available\n                                  let oddEvenMultiplier = 1.9; // Default odds multiplier\n                                  \n                                  // Try to get the custom odds for satamatka_odd_even game type\n                                  if (data.gameOdds && Array.isArray(data.gameOdds)) {\n                                    const oddEvenData = data.gameOdds.find(odd => \n                                      odd.gameType === 'satamatka_odd_even');\n                                    \n                                    if (oddEvenData && oddEvenData.oddValue) {\n                                      // Database stores odds as integer values (e.g., 19000 for 1.9)\n                                      oddEvenMultiplier = oddEvenData.oddValue / 10000;\n                                      console.log('Using satamatka_odd_even odds from database:', oddEvenMultiplier);\n                                    }\n                                  }\n                                  \n                                  // Calculate totals\n                                  const totalBets = oddGames.length;\n                                  const totalBetAmount = oddGames.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                                  // Using the gameOddsData directly to calculate potential win\n                                  let oddEvenMultiplierValue = 1.9; // Default fallback\n                                  \n                                  if (gameOddsData && Array.isArray(gameOddsData)) {\n                                    console.log('Game odds data:', gameOddsData);\n                                    const oddEvenOdds = gameOddsData.find((odd: any) => \n                                      odd.gameType === 'satamatka_odd_even');\n                                    \n                                    if (oddEvenOdds && oddEvenOdds.oddValue !== undefined) {\n                                      console.log('Raw odd_even odds value:', oddEvenOdds.oddValue, 'Type:', typeof oddEvenOdds.oddValue);\n                                      \n                                      // The value is already in the correct format (1.95)\n                                      oddEvenMultiplierValue = oddEvenOdds.oddValue;\n                                      \n                                      console.log('Using actual odd_even multiplier:', oddEvenMultiplierValue);\n                                    }\n                                  }\n                                  \n                                  const potentialWin = oddGames.reduce((sum, game) => sum + ((game.betAmount || 0) * oddEvenMultiplierValue), 0);\n                                  \n                                  // Define risk level\n                                  let riskLevel = 'none';\n                                  if (totalBetAmount > riskThresholds.high) riskLevel = 'high';\n                                  else if (totalBetAmount > riskThresholds.medium) riskLevel = 'medium';\n                                  else if (totalBetAmount > 0) riskLevel = 'low';\n                                  \n                                  return (\n                                    <div className=\"space-y-4\">\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Active Bets:</span>\n                                        <span>{totalBets}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Total Bet Amount:</span>\n                                        <span>{(totalBetAmount / 100).toFixed(2)}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Potential Win:</span>\n                                        <span>{(potentialWin / 100).toFixed(2)}</span>\n                                      </div>\n                                      <div className=\"flex justify-between items-center\">\n                                        <span className=\"font-medium\">Risk Level:</span>\n                                        <span>{getRiskLevelBadge(riskLevel)}</span>\n                                      </div>\n                                      {totalBets > 0 && (\n                                        <Button\n                                          variant=\"outline\"\n                                          size=\"sm\"\n                                          className=\"w-full mt-3\"\n                                          onClick={() => showPlayerDetails(oddGames, `Odd Numbers Players (${totalBets} players)`)}\n                                        >\n                                          <Eye className=\"h-4 w-4 mr-2\" />\n                                          View Players\n                                        </Button>\n                                      )}\n                                    </div>\n                                  );\n                                })()}\n                              </CardContent>\n                            </Card>\n                            \n                            {/* Even Numbers Section */}\n                            <Card>\n                              <CardHeader>\n                                <CardTitle className=\"text-base\">Even Bet Type</CardTitle>\n                              </CardHeader>\n                              <CardContent>\n                                {(() => {\n                                  // Filter games specifically for \"even\" bet type in odd_even game mode\n                                  const evenGames = data.detailedData.gameData.filter(game => {\n                                    if (game.gameType !== 'satamatka') return false;\n                                    if (game.result && game.result !== 'pending') return false;\n                                    if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                                    \n                                    // Look for games specifically with \"even\" bet type in odd_even game mode\n                                    return game.gameMode === 'odd_even' && game.prediction === 'even';\n                                  });\n                                  \n                                  // Get game odds from context if available\n                                  let oddEvenMultiplier = 1.9; // Default odds multiplier\n                                  \n                                  // Try to get the custom odds for satamatka_odd_even game type\n                                  if (data.gameOdds && Array.isArray(data.gameOdds)) {\n                                    const oddEvenData = data.gameOdds.find(odd => \n                                      odd.gameType === 'satamatka_odd_even');\n                                    \n                                    if (oddEvenData && oddEvenData.oddValue) {\n                                      // Database stores odds as integer values (e.g., 19000 for 1.9)\n                                      oddEvenMultiplier = oddEvenData.oddValue / 10000;\n                                      console.log('Using satamatka_odd_even odds from database for even bets:', oddEvenMultiplier);\n                                    }\n                                  }\n                                  \n                                  // Calculate totals\n                                  const totalBets = evenGames.length;\n                                  const totalBetAmount = evenGames.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                                  // Using the gameOddsData directly to calculate potential win\n                                  let oddEvenMultiplierValue = 1.9; // Default fallback\n                                  \n                                  if (gameOddsData && Array.isArray(gameOddsData)) {\n                                    console.log('Game odds data for even bets:', gameOddsData);\n                                    const oddEvenOdds = gameOddsData.find((odd: any) => \n                                      odd.gameType === 'satamatka_odd_even');\n                                    \n                                    if (oddEvenOdds && oddEvenOdds.oddValue !== undefined) {\n                                      console.log('Raw odd_even odds value for even:', oddEvenOdds.oddValue, 'Type:', typeof oddEvenOdds.oddValue);\n                                      \n                                      // The value is already in the correct format (1.95)\n                                      oddEvenMultiplierValue = oddEvenOdds.oddValue;\n                                      \n                                      console.log('Using actual odd_even multiplier for even:', oddEvenMultiplierValue);\n                                    }\n                                  }\n                                  \n                                  const potentialWin = evenGames.reduce((sum, game) => sum + ((game.betAmount || 0) * oddEvenMultiplierValue), 0);\n                                  \n                                  // Define risk level\n                                  let riskLevel = 'none';\n                                  if (totalBetAmount > riskThresholds.high) riskLevel = 'high';\n                                  else if (totalBetAmount > riskThresholds.medium) riskLevel = 'medium';\n                                  else if (totalBetAmount > 0) riskLevel = 'low';\n                                  \n                                  return (\n                                    <div className=\"space-y-4\">\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Active Bets:</span>\n                                        <span>{totalBets}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Total Bet Amount:</span>\n                                        <span>{(totalBetAmount / 100).toFixed(2)}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Potential Win:</span>\n                                        <span>{(potentialWin / 100).toFixed(2)}</span>\n                                      </div>\n                                      <div className=\"flex justify-between items-center\">\n                                        <span className=\"font-medium\">Risk Level:</span>\n                                        <span>{getRiskLevelBadge(riskLevel)}</span>\n                                      </div>\n                                      {totalBets > 0 && (\n                                        <Button\n                                          variant=\"outline\"\n                                          size=\"sm\"\n                                          className=\"w-full mt-3\"\n                                          onClick={() => showPlayerDetails(evenGames, `Even Numbers Players (${totalBets} players)`)}\n                                        >\n                                          <Eye className=\"h-4 w-4 mr-2\" />\n                                          View Players\n                                        </Button>\n                                      )}\n                                    </div>\n                                  );\n                                })()}\n                              </CardContent>\n                            </Card>\n                          </div>\n                        </div>\n                      ) : viewMode === 'harf' ? (\n                        <div className=\"p-4\">\n                          <h3 className=\"text-lg font-bold mb-4 text-primary-foreground\">Harf Risk Management</h3>\n                          \n                          {/* Left Digits (A0-A9) Table */}\n                          <Card className=\"mb-6 border-primary/20 bg-primary/5\">\n                            <CardHeader className=\"border-b border-primary/20\">\n                              <CardTitle className=\"text-base\">Left Digit (A0-A9) - Position 1</CardTitle>\n                            </CardHeader>\n                            <CardContent>\n                              <Table>\n                                <TableHeader>\n                                  <TableRow>\n                                    <TableHead>Number</TableHead>\n                                    <TableHead>Active Bets</TableHead>\n                                    <TableHead>Bet Amount</TableHead>\n                                    <TableHead>Potential Win</TableHead>\n                                    <TableHead>Risk Level</TableHead>\n                                    <TableHead>Action</TableHead>\n                                  </TableRow>\n                                </TableHeader>\n                                <TableBody>\n                                  {Array.from({ length: 10 }, (_, i) => {\n                                    const digit = i.toString();\n                                    \n                                    // Filter games for this left digit\n                                    const gamesForLeftDigit = data.detailedData.gameData.filter(game => {\n                                      if (game.gameType !== 'satamatka') return false;\n                                      if (game.result && game.result !== 'pending') return false;\n                                      if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                                      \n                                      // For left digit (A0-A9), check if it's a harf bet with \"A\" prefix\n                                      return game.gameMode === 'harf' && game.prediction === `A${digit}`;\n                                    });\n                                    \n                                    // Calculate totals\n                                    const totalBets = gamesForLeftDigit.length;\n                                    const totalBetAmount = gamesForLeftDigit.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                                    // Get the actual odds for harf games from fetched data\n                                    let harfMultiplier = 9; // Default fallback\n                                    \n                                    if (gameOddsData && Array.isArray(gameOddsData)) {\n                                      const harfOdds = gameOddsData.find((odd: any) => \n                                        odd.gameType === 'satamatka_harf');\n                                      \n                                      if (harfOdds && harfOdds.oddValue !== undefined) {\n                                        console.log('Raw harf odds value:', harfOdds.oddValue, 'Type:', typeof harfOdds.oddValue);\n                                        \n                                        // Handle different formats of the odds value\n                                        if (harfOdds.oddValue >= 10000) {\n                                          // Format: 90000 = 9\n                                          harfMultiplier = harfOdds.oddValue / 10000;\n                                        } else if (harfOdds.oddValue >= 10) {\n                                          // Format: 95 = 9.5\n                                          harfMultiplier = harfOdds.oddValue;\n                                        } else {\n                                          // Direct value format\n                                          harfMultiplier = harfOdds.oddValue;\n                                        }\n                                        \n                                        console.log('Using actual harf multiplier:', harfMultiplier);\n                                      }\n                                    }\n                                    \n                                    const potentialWin = gamesForLeftDigit.reduce((sum, game) => sum + ((game.betAmount || 0) * harfMultiplier), 0);\n                                    \n                                    // Define risk level\n                                    let riskLevel = 'none';\n                                    if (totalBetAmount > riskThresholds.high) riskLevel = 'high';\n                                    else if (totalBetAmount > riskThresholds.medium) riskLevel = 'medium';\n                                    else if (totalBetAmount > 0) riskLevel = 'low';\n                                    \n                                    return (\n                                      <TableRow key={`left-${digit}`} className={\n                                        riskLevel === 'high' ? 'bg-primary/20 hover:bg-primary/25 border-b border-primary/30' :\n                                        riskLevel === 'medium' ? 'bg-primary/10 hover:bg-primary/15 border-b border-primary/20' :\n                                        riskLevel === 'low' ? 'bg-primary/5 hover:bg-primary/10 border-b border-primary/10' : \n                                        'hover:bg-primary/5 border-b border-primary/5'\n                                      }>\n                                        <TableCell className=\"font-medium\">A{digit}</TableCell>\n                                        <TableCell>{totalBets}</TableCell>\n                                        <TableCell>{(totalBetAmount / 100).toFixed(2)}</TableCell>\n                                        <TableCell>{(potentialWin / 100).toFixed(2)}</TableCell>\n                                        <TableCell>{getRiskLevelBadge(riskLevel)}</TableCell>\n                                        <TableCell>\n                                          {totalBets > 0 && (\n                                            <Button\n                                              variant=\"outline\"\n                                              size=\"sm\"\n                                              onClick={() => showPlayerDetails(gamesForLeftDigit, `Left Digit A${digit} Players (${totalBets} players)`)}\n                                            >\n                                              <Eye className=\"h-4 w-4\" />\n                                            </Button>\n                                          )}\n                                        </TableCell>\n                                      </TableRow>\n                                    );\n                                  })}\n                                </TableBody>\n                              </Table>\n                            </CardContent>\n                          </Card>\n                          \n                          {/* Right Digits (B0-B9) Table */}\n                          <Card className=\"border-primary/20 bg-primary/5\">\n                            <CardHeader className=\"border-b border-primary/20\">\n                              <CardTitle className=\"text-base\">Right Digit (B0-B9) - Position 2</CardTitle>\n                            </CardHeader>\n                            <CardContent>\n                              <Table>\n                                <TableHeader>\n                                  <TableRow>\n                                    <TableHead>Number</TableHead>\n                                    <TableHead>Active Bets</TableHead>\n                                    <TableHead>Bet Amount</TableHead>\n                                    <TableHead>Potential Win</TableHead>\n                                    <TableHead>Risk Level</TableHead>\n                                    <TableHead>Action</TableHead>\n                                  </TableRow>\n                                </TableHeader>\n                                <TableBody>\n                                  {Array.from({ length: 10 }, (_, i) => {\n                                    const digit = i.toString();\n                                    \n                                    // Filter games for this right digit\n                                    const gamesForRightDigit = data.detailedData.gameData.filter(game => {\n                                      if (game.gameType !== 'satamatka') return false;\n                                      if (game.result && game.result !== 'pending') return false;\n                                      if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                                      \n                                      // For right digit (B0-B9), check if it's a harf bet with \"B\" prefix\n                                      return game.gameMode === 'harf' && game.prediction === `B${digit}`;\n                                    });\n                                    \n                                    // Calculate totals\n                                    const totalBets = gamesForRightDigit.length;\n                                    const totalBetAmount = gamesForRightDigit.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                                    // Get the actual odds for harf games from fetched data\n                                    let harfMultiplier = 9; // Default fallback\n                                    \n                                    if (gameOddsData && Array.isArray(gameOddsData)) {\n                                      const harfOdds = gameOddsData.find((odd: any) => \n                                        odd.gameType === 'satamatka_harf');\n                                      \n                                      if (harfOdds && harfOdds.oddValue !== undefined) {\n                                        console.log('Raw harf odds value for right digit:', harfOdds.oddValue, 'Type:', typeof harfOdds.oddValue);\n                                        \n                                        // Handle different formats of the odds value\n                                        if (harfOdds.oddValue >= 10000) {\n                                          // Format: 90000 = 9\n                                          harfMultiplier = harfOdds.oddValue / 10000;\n                                        } else if (harfOdds.oddValue >= 10) {\n                                          // Format: 95 = 9.5\n                                          harfMultiplier = harfOdds.oddValue;\n                                        } else {\n                                          // Direct value format\n                                          harfMultiplier = harfOdds.oddValue;\n                                        }\n                                        \n                                        console.log('Using actual harf multiplier for right digit:', harfMultiplier);\n                                      }\n                                    }\n                                    \n                                    const potentialWin = gamesForRightDigit.reduce((sum, game) => sum + ((game.betAmount || 0) * harfMultiplier), 0);\n                                    \n                                    // Define risk level\n                                    let riskLevel = 'none';\n                                    if (totalBetAmount > riskThresholds.high) riskLevel = 'high';\n                                    else if (totalBetAmount > riskThresholds.medium) riskLevel = 'medium';\n                                    else if (totalBetAmount > 0) riskLevel = 'low';\n                                    \n                                    return (\n                                      <TableRow key={`right-${digit}`} className={\n                                        riskLevel === 'high' ? 'bg-primary/20 hover:bg-primary/25 border-b border-primary/30' :\n                                        riskLevel === 'medium' ? 'bg-primary/10 hover:bg-primary/15 border-b border-primary/20' :\n                                        riskLevel === 'low' ? 'bg-primary/5 hover:bg-primary/10 border-b border-primary/10' : \n                                        'hover:bg-primary/5 border-b border-primary/5'\n                                      }>\n                                        <TableCell className=\"font-medium\">B{digit}</TableCell>\n                                        <TableCell>{totalBets}</TableCell>\n                                        <TableCell>{(totalBetAmount / 100).toFixed(2)}</TableCell>\n                                        <TableCell>{(potentialWin / 100).toFixed(2)}</TableCell>\n                                        <TableCell>{getRiskLevelBadge(riskLevel)}</TableCell>\n                                        <TableCell>\n                                          {totalBets > 0 && (\n                                            <Button\n                                              variant=\"outline\"\n                                              size=\"sm\"\n                                              onClick={() => showPlayerDetails(gamesForRightDigit, `Right Digit B${digit} Players (${totalBets} players)`)}\n                                            >\n                                              <Eye className=\"h-4 w-4\" />\n                                            </Button>\n                                          )}\n                                        </TableCell>\n                                      </TableRow>\n                                    );\n                                  })}\n                                </TableBody>\n                              </Table>\n                            </CardContent>\n                          </Card>\n                        </div>\n                      ) : (\n                        <Table className=\"border-collapse bg-primary/5\">\n                          <TableHeader className=\"sticky top-0 z-10\">\n                            <TableRow className=\"border-b border-primary/30 bg-primary/10 backdrop-blur-sm\">\n                              <TableHead className=\"w-[80px] font-semibold text-foreground\">Number</TableHead>\n                              <TableHead className=\"w-[100px] font-semibold text-foreground\">Active Bets</TableHead>\n                              <TableHead className=\"w-[150px] font-semibold text-foreground\">Bet Amount</TableHead>\n                              <TableHead className=\"w-[150px] font-semibold text-foreground\">Potential Win</TableHead>\n                              <TableHead className=\"font-semibold text-foreground\">Bet Types</TableHead>\n                              <TableHead className=\"w-[120px] font-semibold text-foreground\">Market</TableHead>\n                              <TableHead className=\"w-[100px] font-semibold text-foreground\">Risk Level</TableHead>\n                              <TableHead className=\"w-[120px] font-semibold text-foreground\">Action</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody className=\"bg-transparent\">\n                            {Array.from({ length: 100 }, (_, i) => {\n                              // Format number as two digits (e.g., 00, 01, ..., 99)\n                              const num = i.toString().padStart(2, '0');\n                              \n                              // Filter games for this number\n                              const gamesForNumber = data.detailedData.gameData.filter(game => {\n                                if (game.gameType !== 'satamatka') return false;\n                                if (game.result && game.result !== 'pending') return false;\n                                if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                                if (betTypeFilter !== 'all' && game.prediction !== betTypeFilter && game.prediction !== num) return false;\n                                \n                                // Match exact number predictions (jodi format - 00 to 99)\n                                return game.prediction === num;\n                              });\n                              \n                              // Calculate total bet amount for this number\n                              const totalBetAmount = gamesForNumber.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                              \n                              // Get the actual odds for jodi games from fetched data\n                              let jodiMultiplier = 90; // Default fallback\n                              \n                              if (gameOddsData && Array.isArray(gameOddsData)) {\n                                const jodiOdds = gameOddsData.find((odd: any) => \n                                  odd.gameType === 'satamatka_jodi');\n                                \n                                if (jodiOdds && jodiOdds.oddValue !== undefined) {\n                                  console.log('Raw jodi odds value:', jodiOdds.oddValue, 'Type:', typeof jodiOdds.oddValue);\n                                  \n                                  // Handle different formats of the odds value\n                                  if (jodiOdds.oddValue >= 100000) {\n                                    // Format: 900000 = 90\n                                    jodiMultiplier = jodiOdds.oddValue / 10000;\n                                  } else if (jodiOdds.oddValue >= 10) {\n                                    // Format: 95 = 95\n                                    jodiMultiplier = jodiOdds.oddValue;\n                                  } else {\n                                    // Direct value format\n                                    jodiMultiplier = jodiOdds.oddValue;\n                                  }\n                                  \n                                  console.log('Using actual jodi multiplier:', jodiMultiplier);\n                                }\n                              }\n                              \n                              // Calculate potential win using dynamic odds\n                              const potentialWin = gamesForNumber.reduce((sum, game) => sum + ((game.betAmount || 0) * jodiMultiplier), 0);\n                              \n                              // Get bet types for this number\n                              const betTypes = Array.from(new Set(gamesForNumber.map(game => \n                                game.gameMode || \"Jodi\"\n                              ))).join(', ');\n                              \n                              // Define the risk level based on bet amount using configurable thresholds\n                              let riskLevel = 'none';\n                              if (totalBetAmount > riskThresholds.high) riskLevel = 'high';\n                              else if (totalBetAmount > riskThresholds.medium) riskLevel = 'medium';\n                              else if (totalBetAmount > 0) riskLevel = 'low';\n                              \n                              // Skip rows with no bets\n                              if (gamesForNumber.length === 0) {\n                                return null;\n                              }\n                              \n                              return (\n                                <TableRow \n                                  key={num}\n                                  className={\n                                    riskLevel === 'high' ? 'bg-primary-foreground/5 hover:bg-primary-foreground/10 border-b border-primary/30' :\n                                    riskLevel === 'medium' ? 'bg-primary/5 hover:bg-primary/10 border-b border-primary/20' :\n                                    riskLevel === 'low' ? 'bg-primary/10 hover:bg-primary/15 border-b border-primary/30' : \n                                    'bg-background hover:bg-primary/5 border-b border-primary/10'\n                                  }\n                                >\n                                  <TableCell className=\"font-medium\">{num}</TableCell>\n                                  <TableCell>{gamesForNumber.length}</TableCell>\n                                  <TableCell>{(totalBetAmount / 100).toFixed(2)}</TableCell>\n                                  <TableCell>{(potentialWin / 100).toFixed(2)}</TableCell>\n                                  <TableCell>{betTypes}</TableCell>\n                                  <TableCell>\n                                    {Array.from(new Set(gamesForNumber.map(game => {\n                                      const marketId = game.marketId?.toString();\n                                      return marketId && marketInfo[marketId] \n                                        ? marketInfo[marketId].name \n                                        : 'Unknown';\n                                    }))).join(', ')}\n                                  </TableCell>\n                                  <TableCell>\n                                    {getRiskLevelBadge(riskLevel)}\n                                  </TableCell>\n                                  <TableCell>\n                                    <Button\n                                      variant=\"outline\"\n                                      size=\"sm\"\n                                      onClick={() => showPlayerDetails(gamesForNumber, `Number ${num} Players (${gamesForNumber.length} players)`)}\n                                    >\n                                      <Eye className=\"h-4 w-4 mr-2\" />\n                                      View Players\n                                    </Button>\n                                  </TableCell>\n                                </TableRow>\n                              );\n                            }).filter(Boolean)}\n                          </TableBody>\n                        </Table>\n                      )}\n                    </ScrollArea>\n                  </CardContent>\n                </Card>\n              </>\n            )}\n          </TabsContent>\n          \n          <TabsContent value=\"cricket-toss\" className=\"mt-0\">\n            {cricketTossData ? (\n              <div className=\"space-y-6\">\n                {/* Cricket Overview Cards */}\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Active Cricket Bets\n                      </CardTitle>\n                      <Activity className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{cricketTossData.activeBets}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        From {cricketTossData.totalBets} total bets\n                      </p>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Total Bet Amount\n                      </CardTitle>\n                      <Target className=\"h-4 w-4 text-orange-500\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{(cricketTossData.totalBetAmount/100).toFixed(2)}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Across all cricket toss bets\n                      </p>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Active Betted Users\n                      </CardTitle>\n                      <Users className=\"h-4 w-4 text-purple-500\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">\n                        {(() => {\n                          // Calculate actual active users from cricket match analysis\n                          let activeUsers = 0;\n                          if (data.detailedData?.cricketMatchAnalysis) {\n                            const allUsers = new Set();\n                            data.detailedData.cricketMatchAnalysis.forEach((match: any) => {\n                              if (match.teamAStats?.users) {\n                                match.teamAStats.users.forEach((userId: number) => allUsers.add(userId));\n                              }\n                              if (match.teamBStats?.users) {\n                                match.teamBStats.users.forEach((userId: number) => allUsers.add(userId));\n                              }\n                            });\n                            activeUsers = allUsers.size;\n                          }\n                          return activeUsers;\n                        })()}\n                      </div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Players with active cricket bets\n                      </p>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Potential Win\n                      </CardTitle>\n                      <TrendingUp className=\"h-4 w-4 text-green-500\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">\n                        {(() => {\n                          // Calculate actual cricket match potential payout\n                          let totalPotentialPayout = 0;\n                          if (data.detailedData?.cricketMatchAnalysis) {\n                            totalPotentialPayout = data.detailedData.cricketMatchAnalysis.reduce((sum: number, match: any) => {\n                              return sum + (match.summary?.maxPotentialPayout || 0);\n                            }, 0);\n                          }\n                          return (totalPotentialPayout / 100).toFixed(2);\n                        })()}\n                      </div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Maximum possible payout\n                      </p>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Cricket Match Analysis */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Cricket Toss Match Analysis</CardTitle>\n                    <CardDescription>Detailed risk assessment for each cricket match with team-wise betting data</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    {data.detailedData?.cricketMatchAnalysis && data.detailedData.cricketMatchAnalysis.length > 0 ? (\n                      <div className=\"space-y-6\">\n                        {data.detailedData.cricketMatchAnalysis.map((match: any) => (\n                          <Card key={match.matchId} className=\"border-l-4 border-l-blue-500\">\n                            <CardHeader className=\"pb-3\">\n                              <div className=\"flex items-center justify-between\">\n                                <div>\n                                  <CardTitle className=\"text-lg\">\n                                    {match.matchInfo.teamA} vs {match.matchInfo.teamB}\n                                  </CardTitle>\n                                  <CardDescription className=\"mt-1\">\n                                    {match.matchInfo.description}  {new Date(match.matchInfo.matchTime).toLocaleString()}\n                                  </CardDescription>\n                                </div>\n                                <Badge className={\n                                  match.summary.riskLevel === 'high' ? 'bg-red-500' :\n                                  match.summary.riskLevel === 'medium' ? 'bg-orange-500' : 'bg-green-500'\n                                }>\n                                  {match.summary.riskLevel.toUpperCase()} RISK\n                                </Badge>\n                              </div>\n                            </CardHeader>\n                            <CardContent>\n                              {/* Match Summary */}\n                              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n                                <div className=\"text-center p-3 bg-primary/10 border border-primary/20 rounded-lg\">\n                                  <div className=\"text-lg font-bold text-foreground\">{match.summary.totalBets}</div>\n                                  <div className=\"text-xs text-muted-foreground\">Total Bets</div>\n                                </div>\n                                <div className=\"text-center p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg\">\n                                  <div className=\"text-lg font-bold text-foreground\">{(match.summary.totalAmount / 100).toFixed(0)}</div>\n                                  <div className=\"text-xs text-muted-foreground\">Total Amount</div>\n                                </div>\n                                <div className=\"text-center p-3 bg-green-500/10 border border-green-500/20 rounded-lg\">\n                                  <div className=\"text-lg font-bold text-foreground\">{(match.summary.potentialProfit / 100).toFixed(0)}</div>\n                                  <div className=\"text-xs text-muted-foreground\">Potential Profit</div>\n                                </div>\n                                <div className=\"text-center p-3 bg-red-500/10 border border-red-500/20 rounded-lg\">\n                                  <div className=\"text-lg font-bold text-foreground\">{(match.summary.potentialLoss / 100).toFixed(0)}</div>\n                                  <div className=\"text-xs text-muted-foreground\">Potential Loss</div>\n                                </div>\n                              </div>\n\n                              {/* Team-wise Analysis */}\n                              <div className=\"grid md:grid-cols-2 gap-6\">\n                                {/* Team A */}\n                                <Card className=\"border-primary/30 bg-primary/5\">\n                                  <CardHeader className=\"pb-3 border-b border-primary/20\">\n                                    <div className=\"flex items-center justify-between\">\n                                      <CardTitle className=\"text-base text-foreground\">{match.matchInfo.teamA}</CardTitle>\n                                      <Badge variant=\"outline\" className=\"text-xs bg-primary/10 border-primary/30\">\n                                        Odds: {(match.matchInfo.oddTeamA / 100).toFixed(2)}x\n                                      </Badge>\n                                    </div>\n                                  </CardHeader>\n                                  <CardContent className=\"space-y-3\">\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Active Bets:</span>\n                                      <span className=\"font-medium\">{match.teamAStats.totalBets}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Total Amount:</span>\n                                      <span className=\"font-medium\">{(match.teamAStats.totalAmount / 100).toFixed(0)}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Potential Payout:</span>\n                                      <span className=\"font-bold text-red-600\">{(match.teamAStats.potentialPayout / 100).toFixed(0)}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Players:</span>\n                                      <span className=\"font-medium\">{match.teamAStats.users.length}</span>\n                                    </div>\n                                    {match.teamAStats.users.length > 0 && (\n                                      <div className=\"mt-3\">\n                                        <span className=\"text-xs text-muted-foreground\">Players:</span>\n                                        <div className=\"flex flex-wrap gap-1 mt-1\">\n                                          {match.teamAStats.users.slice(0, 3).map((userId: number) => (\n                                            <Badge key={userId} variant=\"secondary\" className=\"text-xs\">\n                                              {userInfo[userId]?.username || `User ${userId}`}\n                                            </Badge>\n                                          ))}\n                                          {match.teamAStats.users.length > 3 && (\n                                            <Badge variant=\"secondary\" className=\"text-xs\">\n                                              +{match.teamAStats.users.length - 3} more\n                                            </Badge>\n                                          )}\n                                        </div>\n                                      </div>\n                                    )}\n                                  </CardContent>\n                                </Card>\n\n                                {/* Team B */}\n                                <Card className=\"border-primary/30 bg-primary/5\">\n                                  <CardHeader className=\"pb-3 border-b border-primary/20\">\n                                    <div className=\"flex items-center justify-between\">\n                                      <CardTitle className=\"text-base text-foreground\">{match.matchInfo.teamB}</CardTitle>\n                                      <Badge variant=\"outline\" className=\"text-xs bg-primary/10 border-primary/30\">\n                                        Odds: {(match.matchInfo.oddTeamB / 100).toFixed(2)}x\n                                      </Badge>\n                                    </div>\n                                  </CardHeader>\n                                  <CardContent className=\"space-y-3\">\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Active Bets:</span>\n                                      <span className=\"font-medium\">{match.teamBStats.totalBets}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Total Amount:</span>\n                                      <span className=\"font-medium\">{(match.teamBStats.totalAmount / 100).toFixed(0)}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Potential Payout:</span>\n                                      <span className=\"font-bold text-red-600\">{(match.teamBStats.potentialPayout / 100).toFixed(0)}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Players:</span>\n                                      <span className=\"font-medium\">{match.teamBStats.users.length}</span>\n                                    </div>\n                                    {match.teamBStats.users.length > 0 && (\n                                      <div className=\"mt-3\">\n                                        <span className=\"text-xs text-muted-foreground\">Players:</span>\n                                        <div className=\"flex flex-wrap gap-1 mt-1\">\n                                          {match.teamBStats.users.slice(0, 3).map((userId: number) => (\n                                            <Badge key={userId} variant=\"secondary\" className=\"text-xs\">\n                                              {userInfo[userId]?.username || `User ${userId}`}\n                                            </Badge>\n                                          ))}\n                                          {match.teamBStats.users.length > 3 && (\n                                            <Badge variant=\"secondary\" className=\"text-xs\">\n                                              +{match.teamBStats.users.length - 3} more\n                                            </Badge>\n                                          )}\n                                        </div>\n                                      </div>\n                                    )}\n                                  </CardContent>\n                                </Card>\n                              </div>\n                            </CardContent>\n                          </Card>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-8\">\n                        <Activity className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                        <h3 className=\"text-lg font-medium mb-2\">No Active Cricket Matches</h3>\n                        <p className=\"text-muted-foreground\">\n                          There are currently no cricket toss matches with active bets in the system.\n                        </p>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            ) : (\n              <Card>\n                <CardHeader>\n                  <CardTitle>Cricket Toss Risk Management</CardTitle>\n                  <CardDescription>No cricket toss data available</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <p>There are currently no active cricket toss games in the system.</p>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":101767,"size_tokens":null},"server/deposit-discount-endpoint.ts":{"content":"import { Router } from 'express';\nimport { storage } from './storage';\nimport { z } from 'zod';\nimport { UserRole } from '@shared/schema';\n\nconst router = Router();\n\n// Middleware to check if user is a subadmin\nconst isSubadmin = (req, res, next) => {\n  if (!req.user) {\n    return res.status(401).json({ error: 'Unauthorized' });\n  }\n  \n  if (req.user.role !== UserRole.SUBADMIN) {\n    return res.status(403).json({ error: 'Only subadmins can manage deposit discounts' });\n  }\n  \n  next();\n};\n\n// Get deposit discount for a specific player\nrouter.get('/deposit-discount/:userId', isSubadmin, async (req, res) => {\n  try {\n    const userId = parseInt(req.params.userId);\n    const subadminId = req.user.id;\n    \n    if (isNaN(userId)) {\n      return res.status(400).json({ error: 'Invalid user ID' });\n    }\n    \n    const discount = await storage.getPlayerDepositDiscount(userId, subadminId);\n    return res.json(discount || { discountRate: 0 });\n  } catch (error) {\n    console.error('Error getting deposit discount:', error);\n    return res.status(500).json({ error: 'Internal server error' });\n  }\n});\n\n// Set or update deposit discount for a player\nrouter.post('/deposit-discount/:userId', isSubadmin, async (req, res) => {\n  try {\n    const userId = parseInt(req.params.userId);\n    const subadminId = req.user.id;\n    \n    const schema = z.object({\n      discountRate: z.number().int().min(0).max(100)\n    });\n    \n    const validationResult = schema.safeParse(req.body);\n    if (!validationResult.success) {\n      return res.status(400).json({ error: 'Invalid discount rate. Must be a number between 0 and 100.' });\n    }\n    \n    const { discountRate } = validationResult.data;\n    \n    // Verify the player exists and is assigned to this subadmin\n    const player = await storage.getUser(userId);\n    if (!player) {\n      return res.status(404).json({ error: 'Player not found' });\n    }\n    \n    if (player.role !== UserRole.PLAYER) {\n      return res.status(400).json({ error: 'User is not a player' });\n    }\n    \n    if (player.assignedTo !== subadminId) {\n      return res.status(403).json({ error: 'Player is not assigned to this subadmin' });\n    }\n    \n    const updatedDiscount = await storage.upsertPlayerDepositDiscount(subadminId, userId, discountRate);\n    return res.json(updatedDiscount);\n  } catch (error) {\n    console.error('Error setting deposit discount:', error);\n    return res.status(500).json({ error: 'Internal server error' });\n  }\n});\n\n// Get all deposit discounts for this subadmin's players\nrouter.get('/deposit-discounts', isSubadmin, async (req, res) => {\n  try {\n    const subadminId = req.user.id;\n    \n    // Get all players assigned to this subadmin\n    const players = await storage.getUsersByAssignedTo(subadminId);\n    \n    // Get discount for each player\n    const results = await Promise.all(\n      players.map(async (player) => {\n        const discount = await storage.getPlayerDepositDiscount(player.id, subadminId);\n        return {\n          userId: player.id,\n          username: player.username,\n          discountRate: discount?.discountRate || 0\n        };\n      })\n    );\n    \n    return res.json(results);\n  } catch (error) {\n    console.error('Error getting deposit discounts:', error);\n    return res.status(500).json({ error: 'Internal server error' });\n  }\n});\n\nexport default router;","path":null,"size_bytes":3348,"size_tokens":null},"client/src/pages/user-details-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useParams, useLocation } from \"wouter\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { \n  ArrowDown, \n  ArrowUp, \n  BarChart, \n  ChevronLeft, \n  ChevronRight, \n  Clock, \n  FileText, \n  History,\n  User,\n  IndianRupee,\n  UserCog,\n  CalendarDays,\n  Gift,\n  Pencil\n} from \"lucide-react\";\n\nexport default function UserDetailsPage() {\n  const { id } = useParams<{ id: string }>();\n  const userId = parseInt(id);\n  const [_, navigate] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState<string>(\"transactions\");\n  \n  // Pagination states\n  const [transactionsPage, setTransactionsPage] = useState(1);\n  const [betsPage, setBetsPage] = useState(1);\n  const [activeBetsPage, setActiveBetsPage] = useState(1);\n  const [itemsPerPage] = useState(10);\n  \n  // Rewards states\n  const [isEditingCommission, setIsEditingCommission] = useState(false);\n  const [newCommissionRate, setNewCommissionRate] = useState(\"\");\n  \n  // Fetch user details\n  const { data: selectedUser, isLoading: isLoadingUser } = useQuery({\n    queryKey: [\"/api/users\", userId],\n    queryFn: async () => {\n      const res = await apiRequest(\"GET\", `/api/users/${userId}`);\n      return await res.json();\n    },\n    enabled: !!userId,\n  });\n  \n  // Fetch user transactions\n  const { data: userTransactions = [], isLoading: isLoadingTransactions } = useQuery({\n    queryKey: [\"/api/transactions\", userId],\n    queryFn: async () => {\n      const res = await apiRequest(\"GET\", `/api/transactions/${userId}`);\n      return await res.json();\n    },\n    enabled: !!userId && activeTab === \"transactions\",\n  });\n  \n  // Fetch user games\n  const { data: userGames = [], isLoading: isLoadingGames } = useQuery({\n    queryKey: [\"/api/games\", userId],\n    queryFn: async () => {\n      const res = await apiRequest(\"GET\", `/api/games/${userId}`);\n      return await res.json();\n    },\n    enabled: !!userId && activeTab === \"bets\",\n  });\n  \n  // Fetch active bets (pending games) for the user\n  const { data: userActiveBets = [], isLoading: isLoadingActiveBets } = useQuery({\n    queryKey: [\"/api/games/pending\", userId],\n    queryFn: async () => {\n      // Get all games for this user\n      const res = await apiRequest(\"GET\", `/api/games/${userId}`);\n      const allGames = await res.json();\n      \n      // Better pending game detection\n      const activeBets = allGames.filter((game: any) => {\n        const isPending = !game.result || \n                         game.result === \"\" || \n                         game.result === \"pending\" ||\n                         (game.game_data && game.game_data.status === \"open\");\n        return isPending;\n      });\n      \n      return activeBets;\n    },\n    enabled: !!userId && activeTab === \"active-bets\",\n  });\n  \n  // Fetch user rewards data\n  const { data: rewardsData, isLoading: isLoadingRewards } = useQuery({\n    queryKey: [\"/api/users\", userId, \"rewards\"],\n    queryFn: async () => {\n      const res = await apiRequest(\"GET\", `/api/users/${userId}/rewards`);\n      return await res.json();\n    },\n    enabled: !!userId && activeTab === \"rewards\",\n  });\n  \n  // Fetch satamatka markets for market name lookup\n  const { data: satamatkaMarkets = [] } = useQuery({\n    queryKey: [\"/api/satamatka/markets\"],\n    queryFn: async () => {\n      const res = await apiRequest(\"GET\", \"/api/satamatka/markets\");\n      return await res.json();\n    },\n    enabled: activeTab === \"bets\" || activeTab === \"active-bets\",\n  });\n  \n  // Create market lookup map\n  const marketLookup = new Map(\n    satamatkaMarkets.map((market: any) => [market.id, market.name])\n  );\n  \n  // Helper function to format game mode\n  const formatGameMode = (gameMode?: string) => {\n    if (!gameMode) return '';\n    switch(gameMode) {\n      case 'jodi': return 'Jodi';\n      case 'harf': return 'Harf';\n      case 'crossing': return 'Crossing';\n      case 'odd_even': return 'Odd/Even';\n      default: return gameMode.replace(/_/g, ' ');\n    }\n  };\n  \n  // Helper function to get market name for Satamatka games\n  const getSatamatkaMarketInfo = (game: any) => {\n    const marketName = game.marketId ? marketLookup.get(game.marketId) : null;\n    const gameModeName = game.gameMode ? formatGameMode(game.gameMode) : '';\n    \n    if (marketName) {\n      return `${marketName}${gameModeName ? ` - ${gameModeName}` : ''}`;\n    }\n    return gameModeName ? `${gameModeName} (${game.prediction})` : \"Satamatka Game\";\n  };\n  \n  // Update commission mutation\n  const updateCommissionMutation = useMutation({\n    mutationFn: async (commission: number) => {\n      const res = await apiRequest(\"PATCH\", `/api/users/${userId}/reward-commission`, {\n        rewardCommission: commission\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\", userId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\", userId, \"rewards\"] });\n      setIsEditingCommission(false);\n      toast({\n        title: \"Commission Updated\",\n        description: \"The reward commission has been updated successfully.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update commission\",\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Handle commission update\n  const handleCommissionUpdate = () => {\n    const rate = parseFloat(newCommissionRate);\n    if (isNaN(rate) || rate < 0 || rate > 100) {\n      toast({\n        title: \"Invalid Value\",\n        description: \"Please enter a percentage between 0 and 100\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    // Convert percentage to basis points (e.g., 5% = 500)\n    const commissionInBasisPoints = Math.round(rate * 100);\n    updateCommissionMutation.mutate(commissionInBasisPoints);\n  };\n  \n  // Pagination helpers\n  const getPageCount = (totalItems: number) => Math.ceil(totalItems / itemsPerPage);\n  \n  const getPaginatedItems = (items: any[], page: number) => {\n    const startIndex = (page - 1) * itemsPerPage;\n    const endIndex = startIndex + itemsPerPage;\n    return items.slice(startIndex, endIndex);\n  };\n  \n  // Reset pagination when tab changes\n  useEffect(() => {\n    setTransactionsPage(1);\n    setBetsPage(1);\n    setActiveBetsPage(1);\n  }, [activeTab]);\n  \n  const handleGoBack = () => {\n    navigate(\"/users\");\n  };\n\n  if (isLoadingUser) {\n    return (\n      <DashboardLayout title=\"User Details\">\n        <div className=\"flex justify-center items-center h-96\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!selectedUser) {\n    return (\n      <DashboardLayout title=\"User Details\">\n        <Card>\n          <CardHeader>\n            <CardTitle>User Not Found</CardTitle>\n            <CardDescription>\n              The requested user could not be found. Please go back and try again.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button onClick={handleGoBack}>\n              <ChevronLeft className=\"mr-2 h-4 w-4\" />\n              Back to Users\n            </Button>\n          </CardContent>\n        </Card>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout title={`User: ${selectedUser.username}`}>\n      <div className=\"mb-4\">\n        <Button variant=\"outline\" onClick={handleGoBack}>\n          <ChevronLeft className=\"mr-2 h-4 w-4\" />\n          Back to Users\n        </Button>\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <User className=\"h-5 w-5\" />\n            {selectedUser.username}\n          </CardTitle>\n          <CardDescription>User details and summary</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <div className=\"bg-secondary/20 p-4 rounded-lg\">\n              <div className=\"text-sm text-muted-foreground mb-1\">User Role</div>\n              <div className=\"font-semibold flex items-center gap-2\">\n                <UserCog className=\"h-4 w-4 text-blue-400\" />\n                <span className=\"capitalize\">{selectedUser.role}</span>\n              </div>\n            </div>\n            \n            <div className=\"bg-secondary/20 p-4 rounded-lg\">\n              <div className=\"text-sm text-muted-foreground mb-1\">Current Balance</div>\n              <div className=\"font-semibold flex items-center gap-2\">\n                <IndianRupee className=\"h-4 w-4 text-green-400\" />\n                <span>{(selectedUser.balance / 100).toFixed(2)}</span>\n              </div>\n            </div>\n            \n            <div className=\"bg-secondary/20 p-4 rounded-lg\">\n              <div className=\"text-sm text-muted-foreground mb-1\">Status</div>\n              <div className=\"font-semibold\">\n                {selectedUser.isBlocked ? (\n                  <Badge variant=\"destructive\">Blocked</Badge>\n                ) : (\n                  <Badge variant=\"outline\" className=\"bg-green-500/10 text-green-500 border-green-500/20\">\n                    Active\n                  </Badge>\n                )}\n              </div>\n            </div>\n            \n            <div className=\"bg-secondary/20 p-4 rounded-lg\">\n              <div className=\"text-sm text-muted-foreground mb-1\">Member Since</div>\n              <div className=\"font-semibold flex items-center gap-2\">\n                <CalendarDays className=\"h-4 w-4 text-purple-400\" />\n                <span>\n                  {selectedUser.createdAt \n                    ? new Date(selectedUser.createdAt).toLocaleDateString() \n                    : \"N/A\"}\n                </span>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"bg-slate-950 border-slate-800\">\n        <CardHeader>\n          <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n            <div>\n              <CardTitle className=\"text-white\">User Activity</CardTitle>\n              <CardDescription>View transaction history, bet history, and active bets</CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"w-full\">\n            <div className=\"flex border-b border-slate-800 mb-4 w-full overflow-x-auto pb-1\">\n              <button \n                type=\"button\"\n                className={`px-4 py-2 flex items-center justify-center gap-2 whitespace-nowrap text-slate-300 ${activeTab === \"transactions\" ? \"border-b-2 border-primary font-medium\" : \"\"}`}\n                onClick={() => setActiveTab(\"transactions\")}\n              >\n                <History className=\"h-4 w-4\" />\n                <span>Transactions</span>\n              </button>\n              <button \n                type=\"button\"\n                className={`px-4 py-2 flex items-center justify-center gap-2 whitespace-nowrap text-slate-300 ${activeTab === \"bets\" ? \"border-b-2 border-primary font-medium\" : \"\"}`}\n                onClick={() => setActiveTab(\"bets\")}\n              >\n                <FileText className=\"h-4 w-4\" />\n                <span>Game History</span>\n              </button>\n              <button \n                type=\"button\"\n                className={`px-4 py-2 flex items-center justify-center gap-2 whitespace-nowrap text-slate-300 ${activeTab === \"active-bets\" ? \"border-b-2 border-primary font-medium\" : \"\"}`}\n                onClick={() => setActiveTab(\"active-bets\")}\n              >\n                <BarChart className=\"h-4 w-4\" />\n                <span>Active Bets</span>\n              </button>\n              <button \n                type=\"button\"\n                className={`px-4 py-2 flex items-center justify-center gap-2 whitespace-nowrap text-slate-300 ${activeTab === \"rewards\" ? \"border-b-2 border-primary font-medium\" : \"\"}`}\n                onClick={() => setActiveTab(\"rewards\")}\n                data-testid=\"tab-rewards\"\n              >\n                <Gift className=\"h-4 w-4\" />\n                <span>Rewards</span>\n              </button>\n            </div>\n            \n            <div className=\"overflow-hidden\">\n              {/* Transactions Tab */}\n              {activeTab === \"transactions\" && (\n                <div className=\"py-4\">\n                  {isLoadingTransactions ? (\n                    <div className=\"flex justify-center py-8\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : userTransactions.length === 0 ? (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      No transaction history found\n                    </div>\n                  ) : (\n                    <>\n                      <div className=\"overflow-x-auto\">\n                        <Table>\n                          <TableHeader>\n                            <TableRow className=\"bg-slate-900\">\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Date</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Type</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Amount</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Description</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {getPaginatedItems(userTransactions, transactionsPage).map((transaction: any) => (\n                              <TableRow key={transaction.id} className=\"bg-slate-900/40 hover:bg-slate-900/60\">\n                                <TableCell className=\"whitespace-nowrap text-slate-300\">\n                                  {new Date(transaction.createdAt).toLocaleString()}\n                                </TableCell>\n                                <TableCell>\n                                  <Badge variant=\"outline\" className=\"border-slate-700 bg-slate-800/80 text-white\">\n                                    <div className=\"flex items-center gap-1\">\n                                      {transaction.amount > 0 ? (\n                                        <ArrowUp className=\"h-3 w-3 text-green-500\" />\n                                      ) : (\n                                        <ArrowDown className=\"h-3 w-3 text-red-500\" />\n                                      )}\n                                      {transaction.amount > 0 ? \"Deposit\" : \"Withdrawal\"}\n                                    </div>\n                                  </Badge>\n                                </TableCell>\n                                <TableCell className={transaction.amount > 0 ? \"text-amber-500\" : \"text-red-500\"}>\n                                  {transaction.amount > 0 ? \"+\" : \"\"}{(transaction.amount / 100).toFixed(2)}\n                                </TableCell>\n                                <TableCell className=\"text-slate-300\">{transaction.description || \"Balance update\"}</TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </div>\n                      \n                      {/* Pagination Controls */}\n                      {userTransactions.length > itemsPerPage && (\n                        <div className=\"flex items-center justify-center mt-4 gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setTransactionsPage(p => Math.max(1, p - 1))}\n                            disabled={transactionsPage === 1}\n                          >\n                            <ChevronLeft className=\"h-4 w-4\" />\n                          </Button>\n                          <span className=\"text-sm\">\n                            Page {transactionsPage} of {getPageCount(userTransactions.length)}\n                          </span>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setTransactionsPage(p => Math.min(getPageCount(userTransactions.length), p + 1))}\n                            disabled={transactionsPage === getPageCount(userTransactions.length)}\n                          >\n                            <ChevronRight className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n              )}\n              \n              {/* Bet History Tab */}\n              {activeTab === \"bets\" && (\n                <div className=\"py-4\">\n                  {isLoadingGames ? (\n                    <div className=\"flex justify-center py-8\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : userGames.length === 0 ? (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      No bet history found\n                    </div>\n                  ) : (\n                    <>\n                      <div className=\"overflow-x-auto\">\n                        <Table>\n                          <TableHeader>\n                            <TableRow className=\"bg-slate-900\">\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Time</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Game Type</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Market/Match</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Bet Amount</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Prediction</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Result</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Profit/Loss</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Balance</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {getPaginatedItems(userGames, betsPage).map((game: any) => (\n                              <TableRow key={game.id} className=\"bg-slate-900/40 hover:bg-slate-900/60\">\n                                <TableCell className=\"text-slate-400\">\n                                  about {Math.floor((Date.now() - new Date(game.createdAt).getTime()) / (1000 * 60 * 60))} hours ago\n                                </TableCell>\n                                <TableCell>\n                                  <Badge className={`border-0 text-white ${\n                                    game.gameType === 'cricket_toss' ? 'bg-blue-950' : \n                                    game.gameType === 'team_match' ? 'bg-blue-950' :\n                                    game.gameType === 'coin_flip' ? 'bg-blue-950' :\n                                    game.gameType.includes('satamatka') ? 'bg-blue-950' :\n                                    'bg-blue-950'\n                                  }`}>\n                                    {game.gameType === 'cricket_toss' ? 'Cricket Toss' :\n                                     game.gameType === 'team_match' ? 'Team Match' :\n                                     game.gameType === 'coin_flip' ? 'Coin Flip' :\n                                     game.gameType.includes('satamatka') ? 'Satamatka' :\n                                     game.gameType.replace(/_/g, ' ')}\n                                  </Badge>\n                                </TableCell>\n                                <TableCell>\n                                  {(game.gameType === 'cricket_toss' || game.gameType === 'team_match') && (game.gameData || game.match) ? (\n                                    <span>{game.gameData?.teamA || game.match?.teamA} vs {game.gameData?.teamB || game.match?.teamB}</span>\n                                  ) : game.gameType.includes('satamatka') ? (\n                                    <span>{getSatamatkaMarketInfo(game)}</span>\n                                  ) : game.gameType.includes('coin_flip') ? (\n                                    <span>Coin Flip Game</span>\n                                  ) : (\n                                    <span>{game.gameType}</span>\n                                  )}\n                                </TableCell>\n                                <TableCell>\n                                  {(game.betAmount / 100).toFixed(2)}\n                                </TableCell>\n                                <TableCell>\n                                  {game.gameType === 'cricket_toss' || game.gameType === 'team_match' ? (\n                                    <Badge className=\"bg-indigo-900 border-0 text-white\">\n                                      {game.prediction === 'team_a' && (game.gameData || game.match) ? \n                                        (game.gameData?.teamA || game.match?.teamA) : \n                                      game.prediction === 'team_b' && (game.gameData || game.match) ? \n                                        (game.gameData?.teamB || game.match?.teamB) : \n                                      game.prediction === 'Team_a' && (game.gameData || game.match) ? \n                                        (game.gameData?.teamA || game.match?.teamA) :\n                                      game.prediction === 'Team_b' && (game.gameData || game.match) ? \n                                        (game.gameData?.teamB || game.match?.teamB) :\n                                      game.prediction && (game.gameData?.teamA || game.match?.teamA) && \n                                        (game.prediction.includes(game.gameData?.teamA || game.match?.teamA)) ?\n                                        (game.gameData?.teamA || game.match?.teamA) :\n                                      game.prediction && (game.gameData?.teamB || game.match?.teamB) && \n                                        (game.prediction.includes(game.gameData?.teamB || game.match?.teamB)) ?\n                                        (game.gameData?.teamB || game.match?.teamB) :\n                                        game.prediction}\n                                    </Badge>\n                                  ) : game.gameType.includes('satamatka') ? (\n                                    <Badge className=\"bg-indigo-900 border-0 text-white\">\n                                      {game.prediction}\n                                    </Badge>\n                                  ) : game.gameType.includes('coin_flip') ? (\n                                    <Badge className=\"bg-indigo-900 border-0 text-white\">\n                                      {game.prediction}\n                                    </Badge>\n                                  ) : (\n                                    <Badge className=\"bg-indigo-900 border-0 text-white\">\n                                      {game.prediction}\n                                    </Badge>\n                                  )}\n                                </TableCell>\n                                <TableCell>\n                                  {game.result ? (\n                                    <Badge className={(game.payout || 0) > 0 ? \"bg-green-600 hover:bg-green-700 border-0\" : \"bg-red-600 hover:bg-red-700 border-0\"}>\n                                      {game.result}\n                                    </Badge>\n                                  ) : (\n                                    <Badge className=\"bg-amber-600 hover:bg-amber-700 border-0\">\n                                      pending\n                                    </Badge>\n                                  )}\n                                </TableCell>\n                                <TableCell className={\n                                  (game.payout || 0) > 0 ? \n                                    \"text-green-500\" : \n                                  // Change the condition to apply amber text to cricket toss games regardless of their payout\n                                  game.result === null || game.result === \"pending\" || game.gameType === 'cricket_toss' ? \n                                    \"text-amber-500\" : \n                                  \"text-red-500 line-through\"\n                                }>\n                                  {(game.payout || 0) > 0 ? \n                                    `+${(game.payout / 100).toFixed(2)}` : \n                                    game.result === null || game.result === \"pending\" ? \n                                      (game.gameType === 'cricket_toss' && game.gameData ?\n                                        `+${(game.betAmount * (\n                                          (game.prediction === 'team_a' || game.prediction === 'Team_a') ? \n                                            game.gameData.oddTeamA : \n                                          (game.prediction === 'team_b' || game.prediction === 'Team_b') ? \n                                            game.gameData.oddTeamB : \n                                          1.9\n                                        ) / 100 / 100).toFixed(2)}` :\n                                        `${(game.betAmount / 100).toFixed(2)}`) : \n                                      `-${(Math.abs(game.betAmount) / 100).toFixed(2)}`}\n                                </TableCell>\n                                <TableCell className=\"text-green-500\">\n                                  {game.balanceAfter ? (game.balanceAfter / 100).toFixed(2) : \n                                     (((selectedUser?.balance || 0) - (game.betAmount || 0)) / 100).toFixed(2)}\n                                </TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </div>\n                      \n                      {/* Pagination Controls */}\n                      {userGames.length > itemsPerPage && (\n                        <div className=\"flex items-center justify-center mt-4 gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setBetsPage(p => Math.max(1, p - 1))}\n                            disabled={betsPage === 1}\n                          >\n                            <ChevronLeft className=\"h-4 w-4\" />\n                          </Button>\n                          <span className=\"text-sm\">\n                            Page {betsPage} of {getPageCount(userGames.length)}\n                          </span>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setBetsPage(p => Math.min(getPageCount(userGames.length), p + 1))}\n                            disabled={betsPage === getPageCount(userGames.length)}\n                          >\n                            <ChevronRight className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n              )}\n              \n              {/* Active Bets Tab */}\n              {activeTab === \"active-bets\" && (\n                <div className=\"py-4\">\n                  {isLoadingActiveBets ? (\n                    <div className=\"flex justify-center py-8\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : userActiveBets.length === 0 ? (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      No active bets found\n                    </div>\n                  ) : (\n                    <>\n                      <div className=\"overflow-x-auto\">\n                        <Table>\n                          <TableHeader>\n                            <TableRow className=\"bg-slate-900\">\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Time</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Game Type</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Market/Match</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Bet Amount</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Prediction</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Result</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Potential Payout</TableHead>\n                              <TableHead className=\"whitespace-nowrap text-slate-400\">Balance</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {getPaginatedItems(userActiveBets, activeBetsPage).map((game: any) => (\n                              <TableRow key={game.id} className=\"bg-slate-900/40 hover:bg-slate-900/60\">\n                                <TableCell className=\"text-slate-400\">\n                                  about {Math.floor((Date.now() - new Date(game.createdAt).getTime()) / (1000 * 60 * 60))} hours ago\n                                </TableCell>\n                                <TableCell>\n                                  <Badge className=\"bg-blue-950 border-0 text-white\">\n                                    {game.gameType === 'cricket_toss' ? 'Cricket Toss' :\n                                     game.gameType === 'team_match' ? 'Team Match' :\n                                     game.gameType === 'coin_flip' ? 'Coin Flip' :\n                                     game.gameType.includes('satamatka') ? 'Satamatka' :\n                                     game.gameType.replace(/_/g, ' ')}\n                                  </Badge>\n                                </TableCell>\n                                <TableCell>\n                                  {(game.gameType === 'cricket_toss' || game.gameType === 'team_match') && (game.gameData || game.match) ? (\n                                    <span>{game.gameData?.teamA || game.match?.teamA} vs {game.gameData?.teamB || game.match?.teamB}</span>\n                                  ) : game.gameType.includes('satamatka') ? (\n                                    <span>{getSatamatkaMarketInfo(game)}</span>\n                                  ) : game.gameType.includes('coin_flip') ? (\n                                    <span>Coin Flip Game</span>\n                                  ) : (\n                                    <span>{game.gameType}</span>\n                                  )}\n                                </TableCell>\n                                <TableCell>\n                                  {(game.betAmount / 100).toFixed(2)}\n                                </TableCell>\n                                <TableCell>\n                                  {game.gameType === 'cricket_toss' || game.gameType === 'team_match' ? (\n                                    <Badge className=\"bg-indigo-900 border-0 text-white\">\n                                      {game.prediction === 'team_a' && (game.gameData || game.match) ? \n                                        (game.gameData?.teamA || game.match?.teamA) : \n                                      game.prediction === 'team_b' && (game.gameData || game.match) ? \n                                        (game.gameData?.teamB || game.match?.teamB) : \n                                      game.prediction === 'Team_a' && (game.gameData || game.match) ? \n                                        (game.gameData?.teamA || game.match?.teamA) :\n                                      game.prediction === 'Team_b' && (game.gameData || game.match) ? \n                                        (game.gameData?.teamB || game.match?.teamB) :\n                                      game.prediction && (game.gameData?.teamA || game.match?.teamA) && \n                                        (game.prediction.includes(game.gameData?.teamA || game.match?.teamA)) ?\n                                        (game.gameData?.teamA || game.match?.teamA) :\n                                      game.prediction && (game.gameData?.teamB || game.match?.teamB) && \n                                        (game.prediction.includes(game.gameData?.teamB || game.match?.teamB)) ?\n                                        (game.gameData?.teamB || game.match?.teamB) :\n                                        game.prediction}\n                                    </Badge>\n                                  ) : game.gameType.includes('satamatka') ? (\n                                    <Badge className=\"bg-indigo-900 border-0 text-white\">\n                                      {game.prediction}\n                                    </Badge>\n                                  ) : (\n                                    <Badge className=\"bg-indigo-900 border-0 text-white\">\n                                      {game.prediction}\n                                    </Badge>\n                                  )}\n                                </TableCell>\n                                <TableCell>\n                                  <Badge className=\"bg-amber-600 hover:bg-amber-700 border-0\">\n                                    pending\n                                  </Badge>\n                                </TableCell>\n                                <TableCell className=\"text-amber-500\">\n                                  {(game.gameType === 'cricket_toss' || game.gameType === 'team_match') && game.gameData ? (\n                                    <>\n                                      +{(game.betAmount * (\n                                            (game.prediction === 'team_a' || game.prediction === 'Team_a') ? \n                                              (game.gameData.oddTeamA || 190) : \n                                            (game.prediction === 'team_b' || game.prediction === 'Team_b') ? \n                                              (game.gameData.oddTeamB || 190) : \n                                            190\n                                          ) / 100 / 100).toFixed(2)}\n                                    </>\n                                  ) : game.gameType.includes('satamatka') ? (\n                                    <>\n                                      +{(game.betAmount * (\n                                        game.gameMode === 'jodi' ? 90 :\n                                        game.gameMode === 'harf' ? 9 :\n                                        game.gameMode === 'crossing' ? 95 :\n                                        game.gameMode === 'odd_even' ? 1.9 :\n                                        1.9\n                                      ) / 100).toFixed(2)}\n                                    </>\n                                  ) : (\n                                    <>+{(game.betAmount * 1.9 / 100).toFixed(2)}</>\n                                  )}\n                                </TableCell>\n                                <TableCell className=\"text-green-500\">\n                                  {(((selectedUser?.balance || 0)) / 100).toFixed(2)}\n                                </TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </div>\n                      \n                      {/* Pagination Controls */}\n                      {userActiveBets.length > itemsPerPage && (\n                        <div className=\"flex items-center justify-center mt-4 gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setActiveBetsPage(p => Math.max(1, p - 1))}\n                            disabled={activeBetsPage === 1}\n                          >\n                            <ChevronLeft className=\"h-4 w-4\" />\n                          </Button>\n                          <span className=\"text-sm\">\n                            Page {activeBetsPage} of {getPageCount(userActiveBets.length)}\n                          </span>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setActiveBetsPage(p => Math.min(getPageCount(userActiveBets.length), p + 1))}\n                            disabled={activeBetsPage === getPageCount(userActiveBets.length)}\n                          >\n                            <ChevronRight className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n              )}\n              \n              {/* Rewards Tab */}\n              {activeTab === \"rewards\" && (\n                <div className=\"py-4\">\n                  {isLoadingRewards ? (\n                    <div className=\"flex justify-center py-8\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-6\">\n                      {/* Commission Rate Card */}\n                      <div className=\"bg-slate-900/60 rounded-lg p-4\">\n                        <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                          <div>\n                            <h3 className=\"text-lg font-semibold text-white\">Reward Commission Rate</h3>\n                            <p className=\"text-sm text-slate-400 mt-1\">\n                              Percentage of Satamatka spending to be awarded as rewards\n                            </p>\n                          </div>\n                          {isEditingCommission ? (\n                            <div className=\"flex items-center gap-2\">\n                              <Input\n                                type=\"number\"\n                                value={newCommissionRate}\n                                onChange={(e) => setNewCommissionRate(e.target.value)}\n                                placeholder=\"e.g., 5.00\"\n                                className=\"w-24 bg-slate-800 border-slate-700 text-white\"\n                                min=\"0\"\n                                max=\"100\"\n                                step=\"0.01\"\n                                data-testid=\"input-commission-rate\"\n                              />\n                              <span className=\"text-slate-400\">%</span>\n                              <Button\n                                size=\"sm\"\n                                onClick={handleCommissionUpdate}\n                                disabled={updateCommissionMutation.isPending}\n                                data-testid=\"button-save-commission\"\n                              >\n                                {updateCommissionMutation.isPending ? \"Saving...\" : \"Save\"}\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => {\n                                  setIsEditingCommission(false);\n                                  setNewCommissionRate(\"\");\n                                }}\n                                data-testid=\"button-cancel-commission\"\n                              >\n                                Cancel\n                              </Button>\n                            </div>\n                          ) : (\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"text-2xl font-bold text-amber-400\">\n                                {((rewardsData?.rewardCommissionRate || 0) / 100).toFixed(2)}%\n                              </span>\n                              <Button\n                                size=\"icon\"\n                                variant=\"ghost\"\n                                onClick={() => {\n                                  setNewCommissionRate(((rewardsData?.rewardCommissionRate || 0) / 100).toFixed(2));\n                                  setIsEditingCommission(true);\n                                }}\n                                data-testid=\"button-edit-commission\"\n                              >\n                                <Pencil className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                      \n                      {/* Summary Stats */}\n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                        <div className=\"bg-slate-900/60 rounded-lg p-4\">\n                          <div className=\"text-sm text-slate-400 mb-1\">Last 7 Days Spending</div>\n                          <div className=\"text-2xl font-bold text-white\">\n                            {((rewardsData?.totalBetAmount || 0) / 100).toFixed(2)}\n                          </div>\n                          <div className=\"text-xs text-slate-500 mt-1\">\n                            {rewardsData?.totalGames || 0} Satamatka games\n                          </div>\n                        </div>\n                        \n                        <div className=\"bg-slate-900/60 rounded-lg p-4\">\n                          <div className=\"text-sm text-slate-400 mb-1\">Commission Rate</div>\n                          <div className=\"text-2xl font-bold text-amber-400\">\n                            {((rewardsData?.rewardCommissionRate || 0) / 100).toFixed(2)}%\n                          </div>\n                          <div className=\"text-xs text-slate-500 mt-1\">\n                            Set by admin/subadmin\n                          </div>\n                        </div>\n                        \n                        <div className=\"bg-slate-900/60 rounded-lg p-4\">\n                          <div className=\"text-sm text-slate-400 mb-1\">Calculated Reward</div>\n                          <div className=\"text-2xl font-bold text-green-400\">\n                            {((rewardsData?.rewardAmount || 0) / 100).toFixed(2)}\n                          </div>\n                          <div className=\"text-xs text-slate-500 mt-1\">\n                            Cashback amount\n                          </div>\n                        </div>\n                      </div>\n                      \n                      {/* Daily Breakdown */}\n                      <div>\n                        <h3 className=\"text-lg font-semibold text-white mb-4\">Daily Breakdown</h3>\n                        {rewardsData?.dailyBreakdown && rewardsData.dailyBreakdown.length > 0 ? (\n                          <div className=\"overflow-x-auto\">\n                            <Table>\n                              <TableHeader>\n                                <TableRow className=\"bg-slate-900\">\n                                  <TableHead className=\"whitespace-nowrap text-slate-400\">Date</TableHead>\n                                  <TableHead className=\"whitespace-nowrap text-slate-400\">Games Played</TableHead>\n                                  <TableHead className=\"whitespace-nowrap text-slate-400\">Total Bet</TableHead>\n                                  <TableHead className=\"whitespace-nowrap text-slate-400\">Reward</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {rewardsData.dailyBreakdown.map((day: any) => (\n                                  <TableRow key={day.date} className=\"bg-slate-900/40 hover:bg-slate-900/60\">\n                                    <TableCell className=\"text-slate-300\">\n                                      {new Date(day.date).toLocaleDateString('en-IN', {\n                                        weekday: 'short',\n                                        day: 'numeric',\n                                        month: 'short'\n                                      })}\n                                    </TableCell>\n                                    <TableCell className=\"text-slate-300\">\n                                      {day.gamesCount}\n                                    </TableCell>\n                                    <TableCell className=\"text-slate-300\">\n                                      {(day.totalBet / 100).toFixed(2)}\n                                    </TableCell>\n                                    <TableCell className=\"text-green-400\">\n                                      {(day.totalBet * (rewardsData?.rewardCommissionRate || 0) / 10000 / 100).toFixed(2)}\n                                    </TableCell>\n                                  </TableRow>\n                                ))}\n                              </TableBody>\n                            </Table>\n                          </div>\n                        ) : (\n                          <div className=\"text-center py-8 text-muted-foreground\">\n                            No Satamatka games in the last 7 days\n                          </div>\n                        )}\n                      </div>\n                      \n                      {/* Period Info */}\n                      <div className=\"text-sm text-slate-500 text-center\">\n                        Period: {rewardsData?.periodStart && new Date(rewardsData.periodStart).toLocaleDateString('en-IN')} - {rewardsData?.periodEnd && new Date(rewardsData.periodEnd).toLocaleDateString('en-IN')}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":47483,"size_tokens":null},"client/src/components/recent-winners.tsx":{"content":"import { formatDistanceToNow } from \"date-fns\";\nimport { Trophy, Award, Medal, User, Sparkles } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { \n  Card, \n  CardContent, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface Winner {\n  id: number;\n  username: string;\n  game: string;\n  amount: number;\n  payout: number;\n  createdAt: string;\n}\n\ninterface RecentWinnersProps {\n  winners: Winner[];\n}\n\nexport default function RecentWinners({ winners }: RecentWinnersProps) {\n  if (winners.length === 0) {\n    return (\n      <Card className=\"bg-slate-900/70 border-slate-800\">\n        <CardHeader>\n          <CardTitle className=\"text-xl flex items-center text-slate-200\">\n            <Trophy className=\"w-5 h-5 text-blue-400 mr-2\" />\n            Leaderboard\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-col items-center justify-center py-6\">\n            <Award className=\"h-12 w-12 text-slate-700 mb-2\" />\n            <p className=\"text-slate-500 text-sm\">No winners yet</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Sort winners by highest profit (payout - amount) and take top 10\n  const topWinners = [...winners]\n    .sort((a, b) => (b.payout - b.amount) - (a.payout - a.amount))\n    .slice(0, 10);\n\n  return (\n    <Card className=\"bg-slate-900/70 border-slate-800\">\n      <CardHeader>\n        <CardTitle className=\"text-xl flex items-center text-slate-200\">\n          <Trophy className=\"w-5 h-5 text-blue-400 mr-2\" />\n          Leaderboard\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"px-0\">\n        <div className=\"space-y-1\">\n          {topWinners.map((winner, index) => {\n            const profit = (winner.payout - winner.amount) / 100;\n            const formattedProfit = profit.toFixed(2);\n            const timeAgo = formatDistanceToNow(new Date(winner.createdAt), { addSuffix: true });\n            \n            return (\n              <div \n                key={winner.id}\n                className=\"flex items-center px-6 py-2 hover:bg-slate-800/50 transition-colors cursor-default\"\n              >\n                <div className=\"flex-shrink-0 mr-3\">\n                  {index === 0 ? (\n                    <div className=\"w-9 h-9 rounded-full bg-amber-500/20 flex items-center justify-center border border-amber-400/30\">\n                      <Trophy className=\"h-5 w-5 text-amber-400\" />\n                    </div>\n                  ) : index === 1 ? (\n                    <div className=\"w-9 h-9 rounded-full bg-slate-400/20 flex items-center justify-center border border-slate-400/30\">\n                      <Medal className=\"h-5 w-5 text-slate-300\" />\n                    </div>\n                  ) : index === 2 ? (\n                    <div className=\"w-9 h-9 rounded-full bg-amber-700/20 flex items-center justify-center border border-amber-700/30\">\n                      <Award className=\"h-5 w-5 text-amber-700\" />\n                    </div>\n                  ) : (\n                    <div className=\"w-9 h-9 rounded-full bg-slate-800 flex items-center justify-center border border-slate-700\">\n                      <span className=\"text-sm text-slate-400 font-medium\">{index + 1}</span>\n                    </div>\n                  )}\n                </div>\n                \n                <div className=\"flex-grow min-w-0\">\n                  <div className=\"flex items-center\">\n                    <p className=\"font-medium truncate text-slate-200\">\n                      {winner.username}\n                    </p>\n                    <span className=\"mx-1.5 text-slate-600\"></span>\n                    <p className=\"text-sm text-slate-400 truncate\">\n                      {winner.game}\n                    </p>\n                  </div>\n                  <p className=\"text-xs text-slate-500\">\n                    {timeAgo}\n                  </p>\n                </div>\n                \n                <div className=\"flex-shrink-0 ml-2 flex items-center\">\n                  {profit > 100 ? (\n                    <Badge variant=\"outline\" className=\"bg-emerald-900/30 text-emerald-300 border-emerald-500/30 flex items-center\">\n                      <Sparkles className=\"h-3 w-3 mr-1\" />\n                      +{formattedProfit}\n                    </Badge>\n                  ) : (\n                    <Badge variant=\"outline\" className=\"bg-teal-900/30 text-teal-300 border-teal-500/30\">\n                      +{formattedProfit}\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            );\n          })}\n          \n          {/* Link to full leaderboard */}\n          <div className=\"pt-2 pb-1 px-6 text-center\">\n            <Link \n              to=\"/leaderboard\" \n              className=\"text-xs text-blue-400 hover:text-blue-300 transition-colors flex items-center justify-center\"\n            >\n              <Trophy className=\"h-3 w-3 mr-1\" />\n              View Full Leaderboard\n            </Link>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","path":null,"size_bytes":5142,"size_tokens":null},"client/src/components/dashboard-layout.tsx":{"content":"import { ReactNode } from \"react\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Wallet, LogOut, User as UserIcon } from \"lucide-react\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { useLocation } from \"wouter\";\nimport { \n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger\n} from \"@/components/ui/dropdown-menu\";\n\ninterface DashboardLayoutProps {\n  children: ReactNode;\n  title?: string;\n  activeTab?: string;\n}\n\nexport default function DashboardLayout({ children, title, activeTab }: DashboardLayoutProps) {\n  const { user, logoutMutation } = useAuth();\n  const [_, setLocation] = useLocation();\n  \n  const handleLogout = () => {\n    logoutMutation.mutate();\n  };\n  return (\n    <div className=\"flex min-h-screen h-screen bg-slate-950 text-slate-200\">\n      {/* Sidebar - Hidden on mobile */}\n      <div className=\"hidden lg:block h-screen\">\n        <Sidebar activeTab={activeTab} />\n      </div>\n      <div className=\"flex flex-col flex-1 overflow-hidden\">\n        \n        <main className=\"flex-1 overflow-y-auto pb-16 lg:pb-0\">\n          {title && (\n            <div className=\"sticky top-0 z-20 border-b border-slate-800 bg-slate-950/95 backdrop-blur-sm\">\n              <div className=\"px-4 py-3 flex justify-between items-center\">\n                <h1 className=\"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-blue-500\">\n                  {title}\n                </h1>\n                {user && (\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"flex items-center bg-slate-800/60 px-3 py-1.5 rounded-full\">\n                      <Wallet className=\"h-4 w-4 mr-2 text-primary\" />\n                      <span className=\"font-medium\">{(user.balance / 100).toFixed(2)}</span>\n                    </div>\n                    \n                    {/* User avatar dropdown - only for mobile */}\n                    <div className=\"block lg:hidden\">\n                      <DropdownMenu>\n                        <DropdownMenuTrigger className=\"focus:outline-none\">\n                          <Avatar className=\"h-8 w-8 bg-gradient-to-r from-primary to-blue-400\">\n                            <AvatarFallback className=\"text-white font-bold text-xs\">\n                              {user.username.charAt(0).toUpperCase()}\n                            </AvatarFallback>\n                          </Avatar>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\" className=\"w-48\">\n                          <div className=\"flex items-center gap-2 p-2 border-b border-slate-700\">\n                            <Avatar className=\"h-8 w-8 bg-gradient-to-r from-primary to-blue-400\">\n                              <AvatarFallback className=\"text-white font-bold text-xs\">\n                                {user.username.charAt(0).toUpperCase()}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <p className=\"font-medium text-sm\">{user.username}</p>\n                              <p className=\"text-xs text-muted-foreground capitalize\">{user.role}</p>\n                            </div>\n                          </div>\n                          <DropdownMenuItem onClick={() => setLocation(\"/profile\")} className=\"flex items-center gap-2\">\n                            <UserIcon className=\"h-4 w-4\" />\n                            <span>Profile</span>\n                          </DropdownMenuItem>\n                          <DropdownMenuItem onClick={handleLogout} className=\"text-red-400 focus:text-red-300 flex items-center gap-2\">\n                            <LogOut className=\"h-4 w-4\" />\n                            <span>Logout</span>\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n          \n          <div className=\"container mx-auto px-4 py-4\">\n            {children}\n          </div>\n        </main>\n      </div>\n      \n      {/* Mobile Bottom Navigation */}\n      <MobileNav activeTab={activeTab} />\n    </div>\n  );\n}","path":null,"size_bytes":4408,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { AuthProvider } from \"./hooks/use-auth\";\nimport { ProtectedRoute } from \"./lib/protected-route\";\nimport { UserRole } from \"./lib/types\";\n\nimport NotFound from \"@/pages/not-found\";\nimport AuthPage from \"@/pages/auth-page\";\nimport HomePage from \"@/pages/home-page\";\nimport PublicHomePage from \"@/pages/public-home-page\";\nimport GamePage from \"@/pages/game-page\";\nimport GamesPage from \"@/pages/games-page\";\nimport ProfilePage from \"@/pages/profile-page\";\nimport UserManagementPage from \"@/pages/user-management-page\";\nimport SubadminManagementPage from \"@/pages/subadmin-management-page\";\nimport SubadminDashboardPage from \"@/pages/subadmin-dashboard-page\";\nimport GameHistoryPage from \"@/pages/game-history-page\";\nimport CricketTossPage from \"@/pages/cricket-toss-page\";\nimport AdminCricketTossPage from \"@/pages/admin-cricket-toss-page\";\nimport MarketListPage from \"@/pages/market-list-page\";\nimport SatamatkaGamePage from \"@/pages/satamatka-game-page\";\n// Team Match pages removed\n// Cricket Toss pages removed\nimport AdminMarketManagementPage from \"@/pages/admin-market-management-page\";\n// Admin Team Match page removed\n// Risk Management and Jantri Management pages removed for simplification\nimport WalletPage from \"@/pages/wallet-page\";\nimport AdminSettingsPage from \"@/pages/admin-settings-page\";\nimport SubadminSettingsPage from \"@/pages/subadmin-settings-page\";\nimport SubadminCommissionManagementPage from \"@/pages/subadmin-commission-management-page\";\nimport FundManagementPage from \"@/pages/fund-management-page\";\nimport LeaderboardPage from \"@/pages/leaderboard-page\";\nimport SettingsRouter from \"@/pages/settings-router\";\nimport UserDetailsPage from \"@/pages/user-details-page\";\nimport ResetZonePage from \"@/pages/reset-zone-page\";\nimport RiskManagementPage from \"@/pages/risk-management-page\";\nimport ResultsPage from \"@/pages/results-page\";\n\nfunction Router() {\n  return (\n    <Switch>\n      {/* Public routes */}\n      <Route path=\"/\" component={PublicHomePage} />\n      <Route path=\"/results\" component={ResultsPage} />\n      <Route path=\"/auth\" component={AuthPage} />\n      \n      {/* Protected routes */}\n      <ProtectedRoute path=\"/dashboard\" component={HomePage} />\n      \n      {/* Player routes - only for normal players (not admin/subadmin) */}\n      <ProtectedRoute \n        path=\"/coinflip\" \n        component={GamePage} \n        allowedRoles={[UserRole.PLAYER]}\n      />\n      <ProtectedRoute \n        path=\"/cricket-toss\" \n        component={CricketTossPage} \n        allowedRoles={[UserRole.PLAYER]}\n      />\n      <ProtectedRoute \n        path=\"/game-history\" \n        component={GameHistoryPage} \n        allowedRoles={[UserRole.PLAYER]}\n      />\n      {/* Risk management and jantri management routes removed for simplification */}\n      <ProtectedRoute \n        path=\"/fund-management\" \n        component={FundManagementPage}\n        allowedRoles={[UserRole.ADMIN]}\n      />\n      \n      {/* Admin/Subadmin routes */}\n      <ProtectedRoute \n        path=\"/users\" \n        component={UserManagementPage} \n        allowedRoles={[UserRole.ADMIN, UserRole.SUBADMIN]}\n      />\n      <ProtectedRoute \n        path=\"/risk-management\" \n        component={RiskManagementPage} \n        allowedRoles={[UserRole.ADMIN, UserRole.SUBADMIN]}\n      />\n      <ProtectedRoute \n        path=\"/users/:id\" \n        component={UserDetailsPage} \n        allowedRoles={[UserRole.ADMIN, UserRole.SUBADMIN]}\n      />\n      <ProtectedRoute \n        path=\"/subadmins\" \n        component={SubadminManagementPage} \n        allowedRoles={[UserRole.ADMIN]}\n      />\n      {/* Subadmin dashboard integrated into main dashboard */}\n      \n      {/* Admin Market Management routes */}\n      <ProtectedRoute \n        path=\"/manage-markets\" \n        component={AdminMarketManagementPage} \n        allowedRoles={[UserRole.ADMIN]}\n      />\n      <ProtectedRoute \n        path=\"/admin-cricket-toss\" \n        component={AdminCricketTossPage} \n        allowedRoles={[UserRole.ADMIN]}\n      />\n      \n      {/* Reset Zone route - admin only */}\n      <ProtectedRoute \n        path=\"/reset-zone\" \n        component={ResetZonePage} \n        allowedRoles={[UserRole.ADMIN]}\n      />\n      \n      {/* Risk Management route */}\n      <ProtectedRoute \n        path=\"/risk-management\" \n        component={RiskManagementPage} \n        allowedRoles={[UserRole.ADMIN, UserRole.SUBADMIN]}\n      />\n      \n      {/* Settings routes - uses a dedicated router component */}\n      <ProtectedRoute \n        path=\"/settings\" \n        component={SettingsRouter} \n        allowedRoles={[UserRole.ADMIN, UserRole.SUBADMIN]}\n      />\n      <ProtectedRoute \n        path=\"/subadmin-commission-management\" \n        component={SubadminCommissionManagementPage} \n        allowedRoles={[UserRole.ADMIN, UserRole.SUBADMIN]}\n      />\n      \n      {/* Game routes - only for normal players */}\n      <ProtectedRoute \n        path=\"/markets\" \n        component={MarketListPage}\n        allowedRoles={[UserRole.PLAYER]} \n      />\n      <ProtectedRoute \n        path=\"/game/satamatka/:id\" \n        component={SatamatkaGamePage}\n        allowedRoles={[UserRole.PLAYER]} \n      />\n      {/* Sports/Team Match route removed */}\n      {/* Cricket Toss Player route removed */}\n      \n      {/* New player pages - games and profile */}\n      <ProtectedRoute\n        path=\"/games\"\n        component={GamesPage}\n        allowedRoles={[UserRole.PLAYER]}\n      />\n      <ProtectedRoute\n        path=\"/profile\"\n        component={ProfilePage}\n      />\n      \n      {/* Wallet route - accessible to all authenticated users */}\n      <ProtectedRoute\n        path=\"/wallet\"\n        component={WalletPage}\n      />\n      \n      {/* Leaderboard route - accessible to all authenticated users */}\n      <ProtectedRoute\n        path=\"/leaderboard\"\n        component={LeaderboardPage}\n      />\n      \n      {/* 404 route */}\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <Router />\n        <Toaster />\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":6347,"size_tokens":null},"client/src/components/mobile-nav.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Home, Play, History, User, Wallet, BarChart2, Gamepad2, LogOut, AlertTriangle } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { cn } from \"@/lib/utils\";\nimport { UserRole } from \"@shared/schema\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\n\ninterface MobileNavProps {\n  activeTab?: string;\n}\n\nexport default function MobileNav({ activeTab }: MobileNavProps = {}) {\n  const [location] = useLocation();\n  const { user } = useAuth();\n\n  if (!user) return null;\n\n  const isAdmin = user?.role === UserRole.ADMIN;\n  const isSubadmin = user?.role === UserRole.SUBADMIN;\n  const isPlayer = user?.role === UserRole.PLAYER;\n\n  // Define the type for nav items\n  type NavItem = {\n    name: string;\n    icon: React.ReactNode;\n    path: string;\n    visible: boolean;\n    component?: React.ReactNode;\n  };\n  \n  // Base menu items for all users\n  const navItems: NavItem[] = [\n    {\n      name: \"Home\",\n      icon: <Home className=\"w-5 h-5\" />,\n      path: \"/dashboard\",\n      visible: true,\n    },\n    // All Games (Browse) for players\n    {\n      name: \"Games\",\n      icon: <Gamepad2 className=\"w-5 h-5\" />,\n      path: \"/games\",\n      visible: isPlayer,\n    },\n    // History only for players\n    {\n      name: \"History\",\n      icon: <History className=\"w-5 h-5\" />,\n      path: \"/game-history\",\n      visible: isPlayer,\n    },\n    // Risk Management removed for platform simplification\n    // Wallet for all users\n    {\n      name: \"Wallet\",\n      icon: <Wallet className=\"w-5 h-5\" />,\n      path: \"/wallet\",\n      visible: true,\n      component: (\n        <div className=\"flex flex-col items-center justify-center\">\n          <Wallet className=\"w-5 h-5\" />\n          <span className=\"text-xs mt-1 text-blue-300 font-semibold\">{(user.balance / 100).toFixed(2)}</span>\n        </div>\n      ),\n    },\n    // Profile for all users\n    {\n      name: \"Profile\",\n      icon: <User className=\"w-5 h-5\" />,\n      path: \"/profile\",\n      visible: true,\n    },\n\n  ].filter(item => item.visible);\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-800 z-50 lg:hidden\">\n      <div className=\"flex justify-around items-center h-16\">\n        {navItems.map((item) => (\n          <Link\n            key={item.path}\n            href={item.path}\n            className={cn(\n              \"flex flex-col items-center justify-center w-full h-full text-xs\",\n              location === item.path\n                ? \"text-blue-400\"\n                : \"text-slate-400 hover:text-slate-200\"\n            )}\n          >\n            {item.component || (\n              <>\n                {item.icon}\n                <span className=\"mt-1\">{item.name}</span>\n              </>\n            )}\n          </Link>\n        ))}\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":2856,"size_tokens":null},"client/src/pages/public-home-page.tsx":{"content":"import { useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Card, \n  CardContent, \n  CardDescription, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport ResponsiveHeader from \"@/components/responsive-header\";\nimport ProfessionalFooter from \"@/components/professional-footer\";\nimport GameCard from \"@/components/game-card\";\nimport HeroSlider from \"@/components/hero-slider\";\nimport { HomePageHeroSlider } from \"@/components/home/HomePageHeroSlider\";\nimport RecentResults from \"@/components/recent-results\";\nimport RecentWinners from \"@/components/recent-winners\";\nimport FloatingWhatsApp from \"@/components/floating-whatsapp\";\nimport { Trophy, Target, Shield, ArrowRight } from \"lucide-react\";\n\n// Component to display real market results from API\nfunction PublicRecentResults() {\n  const { data: results = [], isLoading, error } = useQuery({\n    queryKey: ['/api/public/market-results', 'limit=8'],\n    queryFn: async () => {\n      const response = await fetch('/api/public/market-results?limit=8');\n      if (!response.ok) {\n        throw new Error('Failed to fetch results');\n      }\n      return response.json();\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-3\">\n        {[...Array(5)].map((_, i) => (\n          <div key={i} className=\"p-3 rounded-lg border border-slate-800 bg-slate-800/50 animate-pulse\">\n            <div className=\"h-4 w-32 bg-slate-700 rounded mb-2\"></div>\n            <div className=\"h-8 w-16 bg-slate-700 rounded mx-auto\"></div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  if (error || results.length === 0) {\n    return (\n      <div className=\"text-center py-8\">\n        <Target className=\"h-12 w-12 text-slate-700 mx-auto mb-4\" />\n        <p className=\"text-slate-500 text-sm\">\n          {error ? 'Unable to load results' : 'No recent results available'}\n        </p>\n      </div>\n    );\n  }\n\n  return <RecentResults results={results} />;\n}\n\n// Sample recent results data for Dishawar and Gali markets (two digits 00-99)\nconst sampleRecentResults = [\n  {\n    id: 1,\n    name: \"Dishawar\",\n    type: \"night\",\n    openTime: \"2023-04-14T21:00:00Z\",\n    closeTime: \"2023-04-14T23:00:00Z\",\n    openResult: \"78\",\n    closeResult: null,\n    status: \"resulted\",\n    createdAt: new Date().toISOString(),\n  },\n  {\n    id: 2,\n    name: \"Gali\",\n    type: \"night\",\n    openTime: \"2023-04-14T20:00:00Z\",\n    closeTime: \"2023-04-14T22:00:00Z\",\n    openResult: \"45\",\n    closeResult: null,\n    status: \"resulted\",\n    createdAt: new Date(Date.now() - 3600000).toISOString(),\n  },\n  {\n    id: 3,\n    name: \"Dishawar\",\n    type: \"night\",\n    openTime: \"2023-04-13T21:00:00Z\",\n    closeTime: \"2023-04-13T23:00:00Z\",\n    openResult: \"23\",\n    closeResult: null,\n    status: \"resulted\",\n    createdAt: new Date(Date.now() - 86400000).toISOString(), // 1 day ago\n  },\n  {\n    id: 4,\n    name: \"Gali\",\n    type: \"night\",\n    openTime: \"2023-04-13T20:00:00Z\",\n    closeTime: \"2023-04-13T22:00:00Z\",\n    openResult: \"67\",\n    closeResult: null,\n    status: \"resulted\",\n    createdAt: new Date(Date.now() - 86400000 - 3600000).toISOString(), // 1 day + 1 hour ago\n  },\n  {\n    id: 5,\n    name: \"Dishawar\",\n    type: \"night\",\n    openTime: \"2023-04-12T21:00:00Z\",\n    closeTime: \"2023-04-12T23:00:00Z\",\n    openResult: \"09\",\n    closeResult: null,\n    status: \"resulted\",\n    createdAt: new Date(Date.now() - 172800000).toISOString(), // 2 days ago\n  },\n  {\n    id: 6,\n    name: \"Gali\",\n    type: \"night\",\n    openTime: \"2023-04-12T20:00:00Z\",\n    closeTime: \"2023-04-12T22:00:00Z\",\n    openResult: \"34\",\n    closeResult: null,\n    status: \"resulted\",\n    createdAt: new Date(Date.now() - 172800000 - 3600000).toISOString(), // 2 days + 1 hour ago\n  },\n  {\n    id: 7,\n    name: \"Dishawar\",\n    type: \"night\",\n    openTime: \"2023-04-11T21:00:00Z\",\n    closeTime: \"2023-04-11T23:00:00Z\",\n    openResult: \"56\",\n    closeResult: null,\n    status: \"resulted\",\n    createdAt: new Date(Date.now() - 259200000).toISOString(), // 3 days ago\n  },\n  {\n    id: 8,\n    name: \"Madhur Day\",\n    type: \"day\",\n    openTime: \"2023-04-14T11:30:00Z\",\n    closeTime: \"2023-04-14T17:30:00Z\",\n    openResult: \"901\",\n    closeResult: \"234\",\n    status: \"resulted\",\n    createdAt: new Date(Date.now() - 25200000).toISOString(),\n  },\n  {\n    id: 9,\n    name: \"Supreme Day\",\n    type: \"day\",\n    openTime: \"2023-04-14T13:00:00Z\",\n    closeTime: \"2023-04-14T19:00:00Z\",\n    openResult: \"012\",\n    closeResult: \"345\",\n    status: \"resulted\",\n    createdAt: new Date(Date.now() - 28800000).toISOString(),\n  },\n  {\n    id: 10,\n    name: \"Worli Mumbai\",\n    type: \"day\",\n    openTime: \"2023-04-14T14:00:00Z\",\n    closeTime: \"2023-04-14T20:00:00Z\",\n    openResult: \"123\",\n    closeResult: \"456\",\n    status: \"resulted\",\n    createdAt: new Date(Date.now() - 32400000).toISOString(),\n  }\n];\n\n// Sample recent winners data\nconst sampleRecentWinners = [\n  {\n    id: 1,\n    username: \"lucky777\",\n    game: \"Coin Flip\",\n    amount: 5000,\n    payout: 9500,\n    createdAt: new Date(Date.now() - 300000).toISOString(),\n  },\n  {\n    id: 2,\n    username: \"betmaster\",\n    game: \"Market Game\",\n    amount: 10000,\n    payout: 50000,\n    createdAt: new Date(Date.now() - 1800000).toISOString(),\n  },\n  {\n    id: 3,\n    username: \"winner123\",\n    game: \"Cricket Betting\",\n    amount: 2000,\n    payout: 6000,\n    createdAt: new Date(Date.now() - 3600000).toISOString(),\n  },\n  {\n    id: 4,\n    username: \"highroller\",\n    game: \"Coin Flip\",\n    amount: 20000,\n    payout: 40000,\n    createdAt: new Date(Date.now() - 7200000).toISOString(),\n  },\n  {\n    id: 5,\n    username: \"gameknight\",\n    game: \"Market Game\",\n    amount: 5000,\n    payout: 25000,\n    createdAt: new Date(Date.now() - 10800000).toISOString(),\n  },\n  {\n    id: 6,\n    username: \"bettingpro\",\n    game: \"Cricket Betting\",\n    amount: 15000,\n    payout: 45000,\n    createdAt: new Date(Date.now() - 14400000).toISOString(),\n  },\n  {\n    id: 7,\n    username: \"levelupgamer\",\n    game: \"Coin Flip\",\n    amount: 3000,\n    payout: 6000,\n    createdAt: new Date(Date.now() - 18000000).toISOString(),\n  },\n  {\n    id: 8,\n    username: \"wagermasters\",\n    game: \"Market Game\",\n    amount: 7500,\n    payout: 37500,\n    createdAt: new Date(Date.now() - 21600000).toISOString(),\n  },\n  {\n    id: 9,\n    username: \"luckybets\",\n    game: \"Cricket Betting\",\n    amount: 4000,\n    payout: 12000,\n    createdAt: new Date(Date.now() - 25200000).toISOString(),\n  },\n  {\n    id: 10,\n    username: \"fortuneplayer\",\n    game: \"Coin Flip\",\n    amount: 10000,\n    payout: 20000,\n    createdAt: new Date(Date.now() - 28800000).toISOString(),\n  }\n];\n\n// Sample game data\nconst gameCards = [\n  {\n    id: \"coinflip\",\n    title: \"Coin Flip\",\n    description: \"Classic heads or tails betting with 50/50 odds for instant wins.\",\n    imageBg: \"linear-gradient(135deg, #0f1729 0%, #1e293b 100%)\",\n    path: \"/coinflip\",\n    popularity: \"high\" as const,\n    winRate: 50,\n    gameType: \"coinflip\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"satamatka\",\n    title: \"Market Game\",\n    description: \"Play market-based games with multiple betting options and high payouts.\",\n    imageBg: \"linear-gradient(135deg, #0f1729 0%, #1e293b 100%)\",\n    path: \"/markets\", // Updated to point to markets page\n    popularity: \"medium\" as const,\n    winRate: 36,\n    gameType: \"market\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"cricket\",\n    title: \"Cricket Toss\",\n    description: \"Predict the cricket match toss outcome for quick wins.\",\n    imageBg: \"linear-gradient(135deg, #0f1729 0%, #1e293b 100%)\",\n    path: \"/cricket-toss\", // Updated to point to cricket toss page\n    popularity: \"high\" as const,\n    winRate: 50,\n    gameType: \"cricket\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"sportsexchange\",\n    title: \"Sports Exchange\",\n    description: \"Coming soon! Cricket, Tennis, and Football match betting with competitive odds.\",\n    imageBg: \"linear-gradient(135deg, #2d3b4d, #4c6583)\",\n    path: \"#\",\n    popularity: \"medium\" as const,\n    winRate: 0,\n    comingSoon: true,\n    gameType: \"sports\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"kingsoriginal\",\n    title: \"Kings Original\",\n    description: \"Coming soon! Our collection of premium games including Big-Small, Color, Lottery, Roulette and more.\",\n    imageBg: \"linear-gradient(to right, #4a4a4a, #6a6a6a)\",\n    path: \"#\",\n    popularity: \"low\" as const,\n    winRate: 0,\n    comingSoon: true,\n    imageUrl: \"/images/royal-k-logo.svg\" // Logo as feature image\n  }\n];\n\nexport default function PublicHomePage() {\n  const [_, setLocation] = useLocation();\n  const { user } = useAuth();\n  \n  // Define Winner type to match what RecentWinners component expects\n  interface Winner {\n    id: number;\n    username: string;\n    game: string;\n    amount: number;\n    payout: number;\n    createdAt: string;\n  }\n  \n  // Fetch real winners data from API\n  const { data: realWinners = [], isLoading: isLoadingWinners } = useQuery<Winner[]>({\n    queryKey: ['/api/games/top-winners'],\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  useEffect(() => {\n    // If user is logged in, redirect to dashboard\n    if (user) {\n      setLocation(\"/dashboard\");\n    }\n  }, [user, setLocation]);\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background text-foreground\">\n      {/* Header */}\n      <ResponsiveHeader />\n\n      {/* Hero Slider Section */}\n      <HomePageHeroSlider />\n\n      {/* Game Cards Section */}\n      <section className=\"py-16\" id=\"games\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"flex justify-between items-center mb-8\">\n            <h2 className=\"text-2xl sm:text-3xl font-bold\">Popular Games</h2>\n            <Button \n              variant=\"ghost\" \n              className=\"text-primary\"\n              onClick={() => setLocation(\"/auth\")}\n            >\n              View All <ArrowRight className=\"ml-1 h-4 w-4\" />\n            </Button>\n          </div>\n          \n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8\">\n            {gameCards.map((game) => (\n              <div key={game.id} className=\"mx-auto w-full max-w-[400px] sm:max-w-none\">\n                <GameCard \n                  id={game.id}\n                  title={game.title}\n                  description={game.description}\n                  imageBg={game.imageBg}\n                  path={game.path}\n                  popularity={game.popularity}\n                  winRate={game.winRate}\n                  comingSoon={game.comingSoon}\n                  gameType={game.gameType}\n                  imageUrl={game.imageUrl} // Keep for backward compatibility with Kings Original\n                />\n              </div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Features Section */}\n      <section className=\"py-16 bg-slate-900/40\" id=\"features\">\n        <div className=\"container mx-auto px-4\">\n          <h2 className=\"text-2xl sm:text-3xl font-bold text-center mb-12\">Why Choose Us</h2>\n          \n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            <Card className=\"border-border\">\n              <CardHeader>\n                <div className=\"mb-2 h-12 w-12 rounded-lg bg-slate-800 flex items-center justify-center\">\n                  <Trophy className=\"h-6 w-6 text-primary\" />\n                </div>\n                <CardTitle>Simple Betting</CardTitle>\n                <CardDescription>\n                  Easy to understand games with excellent odds\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">\n                  Place bets on various games and win up to 95x your bet amount. Our intuitive interface makes betting easy for everyone.\n                </p>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"border-border\">\n              <CardHeader>\n                <div className=\"mb-2 h-12 w-12 rounded-lg bg-slate-800 flex items-center justify-center\">\n                  <Target className=\"h-6 w-6 text-primary\" />\n                </div>\n                <CardTitle>Real-Time Results</CardTitle>\n                <CardDescription>\n                  Watch games unfold in real-time as you wait for the outcome\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">\n                  Our beautiful animations and real-time updates show you the results as they happen. No waiting, no delays.\n                </p>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"border-border\">\n              <CardHeader>\n                <div className=\"mb-2 h-12 w-12 rounded-lg bg-slate-800 flex items-center justify-center\">\n                  <Shield className=\"h-6 w-6 text-primary\" />\n                </div>\n                <CardTitle>Safe & Secure</CardTitle>\n                <CardDescription>\n                  Your funds and data are protected with the highest security standards\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">\n                  We use advanced encryption and security protocols to ensure your information and funds are always protected.\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* How to Play Section */}\n      <section className=\"py-16\">\n        <div className=\"container mx-auto px-4\">\n          <h2 className=\"text-2xl sm:text-3xl font-bold text-center mb-8\">How to Play</h2>\n          \n          <div className=\"grid md:grid-cols-3 gap-6\">\n            <Card className=\"border-border shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader className=\"pb-2 flex flex-row items-start space-x-4\">\n                <div className=\"w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center text-primary text-xl font-bold shrink-0 shadow-sm\">\n                  1\n                </div>\n                <div>\n                  <CardTitle className=\"text-xl mb-1\">Create an Account</CardTitle>\n                  <CardDescription>\n                    Fast and secure sign-up process\n                  </CardDescription>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">\n                  Sign up for a free account in just a few seconds. Track your bets, manage your balance, and access exclusive offers.\n                </p>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"border-border shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader className=\"pb-2 flex flex-row items-start space-x-4\">\n                <div className=\"w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center text-primary text-xl font-bold shrink-0 shadow-sm\">\n                  2\n                </div>\n                <div>\n                  <CardTitle className=\"text-xl mb-1\">Place Your Bet</CardTitle>\n                  <CardDescription>\n                    Simple and intuitive betting\n                  </CardDescription>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">\n                  Select from our variety of games, set your bet amount, and make your prediction. Our user-friendly interface makes betting straightforward.\n                </p>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"border-border shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader className=\"pb-2 flex flex-row items-start space-x-4\">\n                <div className=\"w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center text-primary text-xl font-bold shrink-0 shadow-sm\">\n                  3\n                </div>\n                <div>\n                  <CardTitle className=\"text-xl mb-1\">Win Prizes</CardTitle>\n                  <CardDescription>\n                    Instant payouts on winning bets\n                  </CardDescription>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">\n                  Watch the results in real-time and receive your winnings instantly. Withdraw your earnings or use them to place more bets.\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n          \n          <div className=\"text-center mt-8\">\n            <Button \n              className=\"px-6 py-6 text-lg bg-primary hover:bg-primary/90\"\n              onClick={() => setLocation(\"/auth\")}\n            >\n              Register Now\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* Recent Activity Section */}\n      <section className=\"py-16 bg-slate-950/30\" id=\"recent-activity\">\n        <div className=\"container mx-auto px-4\">\n          <h2 className=\"text-2xl sm:text-3xl font-bold text-center mb-8\">Recent Activity</h2>\n          \n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            {/* Recent Results */}\n            <Card className=\"border-border shadow-sm\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <Target className=\"h-5 w-5 mr-2 text-primary\" />\n                  Recent Results\n                </CardTitle>\n                <CardDescription>\n                  Latest market results from our games\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <PublicRecentResults />\n              </CardContent>\n            </Card>\n            \n            {/* Recent Winners */}\n            <Card className=\"border-border shadow-sm\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <Trophy className=\"h-5 w-5 mr-2 text-primary\" />\n                  Recent Winners\n                </CardTitle>\n                <CardDescription>\n                  Players who recently won big on our platform\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {isLoadingWinners ? (\n                  <div className=\"py-8 flex justify-center\">\n                    <div className=\"animate-spin h-6 w-6 border-2 border-primary rounded-full border-t-transparent\"></div>\n                  </div>\n                ) : (\n                  <RecentWinners winners={realWinners} />\n                )}\n              </CardContent>\n            </Card>\n          </div>\n          \n          <div className=\"text-center mt-8\">\n            <Button \n              variant=\"outline\"\n              className=\"border-primary/30\"\n              onClick={() => setLocation(\"/auth\")}\n            >\n              Join Now to Start Winning\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* Professional Footer */}\n      <ProfessionalFooter />\n      \n      {/* Floating WhatsApp Button */}\n      <FloatingWhatsApp />\n    </div>\n  );\n}","path":null,"size_bytes":19496,"size_tokens":null},"test-user.ts":{"content":"import { db } from './server/db'; import { users } from './shared/schema'; import { eq } from 'drizzle-orm'; async function testUser() { try { console.log('Testing admin user query...'); const result = await db.select().from(users).where(eq(users.username, 'admin')); console.log('Query result:', result); console.log('Number of results:', result.length); } catch (error) { console.error('Error:', error); } } testUser();\n","path":null,"size_bytes":422,"size_tokens":null},"server/balance-migration.js":{"content":"/**\n * This script will update historical game data to populate the balanceAfter field\n * for games where this data is missing.\n */\nimport pg from 'pg';\nimport dotenv from 'dotenv';\nimport { fileURLToPath } from 'url';\nimport { dirname } from 'path';\n\n// Set up __dirname equivalent for ES modules\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\n// Load environment variables\ndotenv.config();\n\nconst { Pool } = pg;\n\n// Create a new pool with the DATABASE_URL\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nasync function migrateBalanceData() {\n  console.log('Starting balance migration process...');\n  \n  // Get connection from pool\n  const client = await pool.connect();\n  \n  try {\n    // Start a transaction\n    await client.query('BEGIN');\n    \n    // Query users first\n    const usersResult = await client.query(\n      'SELECT id, username, balance FROM users WHERE role = $1 ORDER BY id ASC',\n      ['player']\n    );\n    \n    const users = usersResult.rows;\n    console.log(`Found ${users.length} player accounts to process`);\n    \n    // Process each user\n    for (const user of users) {\n      console.log(`\\nProcessing user: ${user.username} (ID: ${user.id})`);\n      \n      // Get all games for this user, ordered by creation date\n      const gamesResult = await client.query(\n        'SELECT id, bet_amount, payout, balance_after, created_at FROM games WHERE user_id = $1 ORDER BY created_at ASC',\n        [user.id]\n      );\n      \n      const games = gamesResult.rows;\n      console.log(`Found ${games.length} games for this user`);\n      \n      if (games.length === 0) {\n        console.log('No games to update for this user');\n        continue;\n      }\n      \n      // Track user balance as we go through their games\n      let runningBalance = user.balance;\n      let updatedGamesCount = 0;\n      \n      // Start from the most recent game and work backwards\n      for (let i = games.length - 1; i >= 0; i--) {\n        const game = games[i];\n        \n        // Skip games that already have balanceAfter set\n        if (game.balance_after !== null) {\n          console.log(`Game ${game.id} already has balance_after: ${game.balance_after}`);\n          continue;\n        }\n        \n        // Calculate what the balance would have been before this game\n        // by removing the payout and adding back the bet amount\n        const balanceBefore = runningBalance - (game.payout || 0) + game.bet_amount;\n        \n        // Update runningBalance for the next (earlier) game\n        runningBalance = balanceBefore;\n        \n        // The balance after this game would be what we just calculated as balanceBefore\n        // plus payout and minus bet_amount\n        const calculatedBalanceAfter = balanceBefore - game.bet_amount + (game.payout || 0);\n        \n        // Update this game's balanceAfter\n        await client.query(\n          'UPDATE games SET balance_after = $1 WHERE id = $2',\n          [calculatedBalanceAfter, game.id]\n        );\n        \n        console.log(`Updated game ${game.id}: Set balance_after to ${calculatedBalanceAfter}`);\n        updatedGamesCount++;\n      }\n      \n      console.log(`Updated ${updatedGamesCount} games for user ${user.username}`);\n    }\n    \n    // Commit the transaction\n    await client.query('COMMIT');\n    console.log('\\nBalance migration completed successfully!');\n    \n  } catch (error) {\n    // Rollback the transaction on error\n    await client.query('ROLLBACK');\n    console.error('Error during balance migration:', error);\n    throw error;\n  } finally {\n    // Release the client back to the pool\n    client.release();\n  }\n}\n\n// Run the migration\nmigrateBalanceData()\n  .then(() => {\n    console.log('Migration process completed successfully.');\n    process.exit(0);\n  })\n  .catch(err => {\n    console.error('Migration failed:', err);\n    process.exit(1);\n  });","path":null,"size_bytes":3899,"size_tokens":null},"client/src/lib/types.ts":{"content":"// User related types\nexport enum UserRole {\n  ADMIN = \"admin\",\n  SUBADMIN = \"subadmin\",\n  PLAYER = \"player\"\n}\n\nexport interface User {\n  id: number;\n  username: string;\n  role: UserRole;\n  balance: number;\n  assignedTo: number | null;\n  isBlocked: boolean;\n}\n\n// Game related types\nexport enum GameOutcome {\n  WIN = \"win\",\n  LOSS = \"loss\",\n  PENDING = \"pending\",\n  CANCELLED = \"cancelled\"\n}\n\nexport interface Game {\n  id: number;\n  userId: number;\n  betAmount: number;\n  gameType: string;\n  prediction: string;\n  result: string | null;\n  payout: number | null;\n  status: GameOutcome;\n  marketId?: number;\n  matchId?: number;\n  createdAt: string;\n}\n\n// Satamatka market types\nexport enum MarketType {\n  DISHAWAR = \"dishawar\",\n  GALI = \"gali\",\n  FARIDABAD = \"faridabad\",\n  GAZIABAD = \"gaziabad\",\n  CUSTOM = \"custom\"\n}\n\nexport enum MarketStatus {\n  ACTIVE = \"active\",\n  CLOSED = \"closed\",\n  UPCOMING = \"upcoming\",\n  RESULTED = \"resulted\",\n  CANCELLED = \"cancelled\"\n}\n\nexport interface SatamatkaMarket {\n  id: number;\n  name: string;\n  type: MarketType;\n  openTime: string;\n  closeTime: string;\n  openResult?: string;\n  closeResult?: string;\n  status: MarketStatus;\n  createdAt: string;\n}\n\nexport enum SatamatkaGameMode {\n  SINGLE = \"single\", \n  JODI = \"jodi\",\n  PATTI = \"patti\",\n  HURF = \"hurf\",\n  CROSS = \"cross\",\n  ODD_EVEN = \"odd_even\"\n}\n\n// Team match types\nexport enum TeamMatchResult {\n  TEAM_A = \"team_a\",\n  TEAM_B = \"team_b\", \n  DRAW = \"draw\",\n  PENDING = \"pending\",\n  CANCELLED = \"cancelled\"\n}\n\nexport enum MatchCategory {\n  CRICKET = \"cricket\",\n  FOOTBALL = \"football\",\n  BASKETBALL = \"basketball\",\n  TENNIS = \"tennis\",\n  OTHER = \"other\"\n}\n\nexport interface TeamMatch {\n  id: number;\n  teamA: string;\n  teamB: string;\n  category: MatchCategory;\n  startTime: string;\n  odds: {\n    teamA: number;\n    teamB: number;\n    draw: number;\n  };\n  result: TeamMatchResult;\n  status: string;\n  createdAt: string;\n}\n\n// Wallet system types\nexport enum PaymentMode {\n  UPI = \"upi\",\n  BANK = \"bank\"\n}\n\nexport enum RequestStatus {\n  PENDING = \"pending\",\n  APPROVED = \"approved\",\n  REJECTED = \"rejected\"\n}\n\nexport enum RequestType {\n  DEPOSIT = \"deposit\",\n  WITHDRAWAL = \"withdrawal\"\n}\n\nexport interface WalletRequest {\n  id: number;\n  userId: number;\n  amount: number;\n  requestType: RequestType;\n  paymentMode: PaymentMode;\n  paymentDetails: {\n    upiId?: string;\n    bankName?: string;\n    accountNumber?: string;\n    ifscCode?: string;\n    utrNumber?: string;\n    transactionId?: string;\n  };\n  status: RequestStatus;\n  proofImageUrl?: string;\n  notes?: string;\n  reviewedBy?: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface Transaction {\n  id: number;\n  userId: number;\n  amount: number;\n  type: string;\n  description: string;\n  relatedId?: number;\n  createdAt: string;\n}\n\nexport interface PaymentDetails {\n  upiDetails?: {\n    upiId: string;\n    qrImageUrl?: string;\n  };\n  bankDetails?: {\n    accountName: string;\n    accountNumber: string;\n    ifscCode: string;\n    bankName: string;\n  };\n}","path":null,"size_bytes":3013,"size_tokens":null},"server/risk-management.ts":{"content":"import { Request, Response } from \"express\";\nimport { storage } from \"./storage\";\nimport { UserRole, GameType } from \"../shared/schema\";\n\n/**\n * Types for risk management data\n */\ninterface RiskSummary {\n  totalBetAmount: number;\n  potentialLiability: number;\n  potentialProfit: number;\n  exposureAmount: number;\n  activeBets: number;\n  totalBets: number;\n  highRiskBets: number;\n  gameType: string;\n  gameTypeFormatted: string;\n}\n\ninterface DetailedRiskData {\n  userExposure: { [userId: number]: number };\n  marketExposure: { [marketId: number]: number };\n  gameData: any[];\n  cricketMatchAnalysis?: any[];\n}\n\ninterface RiskManagementResponse {\n  summaries: RiskSummary[];\n  detailedData: DetailedRiskData;\n  userInfo: { [userId: number]: { username: string; } };\n  marketInfo: { [marketId: number]: { name: string; type: string; } };\n  message?: string;\n}\n\n/**\n * Get risk management data for admins (platform-wide risk analysis)\n */\nexport async function getAdminRiskManagement(req: Request, res: Response) {\n  try {\n    // Check if admin wants to filter by specific subadmin\n    const subadminId = req.query.subadminId ? parseInt(req.query.subadminId as string) : null;\n    \n    console.log(\" Admin risk management request with subadminId:\", subadminId);\n    \n    // Admin gets platform-wide risk management data or filtered by subadmin\n    const marketGameRiskData = await getMarketGameRiskData(subadminId);\n    const cricketTossRiskData = await getCricketTossRiskData(subadminId);\n    \n    // Fetch real user information for all users involved in games\n    const userIds = Array.from(new Set([\n      ...Object.keys(marketGameRiskData.userExposure).map(id => parseInt(id)),\n      ...Object.keys(cricketTossRiskData.userExposure).map(id => parseInt(id))\n    ]));\n    \n    // Fetch real market information for all markets with games\n    const marketIds = Array.from(new Set(\n      Object.keys(marketGameRiskData.marketExposure).map(id => parseInt(id))\n    ));\n    \n    // Get user information from database\n    const userInfo: { [userId: number]: { username: string } } = {};\n    if (userIds.length > 0) {\n      const users = await storage.getUsersByIds(userIds);\n      users.forEach(user => {\n        userInfo[user.id] = { username: user.username };\n      });\n    }\n    \n    // Get market information from database\n    const marketInfo: { [marketId: number]: { name: string; type: string } } = {};\n    if (marketIds.length > 0) {\n      const markets = await storage.getSatamatkaMarketsByIds(marketIds);\n      markets.forEach(market => {\n        marketInfo[market.id] = { \n          name: market.name,\n          type: market.type\n        };\n      });\n    }\n    \n    const response: RiskManagementResponse = {\n      summaries: [\n        {\n          ...marketGameRiskData.summary,\n          gameType: GameType.SATAMATKA,\n          gameTypeFormatted: \"Market Game\"\n        },\n        {\n          ...cricketTossRiskData.summary,\n          gameType: GameType.CRICKET_TOSS,\n          gameTypeFormatted: \"Cricket Toss\"\n        }\n      ],\n      detailedData: {\n        userExposure: {\n          ...marketGameRiskData.userExposure,\n          ...cricketTossRiskData.userExposure\n        },\n        marketExposure: marketGameRiskData.marketExposure,\n        gameData: [\n          ...marketGameRiskData.games,\n          ...cricketTossRiskData.games\n        ],\n        cricketMatchAnalysis: cricketTossRiskData.matchAnalysis || []\n      },\n      userInfo,\n      marketInfo\n    };\n    \n    console.log(\" Cricket match analysis found:\", cricketTossRiskData.matchAnalysis?.length || 0);\n    return res.status(200).json(response);\n  } catch (error) {\n    console.error(\"Error in admin risk management:\", error);\n    return res.status(500).json({ message: \"Failed to get risk management data\" });\n  }\n}\n\n/**\n * Get risk management data for subadmins (data only for their assigned players)\n */\nexport async function getSubadminRiskManagement(req: Request, res: Response) {\n  try {\n    if (!req.user || req.user.role !== UserRole.SUBADMIN) {\n      return res.status(403).json({ message: \"Unauthorized access\" });\n    }\n    \n    const subadminId = req.user.id;\n    \n    // Get all users assigned to this subadmin\n    const assignedUsers = await storage.getUsersByAssignedTo(subadminId);\n    if (!assignedUsers.length) {\n      return res.status(200).json({\n        summaries: [\n          {\n            totalBetAmount: 0,\n            potentialLiability: 0,\n            potentialProfit: 0,\n            exposureAmount: 0,\n            activeBets: 0,\n            totalBets: 0,\n            highRiskBets: 0,\n            gameType: GameType.SATAMATKA,\n            gameTypeFormatted: \"Market Game\"\n          },\n          {\n            totalBetAmount: 0,\n            potentialLiability: 0,\n            potentialProfit: 0,\n            exposureAmount: 0,\n            activeBets: 0,\n            totalBets: 0,\n            highRiskBets: 0,\n            gameType: GameType.CRICKET_TOSS,\n            gameTypeFormatted: \"Cricket Toss\"\n          }\n        ],\n        detailedData: {\n          userExposure: {},\n          marketExposure: {},\n          gameData: []\n        },\n        userInfo: {},\n        marketInfo: {},\n        message: \"No assigned players found\"\n      });\n    }\n    \n    const userIds = assignedUsers.map(user => user.id);\n    \n    // Get odds for this subadmin\n    const marketGameOdd = await storage.getGameOddBySubadminAndType(subadminId, GameType.SATAMATKA);\n    const cricketTossOdd = await storage.getGameOddBySubadminAndType(subadminId, GameType.CRICKET_TOSS);\n    \n    // If subadmin hasn't set odds, use admin odds\n    const defaultMarketOdd = !marketGameOdd ? \n      await storage.getGameOddByType(GameType.SATAMATKA) : \n      marketGameOdd;\n      \n    const defaultCricketOdd = !cricketTossOdd ? \n      await storage.getGameOddByType(GameType.CRICKET_TOSS) : \n      cricketTossOdd;\n    \n    // Get games for assigned users\n    const allGames = await storage.getGamesByUserIds(userIds);\n    \n    // Filter by game type\n    const marketGames = allGames.filter(game => game.gameType === GameType.SATAMATKA);\n    const cricketTossGames = allGames.filter(game => game.gameType === GameType.CRICKET_TOSS);\n    \n    // Calculate risk data for each game type\n    const marketRiskData = calculateRiskData(\n      marketGames, \n      defaultMarketOdd?.oddValue || 90\n    );\n    \n    const cricketRiskData = await getCricketTossRiskData(subadminId);\n    \n    // Create user info mapping\n    const userInfo: { [userId: number]: { username: string } } = {};\n    assignedUsers.forEach(user => {\n      userInfo[user.id] = { username: user.username };\n    });\n    \n    // Get market IDs from the game data\n    const marketIds = Array.from(new Set(\n      marketGames\n        .filter(game => game.marketId)\n        .map(game => game.marketId as number)\n    ));\n    \n    // Fetch market information\n    const marketInfo: { [marketId: number]: { name: string; type: string } } = {};\n    if (marketIds.length > 0) {\n      const markets = await storage.getSatamatkaMarketsByIds(marketIds);\n      markets.forEach(market => {\n        marketInfo[market.id] = { \n          name: market.name,\n          type: market.type\n        };\n      });\n    }\n    \n    const response: RiskManagementResponse = {\n      summaries: [\n        {\n          ...marketRiskData.summary,\n          gameType: GameType.SATAMATKA,\n          gameTypeFormatted: \"Market Game\"\n        },\n        {\n          ...cricketRiskData.summary,\n          gameType: GameType.CRICKET_TOSS,\n          gameTypeFormatted: \"Cricket Toss\"\n        }\n      ],\n      detailedData: {\n        userExposure: {\n          ...marketRiskData.userExposure,\n          ...cricketRiskData.userExposure\n        },\n        marketExposure: marketRiskData.marketExposure,\n        gameData: [\n          ...marketRiskData.games,\n          ...cricketRiskData.games\n        ],\n        cricketMatchAnalysis: cricketRiskData.matchAnalysis || []\n      },\n      userInfo,\n      marketInfo\n    };\n    \n    return res.status(200).json(response);\n  } catch (error) {\n    console.error(\"Error in subadmin risk management:\", error);\n    return res.status(500).json({ message: \"Failed to get risk management data\" });\n  }\n}\n\n/**\n * Get risk management data for market games\n * Shows jantri for markets pending results (WAITING, OPEN, CLOSED - not yet RESULTED)\n */\nasync function getMarketGameRiskData(subadminId?: number | null) {\n  // Get markets for jantri (open, waiting, or closed without results)\n  const marketsForJantri = await storage.getMarketsForJantri();\n  \n  if (!marketsForJantri || marketsForJantri.length === 0) {\n    // No markets pending results, return empty data\n    return {\n      summary: {\n        totalBetAmount: 0,\n        potentialLiability: 0, \n        potentialProfit: 0,\n        exposureAmount: 0,\n        activeBets: 0,\n        totalBets: 0,\n        highRiskBets: 0\n      },\n      userExposure: {},\n      marketExposure: {},\n      games: []\n    };\n  }\n  \n  // Get games only from markets pending results\n  const activeMarketIds = marketsForJantri.map(market => market.id);\n  let games = await storage.getGamesByType(GameType.SATAMATKA);\n  let activeMarketGames = games.filter(game => \n    game.marketId && activeMarketIds.includes(game.marketId)\n  );\n\n  // Filter games by subadmin if specified\n  if (subadminId) {\n    // Get users assigned to this subadmin\n    const subadminUsers = await storage.getUsersByAssignedTo(subadminId);\n    const subadminUserIds = subadminUsers.map(user => user.id);\n    \n    console.log(` Subadmin ${subadminId} has ${subadminUsers.length} assigned users:`, subadminUserIds);\n    console.log(` Before filtering: ${activeMarketGames.length} market games`);\n    \n    // Filter games to only include those from subadmin's users\n    activeMarketGames = activeMarketGames.filter(game => subadminUserIds.includes(game.userId));\n    \n    console.log(` After filtering: ${activeMarketGames.length} market games for subadmin ${subadminId}`);\n  }\n  \n  // Get market game odds set by admin\n  const marketOdds = await storage.getGameOddByType(GameType.SATAMATKA);\n  const oddValue = marketOdds?.oddValue || 90; // Default to 90 if not set\n  \n  return calculateRiskData(activeMarketGames, oddValue);\n}\n\n/**\n * Get risk management data for cricket toss games with detailed match analysis\n */\nasync function getCricketTossRiskData(subadminId?: number | null) {\n  // Get all cricket toss games\n  let games = await storage.getGamesByType(GameType.CRICKET_TOSS);\n\n  // Filter games by subadmin if specified\n  if (subadminId) {\n    // Get users assigned to this subadmin\n    const subadminUsers = await storage.getUsersByAssignedTo(subadminId);\n    const subadminUserIds = subadminUsers.map(user => user.id);\n    \n    console.log(` Cricket: Subadmin ${subadminId} has ${subadminUsers.length} assigned users:`, subadminUserIds);\n    console.log(` Cricket: Before filtering: ${games.length} cricket games`);\n    console.log(` Cricket: All games:`, games.map(g => ({ id: g.id, userId: g.userId, matchId: g.matchId, result: g.result })));\n    \n    // Filter games to only include those from subadmin's users\n    games = games.filter(game => subadminUserIds.includes(game.userId));\n    \n    console.log(` Cricket: After filtering: ${games.length} cricket games for subadmin ${subadminId}`);\n    console.log(` Cricket: Filtered games:`, games.map(g => ({ id: g.id, userId: g.userId, matchId: g.matchId, result: g.result })));\n  }\n  \n  // Get cricket toss odds set by admin\n  const cricketOdds = await storage.getGameOddByType(GameType.CRICKET_TOSS);\n  const oddValue = cricketOdds?.oddValue || 90; // Default to 90 if not set\n  \n  // Get match-wise analysis\n  console.log(` Cricket: About to get match analysis with ${games.length} games`);\n  const matchAnalysis = await getCricketMatchAnalysis(games, oddValue);\n  console.log(` Cricket: Match analysis returned ${matchAnalysis.length} matches`);\n  \n  const riskData = calculateRiskData(games, oddValue);\n  \n  // Add match analysis to the response\n  return {\n    ...riskData,\n    matchAnalysis\n  };\n}\n\n/**\n * Get detailed cricket match analysis with team-wise betting data\n */\nasync function getCricketMatchAnalysis(games: any[], oddValue: number) {\n  try {\n    console.log(\"Getting cricket match analysis...\");\n    console.log(\"Total cricket toss games:\", games.length);\n    \n    // Get all active cricket toss matches\n    const activeMatches = await storage.getActiveTeamMatches();\n    console.log(\"All active matches:\", activeMatches.length);\n    \n    const cricketMatches = activeMatches.filter(match => match.category === \"cricket_toss\");\n    console.log(\"Cricket toss matches:\", cricketMatches.length);\n    \n    if (cricketMatches.length === 0) {\n      console.log(\"No cricket toss matches found\");\n      return [];\n    }\n    \n    const matchAnalysis = await Promise.all(cricketMatches.map(async (match) => {\n      console.log(`Processing match ${match.id}: ${match.teamA} vs ${match.teamB}`);\n      \n      // Filter games for this specific match - match both null result and pending result\n      const matchGames = games.filter(game => \n        game.matchId === match.id && (game.result === null || game.result === 'pending' || !game.result)\n      );\n      \n      console.log(`Match ${match.id} has ${matchGames.length} active bets`);\n      \n      // Separate bets by team selection\n      const teamABets = matchGames.filter(game => game.prediction === 'team_a');\n      const teamBBets = matchGames.filter(game => game.prediction === 'team_b');\n      \n      console.log(`Team A bets: ${teamABets.length}, Team B bets: ${teamBBets.length}`);\n      \n      // Use custom odds from game odds system (prioritize subadmin custom odds)\n      // First check if there are custom odds for cricket toss, otherwise use match odds\n      let teamAOdds = match.oddTeamA / 100; // Default to match odds (2.00x)\n      let teamBOdds = match.oddTeamB / 100; // Default to match odds (2.00x)\n      \n      // Check if any of the players in this match have subadmin with custom cricket toss odds\n      const allPlayerIds = [...teamABets.map(g => g.userId), ...teamBBets.map(g => g.userId)];\n      if (allPlayerIds.length > 0) {\n        // Get the first player's subadmin assignment to check for custom odds\n        const firstPlayer = await storage.getUser(allPlayerIds[0]);\n        if (firstPlayer && firstPlayer.assignedTo) {\n          const subadminOdds = await storage.getGameOddsBySubadmin(firstPlayer.assignedTo);\n          const customOdds = subadminOdds.find(odd => odd.gameType === 'cricket_toss');\n          if (customOdds && customOdds.oddValue) {\n            // Convert from database format (19000 = 1.9) to multiplier\n            const customMultiplier = customOdds.oddValue / 10000;\n            teamAOdds = customMultiplier;\n            teamBOdds = customMultiplier;\n          }\n        }\n      }\n      \n      // Calculate team A statistics using match-specific odds\n      const teamAStats = {\n        totalBets: teamABets.length,\n        totalAmount: teamABets.reduce((sum, game) => sum + game.betAmount, 0),\n        potentialPayout: teamABets.reduce((sum, game) => sum + (game.betAmount * teamAOdds), 0),\n        users: Array.from(new Set(teamABets.map(game => game.userId)))\n      };\n      \n      // Calculate team B statistics using match-specific odds\n      const teamBStats = {\n        totalBets: teamBBets.length,\n        totalAmount: teamBBets.reduce((sum, game) => sum + game.betAmount, 0),\n        potentialPayout: teamBBets.reduce((sum, game) => sum + (game.betAmount * teamBOdds), 0),\n        users: Array.from(new Set(teamBBets.map(game => game.userId)))\n      };\n      \n      // Calculate match totals and risk\n      const totalBetAmount = teamAStats.totalAmount + teamBStats.totalAmount;\n      const maxPotentialPayout = Math.max(teamAStats.potentialPayout, teamBStats.potentialPayout);\n      \n      // For cricket toss: \n      // - Potential Profit = if house wins (keep all bet amounts)\n      // - Potential Liability = worst case payout (maximum we'd pay out)\n      const potentialProfit = totalBetAmount; // House keeps all 400 if house wins\n      const potentialLoss = maxPotentialPayout; // Maximum payout to users (400  2.00 = 800)\n      \n      // Determine risk level based on potential liability\n      let riskLevel = 'low';\n      if (potentialLoss > 50000) { // 500 \n        riskLevel = 'high';\n      } else if (potentialLoss > 20000) { // 200\n        riskLevel = 'medium';\n      }\n      \n      const analysis = {\n        matchId: match.id,\n        matchInfo: {\n          teamA: match.teamA,\n          teamB: match.teamB,\n          description: match.description,\n          matchTime: match.matchTime,\n          oddTeamA: Math.round(teamAOdds * 100), // Use actual calculated odds\n          oddTeamB: Math.round(teamBOdds * 100), // Use actual calculated odds  \n          status: match.status\n        },\n        teamAStats,\n        teamBStats,\n        summary: {\n          totalBets: matchGames.length,\n          totalAmount: totalBetAmount,\n          potentialProfit: totalBetAmount, // House profit if house wins (keep all bets)\n          potentialLoss: maxPotentialPayout, // Maximum payout to users\n          riskLevel,\n          maxPotentialPayout\n        }\n      };\n      \n      console.log(`Match ${match.id} analysis:`, JSON.stringify(analysis, null, 2));\n      return analysis;\n    }));\n    \n    // Return all matches, even those with 0 bets to show in the UI\n    console.log(\"Final match analysis:\", matchAnalysis.length);\n    return matchAnalysis;\n  } catch (error) {\n    console.error(\"Error in cricket match analysis:\", error);\n    return [];\n  }\n}\n\n/**\n * Calculate risk metrics from game data\n */\nfunction calculateRiskData(games: any[], oddValue: number) {\n  // Consider games with no result OR with result='pending' as active bets\n  const activeBets = games.filter(game => !game.result || game.result === 'pending').length;\n  const totalBets = games.length;\n  \n  // Calculate exposure by user\n  const userExposure: { [userId: number]: number } = {};\n  // Calculate exposure by market (for market games)\n  const marketExposure: { [marketId: number]: number } = {};\n  \n  let totalBetAmount = 0;\n  let potentialLiability = 0;\n  let highRiskBets = 0;\n  \n  // Calculate total bet amount and potential liability\n  games.forEach(game => {\n    // Only count active bets for liability calculations (null result OR 'pending' result)\n    if (!game.result || game.result === 'pending') {\n      const betAmount = game.betAmount;\n      \n      // Calculate potential payout based on specific game mode\n      let multiplier = 1;\n      switch (game.gameMode) {\n        case 'jodi': multiplier = 90; break;\n        case 'harf': multiplier = 9; break;\n        case 'crossing': multiplier = 95; break;\n        case 'odd_even': multiplier = 1.9; break;\n        default: multiplier = oddValue / 100; // Fallback to admin setting\n      }\n      \n      const potentialPayout = betAmount * multiplier;\n      \n      totalBetAmount += betAmount;\n      potentialLiability += potentialPayout;\n      \n      // Track high risk bets (bets over 1000)\n      if (betAmount > 1000) {\n        highRiskBets++;\n      }\n      \n      // Track exposure by user\n      if (!userExposure[game.userId]) {\n        userExposure[game.userId] = 0;\n      }\n      userExposure[game.userId] += potentialPayout;\n      \n      // Track exposure by market (for market games)\n      if (game.marketId && !marketExposure[game.marketId]) {\n        marketExposure[game.marketId] = 0;\n      }\n      if (game.marketId) {\n        marketExposure[game.marketId] += potentialPayout;\n      }\n    }\n  });\n  \n  // Calculate potential profit (house edge)\n  const potentialProfit = totalBetAmount - potentialLiability;\n  \n  // Calculate maximum exposure amount (worst-case scenario)\n  const exposureAmount = Math.max(...Object.values(userExposure), 0);\n  \n  return {\n    summary: {\n      totalBetAmount,\n      potentialLiability,\n      potentialProfit,\n      exposureAmount,\n      activeBets,\n      totalBets,\n      highRiskBets\n    },\n    userExposure,\n    marketExposure,\n    games\n  };\n}","path":null,"size_bytes":20197,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"client/src/pages/market-list-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { getQueryFn } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { format } from \"date-fns\";\nimport MarketCard from \"@/components/market-card\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Calendar, Clock, Timer, CheckCircle2, AlertCircle, PauseCircle } from \"lucide-react\";\n\ninterface SatamatkaMarket {\n  id: number;\n  name: string;\n  type: string;\n  openTime: string;\n  closeTime: string;\n  openResult?: string;\n  closeResult?: string;\n  status: string;\n  createdAt: string;\n  coverImage?: string;\n}\n\nexport default function MarketListPage() {\n  const { user } = useAuth();\n  const [activeTab, setActiveTab] = useState(\"active\");\n\n  // Query for all markets\n  const { data: allMarkets = [], isLoading: isLoadingAll } = useQuery<SatamatkaMarket[]>({\n    queryKey: [\"/api/satamatka/markets\"],\n    queryFn: getQueryFn({ on401: \"throw\" }),\n    enabled: !!user,\n  });\n\n  // Query for active markets\n  const { data: activeMarkets = [], isLoading: isLoadingActive } = useQuery<SatamatkaMarket[]>({\n    queryKey: [\"/api/satamatka/markets/active\"],\n    queryFn: getQueryFn({ on401: \"throw\" }),\n    enabled: !!user,\n  });\n\n  // Loading state\n  const isLoading = activeTab === \"active\" ? isLoadingActive : isLoadingAll;\n\n  // Markets to display based on active tab\n  const markets = activeTab === \"active\" ? activeMarkets : allMarkets;\n\n  // Filter markets by status\n  const openMarkets = allMarkets.filter(market => market.status === \"open\");\n  const upcomingMarkets = allMarkets.filter(market => market.status === \"waiting\");\n  const closedMarkets = allMarkets.filter(market => market.status === \"closed\");\n  const resultedMarkets = allMarkets.filter(market => market.status === \"resulted\");\n  \n  // Sort markets in 'all' tab according to status priority: open, waiting, closed, resulted\n  const sortedAllMarkets = [...allMarkets].sort((a, b) => {\n    const statusPriority = {\n      \"open\": 1,\n      \"waiting\": 2,\n      \"closed\": 3, \n      \"resulted\": 4\n    };\n    \n    return (statusPriority[a.status as keyof typeof statusPriority] || 99) - \n           (statusPriority[b.status as keyof typeof statusPriority] || 99);\n  });\n  \n  // Get today's date for display\n  const today = new Date();\n  const dateString = format(today, \"EEEE, MMMM d, yyyy\");\n  \n  return (\n    <DashboardLayout title=\"Satamatka Markets\">\n      <div className=\"mb-6\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <div className=\"flex items-center text-muted-foreground\">\n            <Calendar className=\"h-5 w-5 mr-2\" />\n            <span>{dateString}</span>\n          </div>\n        </div>\n        <p className=\"text-muted-foreground\">Place bets on various market games to win big prizes</p>\n      </div>\n\n      <Tabs defaultValue=\"active\" value={activeTab} onValueChange={setActiveTab}>\n        {/* Mobile view: optimized scrollable tabs */}\n        <div className=\"md:hidden mb-6\">\n          <div className=\"overflow-x-auto scrollbar-thin scrollbar-thumb-primary/20 scrollbar-track-transparent\">\n            <TabsList className=\"inline-flex flex-nowrap min-w-max h-12 p-1 gap-1\">\n              <TabsTrigger \n                value=\"active\" \n                className=\"flex-shrink-0 flex items-center justify-center whitespace-nowrap px-3 py-2 text-sm font-medium transition-all\"\n              >\n                <Clock className=\"h-4 w-4 mr-2\" />\n                <span>Active ({openMarkets.length})</span>\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"upcoming\" \n                className=\"flex-shrink-0 flex items-center justify-center whitespace-nowrap px-3 py-2 text-sm font-medium transition-all\"\n              >\n                <PauseCircle className=\"h-4 w-4 mr-2\" />\n                <span>Upcoming ({upcomingMarkets.length})</span>\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"closed\" \n                className=\"flex-shrink-0 flex items-center justify-center whitespace-nowrap px-3 py-2 text-sm font-medium transition-all\"\n              >\n                <Timer className=\"h-4 w-4 mr-2\" />\n                <span>Waiting ({closedMarkets.length})</span>\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"resulted\" \n                className=\"flex-shrink-0 flex items-center justify-center whitespace-nowrap px-3 py-2 text-sm font-medium transition-all\"\n              >\n                <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n                <span>Results ({resultedMarkets.length})</span>\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"all\" \n                className=\"flex-shrink-0 flex items-center justify-center whitespace-nowrap px-3 py-2 text-sm font-medium transition-all\"\n              >\n                <AlertCircle className=\"h-4 w-4 mr-2\" />\n                <span>All ({allMarkets.length})</span>\n              </TabsTrigger>\n            </TabsList>\n          </div>\n          \n          {/* Mobile filter indicator */}\n          <div className=\"mt-2 text-xs text-muted-foreground text-center\">\n            Swipe to see more filters \n          </div>\n        </div>\n        \n        {/* Desktop view: grid tabs */}\n        <div className=\"hidden md:block\">\n          <TabsList className=\"mb-6 grid w-full grid-cols-5\">\n            <TabsTrigger value=\"active\" className=\"flex items-center justify-center\">\n              <Clock className=\"h-4 w-4 mr-2\" />\n              <span>Active ({openMarkets.length})</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"upcoming\" className=\"flex items-center justify-center\">\n              <PauseCircle className=\"h-4 w-4 mr-2\" />\n              <span>Upcoming ({upcomingMarkets.length})</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"closed\" className=\"flex items-center justify-center\">\n              <Timer className=\"h-4 w-4 mr-2\" />\n              <span>Waiting Results ({closedMarkets.length})</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"resulted\" className=\"flex items-center justify-center\">\n              <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n              <span>Resulted ({resultedMarkets.length})</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"all\" className=\"flex items-center justify-center\">\n              <AlertCircle className=\"h-4 w-4 mr-2\" />\n              <span>All ({allMarkets.length})</span>\n            </TabsTrigger>\n          </TabsList>\n        </div>\n\n        <TabsContent value=\"active\" className=\"space-y-6\">\n          <div className=\"p-4 bg-muted/50 rounded-lg mb-4\">\n            <h2 className=\"text-lg font-semibold flex items-center\">\n              <Clock className=\"h-5 w-5 mr-2 text-green-500\" />\n              Active Markets\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">These markets are currently open for betting</p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {isLoadingAll ? (\n              // Loading skeletons\n              Array.from({ length: 3 }).map((_, i) => (\n                <div key={i} className=\"border rounded-lg p-4\">\n                  <Skeleton className=\"h-6 w-3/4 mb-2\" />\n                  <Skeleton className=\"h-4 w-1/2 mb-4\" />\n                  <div className=\"flex justify-between mb-4\">\n                    <div className=\"space-y-2\">\n                      <Skeleton className=\"h-4 w-20\" />\n                      <Skeleton className=\"h-4 w-24\" />\n                    </div>\n                    <Skeleton className=\"h-14 w-14 rounded-full\" />\n                  </div>\n                  <Skeleton className=\"h-10 w-full\" />\n                </div>\n              ))\n            ) : openMarkets.length > 0 ? (\n              openMarkets.map((market) => (\n                <MarketCard\n                  key={market.id}\n                  id={market.id}\n                  name={market.name}\n                  type={market.type}\n                  openTime={market.openTime}\n                  closeTime={market.closeTime}\n                  openResult={market.openResult}\n                  closeResult={market.closeResult}\n                  status={market.status}\n                  coverImage={market.coverImage}\n                />\n              ))\n            ) : (\n              <div className=\"col-span-full text-center py-10\">\n                <p className=\"text-muted-foreground\">No active markets available at the moment.</p>\n              </div>\n            )}\n          </div>\n        </TabsContent>\n        \n        <TabsContent value=\"upcoming\" className=\"space-y-6\">\n          <div className=\"p-4 bg-muted/50 rounded-lg mb-4\">\n            <h2 className=\"text-lg font-semibold flex items-center\">\n              <PauseCircle className=\"h-5 w-5 mr-2 text-purple-500\" />\n              Upcoming Markets\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">These markets will open for betting soon</p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {isLoadingAll ? (\n              // Loading skeletons\n              Array.from({ length: 3 }).map((_, i) => (\n                <div key={i} className=\"border rounded-lg p-4\">\n                  <Skeleton className=\"h-28 w-full mb-4\" />\n                  <Skeleton className=\"h-6 w-3/4 mb-2\" />\n                  <Skeleton className=\"h-4 w-1/2 mb-2\" />\n                  <Skeleton className=\"h-10 w-full mt-4\" />\n                </div>\n              ))\n            ) : upcomingMarkets.length > 0 ? (\n              upcomingMarkets.map((market) => (\n                <MarketCard\n                  key={market.id}\n                  id={market.id}\n                  name={market.name}\n                  type={market.type}\n                  openTime={market.openTime}\n                  closeTime={market.closeTime}\n                  openResult={market.openResult}\n                  closeResult={market.closeResult}\n                  status={market.status}\n                  showFullInfo={true}\n                  coverImage={market.coverImage}\n                />\n              ))\n            ) : (\n              <div className=\"col-span-full text-center py-10\">\n                <p className=\"text-muted-foreground\">No upcoming markets at the moment.</p>\n              </div>\n            )}\n          </div>\n        </TabsContent>\n        \n        <TabsContent value=\"closed\" className=\"space-y-6\">\n          <div className=\"p-4 bg-muted/50 rounded-lg mb-4\">\n            <h2 className=\"text-lg font-semibold flex items-center\">\n              <Timer className=\"h-5 w-5 mr-2 text-yellow-500\" />\n              Markets Waiting Results\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">These markets are closed for betting and waiting for results to be declared</p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {isLoadingAll ? (\n              // Loading skeletons\n              Array.from({ length: 3 }).map((_, i) => (\n                <div key={i} className=\"border rounded-lg p-4\">\n                  <Skeleton className=\"h-28 w-full mb-4\" />\n                  <Skeleton className=\"h-6 w-3/4 mb-2\" />\n                  <Skeleton className=\"h-4 w-1/2 mb-2\" />\n                  <Skeleton className=\"h-10 w-full mt-4\" />\n                </div>\n              ))\n            ) : closedMarkets.length > 0 ? (\n              closedMarkets.map((market) => (\n                <MarketCard\n                  key={market.id}\n                  id={market.id}\n                  name={market.name}\n                  type={market.type}\n                  openTime={market.openTime}\n                  closeTime={market.closeTime}\n                  openResult={market.openResult}\n                  closeResult={market.closeResult}\n                  status={market.status}\n                  showFullInfo={true}\n                  coverImage={market.coverImage}\n                />\n              ))\n            ) : (\n              <div className=\"col-span-full text-center py-10\">\n                <p className=\"text-muted-foreground\">No markets waiting for results.</p>\n              </div>\n            )}\n          </div>\n        </TabsContent>\n        \n        <TabsContent value=\"resulted\" className=\"space-y-6\">\n          <div className=\"p-4 bg-muted/50 rounded-lg mb-4\">\n            <h2 className=\"text-lg font-semibold flex items-center\">\n              <CheckCircle2 className=\"h-5 w-5 mr-2 text-blue-500\" />\n              Results Declared\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">These markets have their results declared</p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {isLoadingAll ? (\n              // Loading skeletons\n              Array.from({ length: 3 }).map((_, i) => (\n                <div key={i} className=\"border rounded-lg p-4\">\n                  <Skeleton className=\"h-28 w-full mb-4\" />\n                  <Skeleton className=\"h-6 w-3/4 mb-2\" />\n                  <Skeleton className=\"h-4 w-1/2 mb-2\" />\n                  <Skeleton className=\"h-10 w-full mt-4\" />\n                </div>\n              ))\n            ) : resultedMarkets.length > 0 ? (\n              resultedMarkets.map((market) => (\n                <MarketCard\n                  key={market.id}\n                  id={market.id}\n                  name={market.name}\n                  type={market.type}\n                  openTime={market.openTime}\n                  closeTime={market.closeTime}\n                  openResult={market.openResult}\n                  closeResult={market.closeResult}\n                  status={market.status}\n                  showFullInfo={true}\n                  coverImage={market.coverImage}\n                />\n              ))\n            ) : (\n              <div className=\"col-span-full text-center py-10\">\n                <p className=\"text-muted-foreground\">No markets with declared results.</p>\n              </div>\n            )}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"all\" className=\"space-y-6\">\n          <div className=\"p-4 bg-muted/50 rounded-lg mb-4\">\n            <h2 className=\"text-lg font-semibold flex items-center\">\n              <AlertCircle className=\"h-5 w-5 mr-2 text-primary\" />\n              All Markets\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">Complete list of all markets</p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {isLoadingAll ? (\n              // Loading skeletons\n              Array.from({ length: 6 }).map((_, i) => (\n                <div key={i} className=\"border rounded-lg p-4\">\n                  <Skeleton className=\"h-28 w-full mb-4\" />\n                  <Skeleton className=\"h-6 w-3/4 mb-2\" />\n                  <Skeleton className=\"h-4 w-1/2 mb-2\" />\n                  <Skeleton className=\"h-10 w-full mt-4\" />\n                </div>\n              ))\n            ) : sortedAllMarkets.length > 0 ? (\n              sortedAllMarkets.map((market) => (\n                <MarketCard\n                  key={market.id}\n                  id={market.id}\n                  name={market.name}\n                  type={market.type}\n                  openTime={market.openTime}\n                  closeTime={market.closeTime}\n                  openResult={market.openResult}\n                  closeResult={market.closeResult}\n                  status={market.status}\n                  showFullInfo={true}\n                  coverImage={market.coverImage}\n                />\n              ))\n            ) : (\n              <div className=\"col-span-full text-center py-10\">\n                <p className=\"text-muted-foreground\">No markets available.</p>\n              </div>\n            )}\n          </div>\n        </TabsContent>\n      </Tabs>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":16271,"size_tokens":null},"client/src/pages/cricket-toss-page.tsx":{"content":"import React, { useState } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ExclamationTriangleIcon } from \"@radix-ui/react-icons\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { formatDate, formatCurrency } from \"@/lib/utils\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\n\n// Interface for a cricket toss match\ninterface CricketTossMatch {\n  id: number;\n  teamA: string;\n  teamB: string;\n  description?: string;\n  matchTime: string;\n  teamAImage?: string;\n  teamBImage?: string;\n  coverImage?: string;\n  oddTeamA: number;\n  oddTeamB: number;\n  status: string;\n  result?: string;\n  createdAt: string;\n}\n\n// Interface for bet history\ninterface BetHistory {\n  id: number;\n  userId: number;\n  gameType: string;\n  betAmount: number;\n  prediction: string;\n  payout: number;\n  result?: string;\n  createdAt: string;\n  gameData: {\n    teamA: string;\n    teamB: string;\n    teamAImage?: string;\n    teamBImage?: string;\n    coverImage?: string;\n    oddTeamA: number;\n    oddTeamB: number;\n    matchTime: string;\n  };\n}\n\nexport default function CricketTossPage() {\n  const [selectedMatch, setSelectedMatch] = useState<CricketTossMatch | null>(null);\n  const [betAmount, setBetAmount] = useState<string>(\"100\");\n  const [selectedTeam, setSelectedTeam] = useState<string | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Query to fetch open cricket toss matches\n  const { data: openMatches = [], isLoading: loadingMatches } = useQuery({\n    queryKey: [\"/api/cricket-toss/open-matches\"],\n    staleTime: 30000, // 30 seconds\n  });\n\n  // Query to fetch user's betting history\n  const { data: betHistory = [], isLoading: loadingHistory } = useQuery({\n    queryKey: [\"/api/cricket-toss/my-bets\"],\n    staleTime: 30000, // 30 seconds\n  });\n\n  // Mutation to place a bet\n  const placeBetMutation = useMutation({\n    mutationFn: async ({\n      matchId,\n      betAmount,\n      prediction,\n    }: {\n      matchId: number;\n      betAmount: number;\n      prediction: string;\n    }) => {\n      return await fetch(`/api/cricket-toss/${matchId}/play`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          prediction,\n          betAmount\n        }),\n        credentials: \"include\"\n      }).then(async (res) => {\n        if (!res.ok) {\n          const text = await res.text();\n          throw new Error(text || res.statusText);\n        }\n        return res.json();\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Bet Placed Successfully\",\n        description: \"Your bet has been placed on the cricket toss match.\",\n      });\n      setBetAmount(\"100\");\n      setSelectedTeam(null);\n      setSelectedMatch(null);\n      queryClient.invalidateQueries({ queryKey: [\"/api/cricket-toss/my-bets\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] }); // Refresh user balance\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error Placing Bet\",\n        description: error.message || \"Failed to place your bet. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Function to handle placing a bet\n  const handlePlaceBet = () => {\n    if (!selectedMatch || !selectedTeam || !betAmount) {\n      toast({\n        title: \"Incomplete Bet\",\n        description: \"Please select a team and enter a bet amount.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const amount = parseInt(betAmount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({\n        title: \"Invalid Bet Amount\",\n        description: \"Please enter a valid bet amount.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    placeBetMutation.mutate({\n      matchId: selectedMatch.id,\n      betAmount: amount,\n      prediction: selectedTeam,\n    });\n  };\n\n  // Function to calculate potential win amount\n  const calculateWin = (amount: number, team: string) => {\n    return amount * 1.9; // Standard multiplier without displaying odds\n  };\n\n  // Function to calculate potential win amount\n  const calculatePotentialWin = (amount: string, team: string | null) => {\n    if (!selectedMatch || !team || !amount) return 0;\n    \n    const betAmountNum = parseInt(amount);\n    if (isNaN(betAmountNum)) return 0;\n    \n    const odds = team === \"team_a\" ? selectedMatch.oddTeamA : selectedMatch.oddTeamB;\n    return betAmountNum * (odds / 100);\n  };\n\n  // Format the team name based on the prediction value\n  const formatPrediction = (prediction: string, bet: BetHistory) => {\n    if (prediction === \"team_a\") return bet.gameData.teamA;\n    if (prediction === \"team_b\") return bet.gameData.teamB;\n    return prediction;\n  };\n\n  // Get appropriate badge for match status\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"open\":\n        return <Badge className=\"bg-green-500\">Open</Badge>;\n      case \"closed\":\n        return <Badge className=\"bg-yellow-500\">Closed</Badge>;\n      case \"resulted\":\n        return <Badge className=\"bg-blue-500\">Resulted</Badge>;\n      default:\n        return <Badge>{status}</Badge>;\n    }\n  };\n\n  // Get result text for bet history\n  const getResultText = (bet: BetHistory) => {\n    if (!bet.result) return \"Pending\";\n    if (bet.result === bet.prediction) return \"Won\";\n    return \"Lost\";\n  };\n\n  // Get class for result text\n  const getResultClass = (bet: BetHistory) => {\n    if (!bet.result) return \"text-yellow-600\";\n    if (bet.result === bet.prediction) return \"text-green-600 font-bold\";\n    return \"text-red-600\";\n  };\n\n  return (\n    <DashboardLayout title=\"Cricket Toss\">\n      <div className=\"container mx-auto p-4\">\n        <Tabs defaultValue=\"matches\" className=\"w-full\">\n          <TabsList className=\"mb-4\">\n            <TabsTrigger value=\"matches\">Available Matches</TabsTrigger>\n            <TabsTrigger value=\"history\">My Betting History</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"matches\">\n            {loadingMatches ? (\n              <div className=\"flex justify-center p-8\">Loading cricket toss matches...</div>\n            ) : openMatches && openMatches.length > 0 ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {openMatches.map((match: CricketTossMatch) => (\n                  <Card key={match.id} className={selectedMatch?.id === match.id ? \"border-primary\" : \"\"}>\n                    <CardHeader>\n                      <div className=\"flex justify-between items-start\">\n                        <CardTitle className=\"text-lg\">\n                          {match.teamA} vs {match.teamB}\n                        </CardTitle>\n                        {getStatusBadge(match.status)}\n                      </div>\n                      <CardDescription>\n                        {match.description || \"Cricket Toss Match\"}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex justify-between\">\n                          <span>Match Time:</span>\n                          <span>{(() => {\n                            // Parse the time string as local time to avoid timezone conversion\n                            const timeString = match.matchTime.replace('T', ' ').replace('.000Z', '').replace('Z', '');\n                            const localDate = new Date(timeString);\n                            return localDate.toLocaleString('en-IN', { \n                              year: 'numeric',\n                              month: 'short', \n                              day: 'numeric',\n                              hour: 'numeric',\n                              minute: '2-digit',\n                              hour12: true\n                            });\n                          })()}</span>\n                        </div>\n                        <Separator />\n                        {match.coverImage && (\n                          <div className=\"mb-4\">\n                            <img \n                              src={match.coverImage} \n                              alt={`${match.teamA} vs ${match.teamB}`}\n                              className=\"w-full h-32 object-cover rounded-md\" \n                            />\n                          </div>\n                        )}\n                        <div className=\"grid grid-cols-2 gap-2\">\n                          <div className=\"text-center p-2 rounded border\">\n                            <div className=\"font-bold\">{match.teamA}</div>\n                          </div>\n                          <div className=\"text-center p-2 rounded border\">\n                            <div className=\"font-bold\">{match.teamB}</div>\n                          </div>\n                        </div>\n                      </div>\n                    </CardContent>\n                    <CardFooter className=\"flex justify-end\">\n                      <Button\n                        onClick={() => {\n                          setSelectedMatch(match);\n                          setSelectedTeam(null);\n                          setBetAmount(\"100\");\n                        }}\n                      >\n                        Place Bet\n                      </Button>\n                    </CardFooter>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <Alert>\n                <ExclamationTriangleIcon className=\"h-4 w-4\" />\n                <AlertTitle>No Matches Available</AlertTitle>\n                <AlertDescription>\n                  There are no open cricket toss matches available for betting at this time.\n                </AlertDescription>\n              </Alert>\n            )}\n\n            {selectedMatch && (\n              <div className=\"mt-8\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Place Your Bet</CardTitle>\n                    <CardDescription>\n                      {selectedMatch.teamA} vs {selectedMatch.teamB} - {(() => {\n                        const timeString = selectedMatch.matchTime.replace('T', ' ').replace('.000Z', '').replace('Z', '');\n                        const localDate = new Date(timeString);\n                        return localDate.toLocaleString('en-IN', { \n                          year: 'numeric',\n                          month: 'short', \n                          day: 'numeric',\n                          hour: 'numeric',\n                          minute: '2-digit',\n                          hour12: true\n                        });\n                      })()}\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-6\">\n                    {/* Team Selection - Mobile Optimized */}\n                    <div className=\"space-y-3\">\n                      <label className=\"text-sm font-medium block\">Choose Your Team</label>\n                      <div className=\"grid grid-cols-2 gap-3\">\n                        <Button\n                          variant={selectedTeam === \"team_a\" ? \"default\" : \"outline\"}\n                          className=\"h-20 p-4 text-center\"\n                          onClick={() => setSelectedTeam(\"team_a\")}\n                        >\n                          <div className=\"flex flex-col items-center justify-center gap-2\">\n                            <div className=\"font-bold text-lg\">{selectedMatch.teamA}</div>\n                          </div>\n                        </Button>\n                        <Button\n                          variant={selectedTeam === \"team_b\" ? \"default\" : \"outline\"}\n                          className=\"h-20 p-4 text-center\"\n                          onClick={() => setSelectedTeam(\"team_b\")}\n                        >\n                          <div className=\"flex flex-col items-center justify-center gap-2\">\n                            <div className=\"font-bold text-lg\">{selectedMatch.teamB}</div>\n                          </div>\n                        </Button>\n                      </div>\n                    </div>\n\n                    {/* Bet Amount Section - Mobile Optimized */}\n                    <div className=\"space-y-3\">\n                      <label htmlFor=\"betAmount\" className=\"text-sm font-medium block\">\n                        Bet Amount ()\n                      </label>\n                      <Input\n                        id=\"betAmount\"\n                        type=\"number\"\n                        value={betAmount}\n                        onChange={(e) => setBetAmount(e.target.value)}\n                        min=\"10\"\n                        step=\"10\"\n                        className=\"h-12 text-lg\"\n                        placeholder=\"Enter amount\"\n                      />\n                      \n                      {/* Quick bet amount selection - Mobile Optimized */}\n                      <div className=\"grid grid-cols-3 gap-2\">\n                        {[100, 500, 1000, 2000, 5000, 10000].map((amount) => (\n                          <Button\n                            key={amount}\n                            type=\"button\"\n                            size=\"sm\"\n                            variant={parseInt(betAmount) === amount ? \"default\" : \"outline\"}\n                            onClick={() => setBetAmount(amount.toString())}\n                            className=\"h-10 text-sm font-medium\"\n                          >\n                            {amount}\n                          </Button>\n                        ))}\n                      </div>\n                    </div>\n\n                    {/* Potential Win - Mobile Optimized */}\n                    <div className=\"bg-muted/50 p-4 rounded-lg\">\n                      <label className=\"text-sm font-medium block mb-2\">\n                        Potential Win\n                      </label>\n                      <div className=\"text-2xl font-bold text-primary\">\n                        {calculatePotentialWin(betAmount, selectedTeam).toFixed(2)}\n                      </div>\n                      <div className=\"text-xs text-muted-foreground mt-2\">\n                        Select a team and enter your bet amount to calculate potential winnings.\n                      </div>\n                    </div>\n                  </CardContent>\n                  <CardFooter className=\"flex flex-col gap-3 sm:flex-row sm:justify-between\">\n                    <Button \n                      variant=\"outline\" \n                      onClick={() => setSelectedMatch(null)}\n                      className=\"h-12 w-full sm:w-auto\"\n                    >\n                      Cancel\n                    </Button>\n                    <Button \n                      onClick={handlePlaceBet} \n                      disabled={!selectedTeam || placeBetMutation.isPending}\n                      className=\"h-12 w-full sm:w-auto bg-primary hover:bg-primary/90\"\n                    >\n                      {placeBetMutation.isPending ? \"Placing Bet...\" : \"Place Bet\"}\n                    </Button>\n                  </CardFooter>\n                </Card>\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"history\">\n            {loadingHistory ? (\n              <div className=\"flex justify-center p-8\">Loading your bet history...</div>\n            ) : betHistory && betHistory.length > 0 ? (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Match</TableHead>\n                    <TableHead>Bet On</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Payout</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {betHistory.map((bet: BetHistory) => (\n                    <TableRow key={bet.id}>\n                      <TableCell>{formatDate(new Date(bet.createdAt))}</TableCell>\n                      <TableCell>\n                        <div className=\"flex flex-col gap-1\">\n                          {bet.gameData.coverImage && (\n                            <img \n                              src={bet.gameData.coverImage} \n                              alt={`${bet.gameData.teamA} vs ${bet.gameData.teamB}`}\n                              className=\"h-10 w-full max-w-[120px] object-cover rounded-md mb-1\" \n                            />\n                          )}\n                          <div className=\"flex items-center\">\n                            <span>{bet.gameData.teamA}</span>\n                            <span className=\"mx-1 text-xs text-gray-500\">vs</span>\n                            <span>{bet.gameData.teamB}</span>\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1\">\n                          <span>{formatPrediction(bet.prediction, bet)}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>{(bet.betAmount / 100).toFixed(2)}</TableCell>\n                      <TableCell className={getResultClass(bet)}>\n                        {getResultText(bet)}\n                      </TableCell>\n                      <TableCell>\n                        {bet.payout > 0 ? `${(bet.payout / 100).toFixed(2)}` : \"-\"}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            ) : (\n              <Alert>\n                <ExclamationTriangleIcon className=\"h-4 w-4\" />\n                <AlertTitle>No Betting History</AlertTitle>\n                <AlertDescription>\n                  You haven't placed any bets on cricket toss matches yet.\n                </AlertDescription>\n              </Alert>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":18805,"size_tokens":null},"fix-admin-login.ts":{"content":"/**\n * This script fixes login issues with older admin accounts created before\n * email and mobile fields were required.\n * \n * It adds default values for these fields to existing accounts that lack them.\n */\n\nimport { Pool } from 'pg';\nimport dotenv from 'dotenv';\n\n// Load environment variables\ndotenv.config();\n\nasync function fixAdminLogin() {\n  const pool = new Pool({ connectionString: process.env.DATABASE_URL });\n\n  try {\n    console.log('Connecting to database...');\n    const client = await pool.connect();\n\n    try {\n      // First check if the email and mobile columns exist\n      const columnsExist = await client.query(`\n        SELECT column_name \n        FROM information_schema.columns \n        WHERE table_name = 'users' \n        AND column_name IN ('email', 'mobile')\n      `);\n\n      // If the columns don't exist, we need to add them\n      if (columnsExist.rows.length < 2) {\n        console.log('Adding missing email and/or mobile columns...');\n        \n        // Check which columns need to be added\n        const existingColumns = columnsExist.rows.map(row => row.column_name);\n        \n        if (!existingColumns.includes('email')) {\n          await client.query(`ALTER TABLE users ADD COLUMN email TEXT`);\n          console.log('Added email column');\n        }\n        \n        if (!existingColumns.includes('mobile')) {\n          await client.query(`ALTER TABLE users ADD COLUMN mobile TEXT`);\n          console.log('Added mobile column');\n        }\n      }\n\n      // Update admin accounts to have default values for email and mobile if they are NULL\n      console.log('Updating admin accounts with default values for email and mobile...');\n      const result = await client.query(`\n        UPDATE users \n        SET \n          email = COALESCE(email, username || '@admin.example.com'),\n          mobile = COALESCE(mobile, '1234567890')\n        WHERE \n          role = 'admin' AND (email IS NULL OR mobile IS NULL)\n        RETURNING id, username\n      `);\n\n      if (result.rows.length > 0) {\n        console.log(`Updated ${result.rows.length} admin accounts:`);\n        result.rows.forEach(user => {\n          console.log(`- Admin ID: ${user.id}, Username: ${user.username}`);\n        });\n      } else {\n        console.log('No admin accounts needed updating');\n      }\n\n      // Check for any other accounts (subadmins, players) without email/mobile\n      const otherAccounts = await client.query(`\n        UPDATE users \n        SET \n          email = COALESCE(email, username || '@user.example.com'),\n          mobile = COALESCE(mobile, '9876543210')\n        WHERE \n          role != 'admin' AND (email IS NULL OR mobile IS NULL)\n        RETURNING id, username, role\n      `);\n\n      if (otherAccounts.rows.length > 0) {\n        console.log(`Updated ${otherAccounts.rows.length} other accounts:`);\n        otherAccounts.rows.forEach(user => {\n          console.log(`- ${user.role} ID: ${user.id}, Username: ${user.username}`);\n        });\n      } else {\n        console.log('No other accounts needed updating');\n      }\n\n      console.log('Account fixes completed successfully!');\n\n    } finally {\n      client.release();\n    }\n  } catch (error) {\n    console.error('Error fixing admin accounts:', error);\n  } finally {\n    await pool.end();\n  }\n}\n\n// Run the script\nfixAdminLogin().catch(console.error);","path":null,"size_bytes":3337,"size_tokens":null},"create-minimal-storage.ts":{"content":"// This script creates a minimal but working storage.ts file\nimport fs from 'fs';\n\nfunction createMinimalStorage() {\n  try {\n    console.log(\"Creating minimal storage.ts file...\");\n    \n    const minimalStorageContent = `import { db } from \"./db\";\nimport { \n  users, \n  games, \n  satamatkaMarkets,\n  teamMatches,\n  systemSettings,\n  subadminCommissions,\n  userDiscounts,\n  playerDepositDiscounts,\n  gameOdds,\n  transactions,\n  walletRequests,\n  User, \n  InsertUser, \n  Game, \n  InsertGame, \n  UserRole, \n  SatamatkaMarket,\n  InsertSatamatkaMarket,\n  TeamMatch,\n  InsertTeamMatch,\n  SystemSetting,\n  MarketStatus,\n  RecurrencePattern,\n  InsertSystemSetting,\n  SubadminCommission,\n  InsertSubadminCommission,\n  UserDiscount,\n  InsertUserDiscount,\n  PlayerDepositDiscount,\n  InsertPlayerDepositDiscount,\n  GameOdd,\n  InsertGameOdd,\n  Transaction,\n  InsertTransaction,\n  RequestType,\n  RequestStatus,\n  InsertWalletRequest,\n  WalletRequest,\n  PaymentMode,\n  GameType\n} from \"@shared/schema\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\nimport { eq, desc, and, lt, gt, gte, lte, ne, isNotNull, or, sql, asc, count, isNull, like, not } from 'drizzle-orm';\nimport { pool } from \"./db\";\n\n/**\n * Storage interface for database operations\n */\nexport interface IStorage {\n  // User methods\n  getUser(id: number): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  getAllUsers(): Promise<User[]>;\n  getUsersByAssignedTo(assignedToId: number): Promise<User[]>;\n  updateUserBalance(userId: number, newBalance: number): Promise<User | undefined>;\n  updateUser(userId: number, data: {username?: string; password?: string}): Promise<User | undefined>;\n  updateUserPassword(userId: number, hashedPassword: string): Promise<User | undefined>;\n  blockUser(userId: number, blockedById: number): Promise<User | undefined>;\n  unblockUser(userId: number): Promise<User | undefined>;\n  getBlockedByUser(userId: number): Promise<number | null>;\n  assignUserToAdmin(userId: number, adminId: number): Promise<User | undefined>;\n  \n  // Game methods\n  createGame(game: InsertGame): Promise<Game>;\n  getGame(id: number): Promise<Game | undefined>;\n  getGamesByUserId(userId: number): Promise<Game[]>;\n  getGamesByUserIds(userIds: number[]): Promise<Game[]>;\n  getAllGames(limit?: number): Promise<Game[]>;\n  getRecentGames(userId: number, limit?: number): Promise<Game[]>;\n  updateGameStatus(gameId: number, status: string): Promise<Game | undefined>;\n  updateGameResult(gameId: number, result: string, payout?: number): Promise<Game | undefined>;\n\n  // Satamatka Market methods\n  createSatamatkaMarket(market: InsertSatamatkaMarket): Promise<SatamatkaMarket>;\n  getSatamatkaMarket(id: number): Promise<SatamatkaMarket | undefined>;\n  getAllSatamatkaMarkets(): Promise<SatamatkaMarket[]>;\n  getActiveSatamatkaMarkets(): Promise<SatamatkaMarket[]>;\n  updateSatamatkaMarketResults(id: number, openResult?: string, closeResult?: string): Promise<SatamatkaMarket | undefined>;\n  updateSatamatkaMarketStatus(id: number, status: string): Promise<SatamatkaMarket | undefined>;\n  getSatamatkaGamesByMarketId(marketId: number): Promise<Game[]>;\n\n  // Team Match methods\n  createTeamMatch(match: InsertTeamMatch): Promise<TeamMatch>;\n  getTeamMatch(id: number): Promise<TeamMatch | undefined>;\n  getAllTeamMatches(): Promise<TeamMatch[]>;\n  getActiveTeamMatches(): Promise<TeamMatch[]>;\n  updateTeamMatch(id: number, data: Partial<InsertTeamMatch>): Promise<TeamMatch | undefined>;\n  updateTeamMatchResult(id: number, result: string): Promise<TeamMatch | undefined>;\n  updateTeamMatchStatus(id: number, status: string): Promise<TeamMatch | undefined>;\n  getTeamMatchesByCategory(category: string): Promise<TeamMatch[]>; \n  getTeamMatchGamesByMatchId(matchId: number): Promise<Game[]>;\n\n  // Transaction methods\n  createTransaction(transaction: InsertTransaction): Promise<Transaction>;\n  getTransactionsByUserId(userId: number): Promise<Transaction[]>;\n  getAllTransactions(limit?: number): Promise<Transaction[]>;\n\n  // System Settings methods\n  getSystemSetting(settingType: string, settingKey: string): Promise<SystemSetting | undefined>;\n  upsertSystemSetting(settingType: string, settingKey: string, settingValue: string): Promise<SystemSetting>;\n  getSystemSettingsByType(settingType: string): Promise<SystemSetting[]>;\n  \n  // Subadmin Commission methods\n  getSubadminCommissions(subadminId: number): Promise<SubadminCommission[]>;\n  upsertSubadminCommission(subadminId: number, gameType: string, commissionRate: number): Promise<SubadminCommission>;\n  \n  // User Discount methods\n  getUserDiscounts(userId: number, subadminId: number): Promise<UserDiscount[]>;\n  upsertUserDiscount(subadminId: number, userId: number, gameType: string, discountRate: number): Promise<UserDiscount>;\n  \n  // Player deposit discount methods\n  getPlayerDepositDiscount(userId: number, subadminId: number): Promise<PlayerDepositDiscount | undefined>;\n  upsertPlayerDepositDiscount(subadminId: number, userId: number, discountRate: number): Promise<PlayerDepositDiscount>;\n  \n  // Game Odds methods\n  getGameOdds(gameType: string): Promise<GameOdd[]>;\n  getGameOddsBySubadmin(subadminId: number, gameType?: string): Promise<GameOdd[]>;\n  upsertGameOdd(gameType: string, oddValue: number, setByAdmin: boolean, subadminId?: number): Promise<GameOdd>;\n  getOddsForPlayer(userId: number, gameType: string): Promise<number>;\n\n  // Admin seeding methods\n  seedCricketTossGames(): Promise<void>;\n  seedDemoSatamatkaMarkets(): Promise<void>;\n\n  // Session store\n  sessionStore: session.Store;\n}\n\n/**\n * Database storage implementation for Postgres\n */\nexport class DatabaseStorage implements IStorage {\n  public sessionStore: session.Store;\n\n  constructor() {\n    const PgStore = connectPg(session);\n    this.sessionStore = new PgStore({\n      pool,\n      tableName: 'sessions'\n    });\n  }\n\n  // User methods\n  async getUser(id: number): Promise<User | undefined> {\n    const [user] = await db.select()\n      .from(users)\n      .where(eq(users.id, id))\n      .limit(1);\n    return user;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select()\n      .from(users)\n      .where(eq(users.username, username))\n      .limit(1);\n    return user;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db.insert(users)\n      .values(insertUser)\n      .returning();\n    return user;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users);\n  }\n\n  async getUsersByAssignedTo(assignedToId: number): Promise<User[]> {\n    return await db.select()\n      .from(users)\n      .where(eq(users.assignedTo, assignedToId));\n  }\n\n  async updateUserBalance(userId: number, newBalance: number): Promise<User | undefined> {\n    const [user] = await db.update(users)\n      .set({ balance: newBalance })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  async updateUser(userId: number, data: {username?: string; password?: string}): Promise<User | undefined> {\n    const [updatedUser] = await db.update(users)\n      .set(data)\n      .where(eq(users.id, userId))\n      .returning();\n    return updatedUser;\n  }\n\n  async updateUserPassword(userId: number, hashedPassword: string): Promise<User | undefined> {\n    const [updatedUser] = await db.update(users)\n      .set({ password: hashedPassword })\n      .where(eq(users.id, userId))\n      .returning();\n    return updatedUser;\n  }\n\n  async blockUser(userId: number, blockedById: number): Promise<User | undefined> {\n    const [blockedUser] = await db.update(users)\n      .set({ \n        isBlocked: true, \n        blockedBy: blockedById \n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return blockedUser;\n  }\n\n  async unblockUser(userId: number): Promise<User | undefined> {\n    const [unblockedUser] = await db.update(users)\n      .set({ \n        isBlocked: false, \n        blockedBy: null \n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return unblockedUser;\n  }\n\n  async getBlockedByUser(userId: number): Promise<number | null> {\n    const [user] = await db.select({ blockedBy: users.blockedBy })\n      .from(users)\n      .where(eq(users.id, userId))\n      .limit(1);\n    \n    return user?.blockedBy || null;\n  }\n\n  async assignUserToAdmin(userId: number, adminId: number): Promise<User | undefined> {\n    const [assignedUser] = await db.update(users)\n      .set({ assignedTo: adminId })\n      .where(eq(users.id, userId))\n      .returning();\n    return assignedUser;\n  }\n\n  // Game methods\n  async createGame(game: InsertGame): Promise<Game> {\n    const [createdGame] = await db.insert(games)\n      .values(game)\n      .returning();\n    return createdGame;\n  }\n\n  async getGame(id: number): Promise<Game | undefined> {\n    const [game] = await db.select()\n      .from(games)\n      .where(eq(games.id, id))\n      .limit(1);\n    return game;\n  }\n\n  async getGamesByUserId(userId: number): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(eq(games.userId, userId))\n      .orderBy(desc(games.createdAt));\n  }\n\n  async getGamesByUserIds(userIds: number[]): Promise<Game[]> {\n    if (!userIds.length) return [];\n    \n    return await db.select()\n      .from(games)\n      .where(sql\\`\\${games.userId} IN (\\${userIds.join(', ')})\\`)\n      .orderBy(desc(games.createdAt));\n  }\n\n  async getAllGames(limit?: number): Promise<Game[]> {\n    let query = db.select()\n      .from(games)\n      .orderBy(desc(games.createdAt));\n\n    if (limit) {\n      query = query.limit(limit);\n    }\n\n    return await query;\n  }\n\n  async getRecentGames(userId: number, limit?: number): Promise<Game[]> {\n    let query = db.select()\n      .from(games)\n      .where(eq(games.userId, userId))\n      .orderBy(desc(games.createdAt));\n\n    if (limit) {\n      query = query.limit(limit);\n    }\n\n    return await query;\n  }\n\n  async updateGameStatus(gameId: number, status: string): Promise<Game | undefined> {\n    const [game] = await db.update(games)\n      .set({ status })\n      .where(eq(games.id, gameId))\n      .returning();\n    return game;\n  }\n\n  async updateGameResult(gameId: number, result: string, payout?: number): Promise<Game | undefined> {\n    let updateData: any = { result };\n    if (payout !== undefined) {\n      updateData.payout = payout;\n    }\n    \n    const [game] = await db.update(games)\n      .set(updateData)\n      .where(eq(games.id, gameId))\n      .returning();\n    return game;\n  }\n\n  // Satamatka Market methods\n  async createSatamatkaMarket(market: InsertSatamatkaMarket): Promise<SatamatkaMarket> {\n    const [createdMarket] = await db.insert(satamatkaMarkets)\n      .values(market)\n      .returning();\n    return createdMarket;\n  }\n\n  async getSatamatkaMarket(id: number): Promise<SatamatkaMarket | undefined> {\n    const [market] = await db.select()\n      .from(satamatkaMarkets)\n      .where(eq(satamatkaMarkets.id, id))\n      .limit(1);\n    return market;\n  }\n\n  async getAllSatamatkaMarkets(): Promise<SatamatkaMarket[]> {\n    return await db.select()\n      .from(satamatkaMarkets)\n      .orderBy(desc(satamatkaMarkets.createdAt));\n  }\n\n  async getActiveSatamatkaMarkets(): Promise<SatamatkaMarket[]> {\n    return await db.select()\n      .from(satamatkaMarkets)\n      .where(\n        or(\n          eq(satamatkaMarkets.status, MarketStatus.OPEN),\n          eq(satamatkaMarkets.status, MarketStatus.WAITING)\n        )\n      )\n      .orderBy(desc(satamatkaMarkets.createdAt));\n  }\n\n  async updateSatamatkaMarketResults(id: number, openResult?: string, closeResult?: string): Promise<SatamatkaMarket | undefined> {\n    let updateData: any = {};\n    \n    if (openResult !== undefined) {\n      updateData.openResult = openResult;\n    }\n    \n    if (closeResult !== undefined) {\n      updateData.closeResult = closeResult;\n    }\n    \n    const [updatedMarket] = await db.update(satamatkaMarkets)\n      .set(updateData)\n      .where(eq(satamatkaMarkets.id, id))\n      .returning();\n    \n    return updatedMarket;\n  }\n\n  async updateSatamatkaMarketStatus(id: number, status: string): Promise<SatamatkaMarket | undefined> {\n    const [updatedMarket] = await db.update(satamatkaMarkets)\n      .set({ status })\n      .where(eq(satamatkaMarkets.id, id))\n      .returning();\n    \n    return updatedMarket;\n  }\n\n  async getSatamatkaGamesByMarketId(marketId: number): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(eq(games.marketId, marketId))\n      .orderBy(desc(games.createdAt));\n  }\n\n  // Team Match methods\n  async createTeamMatch(match: InsertTeamMatch): Promise<TeamMatch> {\n    const [createdMatch] = await db.insert(teamMatches)\n      .values(match)\n      .returning();\n    return createdMatch;\n  }\n\n  async getTeamMatch(id: number): Promise<TeamMatch | undefined> {\n    const [match] = await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.id, id))\n      .limit(1);\n    return match;\n  }\n\n  async getAllTeamMatches(): Promise<TeamMatch[]> {\n    return await db.select()\n      .from(teamMatches)\n      .orderBy(desc(teamMatches.createdAt));\n  }\n\n  async getActiveTeamMatches(): Promise<TeamMatch[]> {\n    return await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.status, \"open\"))\n      .orderBy(desc(teamMatches.createdAt));\n  }\n\n  async updateTeamMatch(id: number, data: Partial<InsertTeamMatch>): Promise<TeamMatch | undefined> {\n    const [updatedMatch] = await db.update(teamMatches)\n      .set(data)\n      .where(eq(teamMatches.id, id))\n      .returning();\n    \n    return updatedMatch;\n  }\n\n  async updateTeamMatchResult(id: number, result: string): Promise<TeamMatch | undefined> {\n    const [updatedMatch] = await db.update(teamMatches)\n      .set({ result })\n      .where(eq(teamMatches.id, id))\n      .returning();\n    \n    return updatedMatch;\n  }\n\n  async updateTeamMatchStatus(id: number, status: string): Promise<TeamMatch | undefined> {\n    const [updatedMatch] = await db.update(teamMatches)\n      .set({ status })\n      .where(eq(teamMatches.id, id))\n      .returning();\n    \n    return updatedMatch;\n  }\n\n  async getTeamMatchesByCategory(category: string): Promise<TeamMatch[]> {\n    return await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.category, category))\n      .orderBy(desc(teamMatches.createdAt));\n  }\n\n  async getTeamMatchGamesByMatchId(matchId: number): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(eq(games.matchId, matchId))\n      .orderBy(desc(games.createdAt));\n  }\n\n  // Transaction methods\n  async createTransaction(transaction: InsertTransaction): Promise<Transaction> {\n    const [createdTransaction] = await db.insert(transactions)\n      .values(transaction)\n      .returning();\n    return createdTransaction;\n  }\n\n  async getTransactionsByUserId(userId: number): Promise<Transaction[]> {\n    return await db.select()\n      .from(transactions)\n      .where(eq(transactions.userId, userId))\n      .orderBy(desc(transactions.createdAt));\n  }\n\n  async getAllTransactions(limit?: number): Promise<Transaction[]> {\n    let query = db.select()\n      .from(transactions)\n      .orderBy(desc(transactions.createdAt));\n    \n    if (limit) {\n      query = query.limit(limit);\n    }\n    \n    return await query;\n  }\n\n  // System Settings methods\n  async getSystemSetting(settingType: string, settingKey: string): Promise<SystemSetting | undefined> {\n    const [setting] = await db.select()\n      .from(systemSettings)\n      .where(\n        and(\n          eq(systemSettings.settingType, settingType),\n          eq(systemSettings.settingKey, settingKey)\n        )\n      )\n      .limit(1);\n    \n    return setting;\n  }\n\n  async upsertSystemSetting(settingType: string, settingKey: string, settingValue: string): Promise<SystemSetting> {\n    // Check if setting exists\n    const existing = await this.getSystemSetting(settingType, settingKey);\n    \n    if (existing) {\n      // Update existing setting\n      const [updated] = await db.update(systemSettings)\n        .set({ \n          settingValue,\n          updatedAt: new Date() \n        })\n        .where(eq(systemSettings.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new setting\n      const [created] = await db.insert(systemSettings)\n        .values({\n          settingType,\n          settingKey,\n          settingValue,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  async getSystemSettingsByType(settingType: string): Promise<SystemSetting[]> {\n    return await db.select()\n      .from(systemSettings)\n      .where(eq(systemSettings.settingType, settingType))\n      .orderBy(systemSettings.settingKey);\n  }\n\n  // Subadmin Commission methods\n  async getSubadminCommissions(subadminId: number): Promise<SubadminCommission[]> {\n    return await db.select()\n      .from(subadminCommissions)\n      .where(eq(subadminCommissions.subadminId, subadminId))\n      .orderBy(subadminCommissions.gameType);\n  }\n\n  async upsertSubadminCommission(subadminId: number, gameType: string, commissionRate: number): Promise<SubadminCommission> {\n    // Check if commission already exists\n    const [existing] = await db.select()\n      .from(subadminCommissions)\n      .where(\n        and(\n          eq(subadminCommissions.subadminId, subadminId),\n          eq(subadminCommissions.gameType, gameType)\n        )\n      );\n    \n    if (existing) {\n      // Update existing commission\n      const [updated] = await db.update(subadminCommissions)\n        .set({ \n          commissionRate,\n          updatedAt: new Date() \n        })\n        .where(eq(subadminCommissions.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new commission\n      const [created] = await db.insert(subadminCommissions)\n        .values({\n          subadminId,\n          gameType,\n          commissionRate,\n          isActive: true,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  // User Discount methods\n  async getUserDiscounts(userId: number, subadminId: number): Promise<UserDiscount[]> {\n    return await db.select()\n      .from(userDiscounts)\n      .where(\n        and(\n          eq(userDiscounts.userId, userId),\n          eq(userDiscounts.subadminId, subadminId)\n        )\n      )\n      .orderBy(userDiscounts.gameType);\n  }\n\n  async upsertUserDiscount(subadminId: number, userId: number, gameType: string, discountRate: number): Promise<UserDiscount> {\n    // Check if discount already exists\n    const [existing] = await db.select()\n      .from(userDiscounts)\n      .where(\n        and(\n          eq(userDiscounts.subadminId, subadminId),\n          eq(userDiscounts.userId, userId),\n          eq(userDiscounts.gameType, gameType)\n        )\n      );\n    \n    if (existing) {\n      // Update existing discount\n      const [updated] = await db.update(userDiscounts)\n        .set({ \n          discountRate,\n          updatedAt: new Date()\n        })\n        .where(eq(userDiscounts.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new discount\n      const [created] = await db.insert(userDiscounts)\n        .values({\n          subadminId,\n          userId,\n          gameType,\n          discountRate,\n          isActive: true,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  // Player Deposit Discount methods\n  async getPlayerDepositDiscount(userId: number, subadminId: number): Promise<PlayerDepositDiscount | undefined> {\n    const [discount] = await db.select()\n      .from(playerDepositDiscounts)\n      .where(\n        and(\n          eq(playerDepositDiscounts.userId, userId),\n          eq(playerDepositDiscounts.subadminId, subadminId)\n        )\n      );\n    \n    return discount;\n  }\n\n  async upsertPlayerDepositDiscount(subadminId: number, userId: number, discountRate: number): Promise<PlayerDepositDiscount> {\n    // Check if discount already exists\n    const [existing] = await db.select()\n      .from(playerDepositDiscounts)\n      .where(\n        and(\n          eq(playerDepositDiscounts.subadminId, subadminId),\n          eq(playerDepositDiscounts.userId, userId)\n        )\n      );\n    \n    if (existing) {\n      // Update existing discount\n      const [updated] = await db.update(playerDepositDiscounts)\n        .set({ \n          discountRate,\n          updatedAt: new Date()\n        })\n        .where(eq(playerDepositDiscounts.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new discount\n      const [created] = await db.insert(playerDepositDiscounts)\n        .values({\n          subadminId,\n          userId,\n          discountRate,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  // Game Odds methods\n  async getGameOdds(gameType: string): Promise<GameOdd[]> {\n    return await db.select()\n      .from(gameOdds)\n      .where(\n        and(\n          eq(gameOdds.gameType, gameType),\n          eq(gameOdds.setByAdmin, true)\n        )\n      );\n  }\n\n  async getGameOddsBySubadmin(subadminId: number, gameType?: string): Promise<GameOdd[]> {\n    let query = db.select()\n      .from(gameOdds)\n      .where(eq(gameOdds.subadminId, subadminId));\n    \n    if (gameType) {\n      query = query.where(eq(gameOdds.gameType, gameType));\n    }\n    \n    return await query;\n  }\n\n  async upsertGameOdd(gameType: string, oddValue: number, setByAdmin: boolean, subadminId?: number): Promise<GameOdd> {\n    // Build the conditions\n    let conditions = [eq(gameOdds.gameType, gameType)];\n    \n    if (setByAdmin) {\n      conditions.push(eq(gameOdds.setByAdmin, true));\n    } else if (subadminId) {\n      conditions.push(eq(gameOdds.subadminId, subadminId));\n    }\n    \n    // Check if odd already exists\n    const [existing] = await db.select()\n      .from(gameOdds)\n      .where(and(...conditions));\n    \n    if (existing) {\n      // Update existing odd\n      const [updated] = await db.update(gameOdds)\n        .set({ \n          oddValue,\n          updatedAt: new Date()\n        })\n        .where(eq(gameOdds.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new odd\n      const [created] = await db.insert(gameOdds)\n        .values({\n          gameType,\n          oddValue,\n          setByAdmin,\n          subadminId,\n          isActive: true,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  async getOddsForPlayer(userId: number, gameType: string): Promise<number> {\n    // Get the player's assigned subadmin\n    const [user] = await db.select()\n      .from(users)\n      .where(eq(users.id, userId));\n    \n    if (!user || !user.assignedTo) {\n      // If no assigned subadmin, use admin odds\n      const [adminOdd] = await db.select()\n        .from(gameOdds)\n        .where(\n          and(\n            eq(gameOdds.gameType, gameType),\n            eq(gameOdds.setByAdmin, true)\n          )\n        );\n      \n      return adminOdd?.oddValue || 200; // Default to 2.00 odds (stored as integer: 200)\n    }\n    \n    // Check if subadmin has custom odds for this game type\n    const [subadminOdd] = await db.select()\n      .from(gameOdds)\n      .where(\n        and(\n          eq(gameOdds.gameType, gameType),\n          eq(gameOdds.subadminId, user.assignedTo)\n        )\n      );\n    \n    if (subadminOdd) {\n      return subadminOdd.oddValue;\n    }\n    \n    // Fall back to admin odds\n    const [adminOdd] = await db.select()\n      .from(gameOdds)\n      .where(\n        and(\n          eq(gameOdds.gameType, gameType),\n          eq(gameOdds.setByAdmin, true)\n        )\n      );\n    \n    return adminOdd?.oddValue || 200; // Default to 2.00 odds\n  }\n\n  // Admin seeding methods\n  async seedCricketTossGames(): Promise<void> {\n    console.log(\"Cricket toss games seeding is disabled\");\n  }\n\n  async seedDemoSatamatkaMarkets(): Promise<void> {\n    console.log(\"Demo Satamatka markets seeding is disabled\");\n  }\n}\n\nexport const storage = new DatabaseStorage();`;\n    \n    // Write the minimal storage file\n    fs.writeFileSync('./server/storage.ts', minimalStorageContent);\n    console.log(\"Created minimal storage.ts file\");\n    \n  } catch (error) {\n    console.error(\"Error creating minimal storage:\", error);\n  }\n}\n\ncreateMinimalStorage();","path":null,"size_bytes":24711,"size_tokens":null},"client/src/components/sidebar.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { UserRole } from \"@/lib/types\";\nimport { \n  LayoutDashboard, \n  Users, \n  Play, \n  Clock, \n  LogOut, \n  Menu, \n  X,\n  ShieldCheck,\n  History,\n  Target,\n  Trophy,\n  BarChart2,\n  Calculator,\n  Wallet,\n  Settings,\n  Sliders,\n  BadgeDollarSign,\n  Landmark,\n  Gamepad2,\n  User,\n  Calendar,\n  RefreshCw,\n  AlertTriangle\n} from \"lucide-react\";\nimport { GiCricketBat } from \"react-icons/gi\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { cn } from \"@/lib/utils\";\n\ninterface SidebarProps {\n  activeTab?: string;\n}\n\nexport default function Sidebar({ activeTab }: SidebarProps = {}) {\n  const [location] = useLocation();\n  const { user, logoutMutation } = useAuth();\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n\n  const isAdmin = user?.role === UserRole.ADMIN;\n  const isSubadmin = user?.role === UserRole.SUBADMIN;\n  const isRegularUser = user?.role === UserRole.PLAYER;\n  const canManageUsers = isAdmin || isSubadmin;\n  \n  const menuItems = [\n    {\n      name: \"Dashboard\",\n      path: \"/dashboard\",\n      icon: <LayoutDashboard className=\"w-5 h-5 mr-3\" />,\n      visible: true,\n    },\n    // Admin and Subadmin Only\n    {\n      name: \"User Management\",\n      path: \"/users\",\n      icon: <Users className=\"w-5 h-5 mr-3\" />,\n      visible: canManageUsers,\n    },\n    // Admin Only\n    {\n      name: \"Subadmin Management\",\n      path: \"/subadmins\",\n      icon: <ShieldCheck className=\"w-5 h-5 mr-3\" />,\n      visible: isAdmin,\n    },\n    // Jantri Management - Admin and Subadmin\n    {\n      name: \"Jantri Management\",\n      path: \"/risk-management\",\n      icon: <AlertTriangle className=\"w-5 h-5 mr-3\" />,\n      visible: canManageUsers,\n    },\n    // Market Game Management - Admin Only\n    {\n      name: \"Manage Markets\",\n      path: \"/manage-markets\",\n      icon: <Target className=\"w-5 h-5 mr-3\" />,\n      visible: isAdmin,\n    },\n    // Team Match Management removed - functionality no longer used\n    // Cricket Toss Management - Admin Only\n    {\n      name: \"Manage Cricket Toss\",\n      path: \"/admin-cricket-toss\",\n      icon: <GiCricketBat className=\"w-5 h-5 mr-3\" />,\n      visible: isAdmin,\n    },\n    // Reset Zone - Admin Only\n    {\n      name: \"Reset Zone\",\n      path: \"/reset-zone\",\n      icon: <RefreshCw className=\"w-5 h-5 mr-3\" />,\n      visible: isAdmin,\n    },\n    // Regular Users Only (Game Related)\n    {\n      name: \"All Games\",\n      path: \"/games\",\n      icon: <Gamepad2 className=\"w-5 h-5 mr-3\" />,\n      visible: isRegularUser,\n    },\n    {\n      name: \"Coin Flip\",\n      path: \"/coinflip\",\n      icon: <Play className=\"w-5 h-5 mr-3\" />,\n      visible: isRegularUser,\n    },\n    {\n      name: \"Markets\",\n      path: \"/markets\",\n      icon: <Calendar className=\"w-5 h-5 mr-3\" />,\n      visible: isRegularUser,\n    },\n    // Sports Betting removed - team match functionality no longer used\n    {\n      name: \"Cricket Toss\",\n      path: \"/cricket-toss\",\n      icon: <GiCricketBat className=\"w-5 h-5 mr-3\" />,\n      visible: isRegularUser,\n    },\n    {\n      name: \"Game History\",\n      path: \"/game-history\",\n      icon: <Clock className=\"w-5 h-5 mr-3\" />,\n      visible: isRegularUser,\n    },\n    {\n      name: \"Profile\",\n      path: \"/profile\",\n      icon: <User className=\"w-5 h-5 mr-3\" />,\n      visible: true,\n    },\n    // Wallet - accessible by all users\n    {\n      name: \"Wallet\",\n      path: \"/wallet\",\n      icon: <Wallet className=\"w-5 h-5 mr-3\" />,\n      visible: true,\n    },\n    // Admin Management (Jantri and Risk Management removed)\n    {\n      name: \"Fund Management\",\n      path: \"/fund-management\",\n      icon: <Landmark className=\"w-5 h-5 mr-3\" />,\n      visible: isAdmin,\n    },\n\n    // Settings\n    {\n      name: \"Settings\",\n      path: \"/settings\",\n      icon: <Settings className=\"w-5 h-5 mr-3\" />,\n      visible: isAdmin,\n    },\n    {\n      name: \"Settings\",\n      path: \"/settings\",\n      icon: <Sliders className=\"w-5 h-5 mr-3\" />,\n      visible: isSubadmin,\n    },\n    {\n      name: \"Back to Home\",\n      path: \"/\",\n      icon: <svg className=\"w-5 h-5 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M3 12l2-2m0 0l7-7 7 7m-7-7v14\"></path>\n            </svg>,\n      visible: isRegularUser,\n    },\n  ];\n  \n  const toggleMobileMenu = () => setIsMobileMenuOpen(!isMobileMenuOpen);\n  \n  const handleLogout = () => {\n    logoutMutation.mutate();\n  };\n\n  return (\n    <>\n      {/* Desktop Sidebar */}\n      <aside className=\"hidden lg:flex flex-col w-64 h-full bg-slate-900 border-r border-slate-800\">\n        <div className=\"p-4 flex items-center justify-center border-b border-slate-800\">\n          <h1 className=\"text-2xl font-bold\">\n            <span className=\"text-primary\">King</span>\n            <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-primary\">Games</span>\n          </h1>\n        </div>\n        \n        <nav className=\"flex-1 overflow-y-auto py-4 scrollbar-thin scrollbar-thumb-primary scrollbar-track-slate-800\">\n          <ul>\n            {menuItems.filter(item => item.visible).map((item) => (\n              <li key={item.path} className=\"mb-1\">\n                <Link href={item.path}\n                  className={cn(\n                    \"flex items-center px-4 py-3 text-slate-200 hover:bg-slate-800 hover:text-white rounded-lg mx-2 transition-colors\",\n                    location === item.path && \"bg-gradient-to-r from-primary to-purple-700 text-white\"\n                  )}>\n                    {item.icon}\n                    {item.name}\n                </Link>\n              </li>\n            ))}\n          </ul>\n        </nav>\n        \n        {/* User Info */}\n        <div className=\"p-4 border-t border-slate-800\">\n          <div className=\"flex items-center\">\n            <div className=\"w-10 h-10 rounded-full bg-gradient-to-r from-primary to-purple-600 flex items-center justify-center text-white font-bold\">\n              <span>{user?.username?.charAt(0).toUpperCase()}</span>\n            </div>\n            <div className=\"ml-3\">\n              <p className=\"text-sm font-medium text-slate-200\">{user?.username}</p>\n              <p className=\"text-xs text-slate-400 capitalize\">{user?.role}</p>\n            </div>\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              className=\"ml-auto rounded-full text-slate-400 hover:text-slate-200 hover:bg-slate-800\"\n              onClick={handleLogout}\n              disabled={logoutMutation.isPending}\n            >\n              <LogOut className=\"w-5 h-5\" />\n            </Button>\n          </div>\n        </div>\n      </aside>\n      \n      {/* Mobile Nav */}\n      <div className=\"lg:hidden fixed top-0 left-0 right-0 z-50 bg-slate-900 border-b border-slate-800 p-4 flex items-center justify-between\">\n        <h1 className=\"text-xl font-bold\">\n          <span className=\"text-primary\">King</span>\n          <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-primary\">Games</span>\n        </h1>\n        <Button \n          variant=\"ghost\" \n          size=\"icon\"\n          className=\"text-slate-300 hover:bg-slate-800 hover:text-slate-100\"\n          onClick={toggleMobileMenu}\n        >\n          {isMobileMenuOpen ? <X className=\"w-6 h-6\" /> : <Menu className=\"w-6 h-6\" />}\n        </Button>\n      </div>\n      \n      {/* Mobile Menu */}\n      <div className={cn(\n        \"lg:hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-40\",\n        isMobileMenuOpen ? \"block\" : \"hidden\"\n      )}>\n        <div className=\"w-64 h-full bg-slate-900 pt-16 border-r border-slate-800\">\n          <nav className=\"p-4 max-h-[80vh] overflow-y-auto scrollbar-thin scrollbar-thumb-primary scrollbar-track-slate-800\">\n            <ul className=\"space-y-2\">\n              {menuItems.filter(item => item.visible).map((item) => (\n                <li key={item.path}>\n                  <Link \n                    href={item.path}\n                    className={cn(\n                      \"flex items-center px-4 py-3 text-slate-200 hover:bg-slate-800 hover:text-white rounded-lg transition-colors\",\n                      location === item.path && \"bg-gradient-to-r from-primary to-purple-700 text-white\"\n                    )}\n                    onClick={toggleMobileMenu}\n                  >\n                    {item.icon}\n                    {item.name}\n                  </Link>\n                </li>\n              ))}\n            </ul>\n            \n            <Separator className=\"my-4 bg-slate-800\" />\n            \n            <Button \n              variant=\"outline\" \n              className=\"w-full flex items-center justify-center border-slate-700 text-slate-200 hover:bg-slate-800 hover:text-white\" \n              onClick={handleLogout}\n              disabled={logoutMutation.isPending}\n            >\n              <LogOut className=\"w-5 h-5 mr-2\" />\n              Sign Out\n            </Button>\n            \n            <div className=\"mt-4 flex items-center\">\n              <div className=\"w-8 h-8 rounded-full bg-gradient-to-r from-primary to-purple-600 flex items-center justify-center text-white font-bold text-sm\">\n                <span>{user?.username?.charAt(0).toUpperCase()}</span>\n              </div>\n              <div className=\"ml-2\">\n                <p className=\"text-sm font-medium text-slate-200\">{user?.username}</p>\n                <p className=\"text-xs text-slate-400 capitalize\">{user?.role}</p>\n              </div>\n            </div>\n          </nav>\n        </div>\n      </div>\n    </>\n  );\n}","path":null,"size_bytes":9786,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2254,"size_tokens":null},"client/src/components/game-icon-card.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\nimport { IconType } from \"react-icons\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface GameIconCardProps {\n  id: string;\n  title: string;\n  icon: LucideIcon | IconType;\n  path: string;\n  gradient: string;\n  comingSoon?: boolean;\n}\n\nexport default function GameIconCard({\n  id,\n  title,\n  icon: Icon,\n  path,\n  gradient,\n  comingSoon = false\n}: GameIconCardProps) {\n  const [_, setLocation] = useLocation();\n\n  const handleClick = () => {\n    if (!comingSoon) {\n      setLocation(path);\n    }\n  };\n\n  return (\n    <Card \n      className={`overflow-hidden transition-all hover:scale-105 border-slate-700 shadow-sm ${!comingSoon ? 'cursor-pointer' : 'cursor-default'}`}\n      onClick={handleClick}\n    >\n      <CardContent className=\"p-0 relative h-32\">\n        <div className={`flex flex-col items-center justify-center p-6 h-full min-h-[128px] ${gradient}`}>\n          <Icon className=\"h-10 w-10 text-white mb-2\" />\n          <h3 className=\"font-medium text-white text-lg text-center\">{title}</h3>\n        </div>\n        \n        {comingSoon && (\n          <Badge className=\"absolute top-2 right-2 bg-orange-900/80 text-orange-200 border-orange-500/40 text-xs px-2 py-1\">\n            Coming Soon\n          </Badge>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","path":null,"size_bytes":1414,"size_tokens":null},"client/src/pages/games-page.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { UserRole } from \"@shared/schema\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport GameCard from \"@/components/game-card\";\nimport { Play, Gamepad2 } from \"lucide-react\";\n\n// All available games in the platform\nconst allGames = [\n  {\n    id: \"marketgame\",\n    title: \"Market Game\",\n    description: \"Strategic market betting game with multiple betting options.\",\n    imageBg: \"linear-gradient(to right, #1a1d30, #4e3a9a)\",\n    path: \"/markets\",\n    popularity: \"high\" as const,\n    winRate: 40,\n    gameType: \"market\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"crickettoss\",\n    title: \"Cricket Toss\",\n    description: \"Predict the cricket match toss outcome for quick wins.\",\n    imageBg: \"linear-gradient(to right, #1e3a30, #2a8062)\",\n    path: \"/cricket-toss\",\n    popularity: \"high\" as const,\n    winRate: 50,\n    gameType: \"cricket\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"coinflip\",\n    title: \"Coin Flip\",\n    description: \"Classic heads or tails betting with 50/50 odds for instant wins.\",\n    imageBg: \"linear-gradient(to right, #1e293b, #3b5cb8)\",\n    path: \"/coinflip\",\n    popularity: \"high\" as const,\n    winRate: 50,\n    gameType: \"coinflip\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"sportsexchange\",\n    title: \"Sports Exchange\",\n    description: \"Bet on cricket, tennis, and football matches with real-time odds.\",\n    imageBg: \"linear-gradient(to right, #1e293b, #2a5ca8)\",\n    path: \"#\",\n    popularity: \"upcoming\" as const,\n    winRate: 0,\n    comingSoon: true,\n    gameType: \"sports\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"kingsoriginal\",\n    title: \"Kings Original\",\n    description: \"Coming soon! Our collection of premium games including Big-Small, Color, Lottery, Roulette and more.\",\n    imageBg: \"linear-gradient(to right, #4a4a4a, #6a6a6a)\",\n    path: \"#\",\n    popularity: \"low\" as const,\n    winRate: 0,\n    comingSoon: true,\n    imageUrl: \"/images/royal-k-logo.svg\" // Logo as feature image\n  }\n];\n\nexport default function GamesPage() {\n  const { user } = useAuth();\n  const isPlayer = user?.role === UserRole.PLAYER;\n\n  if (!isPlayer) {\n    return (\n      <DashboardLayout title=\"Games\">\n        <div className=\"p-6 bg-slate-800/50 border border-slate-700 rounded-lg\">\n          <h2 className=\"text-xl font-bold mb-3 text-slate-200\">Admin Restricted Area</h2>\n          <p className=\"text-slate-400\">\n            As an administrator, you don't have permission to play games.\n            Your role is to manage the platform and users only.\n          </p>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout title=\"All Games\">\n      <div className=\"mb-6\">\n        <div className=\"flex items-center mb-2\">\n          <Gamepad2 className=\"h-5 w-5 mr-2 text-blue-500\" />\n          <h2 className=\"text-lg font-medium text-slate-200\">\n            Browse All Available Games\n          </h2>\n        </div>\n        <p className=\"text-slate-400 text-sm\">\n          Explore our complete collection of games and start playing now\n        </p>\n      </div>\n      \n      <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6\">\n        {allGames.map((game) => (\n          <GameCard \n            key={game.id}\n            id={game.id}\n            title={game.title}\n            description={game.description}\n            imageBg={game.imageBg}\n            path={game.path}\n            popularity={game.popularity}\n            winRate={game.winRate}\n            comingSoon={game.comingSoon}\n            gameType={game.gameType}\n            imageUrl={game.imageUrl} // Keep for backward compatibility with Kings Original\n          />\n        ))}\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":3881,"size_tokens":null},"server/fix-bets-route.ts":{"content":"import express from 'express';\nimport { requireRole } from './auth';\nimport { UserRole } from '../shared/schema';\nimport { fixCrossingBets } from './fix-crossing-bets';\n\nconst router = express.Router();\n\n// Route to fix crossing bets for a specific market\nrouter.post('/fix-crossing-bets/:marketId', requireRole([UserRole.ADMIN]), fixCrossingBets);\n\nexport default router;","path":null,"size_bytes":372,"size_tokens":null},"test-password.ts":{"content":"import { scrypt, timingSafeEqual } from \"crypto\";\nimport { promisify } from \"util\";\n\nconst scryptAsync = promisify(scrypt);\n\nasync function testPasswordVerification() {\n  try {\n    console.log(\"Testing password verification...\");\n    \n    // The admin user password from the database\n    const storedPassword = \"5d4acce791647cb0fdd02c1f8c5cf3915d139008a05a7c4e0fb23654e9cb1d00c7fe0ba22d527d438892f704af626efef3e12a40673aa8d75ef9fa51a7a7077f.ff1e7c493fd990361cd2bd69c18cea2a\";\n    \n    // The password being tested\n    const suppliedPassword = \"admin123\";\n    \n    // Split the stored password to get the hash and salt\n    const parts = storedPassword.split('.');\n    if (parts.length !== 2) {\n      console.log(\"Invalid password format\");\n      return;\n    }\n    \n    const [hashedPart, salt] = parts;\n    console.log(`Hash part length: ${hashedPart.length}`);\n    console.log(`Salt part length: ${salt.length}`);\n    \n    // Hash the supplied password with the same salt\n    const hashedBuf = Buffer.from(hashedPart, 'hex');\n    const suppliedBuf = await scryptAsync(suppliedPassword, salt, 64);\n    \n    console.log(`Stored hash buffer length: ${hashedBuf.length}`);\n    console.log(`Computed hash buffer length: ${suppliedBuf.length}`);\n    \n    // Compare the hashes\n    const result = timingSafeEqual(hashedBuf, suppliedBuf);\n    console.log(`Password verification result: ${result ? \"MATCHED\" : \"FAILED\"}`);\n    \n    // Log the generated hash for reference\n    console.log(`\\nGenerated hash from 'admin123':`);\n    console.log(suppliedBuf.toString('hex'));\n    \n  } catch (error) {\n    console.error(\"Error testing password verification:\", error);\n  }\n}\n\ntestPasswordVerification();","path":null,"size_bytes":1688,"size_tokens":null},"process-pending-bets.ts":{"content":"/**\n * This script processes any pending bets for a Satamatka market\n * Use this when you see some bets remain in \"pending\" status even after results are declared\n */\n\nimport { db } from './server/db';\nimport { eq, and } from 'drizzle-orm';\nimport { games, users, SatamatkaGameMode } from './shared/schema';\n\nasync function processPendingBets() {\n  try {\n    // Get the market ID from command line\n    const args = process.argv.slice(2);\n    if (args.length === 0) {\n      console.error('Please provide a market ID');\n      console.error('Usage: npx tsx process-pending-bets.ts <marketId>');\n      process.exit(1);\n    }\n    \n    const marketId = parseInt(args[0]);\n    if (isNaN(marketId)) {\n      console.error('Invalid market ID. Please provide a valid number.');\n      process.exit(1);\n    }\n    \n    console.log(`Processing pending bets for market ID ${marketId}...`);\n    \n    // Get the market data\n    const [market] = await db.select()\n      .from('satamatka_markets')\n      .where(eq('satamatka_markets.id', marketId));\n    \n    if (!market) {\n      console.error(`Market with ID ${marketId} not found.`);\n      process.exit(1);\n    }\n    \n    if (!market.closeResult) {\n      console.error(`Market with ID ${marketId} does not have a close result.`);\n      process.exit(1);\n    }\n    \n    console.log(`Market info: ${market.name}, Close Result: ${market.closeResult}`);\n    \n    // Get all pending games for this market\n    const pendingGames = await db.select()\n      .from(games)\n      .where(\n        and(\n          eq(games.marketId, marketId),\n          eq(games.result, 'pending')\n        )\n      );\n    \n    console.log(`Found ${pendingGames.length} pending games to process.`);\n    \n    if (pendingGames.length === 0) {\n      console.log('No pending bets to process.');\n      process.exit(0);\n    }\n    \n    // Get game odds from database\n    const gameOdds = await db.select()\n      .from('game_odds')\n      .where(eq('game_odds.setByAdmin', true));\n    \n    // Create a map for easy access to odds\n    const oddsMap = {\n      'satamatka_jodi': 900000, // Default 90x\n      'satamatka_harf': 90000,  // Default 9x\n      'satamatka_crossing': 900000, // Default 90x\n      'satamatka_odd_even': 19000  // Default 1.9x\n    };\n    \n    // Update odds map with values from the database\n    for (const odds of gameOdds) {\n      if (odds.gameType && odds.oddValue) {\n        oddsMap[odds.gameType] = odds.oddValue;\n      }\n    }\n    \n    console.log('Using odds values:', oddsMap);\n    \n    // Process each pending game\n    let processedCount = 0;\n    let winnersCount = 0;\n    \n    for (const game of pendingGames) {\n      console.log(`Processing game ID ${game.id}, mode: ${game.gameMode}, prediction: ${game.prediction}`);\n      \n      let isWinner = false;\n      let payout = 0;\n      const closeResult = market.closeResult;\n      \n      // Game mode specific win conditions\n      if (game.gameMode === SatamatkaGameMode.JODI && game.prediction === closeResult) {\n        // For Jodi mode, prediction must match closeResult exactly\n        isWinner = true;\n        payout = Math.round(game.betAmount * (oddsMap['satamatka_jodi'] / 10000));\n      } \n      else if (game.gameMode === SatamatkaGameMode.HARF) {\n        // For Harf, check if digit matches position\n        const firstDigit = closeResult[0]; \n        const secondDigit = closeResult[1];\n        \n        // Handle different Harf prediction formats (A0, B1, etc.)\n        let harfDigit = game.prediction;\n        let isLeftDigit = false;\n        let isRightDigit = false;\n        \n        // Handle formatted predictions like A0, A1, B0, B1\n        if (game.prediction.startsWith('A')) {\n          harfDigit = game.prediction.substring(1);\n          isLeftDigit = true;\n        } else if (game.prediction.startsWith('B')) {\n          harfDigit = game.prediction.substring(1);\n          isRightDigit = true;\n        } else if (game.prediction.startsWith('L')) {\n          harfDigit = game.prediction.substring(1);\n          isLeftDigit = true;\n        } else if (game.prediction.startsWith('R')) {\n          harfDigit = game.prediction.substring(1);\n          isRightDigit = true;\n        }\n        \n        // Check if the prediction matches the appropriate position\n        if (\n          (isLeftDigit && harfDigit === firstDigit) || \n          (isRightDigit && harfDigit === secondDigit) ||\n          // For single digit predictions without position indicator\n          (!isLeftDigit && !isRightDigit && (game.prediction === firstDigit || game.prediction === secondDigit))\n        ) {\n          isWinner = true;\n          payout = Math.round(game.betAmount * (oddsMap['satamatka_harf'] / 10000));\n        }\n      }\n      else if (game.gameMode === SatamatkaGameMode.CROSSING) {\n        // For Crossing, check if the prediction matches the result in any order\n        // Clean and prepare prediction digits - handle different prediction formats\n        let digits = [];\n        if (game.prediction.includes(',')) {\n          // Format: \"0,1,2\"\n          digits = game.prediction.replace(/[^0-9,]/g, '').split(',').map(d => d.trim());\n        } else {\n          // Format: \"012\" or other formats without commas\n          digits = game.prediction.replace(/[^0-9]/g, '').split('');\n        }\n        \n        // Extract the actual crossing combinations from the digits\n        // Crossing means any combination of the digits in any order\n        const crossingCombinations = [];\n        for (let i = 0; i < digits.length; i++) {\n          for (let j = 0; j < digits.length; j++) {\n            if (i !== j) {\n              crossingCombinations.push(digits[i] + digits[j]);\n            }\n          }\n        }\n        \n        // The crossing bet should only win if the prediction exactly matches the result\n        // or the player's crossing combination includes the result\n        if (game.prediction === closeResult || crossingCombinations.includes(closeResult)) {\n          isWinner = true;\n          payout = Math.round(game.betAmount * (oddsMap['satamatka_crossing'] / 10000));\n        }\n        \n        console.log(`  Crossing combinations: ${crossingCombinations.join(',')}`);\n        console.log(`  Result: ${closeResult}, Is winner: ${isWinner}`);\n      }\n      else if (game.gameMode === SatamatkaGameMode.ODD_EVEN) {\n        // For Odd-Even, check if prediction matches the result's parity\n        const resultNumber = parseInt(closeResult, 10);\n        const isOdd = resultNumber % 2 !== 0;\n        \n        if ((isOdd && game.prediction === 'odd') || (!isOdd && game.prediction === 'even')) {\n          isWinner = true;\n          payout = Math.round(game.betAmount * (oddsMap['satamatka_odd_even'] / 10000));\n        }\n      }\n      \n      // Update the game result and payout\n      const result = isWinner ? 'win' : 'loss';\n      \n      await db.update(games)\n        .set({ \n          result,\n          payout: isWinner ? payout : 0\n        })\n        .where(eq(games.id, game.id));\n      \n      console.log(`  Updated game result: ${result}, Payout: ${payout/100} rupees`);\n      \n      // If it's a win, update the user's balance\n      if (isWinner) {\n        const [user] = await db.select()\n          .from(users)\n          .where(eq(users.id, game.userId));\n        \n        if (user) {\n          const newBalance = user.balance + payout;\n          await db.update(users)\n            .set({ balance: newBalance })\n            .where(eq(users.id, user.userId));\n          \n          console.log(`  Updated user ${user.username} balance: ${user.balance/100}  ${newBalance/100} rupees`);\n          winnersCount++;\n        }\n      }\n      \n      processedCount++;\n    }\n    \n    console.log(`Processed ${processedCount} pending games.`);\n    console.log(`Found ${winnersCount} winning bets.`);\n    console.log('Done!');\n  } catch (error) {\n    console.error('Error processing pending bets:', error);\n  }\n}\n\nprocessPendingBets().catch(err => console.error('Error executing script:', err));","path":null,"size_bytes":7984,"size_tokens":null},"fix-password-format.ts":{"content":"// This script fixes the password format to be compatible with the auth.ts implementation\nimport { db } from \"./server/db\";\nimport { users } from \"./shared/schema\";\nimport { eq } from \"drizzle-orm\";\nimport { hashPassword } from \"./server/auth\";\n\nasync function fixPasswords() {\n  try {\n    console.log(\"Fixing password formats...\");\n    \n    // Get all users\n    const allUsers = await db.select().from(users);\n    \n    for (const user of allUsers) {\n      console.log(`Fixing password for user: ${user.username}`);\n      \n      // Hash the password using the auth.ts implementation\n      // For demonstration, we'll use default passwords\n      const password = user.username === \"admin\" ? \"admin123\" : \"subadmin123\";\n      const hashedPassword = await hashPassword(password);\n      \n      // Update the user's password\n      await db.update(users)\n        .set({ password: hashedPassword })\n        .where(eq(users.id, user.id));\n        \n      console.log(`Password updated for: ${user.username}`);\n    }\n    \n    console.log(\"All passwords have been fixed!\");\n  } catch (error) {\n    console.error(\"Error fixing passwords:\", error);\n  } finally {\n    process.exit(0);\n  }\n}\n\nfixPasswords();","path":null,"size_bytes":1193,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"import * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5615,"size_tokens":null},"fix-admin-passwords.js":{"content":"/**\n * This script updates the admin and subadmin passwords to work with the new \n * dual-format password system (crypto.scrypt).\n */\n\nimport pg from 'pg';\nimport crypto from 'crypto';\nimport { promisify } from 'util';\n\n// Promisify the scrypt function\nconst scryptAsync = promisify(crypto.scrypt);\n\n// Connect to the database\nconst { Pool } = pg;\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL\n});\n\n// Function to hash password with crypto.scrypt\nasync function hashPassword(password) {\n  const salt = crypto.randomBytes(16).toString('hex');\n  const buf = await scryptAsync(password, salt, 64);\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nasync function resetAdminPasswords() {\n  try {\n    console.log('Starting password reset for admin and subadmin accounts...');\n\n    // Hash the passwords\n    const adminPasswordHash = await hashPassword('admin123');\n    const subadminPasswordHash = await hashPassword('subadmin123');\n\n    // Update admin password (assuming id=1 for admin)\n    const adminResult = await pool.query(\n      'UPDATE users SET password = $1 WHERE role = $2 AND id = $3 RETURNING id, username, role',\n      [adminPasswordHash, 'admin', 1]\n    );\n\n    if (adminResult.rows.length > 0) {\n      console.log(`Reset password for admin user: ${adminResult.rows[0].username}`);\n    } else {\n      console.log('Admin user not found or not updated');\n    }\n\n    // Update subadmin passwords (all users with role=subadmin)\n    const subadminResult = await pool.query(\n      'UPDATE users SET password = $1 WHERE role = $2 RETURNING id, username, role',\n      [subadminPasswordHash, 'subadmin']\n    );\n\n    console.log(`Reset passwords for ${subadminResult.rowCount} subadmin users`);\n    subadminResult.rows.forEach(user => {\n      console.log(`- ${user.username} (ID: ${user.id})`);\n    });\n\n    console.log('Password reset completed successfully');\n  } catch (error) {\n    console.error('Error resetting passwords:', error);\n  } finally {\n    await pool.end();\n  }\n}\n\n// Run the function\nresetAdminPasswords();","path":null,"size_bytes":2043,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"import { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1709,"size_tokens":null},"create-test-dashboard-data.js":{"content":"/**\n * This script creates test data to verify dashboard statistics functionality:\n * 1. Creates admin-to-player direct deposit - should count 100% to deposit total\n * 2. Creates admin-to-subadmin deposit with commission - should count only commission amount to deposit total\n * 3. Creates player game with win/loss - should affect profit/loss total\n * \n * Use this for testing dashboard statistics calculation logic\n */\n\nimport pg from 'pg';\nconst { Pool } = pg;\n\nasync function createTestData() {\n  // Connect to database\n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL\n  });\n\n  try {\n    console.log('Connected to database. Starting test data creation...');\n    \n    // Start a transaction\n    const client = await pool.connect();\n    \n    try {\n      await client.query('BEGIN');\n      \n      // Clear existing transactions\n      console.log('Clearing existing transactions...');\n      await client.query('DELETE FROM transactions WHERE description LIKE \\'%test%\\' OR description LIKE \\'%Direct deposit%\\' OR description LIKE \\'%Funds transferred to%\\'');\n      \n      // Get admin user\n      const adminResult = await client.query('SELECT id FROM users WHERE role = \\'admin\\' LIMIT 1');\n      if (adminResult.rows.length === 0) {\n        throw new Error('Admin user not found!');\n      }\n      const adminId = adminResult.rows[0].id;\n      \n      // 1. Create a player and deposit directly - should count 100% to deposit total\n      console.log('Creating direct player and deposit...');\n      \n      // Check if player already exists, create or update\n      let directPlayerId;\n      const checkPlayerResult = await client.query(\n        'SELECT id FROM users WHERE username = $1', ['test_direct_player']\n      );\n      \n      if (checkPlayerResult.rows.length > 0) {\n        // Player exists, update\n        directPlayerId = checkPlayerResult.rows[0].id;\n        await client.query(\n          'UPDATE users SET balance = 0 WHERE id = $1', [directPlayerId]\n        );\n        console.log(`Using existing direct player (ID: ${directPlayerId})`);\n      } else {\n        // Create new player\n        const insertPlayerResult = await client.query(\n          'INSERT INTO users (username, password, role, balance) VALUES ($1, $2, $3, $4) RETURNING id',\n          ['test_direct_player', '$2b$10$abcdefghijklmnopqrstuv', 'player', 0]\n        );\n        directPlayerId = insertPlayerResult.rows[0].id;\n      }\n      \n      // Direct deposit to player (10,000)\n      const directDeposit = 10000;\n      await client.query(\n        'UPDATE users SET balance = balance + $1 WHERE id = $2',\n        [directDeposit, directPlayerId]\n      );\n      \n      // Record transaction\n      await client.query(\n        'INSERT INTO transactions (user_id, amount, description, created_at, performed_by) VALUES ($1, $2, $3, $4, $5)',\n        [directPlayerId, directDeposit, 'Direct deposit from admin', new Date(), adminId]\n      );\n      \n      console.log(`Created direct player (ID: ${directPlayerId}) with ${directDeposit} deposit`);\n      \n      // 2. Create subadmin and deposit with commission - should count only commission % to deposit total\n      console.log('Creating subadmin and deposit with commission...');\n      \n      // Check if subadmin already exists, create or update\n      let subadminId;\n      const checkSubadminResult = await client.query(\n        'SELECT id FROM users WHERE username = $1', ['test_subadmin']\n      );\n      \n      if (checkSubadminResult.rows.length > 0) {\n        // Subadmin exists, update\n        subadminId = checkSubadminResult.rows[0].id;\n        await client.query(\n          'UPDATE users SET balance = 0 WHERE id = $1', [subadminId]\n        );\n        console.log(`Using existing subadmin (ID: ${subadminId})`);\n      } else {\n        // Create new subadmin\n        const insertSubadminResult = await client.query(\n          'INSERT INTO users (username, password, role, balance) VALUES ($1, $2, $3, $4) RETURNING id',\n          ['test_subadmin', '$2b$10$abcdefghijklmnopqrstuv', 'subadmin', 0]\n        );\n        subadminId = insertSubadminResult.rows[0].id;\n      }\n      \n      // Deposit to subadmin (50,000) with 20% commission (10,000)\n      const subadminDeposit = 50000;\n      const commissionRate = 0.2; // 20%\n      const commissionAmount = Math.floor(subadminDeposit * commissionRate);\n      \n      // Subadmin gets full amount\n      await client.query(\n        'UPDATE users SET balance = balance + $1 WHERE id = $2',\n        [subadminDeposit, subadminId]\n      );\n      \n      // Admin balance deducted by commission only\n      await client.query(\n        'UPDATE users SET balance = balance - $1 WHERE id = $2',\n        [commissionAmount, adminId]\n      );\n      \n      // Record transaction\n      await client.query(\n        'INSERT INTO transactions (user_id, amount, description, created_at, performed_by) VALUES ($1, $2, $3, $4, $5)',\n        [subadminId, subadminDeposit, `Funds transferred to subadmin (${commissionAmount} of ${subadminDeposit} - commission rate applied, commission: ${commissionAmount})`, new Date(), adminId]\n      );\n      \n      console.log(`Created subadmin (ID: ${subadminId}) with ${subadminDeposit} deposit and ${commissionAmount} commission`);\n      \n      // 3. Create player games with win/loss - should affect profit/loss total\n      console.log('Creating player games...');\n      \n      // First game: player loses 5,000 (admin wins)\n      const gameLoss = 5000;\n      await client.query(\n        'INSERT INTO games (user_id, bet_amount, payout, game_type, prediction, result, created_at) VALUES ($1, $2, $3, $4, $5, $6, $7)',\n        [directPlayerId, gameLoss, 0, 'coinflip', 'heads', 'tails', new Date()]\n      );\n      \n      // Update player balance after loss\n      await client.query(\n        'UPDATE users SET balance = balance - $1 WHERE id = $2',\n        [gameLoss, directPlayerId]\n      );\n      \n      console.log(`Created game where direct player lost ${gameLoss}`);\n      \n      // Second game: player wins 2,000 (admin loses)\n      const gameBet = 1000;\n      const gameWin = 2000;\n      await client.query(\n        'INSERT INTO games (user_id, bet_amount, payout, game_type, prediction, result, created_at) VALUES ($1, $2, $3, $4, $5, $6, $7)',\n        [directPlayerId, gameBet, gameWin, 'coinflip', 'heads', 'heads', new Date()]\n      );\n      \n      // Update player balance after win\n      await client.query(\n        'UPDATE users SET balance = balance + $1 - $2 WHERE id = $3',\n        [gameWin, gameBet, directPlayerId]\n      );\n      \n      console.log(`Created game where direct player won ${gameWin} on a ${gameBet} bet`);\n      \n      // Fix admin balance to reflect the proper balance after all transactions\n      // Calculate expected totals for verification\n      const expectedProfitLoss = (gameLoss - gameBet) + commissionAmount; // Admin profit from games + commission\n      const expectedDeposits = directDeposit + commissionAmount; // Direct deposit + commission amount\n      \n      // Admin should have a balance that accounts for:\n      // 1. Commission deduction: -10,000\n      // 2. Game profits: +4,000 (from player losses/wins)\n      // Total: -6,000\n      // But we want to set to 0 for this test\n      await client.query(\n        'UPDATE users SET balance = 0 WHERE id = $1',\n        [adminId]\n      );\n      \n      await client.query('COMMIT');\n      console.log('Test data creation complete!');\n      \n      console.log(`Expected admin dashboard values:\n- Total Profit/Loss: ${expectedProfitLoss}\n- Total Deposits: ${expectedDeposits}\n- Admin Balance: 0 (manually reset for testing)`);\n      \n      \n    } catch (err) {\n      await client.query('ROLLBACK');\n      console.error('Error during test data creation:', err);\n      throw err;\n    } finally {\n      client.release();\n    }\n  } catch (err) {\n    console.error('Database connection error:', err);\n  } finally {\n    await pool.end();\n  }\n}\n\n// Execute the function\ncreateTestData().catch(err => {\n  console.error('Failed to create test data:', err);\n  process.exit(1);\n});","path":null,"size_bytes":8079,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n  options?: { isFormData?: boolean; headers?: Record<string, string> },\n): Promise<Response> {\n  // Determine if we're sending FormData\n  const isFormData = options?.isFormData || data instanceof FormData;\n  \n  // Set up appropriate headers and body\n  let headers: Record<string, string> = {};\n  let body: any = undefined;\n  \n  if (data) {\n    if (isFormData) {\n      // FormData should not have Content-Type set\n      body = data;\n    } else {\n      // JSON data\n      headers = { \"Content-Type\": \"application/json\", ...options?.headers };\n      body = JSON.stringify(data);\n    }\n  } else if (options?.headers) {\n    headers = options.headers;\n  }\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1911,"size_tokens":null},"fix-uloo-user.ts":{"content":"/**\n * Script to fix the password for the \"uloo\" user using proper crypto.scrypt hashing\n */\nimport { db } from \"./server/db\";\nimport { users } from \"./shared/schema\";\nimport { eq } from \"drizzle-orm\";\nimport { scrypt, randomBytes } from \"crypto\";\nimport { promisify } from \"util\";\n\n// Promisify the scrypt function\nconst scryptAsync = promisify(scrypt);\n\n// Function to hash a password with crypto.scrypt\nasync function hashPassword(password: string): Promise<string> {\n  const salt = randomBytes(16).toString('hex');\n  const derivedKey = await scryptAsync(password, salt, 64) as Buffer;\n  return `${derivedKey.toString('hex')}.${salt}`;\n}\n\nasync function fixUlooUser() {\n  try {\n    console.log('Fixing password for \"uloo\" user...');\n    \n    // Hash the password with crypto.scrypt\n    const hashedPassword = await hashPassword('asdf1234');\n    console.log('Generated new password hash');\n    \n    // Update the user's password\n    const result = await db.update(users)\n      .set({ password: hashedPassword })\n      .where(eq(users.username, 'uloo'))\n      .returning({ id: users.id, username: users.username });\n    \n    if (result.length === 0) {\n      console.log('User \"uloo\" not found');\n    } else {\n      console.log('Updated password successfully for user:', result[0]);\n      console.log('You can now login with:');\n      console.log('Username: uloo');\n      console.log('Password: asdf1234');\n    }\n  } catch (error) {\n    console.error('Error updating password:', error);\n  }\n}\n\nfixUlooUser();","path":null,"size_bytes":1508,"size_tokens":null},"client/src/pages/profile-page.tsx":{"content":"import { useState } from \"react\";\nimport { UserRole } from \"@shared/schema\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { \n  Card, \n  CardContent, \n  CardDescription, \n  CardFooter, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  User, \n  Shield, \n  Key, \n  Loader2, \n  Calendar,\n  Wallet\n} from \"lucide-react\";\nimport { z } from \"zod\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\n\n// Define form schema for password change\nconst passwordChangeSchema = z.object({\n  currentPassword: z.string().min(1, \"Current password is required\"),\n  newPassword: z.string().min(6, \"New password must be at least 6 characters\"),\n  confirmPassword: z.string().min(6, \"Confirm password is required\"),\n}).refine(data => data.newPassword === data.confirmPassword, {\n  message: \"Passwords do not match\",\n  path: [\"confirmPassword\"],\n});\n\ntype PasswordChangeForm = z.infer<typeof passwordChangeSchema>;\n\nexport default function ProfilePage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  \n  // Initialize form\n  const form = useForm<PasswordChangeForm>({\n    resolver: zodResolver(passwordChangeSchema),\n    defaultValues: {\n      currentPassword: \"\",\n      newPassword: \"\",\n      confirmPassword: \"\",\n    },\n  });\n  \n  // Password change mutation\n  const passwordChangeMutation = useMutation({\n    mutationFn: async (data: { currentPassword: string, newPassword: string }) => {\n      return apiRequest(\"PATCH\", \"/api/user/password\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Password Updated\",\n        description: \"Your password has been successfully changed\",\n      });\n      form.reset();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update password\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Handle password change form submission\n  const onSubmit = (data: PasswordChangeForm) => {\n    passwordChangeMutation.mutate({\n      currentPassword: data.currentPassword,\n      newPassword: data.newPassword,\n    });\n  };\n\n  if (!user) {\n    return (\n      <DashboardLayout title=\"Profile\">\n        <div className=\"text-center py-8\">\n          <p>Loading user information...</p>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  // Get badge color based on user role\n  const getRoleBadgeClass = (role: string) => {\n    switch (role) {\n      case UserRole.ADMIN:\n        return \"bg-red-500/10 text-red-500 border-red-500/20\";\n      case UserRole.SUBADMIN:\n        return \"bg-amber-500/10 text-amber-500 border-amber-500/20\";\n      case UserRole.PLAYER:\n        return \"bg-green-500/10 text-green-500 border-green-500/20\";\n      default:\n        return \"bg-gray-500/10 text-gray-500 border-gray-500/20\";\n    }\n  };\n\n  return (\n    <DashboardLayout title=\"Profile\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        {/* User Information Card */}\n        <Card className=\"bg-slate-800/50 border-slate-700\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <User className=\"h-5 w-5 text-primary\" />\n              User Information\n            </CardTitle>\n            <CardDescription>\n              Your account details and status\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-center mb-6\">\n              <div className=\"w-20 h-20 rounded-full bg-gradient-to-r from-primary to-blue-400 flex items-center justify-center text-white font-bold text-3xl\">\n                {user.username.charAt(0).toUpperCase()}\n              </div>\n            </div>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <Label className=\"text-muted-foreground text-xs\">Username</Label>\n                <div className=\"font-medium text-lg\">{user.username}</div>\n              </div>\n              \n              {user.email && (\n                <div>\n                  <Label className=\"text-muted-foreground text-xs\">Email</Label>\n                  <div className=\"font-medium\">{user.email}</div>\n                </div>\n              )}\n              \n              {user.mobile && (\n                <div>\n                  <Label className=\"text-muted-foreground text-xs\">Mobile</Label>\n                  <div className=\"font-medium\">{user.mobile}</div>\n                </div>\n              )}\n              \n              <div>\n                <Label className=\"text-muted-foreground text-xs\">Role</Label>\n                <div>\n                  <Badge className={`mt-1 ${getRoleBadgeClass(user.role)}`}>\n                    <div className=\"flex items-center gap-1\">\n                      <Shield className=\"h-3 w-3\" />\n                      {user.role}\n                    </div>\n                  </Badge>\n                </div>\n              </div>\n              \n              <div>\n                <Label className=\"text-muted-foreground text-xs\">Wallet Balance</Label>\n                <div className=\"font-medium text-lg flex items-center gap-1 text-green-500\">\n                  <Wallet className=\"h-4 w-4\" />\n                  {(user.balance / 100).toFixed(2)}\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        \n        {/* Change Password Card */}\n        <Card className=\"bg-slate-800/50 border-slate-700\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Key className=\"h-5 w-5 text-primary\" />\n              Change Password\n            </CardTitle>\n            <CardDescription>\n              Update your account password\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"currentPassword\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Current Password</FormLabel>\n                      <FormControl>\n                        <Input type=\"password\" placeholder=\"Enter current password\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={form.control}\n                  name=\"newPassword\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>New Password</FormLabel>\n                      <FormControl>\n                        <Input type=\"password\" placeholder=\"Enter new password\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={form.control}\n                  name=\"confirmPassword\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Confirm Password</FormLabel>\n                      <FormControl>\n                        <Input type=\"password\" placeholder=\"Confirm new password\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <Button \n                  type=\"submit\" \n                  className=\"w-full\"\n                  disabled={passwordChangeMutation.isPending}\n                >\n                  {passwordChangeMutation.isPending && (\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  )}\n                  Update Password\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":8576,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n  \n  /* Custom scrollbar styling for X-axis */\n  .custom-horizontal-scrollbar::-webkit-scrollbar {\n    height: 8px;\n  }\n  \n  .custom-horizontal-scrollbar::-webkit-scrollbar-track {\n    @apply bg-slate-800/30;\n  }\n  \n  .custom-horizontal-scrollbar::-webkit-scrollbar-thumb {\n    @apply bg-slate-700 rounded-full;\n  }\n  \n  .custom-horizontal-scrollbar::-webkit-scrollbar-thumb:hover {\n    @apply bg-slate-600;\n  }\n}","path":null,"size_bytes":601,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ ...props }) => <ChevronLeft className=\"h-4 w-4\" />,\n        IconRight: ({ ...props }) => <ChevronRight className=\"h-4 w-4\" />,\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }","path":null,"size_bytes":2608,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }","path":null,"size_bytes":1127,"size_tokens":null},"client/src/components/balance-card.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { IndianRupee } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\n\ninterface BalanceCardProps {\n  balance: number;\n}\n\nexport default function BalanceCard({ balance }: BalanceCardProps) {\n  const { user } = useAuth();\n  // Link directly to the wallet page with deposit tab pre-selected\n  const walletUrl = \"/wallet?tab=deposit\";\n  \n  // Only show deposit button for players who are direct players (assigned to admin or null)\n  // Players assigned to a subadmin should not see the deposit button\n  const canDeposit = user?.role === \"player\" && (!user.assignedTo || user.assignedTo === 1);\n  \n  return (\n    <Card className=\"bg-slate-900/70 shadow-lg border border-slate-800 w-full lg:w-auto\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-center\">\n          <div className=\"p-2 rounded-full bg-gradient-to-r from-violet-600 to-fuchsia-600 mr-3\">\n            <IndianRupee className=\"w-6 h-6 text-white\" />\n          </div>\n          <div>\n            <p className=\"text-sm text-slate-400\">Your Balance</p>\n            <p className=\"text-xl font-bold text-fuchsia-300\">{balance.toFixed(2)}</p>\n          </div>\n          {canDeposit && (\n            <Link href={walletUrl}>\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                className=\"ml-4 border-slate-700 text-slate-300 hover:bg-slate-800 hover:text-white\"\n              >\n                Deposit\n              </Button>\n            </Link>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1696,"size_tokens":null},"reset-admin-password.ts":{"content":"// Script to reset the admin password\nimport { db } from './server/db';\nimport { users } from './shared/schema';\nimport { eq } from 'drizzle-orm';\nimport { scrypt, randomBytes } from 'crypto';\nimport { promisify } from 'util';\n\nconst scryptAsync = promisify(scrypt);\n\nasync function hashPassword(password: string) {\n  // Use crypto.scrypt function for password hashing\n  const salt = randomBytes(16).toString('hex');\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nasync function resetAdminPassword() {\n  try {\n    console.log(\"Resetting admin password...\");\n    \n    // Create a new password hash for 'admin123'\n    const password = 'admin123';\n    const hashedPassword = await hashPassword(password);\n    \n    console.log(\"New password hash created\");\n    \n    // Update admin user in the database\n    const result = await db.update(users)\n      .set({ password: hashedPassword })\n      .where(eq(users.username, 'admin'))\n      .returning();\n    \n    if (result.length > 0) {\n      console.log(\" Admin password reset successfully!\");\n      console.log(\"You can now login with username 'admin' and password 'admin123'\");\n    } else {\n      console.log(\" Admin user not found or password reset failed\");\n    }\n    \n  } catch (error) {\n    console.error(\"Error resetting admin password:\", error);\n  }\n}\n\nresetAdminPassword();","path":null,"size_bytes":1394,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });","path":null,"size_bytes":482,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport themePlugin from \"@replit/vite-plugin-shadcn-theme-json\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    themePlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n});\n","path":null,"size_bytes":978,"size_tokens":null},"fix-pending-bets-esm.js":{"content":"/**\n * Simple script to fix pending bets for the current market\n */\n\nimport pg from 'pg';\nimport dotenv from 'dotenv';\n\nconst { Pool } = pg;\ndotenv.config();\n\nasync function fixPendingBets() {\n  // Connect to database\n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n    ssl: {\n      rejectUnauthorized: false\n    }\n  });\n  \n  try {\n    // Get the market ID from command line or use default 5\n    const marketId = process.argv[2] || 5;\n    console.log(`Processing pending bets for market ID ${marketId}...`);\n    \n    // Get market information\n    const marketResult = await pool.query(\n      'SELECT * FROM satamatka_markets WHERE id = $1',\n      [marketId]\n    );\n    \n    if (marketResult.rows.length === 0) {\n      console.error(`Market with ID ${marketId} not found`);\n      return;\n    }\n    \n    const market = marketResult.rows[0];\n    console.log(`Market: ${market.name}, Close result: ${market.close_result}`);\n    \n    if (!market.close_result) {\n      console.error(`Market ${marketId} does not have a close result`);\n      return;\n    }\n    \n    // Find all pending games for this market\n    const pendingGames = await pool.query(\n      'SELECT * FROM games WHERE market_id = $1 AND result = $2',\n      [marketId, 'pending']\n    );\n    \n    console.log(`Found ${pendingGames.rows.length} pending games`);\n    \n    // Process each game\n    for (const game of pendingGames.rows) {\n      console.log(`Processing game ${game.id}, mode: ${game.game_mode}, prediction: ${game.prediction}`);\n      \n      let isWinner = false;\n      let payout = 0;\n      \n      // Get odds for this game type\n      const gameTypeMap = {\n        'jodi': 'satamatka_jodi',\n        'harf': 'satamatka_harf',\n        'crossing': 'satamatka_crossing',\n        'odd_even': 'satamatka_odd_even'\n      };\n      \n      const gameType = gameTypeMap[game.game_mode];\n      if (!gameType) {\n        console.log(`Unknown game mode: ${game.game_mode}`);\n        continue;\n      }\n      \n      const oddsResult = await pool.query(\n        'SELECT * FROM game_odds WHERE game_type = $1 AND set_by_admin = true',\n        [gameType]\n      );\n      \n      // Default odds if not configured\n      let oddValue = 0;\n      switch (game.game_mode) {\n        case 'jodi': oddValue = 900000; break; // 90x\n        case 'harf': oddValue = 90000; break;  // 9x\n        case 'crossing': oddValue = 900000; break; // 90x\n        case 'odd_even': oddValue = 19000; break; // 1.9x\n      }\n      \n      // Use configured odds if available\n      if (oddsResult.rows.length > 0) {\n        oddValue = oddsResult.rows[0].odd_value;\n      }\n      \n      console.log(`Using odds: ${oddValue/10000}x`);\n      \n      // Check if this is a winning bet based on game mode\n      if (game.game_mode === 'jodi') {\n        // Jodi: exact match with close result\n        isWinner = (game.prediction === market.close_result);\n      }\n      else if (game.game_mode === 'harf') {\n        // Harf: digit matches position\n        const firstDigit = market.close_result[0]; \n        const secondDigit = market.close_result[1];\n        \n        // Handle different prediction formats\n        let harfDigit = game.prediction;\n        let isLeftDigit = false;\n        let isRightDigit = false;\n        \n        if (game.prediction.startsWith('A') || game.prediction.startsWith('L')) {\n          harfDigit = game.prediction.substring(1);\n          isLeftDigit = true;\n        } else if (game.prediction.startsWith('B') || game.prediction.startsWith('R')) {\n          harfDigit = game.prediction.substring(1);\n          isRightDigit = true;\n        }\n        \n        if ((isLeftDigit && harfDigit === firstDigit) || \n            (isRightDigit && harfDigit === secondDigit) ||\n            (!isLeftDigit && !isRightDigit && (game.prediction === firstDigit || game.prediction === secondDigit))) {\n          isWinner = true;\n        }\n      }\n      else if (game.game_mode === 'crossing') {\n        // For crossing, ONLY EXACT MATCHES win\n        // If prediction is \"01\", only a result of \"01\" wins (not \"10\")\n        isWinner = (game.prediction === market.close_result);\n        \n        // If not exact match but the prediction is a comma-separated list of digits\n        // like \"0,1,2\" then we need to check if any of the combinations match the result\n        if (!isWinner && game.prediction.includes(',')) {\n          // Parse digits from prediction\n          let digits = [];\n          // Format: \"0,1,2\"\n          digits = game.prediction.replace(/[^0-9,]/g, '').split(',').map(d => d.trim());\n          \n          // Generate crossing combinations\n          const combinations = [];\n          for (let i = 0; i < digits.length; i++) {\n            for (let j = 0; j < digits.length; j++) {\n              if (i !== j) {\n                combinations.push(digits[i] + digits[j]);\n              }\n            }\n          }\n          \n          console.log(`  Crossing combinations: ${combinations.join(',')}`);\n          \n          // Check if the result is in the combinations\n          isWinner = combinations.includes(market.close_result);\n        }\n      }\n      else if (game.game_mode === 'odd_even') {\n        // For Odd-Even, check if prediction matches result's parity\n        const resultNum = parseInt(market.close_result, 10);\n        const isOdd = resultNum % 2 !== 0;\n        \n        if ((isOdd && game.prediction === 'odd') || (!isOdd && game.prediction === 'even')) {\n          isWinner = true;\n        }\n      }\n      \n      // Calculate payout for winners\n      if (isWinner) {\n        payout = Math.round(game.bet_amount * (oddValue / 10000));\n      }\n      \n      // Update game status\n      const gameStatus = isWinner ? 'win' : 'loss';\n      await pool.query(\n        'UPDATE games SET result = $1, payout = $2 WHERE id = $3',\n        [gameStatus, payout, game.id]\n      );\n      \n      console.log(`  Updated game ${game.id} to ${gameStatus}, payout: ${payout/100} rupees`);\n      \n      // If winner, update user balance\n      if (isWinner) {\n        const userResult = await pool.query(\n          'SELECT * FROM users WHERE id = $1',\n          [game.user_id]\n        );\n        \n        if (userResult.rows.length > 0) {\n          const user = userResult.rows[0];\n          const newBalance = user.balance + payout;\n          \n          await pool.query(\n            'UPDATE users SET balance = $1 WHERE id = $2',\n            [newBalance, user.id]\n          );\n          \n          console.log(`  Updated user ${user.username} balance: ${user.balance/100}  ${newBalance/100} rupees`);\n        }\n      }\n    }\n    \n    console.log('Finished processing pending bets!');\n  } catch (err) {\n    console.error('Error:', err);\n  } finally {\n    pool.end();\n  }\n}\n\nfixPendingBets();","path":null,"size_bytes":6762,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7361,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"import * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":777,"size_tokens":null},"client/src/pages/home-page.tsx":{"content":"import { useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { UserRole } from \"@shared/schema\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport GameCard from \"@/components/game-card\";\nimport GameIconCard from \"@/components/game-icon-card\";\nimport RecentWinners from \"@/components/recent-winners\";\nimport RecentResults from \"@/components/recent-results\";\nimport BalanceCard from \"@/components/balance-card\";\nimport StatsCard from \"@/components/stats-card\";\nimport DashboardStatsCard from \"@/components/dashboard-stats-card\";\nimport PromoSlider from \"@/components/promo-slider\";\nimport GameHistoryTable from \"@/components/game-history-table\";\nimport { Button } from \"@/components/ui/button\";\nimport { GiCricketBat } from \"react-icons/gi\";\nimport { \n  Play, \n  Dice1, \n  Trophy, \n  Calendar, \n  BarChart2, \n  TrendingUp,\n  Users,\n  ShieldCheck,\n  Target,\n  Gamepad,\n  Coins,\n  Club,\n  Award,\n  DollarSign,\n  BarChart, \n  Activity,\n  Settings,\n  LayoutDashboard,\n  CalendarRange,\n  UserCircle,\n  Wallet,\n  MinusCircle,\n  PlusCircle,\n  MessageSquare,\n  RefreshCw\n} from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\n// Sample game cards data - in real app this would come from API\nconst gameCards = [\n  {\n    id: \"marketgame\",\n    title: \"Market Game\",\n    description: \"Strategic market betting game with multiple betting options.\",\n    imageBg: \"linear-gradient(to right, #1a1d30, #4e3a9a)\",\n    path: \"/markets\",\n    popularity: \"high\" as const,\n    winRate: 40,\n    gameType: \"market\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"crickettoss\",\n    title: \"Cricket Toss\",\n    description: \"Predict the cricket match toss outcome for quick wins.\",\n    imageBg: \"linear-gradient(to right, #1e3a30, #2a8062)\",\n    path: \"/cricket-toss\",\n    popularity: \"high\" as const,\n    winRate: 50,\n    gameType: \"cricket\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"coinflip\",\n    title: \"Coin Flip\",\n    description: \"Classic heads or tails betting with 50/50 odds for instant wins.\",\n    imageBg: \"linear-gradient(to right, #1e293b, #3b5cb8)\",\n    path: \"/coinflip\",\n    popularity: \"high\" as const,\n    winRate: 50,\n    gameType: \"coinflip\" as const // Using game type for automatic image selection\n  },\n  {\n    id: \"sportsexchange\",\n    title: \"Sports Exchange\",\n    description: \"Bet on cricket, tennis, and football matches with real-time odds.\",\n    imageBg: \"linear-gradient(to right, #1e293b, #2a5ca8)\",\n    path: \"#\",\n    popularity: \"upcoming\" as const,\n    winRate: 0,\n    gameType: \"sports\" as const,\n    comingSoon: true\n  }\n];\n\n// Sample market results data - in real app this would come from API\nconst sampleMarketResults = [\n  {\n    id: 1,\n    name: \"Dishawar Market\",\n    type: \"dishawar\",\n    openTime: \"2023-04-14T10:00:00Z\",\n    closeTime: \"2023-04-14T18:00:00Z\",\n    openResult: \"34\",\n    closeResult: null,\n    status: \"resulted\",\n    createdAt: new Date().toISOString(),\n  },\n  {\n    id: 2,\n    name: \"Gali Market\",\n    type: \"gali\",\n    openTime: \"2023-04-14T09:30:00Z\",\n    closeTime: \"2023-04-14T13:30:00Z\",\n    openResult: \"56\",\n    closeResult: null,\n    status: \"resulted\",\n    createdAt: new Date(Date.now() - 3600000).toISOString(),\n  }\n];\n\n// We'll fetch real winners data from the API\n\nexport default function HomePage() {\n  const { user } = useAuth();\n  const [_, setLocation] = useLocation();\n  \n  // Fetch user statistics with proper typing\n  interface PlayerStats {\n    totalBets: number;\n    winRate: number;\n    recentWinRate: number;\n    totalWagered: number;\n    totalWon: number;\n    netProfit: number;\n    gameTypeDistribution: Record<string, number>;\n    favoriteGame: string | null;\n  }\n  \n  const { data: stats = { \n    winRate: 0, \n    totalBets: 0,\n    recentWinRate: 0,\n    totalWagered: 0,\n    totalWon: 0,\n    netProfit: 0,\n    gameTypeDistribution: {},\n    favoriteGame: null\n  } } = useQuery<PlayerStats>({\n    queryKey: [\"/api/users/stats\"],\n    enabled: !!user && user.role === UserRole.PLAYER,\n  });\n\n  // Fetch recent games for the user\n  const { data: recentGames = [] as any[] } = useQuery({\n    queryKey: [\"/api/games/my-history\"],\n    enabled: !!user,\n  });\n  \n  // Fetch top winners from all games\n  const { data: topWinners = [] as any } = useQuery({\n    queryKey: [\"/api/games/top-winners\"],\n    enabled: !!user,\n  });\n  \n  // Define the interface for subadmin statistics\n  interface SubadminStats {\n    totalProfit: number;\n    totalDeposits: number;\n    totalUsers: number;\n    activeUsers: number;\n    recentGames: Array<{\n      id: number;\n      username: string;\n      gameType: string;\n      betAmount: number;\n      result: 'win' | 'loss' | 'pending';\n      createdAt: string;\n    }>;\n  }\n  \n  // Define the interface for admin statistics\n  interface AdminStats {\n    totalProfitLoss: number;\n    totalDeposits: number;\n    activeBetAmount: number;\n    potentialPayout: number;\n    recentTransactions: Array<{\n      id: number;\n      username: string;\n      type: string;\n      amount: number;\n      createdAt: string;\n    }>;\n  }\n  \n  // Fetch subadmin statistics with proper typing\n  const subadminStatsQuery = useQuery<SubadminStats>({\n    queryKey: [\"/api/subadmin/stats\"],\n    enabled: !!user && user.role === UserRole.SUBADMIN,\n  });\n  \n  // Fetch admin statistics with proper typing\n  const adminStatsQuery = useQuery<AdminStats>({\n    queryKey: [\"/api/admin/stats\"],\n    enabled: !!user && user.role === UserRole.ADMIN,\n    refetchInterval: 30000, // Refresh every 30 seconds\n  });\n  \n  const subadminStats: SubadminStats = subadminStatsQuery.data || { \n    totalProfit: 0, \n    totalDeposits: 0, \n    totalUsers: 0, \n    activeUsers: 0, \n    recentGames: [] \n  };\n  \n  const adminStats: AdminStats = adminStatsQuery.data || {\n    totalProfitLoss: 0,\n    totalDeposits: 0,\n    activeBetAmount: 0,\n    potentialPayout: 0,\n    recentTransactions: []\n  };\n\n  const isAdmin = user?.role === UserRole.ADMIN;\n  const isSubadmin = user?.role === UserRole.SUBADMIN;\n  const isPlayer = user?.role === UserRole.PLAYER;\n  const canManageUsers = isAdmin || isSubadmin;\n  const isAdminOrSubadmin = isAdmin || isSubadmin;\n\n  return (\n    <DashboardLayout title=\"Dashboard\">\n      {/* Balance Bar for Admin/Subadmin, Promo Slider for Players */}\n      <div className=\"flex flex-col lg:flex-row items-start lg:items-center justify-between mb-6 space-y-4 lg:space-y-0\">\n        {isPlayer ? (\n          // Promo Slider for Players\n          <div className=\"w-full\">\n            <PromoSlider />\n          </div>\n        ) : (\n          // Balance card for Admin/Subadmin\n          <div className=\"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:space-x-4 w-full lg:w-auto\">\n            <BalanceCard balance={(user?.balance || 0) / 100} />\n          </div>\n        )}\n        \n        {/* Admin/Subadmin Controls - Only visible to admin/subadmin */}\n        {canManageUsers && (\n          <div className=\"flex flex-wrap gap-2 mt-4 lg:mt-0\">\n            <Button \n              className=\"bg-gradient-to-r from-violet-700 to-indigo-600 hover:from-violet-600 hover:to-indigo-500\"\n              onClick={() => setLocation(\"/users\")}\n            >\n              Manage Users\n            </Button>\n            {isAdmin && (\n              <Button \n                variant=\"outline\"\n                className=\"border-slate-700 text-teal-300 hover:bg-slate-800 hover:text-teal-200\"\n                onClick={() => setLocation(\"/subadmins\")}\n              >\n                Manage Subadmins\n              </Button>\n            )}\n          </div>\n        )}\n      </div>\n      \n      {/* Subadmin Statistics Dashboard - Only visible to subadmins */}\n      {isSubadmin && (\n        <div className=\"mb-8\">\n          <h2 className=\"text-xl font-bold mb-4 flex items-center text-slate-200\">\n            <BarChart2 className=\"h-5 w-5 mr-2 text-blue-500\" />\n            Dashboard Statistics\n          </h2>\n          \n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n            {/* Total Profit Card */}\n            <DashboardStatsCard \n              title=\"Total Profit\" \n              value={`${((subadminStats.totalProfit || 0) / 100).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`}\n              icon={<TrendingUp className=\"h-5 w-5 text-emerald-400\" />}\n              trend={subadminStats.totalProfit >= 0 ? \"up\" : \"down\"}\n              color={subadminStats.totalProfit >= 0 ? \"green\" : \"red\"}\n            />\n            \n            {/* Total Deposits Card */}\n            <DashboardStatsCard \n              title=\"Total Deposits\" \n              value={`${((subadminStats.totalDeposits || 0) / 100).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`}\n              icon={<DollarSign className=\"h-5 w-5 text-blue-400\" />}\n              trend=\"up\" \n              color=\"blue\"\n            />\n            \n            {/* Total Users Card */}\n            <DashboardStatsCard \n              title=\"Total Users\" \n              value={(subadminStats.totalUsers || 0).toString()}\n              icon={<Users className=\"h-5 w-5 text-purple-400\" />}\n              trend=\"up\"\n              color=\"purple\"\n            />\n            \n            {/* Active Users Card */}\n            <DashboardStatsCard \n              title=\"Active Users\" \n              value={(subadminStats.activeUsers || 0).toString()}\n              icon={<Activity className=\"h-5 w-5 text-amber-400\" />}\n              trend=\"neutral\"\n              color=\"amber\"\n            />\n          </div>\n          \n          {/* Recent Games Section */}\n          {subadminStats.recentGames && subadminStats.recentGames.length > 0 && (\n            <div className=\"mt-6\">\n              <h3 className=\"text-lg font-semibold mb-3 text-slate-200\">Recent Game Activity</h3>\n              \n              <div className=\"bg-slate-800/50 border border-slate-700 rounded-lg overflow-hidden\">\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full\">\n                    <thead>\n                      <tr className=\"bg-slate-800\">\n                        <th className=\"py-3 px-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider\">Player</th>\n                        <th className=\"py-3 px-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider\">Game</th>\n                        <th className=\"py-3 px-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider\">Amount</th>\n                        <th className=\"py-3 px-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider\">Result</th>\n                        <th className=\"py-3 px-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider\">Date</th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-slate-700\">\n                      {subadminStats.recentGames.map((game, idx) => (\n                        <tr key={game.id} className={idx % 2 === 0 ? 'bg-slate-800/30' : 'bg-slate-800/10'}>\n                          <td className=\"py-3 px-4 text-sm text-slate-300\">{game.username}</td>\n                          <td className=\"py-3 px-4 text-sm text-slate-300 capitalize\">\n                            {game.gameType.replace('_', ' ')}\n                          </td>\n                          <td className=\"py-3 px-4 text-sm\">\n                            <span className=\"font-medium text-emerald-400\">{((game.betAmount || 0) / 100).toFixed(2)}</span>\n                          </td>\n                          <td className=\"py-3 px-4 text-sm\">\n                            {game.result === 'win' ? (\n                              <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-green-900/30 text-green-400\">\n                                Win\n                              </span>\n                            ) : game.result === 'loss' ? (\n                              <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-red-900/30 text-red-400\">\n                                Loss\n                              </span>\n                            ) : (\n                              <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-slate-700/50 text-slate-400\">\n                                Pending\n                              </span>\n                            )}\n                          </td>\n                          <td className=\"py-3 px-4 text-sm text-slate-400\">\n                            {game.createdAt ? new Date(game.createdAt).toLocaleDateString() : 'N/A'}\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n      \n      {/* Game Icon Cards - Only visible to players */}\n      {isPlayer && (\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8\">\n          <GameIconCard\n            id=\"market\"\n            title=\"Market Games\"\n            icon={Calendar}\n            path=\"/markets\"\n            gradient=\"bg-gradient-to-r from-blue-700 to-cyan-600\"\n          />\n          <GameIconCard\n            id=\"cricket\"\n            title=\"Cricket Toss\"\n            icon={Award}\n            path=\"/cricket-toss\"\n            gradient=\"bg-gradient-to-r from-green-700 to-emerald-600\"\n          />\n          <GameIconCard\n            id=\"coinflip\"\n            title=\"Coin Flip\"\n            icon={Coins}\n            path=\"/coinflip\"\n            gradient=\"bg-gradient-to-r from-orange-700 to-orange-500\"\n          />\n          <GameIconCard\n            id=\"sportsexchange\"\n            title=\"Exchange\"\n            icon={Target}\n            path=\"#\"\n            gradient=\"bg-gradient-to-r from-slate-600 to-blue-800\"\n            comingSoon={true}\n          />\n        </div>\n      )}\n      \n      {/* Admin Dashboard Statistics - Only visible to admin */}\n      {isAdmin && (\n        <div className=\"mb-8\">\n          <h2 className=\"text-xl font-bold mb-4 flex items-center text-slate-200\">\n            <BarChart2 className=\"h-5 w-5 mr-2 text-blue-500\" />\n            Dashboard Statistics\n          </h2>\n          \n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n            {/* Total Profit/Loss Card */}\n            <DashboardStatsCard \n              title=\"Total Profit/Loss\" \n              value={`${((adminStats.totalProfitLoss || 0) / 100).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`}\n              icon={<TrendingUp className=\"h-5 w-5 text-emerald-400\" />}\n              trend={adminStats.totalProfitLoss >= 0 ? \"up\" : \"down\"}\n              color={adminStats.totalProfitLoss >= 0 ? \"green\" : \"red\"}\n            />\n            \n            {/* Total Deposits Card */}\n            <DashboardStatsCard \n              title=\"Total Deposits\" \n              value={`${((adminStats.totalDeposits || 0) / 100).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`}\n              icon={<DollarSign className=\"h-5 w-5 text-blue-400\" />}\n              trend=\"up\" \n              color=\"blue\"\n            />\n            \n            {/* Active Bet Amount Card */}\n            <DashboardStatsCard \n              title=\"Active Bet Amount\" \n              value={`${((adminStats.activeBetAmount || 0) / 100).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`}\n              icon={<Club className=\"h-5 w-5 text-purple-400\" />}\n              trend=\"neutral\"\n              color=\"purple\"\n            />\n            \n            {/* Potential Payout Card */}\n            <DashboardStatsCard \n              title=\"Potential Payout\" \n              value={`${((adminStats.potentialPayout || 0) / 100).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`}\n              icon={<Award className=\"h-5 w-5 text-amber-400\" />}\n              trend=\"neutral\"\n              color=\"amber\"\n            />\n          </div>\n        </div>\n      )}\n      \n      {/* Admin/Subadmin message */}\n      {isAdminOrSubadmin && (\n        <div className=\"mb-8 p-6 bg-slate-800/50 border border-slate-700 rounded-lg\">\n          <h2 className=\"text-xl font-bold mb-3 text-slate-200\">{isAdmin ? 'Admin' : 'Subadmin'} Panel</h2>\n          <p className=\"text-slate-400 mb-4\">\n            {isAdmin \n              ? \"As an admin, you don't have permission to play games. Your role is to manage the platform, games, and users.\"\n              : \"As a subadmin, you don't have permission to play games. Your role is to manage users assigned to you, their risk management, and jantri settings.\"}\n          </p>\n          \n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6\">\n            {/* Dashboard */}\n            <Button \n              className=\"py-6 bg-gradient-to-r from-violet-700 to-indigo-600 hover:from-violet-600 hover:to-indigo-500\"\n              onClick={() => setLocation(\"/dashboard\")}\n            >\n              <LayoutDashboard className=\"h-5 w-5 mr-2\" />\n              Dashboard\n            </Button>\n            \n            {/* User Management */}\n            <Button \n              variant=\"outline\"\n              className=\"py-6 border-slate-700 text-blue-300 hover:bg-slate-800 hover:text-blue-200\"\n              onClick={() => setLocation(\"/users\")}\n            >\n              <Users className=\"h-5 w-5 mr-2\" />\n              Manage Users\n            </Button>\n            \n            {/* Subadmin Management - Admin Only */}\n            {isAdmin && (\n              <Button \n                variant=\"outline\"\n                className=\"py-6 border-slate-700 text-teal-300 hover:bg-slate-800 hover:text-teal-200\"\n                onClick={() => setLocation(\"/subadmins\")}\n              >\n                <ShieldCheck className=\"h-5 w-5 mr-2\" />\n                Manage Subadmins\n              </Button>\n            )}\n            \n            {/* Jantri Management */}\n            <Button \n              variant=\"outline\"\n              className=\"py-6 border-slate-700 text-purple-300 hover:bg-slate-800 hover:text-purple-200\"\n              onClick={() => setLocation(\"/risk-management\")}\n            >\n              <CalendarRange className=\"h-5 w-5 mr-2\" />\n              Jantri Management\n            </Button>\n            \n            {/* Profile */}\n            <Button \n              variant=\"outline\"\n              className=\"py-6 border-slate-700 text-pink-300 hover:bg-slate-800 hover:text-pink-200\"\n              onClick={() => setLocation(\"/profile\")}\n            >\n              <UserCircle className=\"h-5 w-5 mr-2\" />\n              Profile\n            </Button>\n            \n            {/* Wallet */}\n            <Button \n              variant=\"outline\"\n              className=\"py-6 border-slate-700 text-orange-300 hover:bg-slate-800 hover:text-orange-200\"\n              onClick={() => setLocation(\"/wallet\")}\n            >\n              <Wallet className=\"h-5 w-5 mr-2\" />\n              Wallet\n            </Button>\n            \n            {/* Cricket Toss Management - Admin Only */}\n            {isAdmin && (\n              <Button \n                variant=\"outline\"\n                className=\"py-6 border-slate-700 text-cyan-300 hover:bg-slate-800 hover:text-cyan-200\"\n                onClick={() => setLocation(\"/admin-cricket-toss\")}\n              >\n                <Activity className=\"h-5 w-5 mr-2\" />\n                Cricket Toss Management\n              </Button>\n            )}\n            \n            {/* Market Management - Admin Only */}\n            {isAdmin && (\n              <Button \n                variant=\"outline\"\n                className=\"py-6 border-slate-700 text-emerald-300 hover:bg-slate-800 hover:text-emerald-200\"\n                onClick={() => setLocation(\"/manage-markets\")}\n              >\n                <Target className=\"h-5 w-5 mr-2\" />\n                Manage Markets\n              </Button>\n            )}\n            \n            {/* Settings - Admin Only */}\n            {isAdmin && (\n              <Button \n                variant=\"outline\"\n                className=\"py-6 border-slate-700 text-amber-300 hover:bg-slate-800 hover:text-amber-200\"\n                onClick={() => setLocation(\"/settings\")}\n              >\n                <Settings className=\"h-5 w-5 mr-2\" />\n                Settings\n              </Button>\n            )}\n            \n            {/* Fund Management - Admin Only */}\n            {isAdmin && (\n              <Button \n                variant=\"outline\"\n                className=\"py-6 border-slate-700 text-green-300 hover:bg-slate-800 hover:text-green-200\"\n                onClick={() => setLocation(\"/fund-management\")}\n              >\n                <DollarSign className=\"h-5 w-5 mr-2\" />\n                Fund Management\n              </Button>\n            )}\n            \n            {/* Reset Zone - Admin Only */}\n            {isAdmin && (\n              <Button \n                variant=\"outline\"\n                className=\"py-6 border-slate-700 text-red-300 hover:bg-slate-800 hover:text-red-200\"\n                onClick={() => setLocation(\"/reset-zone\")}\n                data-testid=\"button-reset-zone\"\n              >\n                <RefreshCw className=\"h-5 w-5 mr-2\" />\n                Reset Zone\n              </Button>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* Player Features - Only visible to players */}\n      {isPlayer && (\n        <>\n          {/* Featured Games Section */}\n          <div className=\"mb-8\">\n            <div className=\"mb-4\">\n              <h2 className=\"text-xl font-bold flex items-center text-slate-200\">\n                <Play className=\"h-5 w-5 mr-2 text-blue-500\" />\n                Featured Games\n              </h2>\n            </div>\n            \n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6\">\n              {gameCards.map((game) => (\n                <GameCard \n                  key={game.id}\n                  id={game.id}\n                  title={game.title}\n                  description={game.description}\n                  imageBg={game.imageBg}\n                  path={game.path}\n                  popularity={game.popularity}\n                  winRate={game.winRate}\n                  gameType={game.gameType}\n                />\n              ))}\n            </div>\n            \n            <div className=\"mt-4 text-center\">\n              <Button \n                variant=\"outline\"\n                className=\"border-slate-700 text-blue-300 hover:bg-slate-800 hover:text-blue-200\"\n                onClick={() => setLocation(\"/games\")}\n              >\n                <Gamepad className=\"h-4 w-4 mr-2\" />\n                View All Games\n              </Button>\n            </div>\n          </div>\n          \n          {/* Recent Activity Section - Two column layout on desktop */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n            {/* Recent Games */}\n            <GameHistoryTable games={recentGames as any[]} />\n            \n            {/* Right column - winners and results */}\n            <div className=\"space-y-6\">\n              <RecentWinners winners={topWinners} />\n              {/* We'll implement real market results later */}\n              <RecentResults results={[]} />\n            </div>\n          </div>\n          \n          {/* Quick Actions */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-8\">\n            <Button \n              className=\"py-8 text-lg bg-gradient-to-r from-purple-700 to-fuchsia-600 hover:from-purple-600 hover:to-fuchsia-500\"\n              onClick={() => setLocation(\"/coinflip\")}\n            >\n              <Dice1 className=\"h-5 w-5 mr-2\" />\n              Coin Flip\n            </Button>\n            \n            <Button \n              variant=\"outline\"\n              className=\"py-8 text-lg border-slate-700 text-indigo-300 hover:bg-slate-800/50 hover:text-indigo-200\"\n              onClick={() => setLocation(\"/cricket-toss\")}\n            >\n              <GiCricketBat className=\"h-5 w-5 mr-2\" />\n              Cricket Toss\n            </Button>\n            \n            <Button \n              variant=\"outline\"\n              className=\"py-8 text-lg border-slate-700 text-cyan-300 hover:bg-slate-800/50 hover:text-cyan-200\"\n              onClick={() => setLocation(\"/markets\")}\n            >\n              <Calendar className=\"h-5 w-5 mr-2\" />\n              Market Games\n            </Button>\n            \n            <Button \n              variant=\"outline\"\n              className=\"py-8 text-lg border-slate-700 text-emerald-300 hover:bg-slate-800/50 hover:text-emerald-200\"\n              onClick={() => setLocation(\"/game-history\")}\n            >\n              <BarChart2 className=\"h-5 w-5 mr-2\" />\n              Game History\n            </Button>\n            \n            <Button \n              variant=\"outline\"\n              className=\"py-8 text-lg border-slate-700 text-amber-300 hover:bg-slate-800/50 hover:text-amber-200\"\n              onClick={() => setLocation(\"/leaderboard\")}\n            >\n              <Trophy className=\"h-5 w-5 mr-2\" />\n              Leaderboard\n            </Button>\n          </div>\n        </>\n      )}\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":25525,"size_tokens":null},"fix-aloo-password.js":{"content":"/**\n * Quick fix for aloo user password\n */\nimport { db } from './server/db.js';\nimport { users } from './shared/schema.js';\nimport { eq } from 'drizzle-orm';\nimport { scrypt, randomBytes } from 'crypto';\nimport { promisify } from 'util';\n\nconst scryptAsync = promisify(scrypt);\n\nasync function hashPassword(password) {\n  const salt = randomBytes(16).toString('hex');\n  const buf = await scryptAsync(password, salt, 64);\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nasync function fixAlooPassword() {\n  try {\n    // Hash the password properly\n    const hashedPassword = await hashPassword('qwer1234');\n    console.log('Generated hash:', hashedPassword);\n    \n    // Update the password in database\n    const result = await db.update(users)\n      .set({ password: hashedPassword })\n      .where(eq(users.username, 'aloo'))\n      .returning();\n    \n    if (result.length > 0) {\n      console.log(' Password updated successfully for user:', result[0].username);\n      console.log(' You can now login with username: aloo, password: qwer1234');\n    } else {\n      console.log(' No user was updated');\n    }\n  } catch (error) {\n    console.error(' Error:', error);\n  }\n}\n\nfixAlooPassword();","path":null,"size_bytes":1197,"size_tokens":null},"fix-admin-password.ts":{"content":"/**\n * Script to update the admin user password with the correct crypto.scrypt format\n */\nimport { pool } from './server/db';\nimport { scrypt, randomBytes } from 'crypto';\nimport { promisify } from 'util';\n\n// Promisify scrypt\nconst scryptAsync = promisify(scrypt);\n\nasync function hashPassword(password: string) {\n  // Use crypto.scrypt format (same as in auth.ts)\n  const salt = randomBytes(16).toString('hex');\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nasync function fixAdminPassword() {\n  try {\n    console.log('Fixing admin user password...');\n    \n    // Create admin user with direct SQL\n    const client = await pool.connect();\n    \n    try {\n      await client.query('BEGIN');\n      \n      // Check if admin exists\n      const checkResult = await client.query('SELECT id FROM users WHERE username = $1', ['admin']);\n      \n      if (checkResult.rowCount === 0) {\n        console.log('Admin user does not exist, creating one');\n        // Hash password with crypto.scrypt\n        const hashedPassword = await hashPassword('admin123');\n        \n        await client.query(`\n          INSERT INTO users (username, password, email, mobile, role, balance) \n          VALUES ($1, $2, $3, $4, $5, $6)\n        `, ['admin', hashedPassword, 'admin@example.com', '1234567890', 'admin', 0]);\n        \n        console.log('Admin user created successfully with crypto.scrypt password');\n      } else {\n        console.log('Admin user exists, updating password');\n        // Update existing admin's password\n        const hashedPassword = await hashPassword('admin123');\n        \n        await client.query(`\n          UPDATE users\n          SET password = $1\n          WHERE username = 'admin'\n        `, [hashedPassword]);\n        \n        console.log('Admin password updated successfully with crypto.scrypt format');\n      }\n      \n      await client.query('COMMIT');\n    } catch (err) {\n      await client.query('ROLLBACK');\n      throw err;\n    } finally {\n      client.release();\n    }\n    \n  } catch (error) {\n    console.error('Error updating admin password:', error);\n  } finally {\n    // Close the pool\n    await pool.end();\n  }\n}\n\nfixAdminPassword();","path":null,"size_bytes":2225,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/pages/old-risk-management-page.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { UserRole } from \"@shared/schema\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { \n  Card,\n  CardContent, \n  CardDescription, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { \n  Tabs, \n  TabsContent, \n  TabsList, \n  TabsTrigger \n} from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  AlertTriangle,\n  Activity,\n  TrendingDown,\n  TrendingUp,\n  Users,\n  Target,\n  Loader2\n} from \"lucide-react\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { useForm } from \"react-hook-form\";\nimport { Slider } from \"@/components/ui/slider\";\n\ninterface RiskSummary {\n  totalBetAmount: number;\n  potentialLiability: number;\n  potentialProfit: number;\n  exposureAmount: number;\n  activeBets: number;\n  totalBets: number;\n  highRiskBets: number;\n  gameType: string;\n  gameTypeFormatted: string;\n}\n\ninterface DetailedRiskData {\n  userExposure: { [userId: number]: number };\n  marketExposure: { [marketId: number]: number };\n  gameData: any[];\n}\n\ninterface RiskManagementData {\n  summaries: RiskSummary[];\n  detailedData: DetailedRiskData;\n  userInfo: { [userId: string]: { username: string } };\n  marketInfo: { [marketId: string]: { name: string; type: string } };\n  message?: string;\n}\n\n// Interface for user info to display names instead of IDs\ninterface UserInfo {\n  [userId: string]: { username: string };\n}\n\n// Interface for market info to display names instead of IDs\ninterface MarketInfo {\n  [marketId: string]: { name: string; type: string };\n}\n\nfunction LoadingSkeleton() {\n  return (\n    <div className=\"space-y-4\">\n      <Skeleton className=\"h-8 w-1/3\" />\n      <Skeleton className=\"h-4 w-1/4\" />\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mt-6\">\n        <Skeleton className=\"h-32\" />\n        <Skeleton className=\"h-32\" />\n        <Skeleton className=\"h-32\" />\n        <Skeleton className=\"h-32\" />\n      </div>\n    </div>\n  );\n}\n\nexport default function RiskManagementPage() {\n  const { user } = useAuth();\n  const isAdmin = user?.role === UserRole.ADMIN;\n  const isSubadmin = user?.role === UserRole.SUBADMIN;\n  const [activeTab, setActiveTab] = useState('market-game');\n  const [userInfo, setUserInfo] = useState<UserInfo>({});\n  const [marketInfo, setMarketInfo] = useState<MarketInfo>({});\n  const [betTypeFilter, setBetTypeFilter] = useState<string>('all');\n  const [marketFilter, setMarketFilter] = useState<number | 'all'>('all');\n  const [viewMode, setViewMode] = useState<'regular' | 'odd-even' | 'harf'>('regular');\n  \n  // Risk level threshold configuration\n  const [riskThresholds, setRiskThresholds] = useState({\n    high: 1000,\n    medium: 500,\n    low: 100\n  });\n  \n  // Whether risk configuration dialog is open\n  const [riskConfigOpen, setRiskConfigOpen] = useState(false);\n  \n  // Form for risk threshold configuration\n  const riskConfigForm = useForm({\n    defaultValues: {\n      highRisk: riskThresholds.high / 100,\n      mediumRisk: riskThresholds.medium / 100,\n      lowRisk: riskThresholds.low / 100\n    }\n  });\n\n  // Get the appropriate API endpoint based on user role\n  const endpoint = isAdmin ? '/api/risk/admin' : '/api/risk/subadmin';\n\n  // Fetch risk management data\n  const { data, isLoading, error } = useQuery<RiskManagementData>({\n    queryKey: [endpoint],\n    queryFn: async () => {\n      const response = await apiRequest('GET', endpoint);\n      const data = await response.json();\n      return data as RiskManagementData;\n    },\n    refetchInterval: 60000 // Refetch every minute to keep data fresh\n  });\n  \n  // Fetch game odds for the current user (admin or subadmin)\n  const { data: oddsData, isLoading: isLoadingOdds } = useQuery({\n    queryKey: [isAdmin ? '/api/odds/admin' : '/api/game-odds/subadmin', user?.id],\n    enabled: !!user,\n  });\n  \n  // Use real user names from the API\n  useEffect(() => {\n    if (data?.userInfo) {\n      setUserInfo(data.userInfo);\n    }\n  }, [data]);\n  \n  // Use real market names from the API\n  useEffect(() => {\n    if (data?.marketInfo) {\n      setMarketInfo(data.marketInfo);\n      \n      // Auto-select the active market (first one without results)\n      if (marketFilter === 'all') {\n        const activeMarketId = Object.keys(data.marketInfo).find(marketId => {\n          const market = data.marketInfo[marketId];\n          // Find markets that are still active (no results yet)\n          return market && (!market.status || market.status === 'open');\n        });\n        \n        if (activeMarketId) {\n          setMarketFilter(parseInt(activeMarketId));\n        }\n      }\n    }\n  }, [data, marketFilter]);\n\n  // Function to save risk thresholds\n  const saveRiskThresholds = (values: any) => {\n    // Convert rupees back to database values (multiply by 100)\n    setRiskThresholds({\n      high: values.highRisk * 100,\n      medium: values.mediumRisk * 100,\n      low: values.lowRisk * 100\n    });\n    setRiskConfigOpen(false);\n  };\n\n  // Helper function for risk level badge\n  const getRiskLevelBadge = (level: string) => {\n    if (level === 'high') return <Badge className=\"bg-[#9333EA] text-white\">High</Badge>;\n    if (level === 'medium') return <Badge className=\"bg-[#9333EA] text-white\">Medium</Badge>;\n    if (level === 'low') return <Badge className=\"bg-[#9333EA] text-white\">Low</Badge>;\n    return null;\n  };\n\n  // Prepare data conditionally but without using hooks\n  let marketGameData = null;\n  let cricketTossData = null;\n  \n  if (data && data.summaries) {\n    marketGameData = data.summaries.find(summary => summary.gameType === 'satamatka');\n    cricketTossData = data.summaries.find(summary => summary.gameType === 'cricket_toss');\n  }\n\n  if (isLoading) {\n    return (\n      <DashboardLayout title=\"Jantri Management\" activeTab=\"risk-management\">\n        <div className=\"p-6\">\n          <LoadingSkeleton />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  if (error) {\n    return (\n      <DashboardLayout title=\"Jantri Management\" activeTab=\"risk-management\">\n        <div className=\"p-6\">\n          <Card className=\"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800\">\n            <CardHeader>\n              <CardTitle className=\"text-red-700 dark:text-red-300 flex items-center\">\n                <AlertTriangle className=\"w-5 h-5 mr-2\" />\n                Error Loading Jantri Management Data\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p>There was a problem loading the jantri management data. Please try again later.</p>\n            </CardContent>\n          </Card>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!data || !data.summaries || data.summaries.length === 0) {\n    return (\n      <DashboardLayout title=\"Jantri Management\" activeTab=\"risk-management\">\n        <div className=\"p-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Jantri Management</CardTitle>\n              <CardDescription>No game data available</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <p>There's currently no data to display. This may be because there are no active games or bets in the system.</p>\n            </CardContent>\n          </Card>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout title=\"Jantri Management\" activeTab=\"risk-management\">\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-xl font-bold\">\n              {isAdmin ? 'Platform-wide Jantri Analysis' : 'Jantri Analysis for Your Players'}\n            </h2>\n            <p className=\"text-muted-foreground\">\n              Monitor and manage Satamatka numbers with comprehensive betting data\n            </p>\n          </div>\n        </div>\n        \n        {/* Risk Configuration Dialog */}\n        <Dialog open={riskConfigOpen} onOpenChange={setRiskConfigOpen}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Configure Risk Thresholds</DialogTitle>\n              <DialogDescription>\n                Set the bet amount thresholds for different risk levels. Values are in rupees.\n              </DialogDescription>\n            </DialogHeader>\n            \n            <Form {...riskConfigForm}>\n              <form onSubmit={riskConfigForm.handleSubmit(saveRiskThresholds)} className=\"space-y-4\">\n                <FormField\n                  control={riskConfigForm.control}\n                  name=\"highRisk\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>High Risk Threshold ()</FormLabel>\n                      <FormDescription>\n                        Bets above this amount will be marked as high risk (red)\n                      </FormDescription>\n                      <FormControl>\n                        <div className=\"flex items-center gap-4\">\n                          <Slider\n                            value={[field.value]}\n                            min={100}\n                            max={10000}\n                            step={100}\n                            onValueChange={(vals) => field.onChange(vals[0])}\n                            className=\"flex-1\"\n                          />\n                          <Input\n                            type=\"number\"\n                            value={field.value}\n                            onChange={(e) => field.onChange(parseFloat(e.target.value))}\n                            className=\"w-24\"\n                          />\n                        </div>\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={riskConfigForm.control}\n                  name=\"mediumRisk\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Medium Risk Threshold ()</FormLabel>\n                      <FormDescription>\n                        Bets above this amount but below high risk will be marked as medium risk (orange)\n                      </FormDescription>\n                      <FormControl>\n                        <div className=\"flex items-center gap-4\">\n                          <Slider\n                            value={[field.value]}\n                            min={50}\n                            max={9900}\n                            step={100}\n                            onValueChange={(vals) => field.onChange(vals[0])}\n                            className=\"flex-1\"\n                          />\n                          <Input\n                            type=\"number\"\n                            value={field.value}\n                            onChange={(e) => field.onChange(parseFloat(e.target.value))}\n                            className=\"w-24\"\n                          />\n                        </div>\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={riskConfigForm.control}\n                  name=\"lowRisk\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Low Risk Threshold ()</FormLabel>\n                      <FormDescription>\n                        Bets above this amount but below medium risk will be marked as low risk (blue)\n                      </FormDescription>\n                      <FormControl>\n                        <div className=\"flex items-center gap-4\">\n                          <Slider\n                            value={[field.value]}\n                            min={1}\n                            max={5000}\n                            step={10}\n                            onValueChange={(vals) => field.onChange(vals[0])}\n                            className=\"flex-1\"\n                          />\n                          <Input\n                            type=\"number\"\n                            value={field.value}\n                            onChange={(e) => field.onChange(parseFloat(e.target.value))}\n                            className=\"w-24\"\n                          />\n                        </div>\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                \n                <DialogFooter>\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setRiskConfigOpen(false)}>\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\">Save Changes</Button>\n                </DialogFooter>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n\n        <Separator />\n\n        {/* Detailed Analysis Tabs */}\n        <Tabs defaultValue=\"market-game\" className=\"w-full mt-6\" onValueChange={setActiveTab}>\n          <TabsList className=\"grid w-full grid-cols-2 mb-4\">\n            <TabsTrigger value=\"market-game\">Satamatka Analysis</TabsTrigger>\n            <TabsTrigger value=\"cricket-toss\">Cricket Toss Risk</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"market-game\" className=\"mt-0\">\n            \n            {marketGameData && (\n              <>\n                {/* Stats Overview Cards */}\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6\">\n                  <Card className=\"border-primary/20 bg-primary/5\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Active Satamatka Bets\n                      </CardTitle>\n                      <Activity className=\"h-4 w-4 text-primary\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{marketGameData.activeBets}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        From {marketGameData.totalBets} total bets\n                      </p>\n                      <div className=\"mt-3\">\n                        <Progress \n                          value={marketGameData.totalBets > 0 ? (marketGameData.activeBets / marketGameData.totalBets) * 100 : 0} \n                          className=\"h-2\" \n                        />\n                      </div>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card className=\"border-primary/20 bg-primary/5\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        High Risk Bets\n                      </CardTitle>\n                      <AlertTriangle className=\"h-4 w-4 text-primary\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{marketGameData.highRiskBets}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Require immediate attention\n                      </p>\n                      <div className=\"mt-3\">\n                        <Progress \n                          value={marketGameData.activeBets > 0 ? (marketGameData.highRiskBets / marketGameData.activeBets) * 100 : 0} \n                          className=\"h-2 bg-red-200\" \n                          indicatorClassName=\"bg-red-500\"\n                        />\n                      </div>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card className=\"border-primary/20 bg-primary/5\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Current Exposure\n                      </CardTitle>\n                      <Target className=\"h-4 w-4 text-primary\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{(marketGameData.exposureAmount/100).toFixed(2)}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        From active bets\n                      </p>\n                      <div className=\"mt-3 flex items-center space-x-2\">\n                        <TrendingUp className=\"h-4 w-4 text-green-500\" />\n                        <span className=\"text-xs text-green-600\">\n                          Potential Profit: {(marketGameData.potentialProfit/100).toFixed(2)}\n                        </span>\n                      </div>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Potential Liability\n                      </CardTitle>\n                      <TrendingDown className=\"h-4 w-4 text-red-500\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{(marketGameData.potentialLiability/100).toFixed(2)}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Maximum possible loss\n                      </p>\n                      <div className=\"mt-3 flex items-center space-x-2\">\n                        <div className=\"text-xs\">\n                          <span className=\"font-medium\">Risk Coverage: </span>\n                          <span className=\"text-blue-600\">{marketGameData.potentialLiability > 0 ? Math.min(100, Math.round((marketGameData.potentialProfit / marketGameData.potentialLiability) * 100)) : 0}%</span>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n                \n                {/* Grid view showing all numbers from 00-99 */}\n                <Card className=\"mb-6\">\n                  <CardHeader>\n                    <CardTitle>Satamatka Numbers (00-99)</CardTitle>\n                    <CardDescription>Comprehensive view of all numbers with active bets</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"mb-4 flex flex-col space-y-3\">\n                      {/* Market Filter */}\n                      <div className=\"flex items-center space-x-2\">\n                        <span className=\"font-semibold w-24\">Market Filter:</span>\n                        <select \n                          className=\"p-2 rounded-md bg-background border border-input text-sm\" \n                          value={marketFilter === 'all' ? 'all' : marketFilter.toString()}\n                          onChange={(e) => setMarketFilter(e.target.value === 'all' ? 'all' : parseInt(e.target.value))}\n                        >\n                          <option value=\"all\">All Markets</option>\n                          {Object.entries(marketInfo).map(([marketId, market]) => (\n                            <option key={marketId} value={marketId}>\n                              {market.name}\n                            </option>\n                          ))}\n                        </select>\n                      </div>\n                      \n                      {/* Bet Type Filter - Jodi only for simplicity */}\n                      <div className=\"flex items-center space-x-2\">\n                        <span className=\"font-semibold w-24\">View Mode:</span>\n                        <div className=\"flex items-center space-x-2\">\n                          <Badge \n                            className={`cursor-pointer px-3 py-1 ${viewMode === 'regular' && betTypeFilter === 'all' ? 'bg-primary' : 'bg-slate-700'}`}\n                            onClick={() => {\n                              setViewMode('regular');\n                              setBetTypeFilter('all');\n                            }}\n                          >\n                            All Numbers\n                          </Badge>\n                          <Badge \n                            className={`cursor-pointer px-3 py-1 ${viewMode === 'regular' && betTypeFilter === 'jodi' ? 'bg-primary' : 'bg-slate-700'}`}\n                            onClick={() => {\n                              setViewMode('regular');\n                              setBetTypeFilter('jodi');\n                            }}\n                          >\n                            Jodi Only\n                          </Badge>\n                          <Badge \n                            className={`cursor-pointer px-3 py-1 ${viewMode === 'odd-even' ? 'bg-primary' : 'bg-slate-700'}`}\n                            onClick={() => {\n                              setViewMode('odd-even');\n                              setBetTypeFilter('all');\n                            }}\n                          >\n                            Odd/Even\n                          </Badge>\n                          <Badge \n                            className={`cursor-pointer px-3 py-1 ${viewMode === 'harf' ? 'bg-primary' : 'bg-slate-700'}`}\n                            onClick={() => {\n                              setViewMode('harf');\n                              setBetTypeFilter('all');\n                            }}\n                          >\n                            Harf (A0-B9)\n                          </Badge>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"flex items-center space-x-1\">\n                          <span className=\"inline-block w-3 h-3 rounded-full bg-red-500\"></span>\n                          <span className=\"text-xs\">High Risk ({(riskThresholds.high/100).toFixed(2)}+)</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <span className=\"inline-block w-3 h-3 rounded-full bg-orange-500\"></span>\n                          <span className=\"text-xs\">Medium Risk ({(riskThresholds.medium/100).toFixed(2)}+)</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <span className=\"inline-block w-3 h-3 rounded-full bg-blue-500\"></span>\n                          <span className=\"text-xs\">Low Risk (Above 0)</span>\n                        </div>\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\" \n                          className=\"ml-2 text-xs\" \n                          onClick={() => setRiskConfigOpen(true)}\n                        >\n                          Configure Risk Levels\n                        </Button>\n                      </div>\n                    </div>\n                    \n                    <ScrollArea className=\"h-[600px]\">\n                      {viewMode === 'odd-even' ? (\n                        <div className=\"p-4\">\n                          <h3 className=\"text-lg font-bold mb-4\">Odd/Even Risk Management</h3>\n                          <div className=\"grid grid-cols-2 gap-6\">\n                            {/* Odd Numbers Section */}\n                            <Card>\n                              <CardHeader>\n                                <CardTitle className=\"text-base\">Odd Bet Type</CardTitle>\n                              </CardHeader>\n                              <CardContent>\n                                {(() => {\n                                  // Filter games specifically for \"odd\" bet type in odd_even game mode\n                                  const oddGames = data.detailedData.gameData.filter(game => {\n                                    if (game.gameType !== 'satamatka') return false;\n                                    if (game.result && game.result !== 'pending') return false;\n                                    if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                                    \n                                    // Only include bets with odd_even game mode and odd prediction\n                                    return game.gameMode === 'odd_even' && game.prediction === 'odd';\n                                  });\n                                  \n                                  // Get the actual odds for odd_even games from fetched data\n                                  let oddEvenMultiplier = 1.9; // Default fallback\n                                  \n                                  if (oddsData && Array.isArray(oddsData)) {\n                                    // Find the odds for satamatka_odd_even game type\n                                    const oddEvenData = oddsData.find(odd => \n                                      odd.gameType === 'satamatka_odd_even');\n                                    \n                                    if (oddEvenData && oddEvenData.oddValue !== undefined) {\n                                      console.log('Raw odd_even odds value:', oddEvenData.oddValue, 'Type:', typeof oddEvenData.oddValue);\n                                      \n                                      // Handle different formats of the odds value\n                                      if (oddEvenData.oddValue >= 10000) {\n                                        // Format used for subadmin: 19000 = 1.9\n                                        oddEvenMultiplier = oddEvenData.oddValue / 10000;\n                                      } else if (oddEvenData.oddValue >= 10) {\n                                        // Alternative format: 19 = 1.9\n                                        oddEvenMultiplier = oddEvenData.oddValue / 10;\n                                      } else {\n                                        // Format used for admin: 1.95 = 1.95\n                                        oddEvenMultiplier = oddEvenData.oddValue;\n                                      }\n                                      \n                                      console.log('Using calculated odd_even multiplier:', oddEvenMultiplier);\n                                    }\n                                  }\n                                  \n                                  // Calculate totals\n                                  const totalBets = oddGames.length;\n                                  const totalBetAmount = oddGames.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                                  const potentialWin = oddGames.reduce((sum, game) => sum + ((game.betAmount || 0) * oddEvenMultiplier), 0);\n                                  \n                                  // Define risk level\n                                  let riskLevel = 'none';\n                                  if (totalBetAmount > riskThresholds.high) riskLevel = 'high';\n                                  else if (totalBetAmount > riskThresholds.medium) riskLevel = 'medium';\n                                  else if (totalBetAmount > 0) riskLevel = 'low';\n                                  \n                                  return (\n                                    <div className=\"space-y-4\">\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Active Bets:</span>\n                                        <span>{totalBets}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Total Bet Amount:</span>\n                                        <span>{(totalBetAmount / 100).toFixed(2)}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Potential Win:</span>\n                                        <span>{(potentialWin / 100).toFixed(2)}</span>\n                                      </div>\n                                      <div className=\"flex justify-between items-center\">\n                                        <span className=\"font-medium\">Risk Level:</span>\n                                        <span>{getRiskLevelBadge(riskLevel)}</span>\n                                      </div>\n                                    </div>\n                                  );\n                                })()}\n                              </CardContent>\n                            </Card>\n                            \n                            {/* Even Numbers Section */}\n                            <Card>\n                              <CardHeader>\n                                <CardTitle className=\"text-base\">Even Bet Type</CardTitle>\n                              </CardHeader>\n                              <CardContent>\n                                {(() => {\n                                  // Filter games specifically for \"even\" bet type in odd_even game mode\n                                  const evenGames = data.detailedData.gameData.filter(game => {\n                                    if (game.gameType !== 'satamatka') return false;\n                                    if (game.result && game.result !== 'pending') return false;\n                                    if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                                    \n                                    // Only include bets with odd_even game mode and even prediction\n                                    return game.gameMode === 'odd_even' && game.prediction === 'even';\n                                  });\n                                  \n                                  // Get the actual odds for odd_even games from fetched data\n                                  let oddEvenMultiplier = 1.9; // Default fallback\n                                  \n                                  if (oddsData && Array.isArray(oddsData)) {\n                                    // Find the odds for satamatka_odd_even game type\n                                    const oddEvenData = oddsData.find(odd => \n                                      odd.gameType === 'satamatka_odd_even');\n                                    \n                                    if (oddEvenData && oddEvenData.oddValue !== undefined) {\n                                      console.log('Raw odd_even odds value for even bets:', oddEvenData.oddValue, 'Type:', typeof oddEvenData.oddValue);\n                                      \n                                      // Handle different formats of the odds value\n                                      if (oddEvenData.oddValue >= 10000) {\n                                        // Format used for subadmin: 19000 = 1.9\n                                        oddEvenMultiplier = oddEvenData.oddValue / 10000;\n                                      } else if (oddEvenData.oddValue >= 10) {\n                                        // Alternative format: 19 = 1.9\n                                        oddEvenMultiplier = oddEvenData.oddValue / 10;\n                                      } else {\n                                        // Format used for admin: 1.95 = 1.95\n                                        oddEvenMultiplier = oddEvenData.oddValue;\n                                      }\n                                      \n                                      console.log('Using calculated odd_even multiplier for even bets:', oddEvenMultiplier);\n                                    }\n                                  }\n                                  \n                                  // Calculate totals\n                                  const totalBets = evenGames.length;\n                                  const totalBetAmount = evenGames.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                                  const potentialWin = evenGames.reduce((sum, game) => sum + ((game.betAmount || 0) * oddEvenMultiplier), 0);\n                                  \n                                  // Define risk level\n                                  let riskLevel = 'none';\n                                  if (totalBetAmount > riskThresholds.high) riskLevel = 'high';\n                                  else if (totalBetAmount > riskThresholds.medium) riskLevel = 'medium';\n                                  else if (totalBetAmount > 0) riskLevel = 'low';\n                                  \n                                  return (\n                                    <div className=\"space-y-4\">\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Active Bets:</span>\n                                        <span>{totalBets}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Total Bet Amount:</span>\n                                        <span>{(totalBetAmount / 100).toFixed(2)}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"font-medium\">Potential Win:</span>\n                                        <span>{(potentialWin / 100).toFixed(2)}</span>\n                                      </div>\n                                      <div className=\"flex justify-between items-center\">\n                                        <span className=\"font-medium\">Risk Level:</span>\n                                        <span>{getRiskLevelBadge(riskLevel)}</span>\n                                      </div>\n                                    </div>\n                                  );\n                                })()}\n                              </CardContent>\n                            </Card>\n                          </div>\n                        </div>\n                      ) : viewMode === 'harf' ? (\n                        <div className=\"p-4\">\n                          <h3 className=\"text-lg font-bold mb-4\">Harf Risk Management</h3>\n                          <div className=\"grid grid-cols-2 gap-6 mb-8\">\n                            <Card>\n                              <CardHeader>\n                                <CardTitle className=\"text-base\">Left Digit (A0-A9)</CardTitle>\n                              </CardHeader>\n                              <CardContent>\n                                <div className=\"grid grid-cols-5 gap-4\">\n                                  {Array.from({ length: 10 }, (_, i) => {\n                                    const digit = i.toString();\n                                    \n                                    // Filter games for this left digit\n                                    const gamesForLeftDigit = data.detailedData.gameData.filter(game => {\n                                      if (game.gameType !== 'satamatka') return false;\n                                      if (game.result && game.result !== 'pending') return false;\n                                      if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                                      \n                                      // For harf mode, match A0, A1, etc. format\n                                      return game.gameMode === 'harf' && game.prediction === `A${digit}`;\n                                    });\n                                    \n                                    // Calculate totals\n                                    const totalBets = gamesForLeftDigit.length;\n                                    const totalBetAmount = gamesForLeftDigit.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                                    const potentialWin = gamesForLeftDigit.reduce((sum, game) => sum + ((game.betAmount || 0) * 90), 0);\n                                    \n                                    // Define risk level\n                                    let riskLevel = 'none';\n                                    if (totalBetAmount > riskThresholds.high) riskLevel = 'high';\n                                    else if (totalBetAmount > riskThresholds.medium) riskLevel = 'medium';\n                                    else if (totalBetAmount > 0) riskLevel = 'low';\n                                    \n                                    return (\n                                      <Card key={`left-${digit}`} className={\n                                        riskLevel === 'high' ? 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800' :\n                                        riskLevel === 'medium' ? 'bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800' :\n                                        riskLevel === 'low' ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800' : ''\n                                      }>\n                                        <CardHeader className=\"p-3 pb-0\">\n                                          <CardTitle className=\"text-base text-center\">A{digit}</CardTitle>\n                                        </CardHeader>\n                                        <CardContent className=\"p-3 text-sm\">\n                                          <div className=\"space-y-1\">\n                                            <div className=\"flex justify-between\">\n                                              <span>Bets:</span>\n                                              <span>{totalBets}</span>\n                                            </div>\n                                            <div className=\"flex justify-between\">\n                                              <span>Amount:</span>\n                                              <span>{(totalBetAmount / 100).toFixed(0)}</span>\n                                            </div>\n                                            <div className=\"flex justify-between\">\n                                              <span>Win:</span>\n                                              <span>{(potentialWin / 100).toFixed(0)}</span>\n                                            </div>\n                                          </div>\n                                        </CardContent>\n                                      </Card>\n                                    );\n                                  })}\n                                </div>\n                              </CardContent>\n                            </Card>\n                            \n                            <Card>\n                              <CardHeader>\n                                <CardTitle className=\"text-base\">Right Digit (B0-B9)</CardTitle>\n                              </CardHeader>\n                              <CardContent>\n                                <div className=\"grid grid-cols-5 gap-4\">\n                                  {Array.from({ length: 10 }, (_, i) => {\n                                    const digit = i.toString();\n                                    \n                                    // Filter games for this right digit\n                                    const gamesForRightDigit = data.detailedData.gameData.filter(game => {\n                                      if (game.gameType !== 'satamatka') return false;\n                                      if (game.result && game.result !== 'pending') return false;\n                                      if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                                      \n                                      // For harf mode, match B0, B1, etc. format\n                                      return game.gameMode === 'harf' && game.prediction === `B${digit}`;\n                                    });\n                                    \n                                    // Calculate totals\n                                    const totalBets = gamesForRightDigit.length;\n                                    const totalBetAmount = gamesForRightDigit.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                                    const potentialWin = gamesForRightDigit.reduce((sum, game) => sum + ((game.betAmount || 0) * 90), 0);\n                                    \n                                    // Define risk level\n                                    let riskLevel = 'none';\n                                    if (totalBetAmount > riskThresholds.high) riskLevel = 'high';\n                                    else if (totalBetAmount > riskThresholds.medium) riskLevel = 'medium';\n                                    else if (totalBetAmount > 0) riskLevel = 'low';\n                                    \n                                    return (\n                                      <Card key={`right-${digit}`} className={\n                                        riskLevel === 'high' ? 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800' :\n                                        riskLevel === 'medium' ? 'bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800' :\n                                        riskLevel === 'low' ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800' : ''\n                                      }>\n                                        <CardHeader className=\"p-3 pb-0\">\n                                          <CardTitle className=\"text-base text-center\">B{digit}</CardTitle>\n                                        </CardHeader>\n                                        <CardContent className=\"p-3 text-sm\">\n                                          <div className=\"space-y-1\">\n                                            <div className=\"flex justify-between\">\n                                              <span>Bets:</span>\n                                              <span>{totalBets}</span>\n                                            </div>\n                                            <div className=\"flex justify-between\">\n                                              <span>Amount:</span>\n                                              <span>{(totalBetAmount / 100).toFixed(0)}</span>\n                                            </div>\n                                            <div className=\"flex justify-between\">\n                                              <span>Win:</span>\n                                              <span>{(potentialWin / 100).toFixed(0)}</span>\n                                            </div>\n                                          </div>\n                                        </CardContent>\n                                      </Card>\n                                    );\n                                  })}\n                                </div>\n                              </CardContent>\n                            </Card>\n                          </div>\n                        </div>\n                      ) : (\n                        <Table>\n                          <TableHeader className=\"sticky top-0 bg-background z-10\">\n                            <TableRow>\n                              <TableHead className=\"w-[80px]\">Number</TableHead>\n                              <TableHead className=\"w-[100px]\">Active Bets</TableHead>\n                              <TableHead className=\"w-[150px]\">Bet Amount</TableHead>\n                              <TableHead className=\"w-[150px]\">Potential Win</TableHead>\n                              <TableHead>Bet Types</TableHead>\n                              <TableHead className=\"w-[120px]\">Market</TableHead>\n                              <TableHead className=\"w-[100px]\">Risk Level</TableHead>\n                              <TableHead className=\"w-[200px]\">Player Details</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                          {Array.from({ length: 100 }, (_, i) => {\n                            // Format number as two digits (e.g., 00, 01, ..., 99)\n                            const num = i.toString().padStart(2, '0');\n                            \n                            // Filter games for this number\n                            const gamesForNumber = data.detailedData.gameData.filter(game => {\n                              if (game.gameType !== 'satamatka') return false;\n                              if (game.result && game.result !== 'pending') return false;\n                              if (marketFilter !== 'all' && game.marketId !== marketFilter) return false;\n                              if (betTypeFilter !== 'all' && game.prediction !== betTypeFilter && game.prediction !== num) return false;\n                              \n                              // Match exact number predictions (jodi format - 00 to 99)\n                              return game.prediction === num;\n                            });\n                            \n                            // Calculate total bet amount for this number\n                            const totalBetAmount = gamesForNumber.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n                            \n                            // Calculate potential win amount (90x for Jodi)\n                            const potentialWin = gamesForNumber.reduce((sum, game) => sum + ((game.betAmount || 0) * 90), 0);\n                            \n                            // Get bet types for this number\n                            const betTypes = Array.from(new Set(gamesForNumber.map(game => \n                              game.gameMode || \"Jodi\"\n                            ))).join(', ');\n                            \n                            // Define the risk level based on bet amount using configurable thresholds\n                            let riskLevel = 'none';\n                            if (totalBetAmount > riskThresholds.high) riskLevel = 'high';\n                            else if (totalBetAmount > riskThresholds.medium) riskLevel = 'medium';\n                            else if (totalBetAmount > 0) riskLevel = 'low';\n                            \n                            // Skip rows with no bets\n                            if (gamesForNumber.length === 0) {\n                              return null;\n                            }\n                            \n                            return (\n                              <TableRow \n                                key={num}\n                                className={\n                                  riskLevel === 'high' \n                                    ? 'bg-red-500/10'\n                                    : riskLevel === 'medium'\n                                      ? 'bg-orange-500/10'\n                                      : riskLevel === 'low'\n                                        ? 'bg-blue-500/10'\n                                        : ''\n                                }\n                              >\n                                <TableCell className=\"font-bold\">{num}</TableCell>\n                                <TableCell>{gamesForNumber.length}</TableCell>\n                                <TableCell>\n                                  {totalBetAmount > 0 \n                                    ? `${totalBetAmount.toFixed(2)}` \n                                    : \"-\"}\n                                </TableCell>\n                                <TableCell>\n                                  {potentialWin > 0\n                                    ? `${potentialWin.toFixed(2)}`\n                                    : \"-\"}\n                                </TableCell>\n                                <TableCell>{betTypes || \"Jodi\"}</TableCell>\n                                <TableCell>\n                                  {gamesForNumber.length > 0 && (\n                                    <div className=\"flex flex-col space-y-1\">\n                                      {Array.from(new Set(gamesForNumber.map(game => game.marketId))).map(marketId => (\n                                        <Badge key={marketId} variant=\"outline\">\n                                          {marketInfo[marketId]?.name || `Market ${marketId}`}\n                                        </Badge>\n                                      ))}\n                                    </div>\n                                  )}\n                                </TableCell>\n                                <TableCell>\n                                  {getRiskLevelBadge(riskLevel)}\n                                </TableCell>\n                                <TableCell>\n                                  {gamesForNumber.length > 0 && (\n                                    <div className=\"flex flex-col space-y-1\">\n                                      {Array.from(new Set(gamesForNumber.map(game => game.userId))).map(userId => (\n                                        <div key={userId} className=\"flex items-center space-x-1\">\n                                          <Users className=\"h-3 w-3\" />\n                                          <span className=\"text-xs\">{userInfo[userId]?.username || `User ${userId}`}</span>\n                                        </div>\n                                      ))}\n                                    </div>\n                                  )}\n                                </TableCell>\n                              </TableRow>\n                            );\n                          }).filter(Boolean)}\n                        </TableBody>\n                      </Table>\n                    </ScrollArea>\n                  </CardContent>\n                </Card>\n              </>\n            )}\n          </TabsContent>\n          \n          <TabsContent value=\"cricket-toss\" className=\"mt-0\">\n            {/* Cricket Toss Risk Management Content */}\n            {cricketTossData ? (\n              <div className=\"space-y-6\">\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Active Cricket Bets\n                      </CardTitle>\n                      <Activity className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{cricketTossData.activeBets}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        From {cricketTossData.totalBets} total bets\n                      </p>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Total Bet Amount\n                      </CardTitle>\n                      <Target className=\"h-4 w-4 text-orange-500\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{(cricketTossData.totalBetAmount/100).toFixed(2)}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Across all cricket toss bets\n                      </p>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Potential Profit\n                      </CardTitle>\n                      <TrendingUp className=\"h-4 w-4 text-green-500\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{(cricketTossData.potentialProfit/100).toFixed(2)}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Best case scenario\n                      </p>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">\n                        Potential Liability\n                      </CardTitle>\n                      <TrendingDown className=\"h-4 w-4 text-red-500\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{(cricketTossData.potentialLiability/100).toFixed(2)}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Worst case scenario\n                      </p>\n                    </CardContent>\n                  </Card>\n                </div>\n                \n                {/* Cricket Match-wise Risk Analysis */}\n                <Card className=\"mt-6\">\n                  <CardHeader>\n                    <CardTitle>Cricket Toss Match Analysis</CardTitle>\n                    <CardDescription>Detailed risk assessment for each cricket match with team-wise betting data</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    {data.detailedData?.cricketMatchAnalysis && data.detailedData.cricketMatchAnalysis.length > 0 ? (\n                      <div className=\"space-y-6\">\n                        {data.detailedData.cricketMatchAnalysis.map((match: any) => (\n                          <Card key={match.matchId} className=\"border-l-4 border-l-blue-500\">\n                            <CardHeader className=\"pb-3\">\n                              <div className=\"flex items-center justify-between\">\n                                <div>\n                                  <CardTitle className=\"text-lg\">\n                                    {match.matchInfo.teamA} vs {match.matchInfo.teamB}\n                                  </CardTitle>\n                                  <CardDescription className=\"mt-1\">\n                                    {match.matchInfo.description}  {new Date(match.matchInfo.matchTime).toLocaleString()}\n                                  </CardDescription>\n                                </div>\n                                <Badge className={\n                                  match.summary.riskLevel === 'high' ? 'bg-red-500' :\n                                  match.summary.riskLevel === 'medium' ? 'bg-orange-500' : 'bg-green-500'\n                                }>\n                                  {match.summary.riskLevel.toUpperCase()} RISK\n                                </Badge>\n                              </div>\n                            </CardHeader>\n                            <CardContent>\n                              {/* Match Summary Stats */}\n                              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n                                <div className=\"text-center p-3 bg-slate-50 dark:bg-slate-800 rounded-lg\">\n                                  <div className=\"text-lg font-bold\">{match.summary.totalBets}</div>\n                                  <div className=\"text-xs text-muted-foreground\">Total Bets</div>\n                                </div>\n                                <div className=\"text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n                                  <div className=\"text-lg font-bold\">{(match.summary.totalAmount / 100).toFixed(0)}</div>\n                                  <div className=\"text-xs text-muted-foreground\">Total Amount</div>\n                                </div>\n                                <div className=\"text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n                                  <div className=\"text-lg font-bold\">{(match.summary.potentialProfit / 100).toFixed(0)}</div>\n                                  <div className=\"text-xs text-muted-foreground\">Potential Profit</div>\n                                </div>\n                                <div className=\"text-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg\">\n                                  <div className=\"text-lg font-bold\">{(match.summary.potentialLoss / 100).toFixed(0)}</div>\n                                  <div className=\"text-xs text-muted-foreground\">Potential Loss</div>\n                                </div>\n                              </div>\n\n                              {/* Team-wise Betting Analysis */}\n                              <div className=\"grid md:grid-cols-2 gap-6\">\n                                {/* Team A Analysis */}\n                                <Card className=\"border-primary/20\">\n                                  <CardHeader className=\"pb-3\">\n                                    <div className=\"flex items-center justify-between\">\n                                      <CardTitle className=\"text-base\">{match.matchInfo.teamA}</CardTitle>\n                                      <Badge variant=\"outline\" className=\"text-xs\">\n                                        Odds: {(match.matchInfo.oddTeamA / 100).toFixed(2)}x\n                                      </Badge>\n                                    </div>\n                                  </CardHeader>\n                                  <CardContent className=\"space-y-3\">\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Active Bets:</span>\n                                      <span className=\"font-medium\">{match.teamAStats.totalBets}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Total Amount:</span>\n                                      <span className=\"font-medium\">{(match.teamAStats.totalAmount / 100).toFixed(0)}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Potential Payout:</span>\n                                      <span className=\"font-bold text-red-600\">{(match.teamAStats.potentialPayout / 100).toFixed(0)}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Unique Players:</span>\n                                      <span className=\"font-medium\">{match.teamAStats.users.length}</span>\n                                    </div>\n                                    {match.teamAStats.users.length > 0 && (\n                                      <div className=\"mt-3\">\n                                        <span className=\"text-xs text-muted-foreground\">Players:</span>\n                                        <div className=\"flex flex-wrap gap-1 mt-1\">\n                                          {match.teamAStats.users.slice(0, 3).map((userId: number) => (\n                                            <Badge key={userId} variant=\"secondary\" className=\"text-xs\">\n                                              {userInfo[userId]?.username || `User ${userId}`}\n                                            </Badge>\n                                          ))}\n                                          {match.teamAStats.users.length > 3 && (\n                                            <Badge variant=\"secondary\" className=\"text-xs\">\n                                              +{match.teamAStats.users.length - 3} more\n                                            </Badge>\n                                          )}\n                                        </div>\n                                      </div>\n                                    )}\n                                  </CardContent>\n                                </Card>\n\n                                {/* Team B Analysis */}\n                                <Card className=\"border-secondary/20\">\n                                  <CardHeader className=\"pb-3\">\n                                    <div className=\"flex items-center justify-between\">\n                                      <CardTitle className=\"text-base\">{match.matchInfo.teamB}</CardTitle>\n                                      <Badge variant=\"outline\" className=\"text-xs\">\n                                        Odds: {(match.matchInfo.oddTeamB / 100).toFixed(2)}x\n                                      </Badge>\n                                    </div>\n                                  </CardHeader>\n                                  <CardContent className=\"space-y-3\">\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Active Bets:</span>\n                                      <span className=\"font-medium\">{match.teamBStats.totalBets}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Total Amount:</span>\n                                      <span className=\"font-medium\">{(match.teamBStats.totalAmount / 100).toFixed(0)}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Potential Payout:</span>\n                                      <span className=\"font-bold text-red-600\">{(match.teamBStats.potentialPayout / 100).toFixed(0)}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center\">\n                                      <span className=\"text-sm text-muted-foreground\">Unique Players:</span>\n                                      <span className=\"font-medium\">{match.teamBStats.users.length}</span>\n                                    </div>\n                                    {match.teamBStats.users.length > 0 && (\n                                      <div className=\"mt-3\">\n                                        <span className=\"text-xs text-muted-foreground\">Players:</span>\n                                        <div className=\"flex flex-wrap gap-1 mt-1\">\n                                          {match.teamBStats.users.slice(0, 3).map((userId: number) => (\n                                            <Badge key={userId} variant=\"secondary\" className=\"text-xs\">\n                                              {userInfo[userId]?.username || `User ${userId}`}\n                                            </Badge>\n                                          ))}\n                                          {match.teamBStats.users.length > 3 && (\n                                            <Badge variant=\"secondary\" className=\"text-xs\">\n                                              +{match.teamBStats.users.length - 3} more\n                                            </Badge>\n                                          )}\n                                        </div>\n                                      </div>\n                                    )}\n                                  </CardContent>\n                                </Card>\n                              </div>\n                            </CardContent>\n                          </Card>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-8\">\n                        <Activity className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                        <h3 className=\"text-lg font-medium mb-2\">No Active Cricket Matches</h3>\n                        <p className=\"text-muted-foreground\">\n                          There are currently no cricket toss matches with active bets in the system.\n                        </p>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            ) : (\n              <Card>\n                <CardHeader>\n                  <CardTitle>Cricket Toss Risk Analysis</CardTitle>\n                  <CardDescription>No cricket toss games data available</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <p>There are currently no active cricket toss games in the system.</p>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":66430,"size_tokens":null},"generate-hash.js":{"content":"/**\n * This script generates a crypto.scrypt hash for a given password.\n * Useful for manually creating passwords in the new format.\n */\n\nimport crypto from 'crypto';\nimport { promisify } from 'util';\n\n// Promisify the scrypt function\nconst scryptAsync = promisify(crypto.scrypt);\n\n// Function to hash password with crypto.scrypt\nasync function hashPassword(password) {\n  const salt = crypto.randomBytes(16).toString('hex');\n  const buf = await scryptAsync(password, salt, 64);\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nasync function generateHash() {\n  // You can change this password to whatever you need\n  const password = \"password123\";\n  \n  try {\n    const hash = await hashPassword(password);\n    console.log(`\\nPassword: ${password}`);\n    console.log(`Hash: ${hash}`);\n    console.log(`\\nThis hash can be stored directly in the database.`);\n  } catch (error) {\n    console.error('Error generating hash:', error);\n  }\n}\n\n// Run the function\ngenerateHash();","path":null,"size_bytes":967,"size_tokens":null},"fix-pending-bets.js":{"content":"/**\n * Simple script to fix pending bets for the current market\n */\n\nconst { Pool } = require('pg');\nrequire('dotenv').config();\n\nasync function fixPendingBets() {\n  // Connect to database\n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n    ssl: {\n      rejectUnauthorized: false\n    }\n  });\n  \n  try {\n    // Get the market ID from command line or use default 5\n    const marketId = process.argv[2] || 5;\n    console.log(`Processing pending bets for market ID ${marketId}...`);\n    \n    // Get market information\n    const marketResult = await pool.query(\n      'SELECT * FROM satamatka_markets WHERE id = $1',\n      [marketId]\n    );\n    \n    if (marketResult.rows.length === 0) {\n      console.error(`Market with ID ${marketId} not found`);\n      return;\n    }\n    \n    const market = marketResult.rows[0];\n    console.log(`Market: ${market.name}, Close result: ${market.close_result}`);\n    \n    if (!market.close_result) {\n      console.error(`Market ${marketId} does not have a close result`);\n      return;\n    }\n    \n    // Find all pending games for this market\n    const pendingGames = await pool.query(\n      'SELECT * FROM games WHERE market_id = $1 AND result = $2',\n      [marketId, 'pending']\n    );\n    \n    console.log(`Found ${pendingGames.rows.length} pending games`);\n    \n    // Process each game\n    for (const game of pendingGames.rows) {\n      console.log(`Processing game ${game.id}, mode: ${game.game_mode}, prediction: ${game.prediction}`);\n      \n      let isWinner = false;\n      let payout = 0;\n      \n      // Get odds for this game type\n      const gameTypeMap = {\n        'jodi': 'satamatka_jodi',\n        'harf': 'satamatka_harf',\n        'crossing': 'satamatka_crossing',\n        'odd_even': 'satamatka_odd_even'\n      };\n      \n      const gameType = gameTypeMap[game.game_mode];\n      if (!gameType) {\n        console.log(`Unknown game mode: ${game.game_mode}`);\n        continue;\n      }\n      \n      const oddsResult = await pool.query(\n        'SELECT * FROM game_odds WHERE game_type = $1 AND set_by_admin = true',\n        [gameType]\n      );\n      \n      // Default odds if not configured\n      let oddValue = 0;\n      switch (game.game_mode) {\n        case 'jodi': oddValue = 900000; break; // 90x\n        case 'harf': oddValue = 90000; break;  // 9x\n        case 'crossing': oddValue = 900000; break; // 90x\n        case 'odd_even': oddValue = 19000; break; // 1.9x\n      }\n      \n      // Use configured odds if available\n      if (oddsResult.rows.length > 0) {\n        oddValue = oddsResult.rows[0].odd_value;\n      }\n      \n      console.log(`Using odds: ${oddValue/10000}x`);\n      \n      // Check if this is a winning bet based on game mode\n      if (game.game_mode === 'jodi') {\n        // Jodi: exact match with close result\n        isWinner = (game.prediction === market.close_result);\n      }\n      else if (game.game_mode === 'harf') {\n        // Harf: digit matches position\n        const firstDigit = market.close_result[0]; \n        const secondDigit = market.close_result[1];\n        \n        // Handle different prediction formats\n        let harfDigit = game.prediction;\n        let isLeftDigit = false;\n        let isRightDigit = false;\n        \n        if (game.prediction.startsWith('A') || game.prediction.startsWith('L')) {\n          harfDigit = game.prediction.substring(1);\n          isLeftDigit = true;\n        } else if (game.prediction.startsWith('B') || game.prediction.startsWith('R')) {\n          harfDigit = game.prediction.substring(1);\n          isRightDigit = true;\n        }\n        \n        if ((isLeftDigit && harfDigit === firstDigit) || \n            (isRightDigit && harfDigit === secondDigit) ||\n            (!isLeftDigit && !isRightDigit && (game.prediction === firstDigit || game.prediction === secondDigit))) {\n          isWinner = true;\n        }\n      }\n      else if (game.game_mode === 'crossing') {\n        // For crossing, we check if the prediction EXACTLY matches the result\n        // This is what the client wants - only exact matches win\n        isWinner = (game.prediction === market.close_result);\n        \n        // If not exact match, generate crossing combinations and check\n        if (!isWinner) {\n          // Parse digits from prediction\n          let digits = [];\n          if (game.prediction.includes(',')) {\n            // Format: \"0,1,2\"\n            digits = game.prediction.replace(/[^0-9,]/g, '').split(',').map(d => d.trim());\n          } else {\n            // Format: \"012\" or other formats without commas\n            digits = game.prediction.replace(/[^0-9]/g, '').split('');\n          }\n          \n          // Generate crossing combinations\n          const combinations = [];\n          for (let i = 0; i < digits.length; i++) {\n            for (let j = 0; j < digits.length; j++) {\n              if (i !== j) {\n                combinations.push(digits[i] + digits[j]);\n              }\n            }\n          }\n          \n          console.log(`  Crossing combinations: ${combinations.join(',')}`);\n          \n          // Check if the result is in the combinations - MUST MATCH EXACTLY\n          isWinner = combinations.includes(market.close_result);\n        }\n      }\n      else if (game.game_mode === 'odd_even') {\n        // For Odd-Even, check if prediction matches result's parity\n        const resultNum = parseInt(market.close_result, 10);\n        const isOdd = resultNum % 2 !== 0;\n        \n        if ((isOdd && game.prediction === 'odd') || (!isOdd && game.prediction === 'even')) {\n          isWinner = true;\n        }\n      }\n      \n      // Calculate payout for winners\n      if (isWinner) {\n        payout = Math.round(game.bet_amount * (oddValue / 10000));\n      }\n      \n      // Update game status\n      const gameStatus = isWinner ? 'win' : 'loss';\n      await pool.query(\n        'UPDATE games SET result = $1, payout = $2 WHERE id = $3',\n        [gameStatus, payout, game.id]\n      );\n      \n      console.log(`  Updated game ${game.id} to ${gameStatus}, payout: ${payout/100} rupees`);\n      \n      // If winner, update user balance\n      if (isWinner) {\n        const userResult = await pool.query(\n          'SELECT * FROM users WHERE id = $1',\n          [game.user_id]\n        );\n        \n        if (userResult.rows.length > 0) {\n          const user = userResult.rows[0];\n          const newBalance = user.balance + payout;\n          \n          await pool.query(\n            'UPDATE users SET balance = $1 WHERE id = $2',\n            [newBalance, user.id]\n          );\n          \n          console.log(`  Updated user ${user.username} balance: ${user.balance/100}  ${newBalance/100} rupees`);\n        }\n      }\n    }\n    \n    console.log('Finished processing pending bets!');\n  } catch (err) {\n    console.error('Error:', err);\n  } finally {\n    pool.end();\n  }\n}\n\nfixPendingBets();","path":null,"size_bytes":6857,"size_tokens":null},"fix-crossing-bets.ts":{"content":"/**\n * This script fixes the crossing bets for a specific Satamatka market\n * It reprocesses the results for crossing bets that should be wins\n */\n\nimport { db } from './server/db';\nimport { eq, and } from 'drizzle-orm';\nimport { games, SatamatkaGameMode } from './shared/schema';\nimport { storage } from './server/storage';\n\nasync function fixCrossingBets() {\n  try {\n    console.log('Starting to fix crossing bets...');\n    \n    // Market ID to fix (change this to the specific market ID you want to fix)\n    const marketId = 4;\n    \n    // Get market details\n    const market = await storage.getSatamatkaMarket(marketId);\n    if (!market) {\n      console.error(`Market with ID ${marketId} not found`);\n      return;\n    }\n    \n    console.log(`Processing market: ${market.name} (ID: ${marketId})`);\n    console.log(`Result: ${market.closeResult}`);\n    \n    if (!market.closeResult) {\n      console.error('Market does not have a close result set');\n      return;\n    }\n    \n    // Get all crossing games for this market\n    const crossingGames = await db.select()\n      .from(games)\n      .where(\n        and(\n          eq(games.marketId, marketId),\n          eq(games.gameMode, SatamatkaGameMode.CROSSING)\n        )\n      );\n    \n    console.log(`Found ${crossingGames.length} crossing games to check`);\n    \n    // Process each game to check if it should be a win\n    for (const game of crossingGames) {\n      // For Crossing, check if the prediction matches the result in any order\n      const digits = game.prediction.replace(/[^0-9,]/g, '').split(',');\n      \n      // Extract all possible crossing combinations from the digits\n      const crossingCombinations = [];\n      for (let i = 0; i < digits.length; i++) {\n        for (let j = 0; j < digits.length; j++) {\n          if (i !== j) {\n            crossingCombinations.push(digits[i] + digits[j]);\n          }\n        }\n      }\n      \n      // Check both normal and reverse ordering of the result\n      const resultToCheck = market.closeResult;\n      const reverseResult = resultToCheck.length === 2 ? resultToCheck[1] + resultToCheck[0] : resultToCheck;\n      \n      // Determine if this should be a win\n      const shouldBeWin = crossingCombinations.includes(resultToCheck) || crossingCombinations.includes(reverseResult);\n      \n      console.log(`Game ID: ${game.id}, Prediction: ${game.prediction}, Combinations: ${JSON.stringify(crossingCombinations)}`);\n      console.log(`  Result: ${resultToCheck} (or ${reverseResult}), Should be win: ${shouldBeWin}, Current result: ${game.result}`);\n      \n      // If the game should be a win but is marked as loss, update it\n      if (shouldBeWin && game.result === 'loss') {\n        console.log(`  FIXING: Game ID ${game.id} should be a win`);\n        \n        // Get appropriate odds \n        let gameTypeOdds = await db.select()\n          .from('game_odds')\n          .where(\n            and(\n              eq('game_odds.gameType', 'satamatka_crossing'),\n              eq('game_odds.setByAdmin', true)\n            )\n          );\n        \n        let oddValue = gameTypeOdds.length > 0 ? gameTypeOdds[0].oddValue : 950000; // Default to 95x if not found\n        \n        // Calculate payout (betAmount is stored in paisa)\n        const payout = Math.round(game.betAmount * (oddValue / 10000));\n        \n        // Update the game result to win and set payout\n        const [updatedGame] = await db.update(games)\n          .set({ result: 'win', payout })\n          .where(eq(games.id, game.id))\n          .returning();\n        \n        // Now update the user's balance to add the payout amount\n        const user = await storage.getUser(game.userId);\n        if (user) {\n          const newBalance = user.balance + payout;\n          await storage.updateUserBalance(user.id, newBalance);\n          console.log(`  Updated user ${user.username} balance: ${user.balance/100}  ${newBalance/100} (+${payout/100})`);\n        }\n        \n        console.log(`   Fixed game ID ${game.id}: Changed to win, Payout: ${payout/100}`);\n      }\n    }\n    \n    console.log('Completed fixing crossing bets!');\n  } catch (error) {\n    console.error('Error fixing crossing bets:', error);\n  }\n}\n\nfixCrossingBets().catch(err => console.error('Error:', err));","path":null,"size_bytes":4252,"size_tokens":null},"reset-dashboard-stats.js":{"content":"/**\n * This script resets all data related to admin dashboard statistics:\n * - Removes all transaction records\n * - Resets admin balance to 0\n * - Clears all game data\n * \n * Use this for testing dashboard statistics calculation logic\n */\n\nimport pg from 'pg';\nconst { Pool } = pg;\n\nasync function resetDashboardStats() {\n  // Connect to database\n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL\n  });\n\n  try {\n    console.log('Connected to database. Starting reset process...');\n    \n    // Start a transaction\n    const client = await pool.connect();\n    \n    try {\n      await client.query('BEGIN');\n      \n      // 1. Clear all transactions\n      console.log('Removing all transaction records...');\n      await client.query('DELETE FROM transactions');\n      \n      // 2. Reset admin balance to 0\n      console.log('Resetting admin balance to 0...');\n      await client.query('UPDATE users SET balance = 0 WHERE role = \\'admin\\'');\n      \n      // 3. Remove all games\n      console.log('Removing all game records...');\n      await client.query('DELETE FROM games');\n      \n      // 4. Also reset the balances of all subadmins\n      console.log('Resetting subadmin balances to 0...');\n      await client.query('UPDATE users SET balance = 0 WHERE role = \\'subadmin\\'');\n      \n      await client.query('COMMIT');\n      console.log('Dashboard statistics data reset complete!');\n    } catch (err) {\n      await client.query('ROLLBACK');\n      console.error('Error during reset process:', err);\n      throw err;\n    } finally {\n      client.release();\n    }\n  } catch (err) {\n    console.error('Database connection error:', err);\n  } finally {\n    await pool.end();\n  }\n}\n\n// Execute the reset function\nresetDashboardStats().catch(err => {\n  console.error('Failed to reset dashboard statistics:', err);\n  process.exit(1);\n});","path":null,"size_bytes":1848,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5046,"size_tokens":null},"client/src/components/coin-flip-game.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { GameOutcome } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { formatCurrency, formatProfitLoss } from \"@/lib/format-utils\";\nimport { \n  playCoinFlipSound, \n  playWinSound, \n  initAudio, \n  toggleMute, \n  isSoundMuted \n} from \"@/lib/sound-utils\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { \n  Card, \n  CardContent, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { \n  ChevronsUp, \n  ChevronsDown, \n  IndianRupee, \n  Trophy, \n  X, \n  History, \n  Volume2, \n  VolumeX \n} from \"lucide-react\";\n\n// Game history type to use in the component\ninterface GameHistory {\n  id: number;\n  userId: number;\n  gameType: string;\n  betAmount: number;\n  prediction: string;\n  result: string;\n  payout: number;\n  createdAt: string;\n}\n\nexport default function CoinFlipGame() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [betAmount, setBetAmount] = useState(10);\n  const [selectedPrediction, setSelectedPrediction] = useState<string | null>(null);\n  const [isFlipping, setIsFlipping] = useState(false);\n  const [result, setResult] = useState<string | null>(null);\n  const [showWinPopup, setShowWinPopup] = useState(false);\n  const [showLosePopup, setShowLosePopup] = useState(false);\n  const [walletUpdating, setWalletUpdating] = useState(false);\n  const [muted, setMuted] = useState(isSoundMuted());\n  const [gameOdds, setGameOdds] = useState(0);\n  const [lastResult, setLastResult] = useState<{\n    isWin: boolean;\n    amount: number;\n    prediction: string;\n    result: string;\n  } | null>(null);\n  const coinRef = useRef<HTMLDivElement>(null);\n  \n  // Fetch the game odds for Coin Flip\n  const { data: coinFlipOddsData } = useQuery<any>({\n    queryKey: ['/api/game-odds/player', 'coin_flip', user?.id],\n    queryFn: async () => {\n      try {\n        const response = await apiRequest(\"GET\", `/api/game-odds/player?gameType=coin_flip`)\n          .then(res => res.json())\n          .catch(err => {\n            console.error(\"Error fetching coin flip odds:\", err);\n            return null;\n          });\n        \n        console.log(\"Coin flip odds from API:\", response);\n        return response;\n      } catch (error) {\n        console.error(\"Failed to fetch coin flip odds:\", error);\n        return null;\n      }\n    },\n    enabled: !!user\n  });\n  \n  // Update game odds when they load\n  useEffect(() => {\n    if (coinFlipOddsData && coinFlipOddsData.length > 0) {\n      // The odds are stored as integer with multiplier * 10000\n      // For example, 1.95x is stored as 19500\n      const odds = coinFlipOddsData[0]?.oddValue / 10000;\n      console.log(\"Using coin flip odds:\", odds);\n      setGameOdds(odds || 1.95); // Default to 1.95 if no odds are set\n    }\n  }, [coinFlipOddsData]);\n  \n  // Fetch recent games for the user, filtered by coin_flip game type\n  const { data: games = [] } = useQuery<GameHistory[]>({\n    queryKey: [\"/api/games/my-history\"],\n    enabled: !!user,\n  });\n\n  // Play game mutation\n  const playGameMutation = useMutation({\n    mutationFn: async ({ betAmount, prediction }: { betAmount: number; prediction: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/games/play\", {\n        betAmount: betAmount * 100, // Convert to cents\n        prediction,\n      });\n      return await res.json();\n    },\n    onSuccess: (data) => {\n      // Store the result to trigger animation, but don't update wallet yet\n      setResult(data.game.result);\n      \n      // Indicate wallet update is pending until after the animation completes\n      setWalletUpdating(true);\n      \n      // First let the coin flip for a while (1.4 seconds) without showing result\n      // Then slow down to show the result (0.6 seconds)\n      // Then stop, update wallet, and show popup\n      \n      // Wait for the coin flip animation to complete (2 seconds)\n      setTimeout(() => {\n        // Set flipping to false (stop spinning)\n        setIsFlipping(false);\n        \n        // Prepare result data\n        const isWin = data.game.payout > 0;\n        \n        // Only play win sound if the player wins\n        // No sound for losses as requested\n        if (isWin) {\n          playWinSound();\n        }\n        \n        // For win popup, display the amount won using the odds from server\n        // If win, multiply by odds from the server, otherwise just show the bet amount\n        const actualOdds = gameOdds > 0 ? gameOdds : 1.95; // Use default 1.95 if odds not loaded\n        console.log(`Win calculation: isWin=${isWin}, betAmount=${betAmount}, odds=${actualOdds}`);\n        const winAmount = isWin ? betAmount * actualOdds : betAmount;\n        \n        setLastResult({\n          isWin,\n          amount: winAmount,  // Use the direct bet amount value (already in rupees)\n          prediction: selectedPrediction!,\n          result: data.game.result\n        });\n        \n        // IMPORTANT: Update user data in cache AFTER animation completes\n        // This ensures the wallet balance updates only after user sees the result\n        queryClient.setQueryData([\"/api/user\"], data.user);\n        \n        // Invalidate game history query to refresh the last results display\n        queryClient.invalidateQueries({ queryKey: [\"/api/games/my-history\"] });\n        \n        setWalletUpdating(false);\n        \n        // Show appropriate popup after a slight delay\n        // This gives user time to see the final result before showing popup\n        setTimeout(() => {\n          if (isWin) {\n            setShowWinPopup(true);\n          } else {\n            setShowLosePopup(true);\n          }\n        }, 600); // Add a small delay after animation stops\n      }, 2000); // 2 seconds for coin flip animation\n    },\n    onError: (error: Error) => {\n      setIsFlipping(false);\n      setWalletUpdating(false);\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleBetAmountChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = parseInt(e.target.value);\n    if (isNaN(value) || value <= 0) {\n      setBetAmount(0);\n    } else {\n      setBetAmount(value);\n    }\n  };\n\n  // Set bet amount with values that match display (10, 50, 100)\n  const handleQuickAmount = (amount: number) => {\n    setBetAmount(amount);\n  };\n\n  const handleMaxAmount = () => {\n    setBetAmount(Math.floor((user?.balance || 0) / 100));\n  };\n\n  const selectPrediction = (prediction: string) => {\n    setSelectedPrediction(prediction);\n  };\n\n  const handlePlayAgain = () => {\n    // Reset game state for a new game\n    setShowWinPopup(false);\n    setShowLosePopup(false);\n    setSelectedPrediction(null);\n    setResult(null);\n    setWalletUpdating(false); // Ensure wallet updating state is reset\n  };\n  \n  const handleToggleMute = () => {\n    // Toggle the mute state in the sound utility\n    const newMuteState = toggleMute();\n    setMuted(newMuteState);\n    \n    // Initialize audio context (this is needed for the first toggle)\n    initAudio();\n    \n    // Show toast notification about sound state\n    toast({\n      title: newMuteState ? \"Sound Off\" : \"Sound On\",\n      description: newMuteState ? \"Game sounds have been muted\" : \"Game sounds have been enabled\",\n    });\n  };\n\n  const handlePlaceBet = () => {\n    if (!selectedPrediction) {\n      toast({\n        title: \"Select a prediction\",\n        description: \"Please select Heads or Tails first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (betAmount <= 0) {\n      toast({\n        title: \"Invalid bet amount\",\n        description: \"Please enter a valid bet amount\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const betAmountInCents = betAmount * 100;\n    if (betAmountInCents > (user?.balance || 0)) {\n      toast({\n        title: \"Insufficient balance\",\n        description: \"You don't have enough balance for this bet\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Initialize audio context (must be called after user interaction)\n    initAudio();\n    \n    // Play coin flip sound\n    playCoinFlipSound();\n    \n    // Start animation and play game\n    setIsFlipping(true);\n    setResult(null);\n    setWalletUpdating(true); // Set wallet updating state when placing bet\n    \n    playGameMutation.mutate({\n      betAmount,\n      prediction: selectedPrediction,\n    });\n  };\n\n  return (\n    <Card className=\"bg-card rounded-xl shadow-xl border border-border mb-8 relative overflow-hidden\">\n      <CardHeader className=\"relative\">\n        {/* Mute/Unmute button in top-right corner */}\n        <Button \n          variant=\"ghost\" \n          size=\"icon\" \n          className=\"absolute top-2 right-2 h-8 w-8 rounded-full bg-background/40 hover:bg-background/60 border border-border\"\n          onClick={handleToggleMute}\n          title={muted ? \"Unmute sounds\" : \"Mute sounds\"}\n        >\n          {muted ? (\n            <VolumeX className=\"h-4 w-4 text-muted-foreground\" />\n          ) : (\n            <Volume2 className=\"h-4 w-4 text-primary\" />\n          )}\n        </Button>\n        \n        <CardTitle className=\"text-xl font-bold text-center\">\n          <span className=\"text-primary\">King</span>\n          <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-primary\">Games</span>\n          <span className=\"ml-2\">Royal Toss</span>\n        </CardTitle>\n      </CardHeader>\n      \n      <CardContent className=\"pt-0\">\n        <div className=\"flex flex-col lg:flex-row lg:items-center lg:gap-6\">\n          {/* Game Area */}\n          <div className=\"flex-1 flex flex-col md:flex-row items-center justify-center gap-5 mb-5 lg:mb-0\">\n            <div className=\"flex flex-col items-center\">\n              <motion.div \n                className=\"relative w-32 h-32 sm:w-36 sm:h-36 perspective-1000 mb-3\"\n                style={{ perspective: \"1000px\" }}\n              >\n                <motion.div\n                  ref={coinRef}\n                  className=\"w-full h-full relative transform-style-3d\"\n                  animate={{\n                    rotateY: isFlipping \n                      ? [0, 1080, result === GameOutcome.HEADS ? 1440 : 1530]  // Start, multiple spins, then result position\n                      : result === GameOutcome.HEADS\n                        ? 0     // Keep showing heads after animation\n                        : result === GameOutcome.TAILS\n                          ? 180 // Keep showing tails after animation\n                          : 0,  // Default position\n                  }}\n                  transition={{\n                    duration: isFlipping ? 2 : 0,\n                    ease: \"easeOut\",\n                    times: isFlipping ? [0, 0.7, 1] : [0, 1],  // Control timing of animation segments\n                  }}\n                  style={{ transformStyle: \"preserve-3d\" }}\n                >\n                  {/* Heads Side */}\n                  <div \n                    className=\"absolute w-full h-full rounded-full flex items-center justify-center backface-hidden\"\n                    style={{ backfaceVisibility: \"hidden\" }}\n                  >\n                    <img \n                      src=\"/images/heads.png\" \n                      alt=\"Heads\" \n                      className=\"w-full h-full object-contain\"\n                    />\n                  </div>\n                  {/* Tails Side */}\n                  <div \n                    className=\"absolute w-full h-full rounded-full flex items-center justify-center backface-hidden\"\n                    style={{ backfaceVisibility: \"hidden\", transform: \"rotateY(180deg)\" }}\n                  >\n                    <img \n                      src=\"/images/tails.png\" \n                      alt=\"Tails\" \n                      className=\"w-full h-full object-contain\"\n                    />\n                  </div>\n                </motion.div>\n              </motion.div>\n              \n              {/* Display message during wallet update */}\n              {!isFlipping && walletUpdating && (\n                <div className=\"text-center text-xs text-primary mt-2 flex items-center justify-center\">\n                  <span className=\"animate-pulse\">Updating wallet...</span>\n                </div>\n              )}\n            </div>\n            \n            <div className=\"text-center\">\n              <p className=\"text-muted-foreground mb-2 text-sm\">Select your prediction:</p>\n              <div className=\"grid grid-cols-2 gap-2 sm:flex sm:flex-row sm:justify-center sm:space-x-3\">\n                <Button\n                  onClick={() => selectPrediction(GameOutcome.HEADS)}\n                  className={`px-4 py-3 relative ${\n                    selectedPrediction === GameOutcome.HEADS\n                      ? \"bg-primary hover:bg-primary/90 ring-2 ring-primary/30 ring-offset-2 ring-offset-background\"\n                      : \"bg-primary/70 hover:bg-primary/80\"\n                  } text-white font-bold rounded-lg transition-all`}\n                  disabled={isFlipping}\n                >\n                  {selectedPrediction === GameOutcome.HEADS && (\n                    <div className=\"absolute -top-1 -right-1 bg-white text-primary text-xs font-bold rounded-full p-1 w-5 h-5 flex items-center justify-center\">\n                      \n                    </div>\n                  )}\n                  <span className=\"text-sm sm:text-base\">HEADS</span>\n                </Button>\n                <Button\n                  onClick={() => selectPrediction(GameOutcome.TAILS)}\n                  className={`px-4 py-3 relative ${\n                    selectedPrediction === GameOutcome.TAILS\n                      ? \"bg-purple-600 hover:bg-purple-700 ring-2 ring-purple-400 ring-offset-2 ring-offset-background\"\n                      : \"bg-purple-600/70 hover:bg-purple-600\"\n                  } text-white font-bold rounded-lg transition-all`}\n                  disabled={isFlipping}\n                >\n                  {selectedPrediction === GameOutcome.TAILS && (\n                    <div className=\"absolute -top-1 -right-1 bg-white text-purple-600 text-xs font-bold rounded-full p-1 w-5 h-5 flex items-center justify-center\">\n                      \n                    </div>\n                  )}\n                  <span className=\"text-sm sm:text-base\">TAILS</span>\n                </Button>\n              </div>\n              \n              {/* Last 6 Results */}\n              <div className=\"mt-4\">\n                <div className=\"flex items-center justify-center gap-1 mb-2\">\n                  <History className=\"h-4 w-4 text-muted-foreground\" />\n                  <p className=\"text-xs text-muted-foreground\">Last Results</p>\n                </div>\n                <div className=\"flex justify-center space-x-2\">\n                  {games\n                    .filter(game => game.gameType === \"coin_flip\")\n                    .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()) // Sort newest first\n                    .slice(0, 6)\n                    .map((game, index) => (\n                      <div \n                        key={game.id}\n                        className={`w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold ${\n                          game.result === GameOutcome.HEADS \n                            ? \"bg-primary text-white\" \n                            : \"bg-purple-600 text-white\"\n                        } ${game.payout > 0 ? 'ring-2 ring-green-500 ring-offset-1 ring-offset-background' : 'ring-1 ring-red-500/30'}`}\n                        title={`${game.result} (${game.payout > 0 ? 'Win' : 'Loss'})`}\n                      >\n                        {game.result === GameOutcome.HEADS ? 'H' : 'T'}\n                      </div>\n                    ))\n                  }\n                  {games.filter(game => game.gameType === \"coin_flip\").length === 0 && (\n                    <div className=\"text-xs text-muted-foreground\">No previous results</div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          {/* Bet Settings */}\n          <div className=\"lg:w-72 bg-card/50 border border-border rounded-lg p-3\">\n            <h3 className=\"text-base font-medium mb-2 pb-1 border-b border-border flex items-center\">\n              <IndianRupee className=\"h-4 w-4 mr-1\" />\n              <span>Bet Settings</span>\n            </h3>\n            \n            <div className=\"mb-3\">\n              <div className=\"flex items-center mb-1\">\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={() => setBetAmount(Math.max(1, betAmount - 1))}\n                  disabled={betAmount <= 1 || isFlipping}\n                  className=\"px-2 h-8 rounded-r-none\"\n                >\n                  <ChevronsDown className=\"h-3 w-3\" />\n                </Button>\n                <div className=\"relative flex-1\">\n                  <div className=\"absolute left-2 top-1/2 transform -translate-y-1/2 text-muted-foreground text-sm\">\n                    \n                  </div>\n                  <Input\n                    type=\"number\"\n                    value={betAmount}\n                    onChange={handleBetAmountChange}\n                    className=\"text-center h-8 rounded-none border-x-0 pl-5 text-sm\"\n                    disabled={isFlipping}\n                    min={1}\n                  />\n                </div>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={() => setBetAmount(betAmount + 1)}\n                  disabled={betAmount * 100 >= (user?.balance || 0) - 100 || isFlipping}\n                  className=\"px-2 h-8 rounded-l-none\"\n                >\n                  <ChevronsUp className=\"h-3 w-3\" />\n                </Button>\n              </div>\n              <div className=\"grid grid-cols-4 gap-1\">\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={() => handleQuickAmount(10)}\n                  disabled={isFlipping || 1000 > (user?.balance || 0)}\n                  className=\"text-xs h-7\"\n                >\n                  10\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={() => handleQuickAmount(50)}\n                  disabled={isFlipping || 5000 > (user?.balance || 0)}\n                  className=\"text-xs h-7\"\n                >\n                  50\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={() => handleQuickAmount(100)}\n                  disabled={isFlipping || 10000 > (user?.balance || 0)}\n                  className=\"text-xs h-7\"\n                >\n                  100\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleMaxAmount}\n                  disabled={isFlipping || (user?.balance || 0) <= 0}\n                  className=\"text-xs h-7\"\n                >\n                  MAX\n                </Button>\n              </div>\n            </div>\n            \n            <div className=\"mb-3\">\n              <div className=\"flex items-center justify-between text-sm mb-1\">\n                <span className=\"text-muted-foreground flex items-center\">\n                  <Trophy className=\"h-3 w-3 mr-1\" />\n                  Potential Win:\n                </span>\n                <div className=\"flex items-center text-green-500 font-medium\">\n                  {/* Use game odds from the server instead of hardcoded value */}\n                  {(betAmount * (gameOdds > 0 ? gameOdds : 1.95)).toFixed(2)}\n                  <span className=\"text-xs text-muted-foreground ml-1\">\n                    ({(gameOdds > 0 ? gameOdds : 1.95).toFixed(2)}x)\n                  </span>\n                </div>\n              </div>\n            </div>\n            \n            <Button\n              onClick={handlePlaceBet}\n              className=\"w-full px-4 py-4 bg-gradient-to-r from-primary/90 to-purple-600 hover:from-primary hover:to-purple-700 text-white font-bold text-center transition-colors\"\n              disabled={isFlipping || !selectedPrediction || betAmount <= 0 || betAmount * 100 > (user?.balance || 0)}\n            >\n              {isFlipping ? \"Flipping...\" : \"PLACE BET\"}\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n\n      {/* Win Popup */}\n      <AnimatePresence>\n        {showWinPopup && lastResult && (\n          <motion.div \n            className=\"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n          >\n            <motion.div \n              className=\"bg-card p-6 rounded-lg border border-primary shadow-xl max-w-md w-full mx-4\"\n              initial={{ scale: 0.8, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.8, opacity: 0 }}\n              transition={{ type: \"spring\", damping: 15 }}\n            >\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-xl font-bold text-white\">You Won!</h3>\n                <Button \n                  variant=\"ghost\" \n                  size=\"icon\" \n                  className=\"rounded-full\" \n                  onClick={() => setShowWinPopup(false)}\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n              \n              <div className=\"my-5 text-center\">\n                <div className=\"flex items-center justify-center mb-3\">\n                  <Trophy className=\"h-12 w-12 text-amber-500 mr-2\" />\n                  <div className=\"flex items-center text-3xl font-bold text-green-500\">\n                    {lastResult.amount}\n                  </div>\n                </div>\n                \n                <p className=\"text-slate-300 mb-4\">\n                  Your prediction was <strong className=\"text-primary\">{lastResult.prediction}</strong> and the result was <strong className=\"text-primary\">{lastResult.result}</strong>\n                </p>\n              </div>\n              \n              <Button \n                className=\"w-full bg-gradient-to-r from-primary/90 to-purple-600 hover:from-primary hover:to-purple-700 mt-2 py-6 text-lg\"\n                onClick={handlePlayAgain}\n              >\n                Play Again\n              </Button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Lose Popup */}\n      <AnimatePresence>\n        {showLosePopup && lastResult && (\n          <motion.div \n            className=\"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n          >\n            <motion.div \n              className=\"bg-card p-6 rounded-lg border border-purple-600 shadow-xl max-w-md w-full mx-4\"\n              initial={{ scale: 0.8, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.8, opacity: 0 }}\n              transition={{ type: \"spring\", damping: 15 }}\n            >\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-xl font-bold text-white\">You Lost!</h3>\n                <Button \n                  variant=\"ghost\" \n                  size=\"icon\" \n                  className=\"rounded-full\" \n                  onClick={() => setShowLosePopup(false)}\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n              \n              <div className=\"my-5 text-center\">\n                <div className=\"flex items-center justify-center mb-3\">\n                  <div className=\"flex items-center text-2xl font-bold text-red-500\">\n                    <span>- </span>\n                    {betAmount}\n                  </div>\n                </div>\n                \n                <p className=\"text-slate-300 mb-4\">\n                  Your prediction was <strong className=\"text-purple-400\">{lastResult.prediction}</strong> but the result was <strong className=\"text-purple-400\">{lastResult.result}</strong>\n                </p>\n                <p className=\"text-slate-400\">Better luck next time!</p>\n              </div>\n              \n              <Button \n                className=\"w-full bg-gradient-to-r from-primary/90 to-purple-600 hover:from-primary hover:to-purple-700 mt-2 py-6 text-lg\"\n                onClick={handlePlayAgain}\n              >\n                Try Again\n              </Button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </Card>\n  );\n}\n","path":null,"size_bytes":25399,"size_tokens":null},"fix-storage-errors.ts":{"content":"// This script fixes errors in the storage.ts file\nimport fs from 'fs';\n\nfunction fixStorageErrors() {\n  try {\n    console.log(\"Fixing errors in storage.ts...\");\n    \n    // Read the storage.ts file\n    const storageFile = fs.readFileSync('./server/storage.ts', 'utf8');\n    \n    // Fix error with updateData in the updateTeamMatch function\n    const errorPattern = /async updateTeamMatch\\(id: number, data: Partial<InsertTeamMatch>\\): Promise<TeamMatch \\| undefined> {[^}]*}/gs;\n    const correctImplementation = `async updateTeamMatch(id: number, data: Partial<InsertTeamMatch>): Promise<TeamMatch | undefined> {\n    const [updatedMatch] = await db.update(teamMatches)\n      .set(data)\n      .where(eq(teamMatches.id, id))\n      .returning();\n    \n    return updatedMatch;\n  }`;\n    \n    let updatedFile = storageFile.replace(errorPattern, correctImplementation);\n    \n    // Write the updated file\n    fs.writeFileSync('./server/storage.ts', updatedFile);\n    console.log(\"Fixed errors in storage.ts\");\n    \n  } catch (error) {\n    console.error(\"Error fixing storage.ts:\", error);\n  }\n}\n\nfixStorageErrors();","path":null,"size_bytes":1111,"size_tokens":null},"generate-crypto-password.js":{"content":"import crypto from 'crypto';\nimport { promisify } from 'util';\n\nconst scryptAsync = promisify(crypto.scrypt);\n\nasync function hashPassword(password) {\n  const salt = crypto.randomBytes(16).toString('hex');\n  const buf = await scryptAsync(password, salt, 64);\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nasync function main() {\n  try {\n    const hashedPassword = await hashPassword('admin123');\n    console.log('Hashed Password for admin123:', hashedPassword);\n  } catch (error) {\n    console.error('Error generating password hash:', error);\n  }\n}\n\nmain();","path":null,"size_bytes":557,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"update-admin-password.ts":{"content":"import { db } from \"./server/db\";\nimport { users } from \"./shared/schema\";\nimport { eq } from \"drizzle-orm\";\nimport { scrypt, randomBytes } from \"crypto\";\nimport { promisify } from \"util\";\n\n// Promisify the scrypt function\nconst scryptAsync = promisify(scrypt);\n\n// Function to hash a password with crypto.scrypt\nasync function hashPassword(password: string): Promise<string> {\n  const salt = randomBytes(16).toString('hex');\n  const derivedKey = await scryptAsync(password, salt, 64) as Buffer;\n  return `${derivedKey.toString('hex')}.${salt}`;\n}\n\nasync function updateAdminPassword() {\n  try {\n    console.log('Updating admin user password...');\n    \n    // Hash the password with crypto.scrypt\n    const hashedPassword = await hashPassword('admin123');\n    console.log('Generated new password hash');\n    \n    // Update the admin user's password\n    const result = await db.update(users)\n      .set({ password: hashedPassword })\n      .where(eq(users.username, 'admin'))\n      .returning({ id: users.id, username: users.username });\n    \n    if (result.length === 0) {\n      console.log('Admin user not found');\n    } else {\n      console.log('Updated admin password successfully:', result[0]);\n      console.log('You can now login with:');\n      console.log('Username: admin');\n      console.log('Password: admin123');\n    }\n  } catch (error) {\n    console.error('Error updating admin password:', error);\n  }\n}\n\nupdateAdminPassword();","path":null,"size_bytes":1438,"size_tokens":null},"removed_files/cricket-toss.ts":{"content":"import express, { Request, Response, NextFunction } from 'express';\nimport { storage } from './storage';\nimport { GameType, TeamMatchResult, games } from '@shared/schema';\nimport { z } from 'zod';\nimport { db, pool } from './db';\nimport { eq } from 'drizzle-orm';\n\n// Schema for creating a cricket toss game\nconst createCricketTossSchema = z.object({\n  teamA: z.string().min(2, \"Team A name must be at least 2 characters\"),\n  teamB: z.string().min(2, \"Team B name must be at least 2 characters\"),\n  description: z.string().optional(),\n  tossTime: z.string(),\n  imageUrl: z.string().optional(),\n  openTime: z.string().optional(),\n  closeTime: z.string().optional(),\n});\n\nexport function setupCricketTossRoutes(app: express.Express) {\n  // Change cricket toss game status (open/close)\n  app.patch(\"/api/cricket-toss-games/:id/status\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated() || req.user!.role !== \"admin\") {\n        return res.status(403).json({ message: \"Only admin can change game status\" });\n      }\n\n      const gameId = Number(req.params.id);\n      const { status } = req.body;\n\n      if (!status || ![\"open\", \"closed\"].includes(status)) {\n        return res.status(400).json({ message: \"Status must be 'open' or 'closed'\" });\n      }\n\n      // Get the existing game\n      const game = await storage.getGame(gameId);\n      if (!game) {\n        return res.status(404).json({ message: \"Game not found\" });\n      }\n\n      if (game.gameType !== GameType.CRICKET_TOSS) {\n        return res.status(400).json({ message: \"Game is not a cricket toss game\" });\n      }\n\n      // Update the game data with new status\n      const gameData = typeof game.gameData === 'object' && game.gameData !== null \n        ? { ...game.gameData as any } \n        : {};\n\n      gameData.status = status;\n\n      // Update the game data\n      try {\n        const result = await pool.query(\n          `UPDATE games SET game_data = $1 WHERE id = $2 RETURNING *`,\n          [JSON.stringify(gameData), gameId]\n        );\n\n        if (result.rows.length === 0) {\n          return res.status(404).json({ message: \"Failed to update game status\" });\n        }\n\n        // Return the updated game\n        const updatedGame = await storage.getGame(gameId);\n        res.json(updatedGame);\n      } catch (error) {\n        console.error(\"Error updating game status:\", error);\n        return res.status(500).json({ \n          message: \"Failed to update game status\", \n          error: error instanceof Error ? error.message : String(error) \n        });\n      }\n    } catch (err) {\n      next(err);\n    }\n  });\n  // Get all cricket toss games\n  app.get(\"/api/cricket-toss-games\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const allGames = await storage.getAllGames();\n      const cricketTossGames = allGames.filter(game => \n        game.gameType === GameType.CRICKET_TOSS && \n        game.userId === 1 && // Admin-created games\n        (!game.matchId) // No match ID means it's a standalone cricket toss game\n      );\n      \n      res.json(cricketTossGames);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Update cricket toss game result (admin only)\n  app.patch(\"/api/cricket-toss-games/:id/result\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated() || req.user!.role !== \"admin\") {\n        return res.status(403).json({ message: \"Only admin can declare results\" });\n      }\n      \n      const gameId = Number(req.params.id);\n      const { result } = req.body;\n      \n      if (!result || ![\"team_a\", \"team_b\"].includes(result)) {\n        return res.status(400).json({ message: \"Invalid result value\" });\n      }\n      \n      const game = await storage.getGame(gameId);\n      if (!game) {\n        return res.status(404).json({ message: \"Game not found\" });\n      }\n      \n      if (game.gameType !== GameType.CRICKET_TOSS) {\n        return res.status(400).json({ message: \"Game is not a cricket toss game\" });\n      }\n      \n      // Process the result and handle user balance updates\n      try {\n        // Get the user who placed the bet\n        const user = await storage.getUser(game.userId);\n        if (!user) {\n          return res.status(404).json({ message: \"User not found\" });\n        }\n        \n        // Calculate payout based on result\n        let payout = 0;\n        if (game.prediction === result) {\n          // If prediction matches, calculate payout based on the odds in gameData\n          // Include the bet amount in the payout (total return, not just profit)\n          const gameData = game.gameData as any;\n          const odds = result === 'team_a' ? gameData.oddTeamA : gameData.oddTeamB;\n          // Calculate total payout including original bet amount \n          const winAmount = Math.floor(game.betAmount * (odds / 100));\n          payout = winAmount + game.betAmount;\n        }\n        \n        // Update user balance with the payout\n        const updatedBalance = user.balance + payout;\n        await storage.updateUserBalance(user.id, updatedBalance);\n        \n        // Update the game with result, balanceAfter\n        const updateResult = await db.update(games)\n          .set({\n            result,\n            payout,\n            balanceAfter: updatedBalance, // Track the balance after this result is applied\n          })\n          .where(eq(games.id, gameId))\n          .returning();\n        \n        if (updateResult.length === 0) {\n          return res.status(404).json({ message: \"Game not found or could not be updated\" });\n        }\n        \n        // Get the updated game to return to the client\n        const updatedGame = await storage.getGame(gameId);\n        \n        if (!updatedGame) {\n          return res.status(404).json({ message: \"Failed to retrieve updated game\" });\n        }\n        \n        // Return the updated game\n        res.json(updatedGame);\n      } catch (error) {\n        console.error(\"Error updating game result:\", error);\n        return res.status(500).json({ \n          message: \"Failed to update game result\", \n          error: error instanceof Error ? error.message : String(error) \n        });\n      }\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Update cricket toss game details (admin only)\n  app.patch(\"/api/cricket-toss-games/:id\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated() || req.user!.role !== \"admin\") {\n        return res.status(403).json({ message: \"Only admin can edit cricket toss games\" });\n      }\n      \n      const gameId = Number(req.params.id);\n      const validationResult = createCricketTossSchema.safeParse(req.body);\n      \n      if (!validationResult.success) {\n        return res.status(400).json({ \n          error: \"Invalid data\", \n          details: validationResult.error.format() \n        });\n      }\n      \n      // Get the existing game\n      const existingGame = await storage.getGame(gameId);\n      \n      if (!existingGame) {\n        return res.status(404).json({ message: \"Game not found\" });\n      }\n      \n      if (existingGame.gameType !== GameType.CRICKET_TOSS) {\n        return res.status(400).json({ message: \"Game is not a cricket toss game\" });\n      }\n      \n      const { teamA, teamB, description, tossTime, imageUrl, openTime, closeTime } = validationResult.data;\n      \n      // Get odds from database settings\n      let odds = await storage.getGameOdds(GameType.CRICKET_TOSS);\n      \n      // If no odds found, use existing values or default\n      let oddTeamA = 190; // Default 1.9x odd (stored as 190)\n      let oddTeamB = 190; // Default 1.9x odd (stored as 190)\n      \n      if (odds && odds.length > 0) {\n        // Use the first odds setting (admin setting should be prioritized in the getGameOdds function)\n        const oddSetting = odds[0];\n        oddTeamA = oddSetting.oddValue;\n        oddTeamB = oddSetting.oddValue;\n      } else if (existingGame.gameData && (existingGame.gameData as any).oddTeamA) {\n        // Preserve existing odds if available\n        oddTeamA = (existingGame.gameData as any).oddTeamA;\n        oddTeamB = (existingGame.gameData as any).oddTeamB;\n      }\n      \n      // Update only the game data field, creating a new object\n      const existingGameData = typeof existingGame.gameData === 'object' && existingGame.gameData !== null \n        ? existingGame.gameData as Record<string, any>\n        : {};\n        \n      const updatedGameData = {\n        ...existingGameData,\n        teamA,\n        teamB,\n        description: description || \"\",\n        tossTime,\n        oddTeamA,\n        oddTeamB,\n        imageUrl: imageUrl || \"\",\n        openTime: openTime || tossTime, // Use provided openTime or default to toss time\n        closeTime: closeTime || tossTime, // Use provided closeTime or default to toss time\n      };\n      \n      // Create a simpler method for updating the game data\n      try {\n        // Use the Node PostgreSQL client directly\n        const result = await pool.query(\n          `UPDATE games SET game_data = $1 WHERE id = $2 RETURNING *`,\n          [JSON.stringify(updatedGameData), gameId]\n        );\n        \n        if (result.rows.length === 0) {\n          return res.status(404).json({ message: \"Failed to update game\" });\n        }\n        \n        // Return the updated game\n        const updatedGame = await storage.getGame(gameId);\n        res.json(updatedGame);\n      } catch (error) {\n        console.error(\"Error updating game:\", error);\n        return res.status(500).json({ \n          message: \"Failed to update game data\", \n          error: error instanceof Error ? error.message : String(error) \n        });\n      }\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get active cricket toss games\n  app.get(\"/api/cricket-toss-games/active\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const allGames = await storage.getAllGames();\n      const activeGames = allGames.filter(game => \n        game.gameType === GameType.CRICKET_TOSS && \n        game.userId === 1 && // Admin-created games\n        (!game.matchId) && // No match ID means it's a standalone cricket toss game\n        (game.gameData as any)?.status === 'open'\n      );\n      \n      res.json(activeGames);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Admin create cricket toss game\n  app.post(\"/api/cricket-toss-games\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.user || req.user.role !== 'admin') {\n        return res.status(403).json({ message: \"Only admin can create cricket toss games\" });\n      }\n\n      const validationResult = createCricketTossSchema.safeParse(req.body);\n      if (!validationResult.success) {\n        return res.status(400).json({ \n          error: \"Invalid data\", \n          details: validationResult.error.format() \n        });\n      }\n      \n      const { teamA, teamB, description, tossTime, imageUrl, openTime, closeTime } = validationResult.data;\n      \n      // Get odds from database settings\n      let odds = await storage.getGameOdds(GameType.CRICKET_TOSS);\n      \n      // If no odds found, use default values\n      let oddTeamA = 190; // Default 1.9x odd (stored as 190)\n      let oddTeamB = 190; // Default 1.9x odd (stored as 190)\n      \n      if (odds && odds.length > 0) {\n        // Use the first odds setting (admin setting should be prioritized in the getGameOdds function)\n        const oddSetting = odds[0];\n        oddTeamA = oddSetting.oddValue;\n        oddTeamB = oddSetting.oddValue;\n      }\n      \n      // Create a standalone cricket toss game (not linked to team matches)\n      const newGame = {\n        userId: req.user.id, // Admin user\n        gameType: GameType.CRICKET_TOSS,\n        betAmount: 0, // This is a game template, not an actual bet\n        prediction: \"pending\", // Required by schema, using \"pending\" as placeholder\n        gameData: {\n          teamA,\n          teamB,\n          description: description || \"\",\n          tossTime,\n          oddTeamA,   // Use odds value from settings\n          oddTeamB,   // Use odds value from settings\n          imageUrl: imageUrl || \"\",\n          openTime: openTime || tossTime, // If no specific open time, use toss time\n          closeTime: closeTime || tossTime, // If no specific close time, use toss time\n          status: \"open\" // Game is open for betting\n        },\n        result: \"pending\",\n        payout: 0\n      };\n      \n      const createdGame = await storage.createGame(newGame);\n      res.status(201).json(createdGame);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Place a bet on a cricket toss game\n  app.post(\"/api/cricket-toss-games/:id/play\", async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      if (req.user!.isBlocked) {\n        return res.status(403).json({ message: \"Your account is blocked\" });\n      }\n\n      const gameId = Number(req.params.id);\n      \n      // Validate the request body\n      const playSchema = z.object({\n        betAmount: z.number().min(10, \"Minimum bet amount is 10\"),\n        betOn: z.enum([TeamMatchResult.TEAM_A, TeamMatchResult.TEAM_B], {\n          errorMap: () => ({ message: \"Bet must be on either team_a or team_b\" })\n        })\n      });\n      \n      // Handle potential parsing errors (client may send string instead of number)\n      const parsedBody = {\n        ...req.body,\n        betAmount: typeof req.body.betAmount === 'string' \n          ? parseInt(req.body.betAmount, 10)\n          : req.body.betAmount\n      };\n      \n      const validationResult = playSchema.safeParse(parsedBody);\n      \n      if (!validationResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid bet amount or prediction\" \n        });\n      }\n      \n      const { betAmount, betOn } = validationResult.data;\n      \n      // Get the cricket toss game directly\n      const game = await storage.getGame(gameId);\n      \n      if (!game) {\n        return res.status(404).json({ message: \"Cricket Toss game not found\" });\n      }\n      \n      if (game.gameType !== GameType.CRICKET_TOSS) {\n        return res.status(400).json({ message: \"Game is not a Cricket Toss game\" });\n      }\n      \n      if ((game.gameData as any)?.status !== 'open') {\n        return res.status(400).json({ message: \"Game is not open for betting\" });\n      }\n      \n      // Check if user has sufficient balance\n      const user = await storage.getUser(req.user!.id);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      if (user.balance < betAmount) {\n        return res.status(400).json({ message: \"Insufficient balance\" });\n      }\n      \n      // Deduct the bet amount from user's balance\n      await storage.updateUserBalance(user.id, user.balance - betAmount);\n      \n      // Calculate potential payout based on odds from the game data\n      const gameData = game.gameData as any;\n      const odds = betOn === TeamMatchResult.TEAM_A ? gameData.oddTeamA : gameData.oddTeamB;\n      // Calculate potential winnings based on odds and include original bet amount\n      const winAmount = Math.floor((betAmount * odds) / 100);\n      const potentialPayout = winAmount + betAmount;\n      \n      // Create a new game entry for this user's bet\n      const newBalance = user.balance - betAmount;\n      const userBet = {\n        userId: user.id,\n        gameType: GameType.CRICKET_TOSS,\n        betAmount,\n        prediction: betOn, // Use betOn as prediction to match the schema\n        gameData: {\n          teamA: gameData.teamA,\n          teamB: gameData.teamB,\n          tossGameId: game.id, // Link to the original cricket toss game\n          oddTeamA: gameData.oddTeamA,\n          oddTeamB: gameData.oddTeamB,\n          description: gameData.description,\n          tossTime: gameData.tossTime,\n          openTime: gameData.openTime,\n          closeTime: gameData.closeTime,\n          status: 'pending'\n        },\n        result: \"pending\", // Use pending instead of null\n        payout: potentialPayout,\n        balanceAfter: newBalance // Track the balance after this bet\n      };\n      \n      const createdBet = await storage.createGame(userBet);\n      \n      res.status(201).json({\n        message: \"Bet placed successfully\",\n        bet: createdBet,\n        user: {\n          ...user,\n          balance: newBalance,\n          password: undefined,\n        }\n      });\n    } catch (error) {\n      next(error);\n    }\n  });\n}","path":null,"size_bytes":16628,"size_tokens":null},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp, foreignKey, json, jsonb, decimal, varchar, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { relations } from \"drizzle-orm\";\n\n// User roles\nexport const UserRole = {\n  ADMIN: \"admin\",\n  SUBADMIN: \"subadmin\",\n  PLAYER: \"player\",\n} as const;\n\nexport type UserRoleType = typeof UserRole[keyof typeof UserRole];\n\n// Game outcomes\nexport const GameOutcome = {\n  HEADS: \"heads\",\n  TAILS: \"tails\",\n} as const;\n\nexport type GameOutcomeType = typeof GameOutcome[keyof typeof GameOutcome];\n\n// Game types\nexport const GameType = {\n  COIN_FLIP: \"coin_flip\",\n  SATAMATKA: \"satamatka\",\n  CRICKET_TOSS: \"cricket_toss\"\n} as const;\n\nexport type GameTypeValue = typeof GameType[keyof typeof GameType];\n\n// Note: Team Match functionality has been removed from the application\n// These constants are kept for compatibility with existing code\nexport const TeamMatchResult = {\n  TEAM_A: \"team_a\",\n  TEAM_B: \"team_b\",\n  DRAW: \"draw\",\n  PENDING: \"pending\",\n} as const;\n\nexport type TeamMatchResultValue = typeof TeamMatchResult[keyof typeof TeamMatchResult];\n\n// Match categories\nexport const MatchCategory = {\n  CRICKET: \"cricket\",\n  FOOTBALL: \"football\",\n  BASKETBALL: \"basketball\",\n  OTHER: \"other\",\n} as const;\n\nexport type MatchCategoryValue = typeof MatchCategory[keyof typeof MatchCategory];\n\n// Market types\nexport const MarketType = {\n  DISHAWAR: \"dishawar\",\n  GALI: \"gali\",\n  MUMBAI: \"mumbai\",\n  KALYAN: \"kalyan\",\n} as const;\n\nexport type MarketTypeValue = typeof MarketType[keyof typeof MarketType];\n\n// Satamatka Game Modes for Dishawar/Gali markets\nexport const SatamatkaGameMode = {\n  JODI: \"jodi\", // Bet on two-digit number (00-99)\n  HARF: \"harf\", // Bet on a single digit in a specific position (left or right)\n  CROSSING: \"crossing\", // Cross betting\n  ODD_EVEN: \"odd_even\", // Bet on whether the result will be odd or even\n} as const;\n\nexport type SatamatkaGameModeValue = typeof SatamatkaGameMode[keyof typeof SatamatkaGameMode];\n\n// Payment Method Enums\nexport const PaymentMode = {\n  UPI: 'upi',\n  BANK: 'bank',\n} as const;\n\nexport type PaymentModeType = typeof PaymentMode[keyof typeof PaymentMode];\n\nexport const RequestStatus = {\n  PENDING: 'pending',\n  APPROVED: 'approved',\n  REJECTED: 'rejected',\n} as const;\n\nexport type RequestStatusType = typeof RequestStatus[keyof typeof RequestStatus];\n\nexport const RequestType = {\n  DEPOSIT: 'deposit',\n  WITHDRAWAL: 'withdrawal',\n} as const;\n\nexport type RequestTypeValue = typeof RequestType[keyof typeof RequestType];\n\n// Tables\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  email: text(\"email\"),\n  mobile: text(\"mobile\"),\n  role: text(\"role\").notNull().default(UserRole.PLAYER), // admin, subadmin, player\n  balance: integer(\"balance\").notNull().default(0),\n  assignedTo: integer(\"assigned_to\").references(() => users.id),\n  isBlocked: boolean(\"is_blocked\").notNull().default(false),\n  blockedBy: integer(\"blocked_by\").references(() => users.id),\n  rewardCommission: integer(\"reward_commission\").notNull().default(0), // percentage (stored as integer, e.g. 500 = 5.00%)\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users)\n  .pick({\n    username: true,\n    password: true,\n    email: true,\n    mobile: true,\n    role: true,\n    assignedTo: true,\n    rewardCommission: true,\n  })\n  .extend({\n    role: z.enum([UserRole.ADMIN, UserRole.SUBADMIN, UserRole.PLAYER]),\n  })\n  .partial({\n    assignedTo: true,\n    email: true,\n    mobile: true,\n    rewardCommission: true,\n  });\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport const games = pgTable(\"games\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  gameType: text(\"game_type\").notNull().default(GameType.COIN_FLIP), // coin_flip, satamatka, team_match\n  betAmount: integer(\"bet_amount\").notNull(),\n  prediction: text(\"prediction\").notNull(), // For coin flip: \"heads\" or \"tails\", for satamatka: \"0\" to \"9\" or \"00\" to \"99\"\n  result: text(\"result\"), // For coin flip: \"heads\" or \"tails\", for satamatka: \"0\" to \"9\" or \"00\" to \"99\"\n  payout: integer(\"payout\").notNull().default(0),\n  balanceAfter: integer(\"balance_after\"), // Balance after this game is played (for history tracking)\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  marketId: integer(\"market_id\").references(() => satamatkaMarkets.id),\n  matchId: integer(\"match_id\").references(() => teamMatches.id),\n  gameMode: text(\"game_mode\"), // For satamatka: \"single\", \"jodi\", \"patti\"\n  gameData: jsonb(\"game_data\"), // For cricket_toss: team names, odds, etc.\n});\n\nexport const insertGameSchema = createInsertSchema(games)\n  .pick({\n    userId: true,\n    gameType: true,\n    betAmount: true,\n    prediction: true,\n    result: true,\n    payout: true,\n    balanceAfter: true,\n    marketId: true,\n    matchId: true,\n    gameMode: true,\n    gameData: true,\n  })\n  .extend({\n    gameType: z.enum([GameType.COIN_FLIP, GameType.SATAMATKA, GameType.CRICKET_TOSS]),\n    gameMode: z.enum([\n      SatamatkaGameMode.JODI,\n      SatamatkaGameMode.HARF,\n      SatamatkaGameMode.CROSSING, \n      SatamatkaGameMode.ODD_EVEN\n    ]).optional(),\n    gameData: z.any().optional(), \n  })\n  .partial({\n    result: true,\n    balanceAfter: true,\n    marketId: true,\n    matchId: true,\n    gameMode: true,\n    gameData: true,\n  });\n\nexport type InsertGame = z.infer<typeof insertGameSchema>;\nexport type Game = typeof games.$inferSelect;\n\nexport const RecurrencePattern = {\n  DAILY: \"daily\",\n  WEEKDAYS: \"weekdays\",\n  WEEKLY: \"weekly\",\n  CUSTOM: \"custom\",\n} as const;\n\nexport type RecurrencePatternValue = typeof RecurrencePattern[keyof typeof RecurrencePattern];\n\nexport const MarketStatus = {\n  WAITING: \"waiting\",  // Newly created, not yet open for betting\n  OPEN: \"open\",        // Open for betting\n  CLOSED: \"closed\",    // Closed for betting, awaiting results\n  RESULTED: \"resulted\", // Results published\n  SETTLED: \"settled\",  // Bets have been settled\n} as const;\n\nexport type MarketStatusValue = typeof MarketStatus[keyof typeof MarketStatus];\n\nexport const satamatkaMarkets = pgTable(\"satamatka_markets\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  type: text(\"type\").notNull(), // dishawar, gali, mumbai, kalyan\n  openTime: timestamp(\"open_time\").notNull(),\n  closeTime: timestamp(\"close_time\").notNull(),\n  resultTime: timestamp(\"result_time\"), // Added new field for result declaration time\n  openResult: text(\"open_result\"),\n  closeResult: text(\"close_result\"),\n  status: text(\"status\").notNull().default(MarketStatus.WAITING),\n  isRecurring: boolean(\"is_recurring\").notNull().default(false),\n  recurrencePattern: text(\"recurrence_pattern\").default(RecurrencePattern.DAILY),\n  lastResultedDate: timestamp(\"last_resulted_date\"),\n  nextOpenTime: timestamp(\"next_open_time\"), \n  nextCloseTime: timestamp(\"next_close_time\"),\n  coverImage: text(\"cover_image\"), // Added field for market cover image\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertSatamatkaMarketSchema = createInsertSchema(satamatkaMarkets)\n  .pick({\n    name: true,\n    type: true,\n    openResult: true,\n    closeResult: true,\n    status: true,\n    isRecurring: true,\n    recurrencePattern: true,\n    nextOpenTime: true,\n    nextCloseTime: true,\n    resultTime: true,\n  })\n  .extend({\n    type: z.enum([MarketType.DISHAWAR, MarketType.GALI, MarketType.MUMBAI, MarketType.KALYAN]),\n    coverImage: z.string().optional(),\n    openTime: z.union([z.string(), z.date()]).transform(val => typeof val === 'string' ? new Date(val) : val),\n    closeTime: z.union([z.string(), z.date()]).transform(val => typeof val === 'string' ? new Date(val) : val),\n    resultTime: z.union([z.string(), z.date()]).transform(val => \n      val ? (typeof val === 'string' ? new Date(val) : val) : undefined\n    ).optional(),\n    status: z.enum([\n      MarketStatus.WAITING,\n      MarketStatus.OPEN, \n      MarketStatus.CLOSED, \n      MarketStatus.RESULTED, \n      MarketStatus.SETTLED\n    ]).default(MarketStatus.WAITING),\n    isRecurring: z.boolean().default(false),\n    recurrencePattern: z.enum([\n      RecurrencePattern.DAILY,\n      RecurrencePattern.WEEKDAYS,\n      RecurrencePattern.WEEKLY,\n      RecurrencePattern.CUSTOM\n    ]).default(RecurrencePattern.DAILY).optional(),\n    nextOpenTime: z.union([z.string(), z.date()]).transform(val => \n      val ? (typeof val === 'string' ? new Date(val) : val) : undefined\n    ).optional(),\n    nextCloseTime: z.union([z.string(), z.date()]).transform(val => \n      val ? (typeof val === 'string' ? new Date(val) : val) : undefined\n    ).optional(),\n  })\n  .partial({\n    openResult: true,\n    closeResult: true,\n    recurrencePattern: true,\n    nextOpenTime: true,\n    nextCloseTime: true,\n    resultTime: true,\n  });\n\nexport type InsertSatamatkaMarket = z.infer<typeof insertSatamatkaMarketSchema>;\nexport type SatamatkaMarket = typeof satamatkaMarkets.$inferSelect;\n\n// Wallet Request Schema\nexport const walletRequests = pgTable(\"wallet_requests\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\")\n    .notNull()\n    .references(() => users.id),\n  amount: integer(\"amount\").notNull(), // in cents\n  requestType: text(\"request_type\").notNull(), // 'deposit' or 'withdrawal'\n  paymentMode: text(\"payment_mode\").notNull(), // 'upi', 'bank'\n  paymentDetails: json(\"payment_details\").notNull(),\n  status: text(\"status\").notNull().default(RequestStatus.PENDING), // 'pending', 'approved', 'rejected'\n  proofImageUrl: text(\"proof_image_url\"),\n  notes: text(\"notes\"),\n  reviewedBy: integer(\"reviewed_by\").references(() => users.id), // ID of admin/subadmin who reviewed this request\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Transaction Schema\nexport const transactions = pgTable(\"transactions\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\")\n    .notNull()\n    .references(() => users.id),\n  amount: integer(\"amount\").notNull(), // positive for deposit, negative for withdrawal\n  balanceAfter: integer(\"balance_after\"), // Balance after transaction (added to track history)\n  performedBy: integer(\"performed_by\")\n    .notNull()\n    .references(() => users.id), // ID of admin/subadmin who performed this action\n  description: text(\"description\"), // Remark or description for the transaction\n  requestId: integer(\"request_id\").references(() => walletRequests.id), // Reference to the wallet request if applicable\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Insert schemas\nexport const insertTransactionSchema = createInsertSchema(transactions)\n  .pick({\n    userId: true,\n    amount: true,\n    balanceAfter: true,\n    performedBy: true,\n    description: true,\n    requestId: true,\n  })\n  .partial({\n    description: true,\n    requestId: true,\n    balanceAfter: true,\n  });\n\nexport const insertWalletRequestSchema = createInsertSchema(walletRequests)\n  .pick({\n    userId: true,\n    amount: true,\n    requestType: true,\n    paymentMode: true,\n    paymentDetails: true,\n    proofImageUrl: true,\n    notes: true,\n  })\n  .extend({\n    requestType: z.enum([RequestType.DEPOSIT, RequestType.WITHDRAWAL]),\n    paymentMode: z.enum([PaymentMode.UPI, PaymentMode.BANK]),\n  })\n  .partial({\n    proofImageUrl: true,\n    notes: true,\n  });\n\nexport type InsertWalletRequest = z.infer<typeof insertWalletRequestSchema>;\nexport type WalletRequest = typeof walletRequests.$inferSelect;\n\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\nexport type Transaction = typeof transactions.$inferSelect;\n\n// Team Matches Schema (kept for compatibility)\nexport const teamMatches = pgTable(\"team_matches\", {\n  id: serial(\"id\").primaryKey(),\n  teamA: text(\"team_a\").notNull(),\n  teamB: text(\"team_b\").notNull(),\n  category: text(\"category\").notNull().default(MatchCategory.CRICKET),\n  description: text(\"description\"),\n  matchTime: timestamp(\"match_time\").notNull(),\n  result: text(\"result\").notNull().default(TeamMatchResult.PENDING),\n  oddTeamA: integer(\"odd_team_a\").notNull().default(200),\n  oddTeamB: integer(\"odd_team_b\").notNull().default(200),\n  oddDraw: integer(\"odd_draw\").default(300),\n  status: text(\"status\").notNull().default(\"open\"),\n  teamAImage: text(\"team_a_image\"),\n  teamBImage: text(\"team_b_image\"),\n  coverImage: text(\"cover_image\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertTeamMatchSchema = createInsertSchema(teamMatches)\n  .pick({\n    teamA: true,\n    teamB: true,\n    category: true,\n    description: true,\n    matchTime: true,\n    result: true,\n    oddTeamA: true,\n    oddTeamB: true,\n    oddDraw: true,\n    status: true,\n    teamAImage: true,\n    teamBImage: true,\n    coverImage: true,\n  })\n  .extend({\n    matchTime: z.union([\n      z.string().transform((val) => new Date(val)),\n      z.date()\n    ]),\n    category: z.enum([\n      MatchCategory.CRICKET,\n      MatchCategory.FOOTBALL,\n      MatchCategory.BASKETBALL,\n      MatchCategory.OTHER\n    ]).default(MatchCategory.CRICKET),\n    result: z.enum([\n      TeamMatchResult.TEAM_A,\n      TeamMatchResult.TEAM_B,\n      TeamMatchResult.DRAW,\n      TeamMatchResult.PENDING\n    ]).default(TeamMatchResult.PENDING),\n    status: z.enum([\"open\", \"closed\", \"resulted\"]).default(\"open\"),\n    teamAImage: z.string().optional(),\n    teamBImage: z.string().optional(),\n    coverImage: z.string().optional(),\n  });\n\nexport type InsertTeamMatch = z.infer<typeof insertTeamMatchSchema>;\nexport type TeamMatch = typeof teamMatches.$inferSelect;\n\n// Define relations after all tables are defined\n// Session table for connect-pg-simple\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey().notNull(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  // Self-relation for assignedTo\n  assignedToUser: one(users, {\n    fields: [users.assignedTo],\n    references: [users.id],\n    relationName: \"assignedToUser\",\n  }),\n  // Inverse of assignedTo relation\n  assignedUsers: many(users, { relationName: \"assignedToUser\" }),\n  // Relation to games\n  games: many(games),\n  // Relation to transactions\n  transactions: many(transactions, { relationName: \"userTransactions\" }),\n  // Relation to transactions performed by this user\n  performedTransactions: many(transactions, { relationName: \"performedByTransactions\" }),\n  // Relation to wallet requests\n  walletRequests: many(walletRequests),\n}));\n\nexport const gamesRelations = relations(games, ({ one }) => ({\n  user: one(users, {\n    fields: [games.userId],\n    references: [users.id],\n  }),\n  market: one(satamatkaMarkets, {\n    fields: [games.marketId],\n    references: [satamatkaMarkets.id],\n    relationName: \"marketGames\",\n  }),\n  match: one(teamMatches, {\n    fields: [games.matchId],\n    references: [teamMatches.id],\n    relationName: \"teamMatchGames\",\n  }),\n}));\n\nexport const satamatkaMarketsRelations = relations(satamatkaMarkets, ({ many }) => ({\n  games: many(games, { relationName: \"marketGames\" }),\n}));\n\nexport const transactionsRelations = relations(transactions, ({ one }) => ({\n  // User who this transaction affects\n  user: one(users, {\n    fields: [transactions.userId],\n    references: [users.id],\n    relationName: \"userTransactions\",\n  }),\n  // User who performed this transaction\n  performer: one(users, {\n    fields: [transactions.performedBy],\n    references: [users.id],\n    relationName: \"performedByTransactions\",\n  }),\n  // Relation to wallet request\n  request: one(walletRequests, {\n    fields: [transactions.requestId],\n    references: [walletRequests.id],\n  }),\n}));\n\nexport const walletRequestsRelations = relations(walletRequests, ({ one, many }) => ({\n  // User who made this request\n  user: one(users, {\n    fields: [walletRequests.userId],\n    references: [users.id],\n  }),\n  // Admin/subadmin who reviewed this request\n  reviewer: one(users, {\n    fields: [walletRequests.reviewedBy],\n    references: [users.id],\n  }),\n  // Transactions related to this request\n  transactions: many(transactions),\n}));\n\nexport const teamMatchesRelations = relations(teamMatches, ({ many }) => ({\n  games: many(games, { relationName: \"teamMatchGames\" }),\n}));\n\n// System Settings Schema\nexport const systemSettings = pgTable(\"system_settings\", {\n  id: serial(\"id\").primaryKey(),\n  settingType: text(\"setting_type\").notNull(), // payment, odds, commission, etc.\n  settingKey: text(\"setting_key\").notNull(),\n  settingValue: text(\"setting_value\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertSystemSettingSchema = createInsertSchema(systemSettings);\nexport type InsertSystemSetting = z.infer<typeof insertSystemSettingSchema>;\nexport type SystemSetting = typeof systemSettings.$inferSelect;\n\n// SubAdmin Commission Schema\nexport const subadminCommissions = pgTable(\"subadmin_commissions\", {\n  id: serial(\"id\").primaryKey(),\n  subadminId: integer(\"subadmin_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  gameType: text(\"game_type\").notNull(), // satamatka_single, satamatka_jodi, etc.\n  commissionRate: integer(\"commission_rate\").notNull(), // percentage (stored as integer, e.g. 525 = 5.25%)\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Deposit commissions for subadmins (used in fund transfers)\nexport const depositCommissions = pgTable(\"deposit_commissions\", {\n  id: serial(\"id\").primaryKey(),\n  subadminId: integer(\"subadmin_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  commissionRate: integer(\"commission_rate\").notNull(), // percentage (stored as integer, e.g. 3000 = 30.00%)\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertSubadminCommissionSchema = createInsertSchema(subadminCommissions);\nexport type InsertSubadminCommission = z.infer<typeof insertSubadminCommissionSchema>;\nexport type SubadminCommission = typeof subadminCommissions.$inferSelect;\n\nexport const insertDepositCommissionSchema = createInsertSchema(depositCommissions);\nexport type InsertDepositCommission = z.infer<typeof insertDepositCommissionSchema>;\nexport type DepositCommission = typeof depositCommissions.$inferSelect;\n\n// User Discount Schema (set by subadmin)\nexport const userDiscounts = pgTable(\"user_discounts\", {\n  id: serial(\"id\").primaryKey(),\n  subadminId: integer(\"subadmin_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  userId: integer(\"user_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  gameType: text(\"game_type\").notNull(), // satamatka_single, satamatka_jodi, etc.\n  discountRate: integer(\"discount_rate\").notNull(), // percentage (stored as integer, e.g. 525 = 5.25%)\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Table for player deposit discounts (separate from game-specific discounts)\nexport const playerDepositDiscounts = pgTable(\"player_deposit_discounts\", {\n  id: serial(\"id\").primaryKey(),\n  subadminId: integer(\"subadmin_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  userId: integer(\"user_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  discountRate: integer(\"discount_rate\").notNull(), // percentage (stored as integer, e.g. 1000 = 10.00%)\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertUserDiscountSchema = createInsertSchema(userDiscounts);\nexport type InsertUserDiscount = z.infer<typeof insertUserDiscountSchema>;\nexport type UserDiscount = typeof userDiscounts.$inferSelect;\n\nexport const insertPlayerDepositDiscountSchema = createInsertSchema(playerDepositDiscounts);\nexport type InsertPlayerDepositDiscount = z.infer<typeof insertPlayerDepositDiscountSchema>;\nexport type PlayerDepositDiscount = typeof playerDepositDiscounts.$inferSelect;\n\n// Game Odds Schema\nexport const gameOdds = pgTable(\"game_odds\", {\n  id: serial(\"id\").primaryKey(),\n  gameType: text(\"game_type\").notNull(), // satamatka_single, satamatka_jodi, etc.\n  oddValue: integer(\"odd_value\").notNull(), // multiplier (stored as integer, e.g. 250 = 2.50x)\n  setByAdmin: boolean(\"set_by_admin\").default(true).notNull(), // true if set by admin, false if by subadmin\n  subadminId: integer(\"subadmin_id\").references(() => users.id, { onDelete: \"cascade\" }),\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertGameOddSchema = createInsertSchema(gameOdds);\nexport type InsertGameOdd = z.infer<typeof insertGameOddSchema>;\nexport type GameOdd = typeof gameOdds.$inferSelect;\n\n// Relations\nexport const subadminCommissionsRelations = relations(subadminCommissions, ({ one }) => ({\n  subadmin: one(users, { fields: [subadminCommissions.subadminId], references: [users.id] }),\n}));\n\nexport const depositCommissionsRelations = relations(depositCommissions, ({ one }) => ({\n  subadmin: one(users, { fields: [depositCommissions.subadminId], references: [users.id] }),\n}));\n\nexport const userDiscountsRelations = relations(userDiscounts, ({ one }) => ({\n  subadmin: one(users, { fields: [userDiscounts.subadminId], references: [users.id] }),\n  user: one(users, { fields: [userDiscounts.userId], references: [users.id] }),\n}));\n\nexport const playerDepositDiscountsRelations = relations(playerDepositDiscounts, ({ one }) => ({\n  subadmin: one(users, { fields: [playerDepositDiscounts.subadminId], references: [users.id] }),\n  user: one(users, { fields: [playerDepositDiscounts.userId], references: [users.id] }),\n}));\n\nexport const gameOddsRelations = relations(gameOdds, ({ one }) => ({\n  subadmin: one(users, { fields: [gameOdds.subadminId], references: [users.id] }),\n}));","path":null,"size_bytes":22629,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"server/deposit-discount-helper.ts":{"content":"import { db } from './db';\nimport { playerDepositDiscounts } from '@shared/schema';\nimport { and, eq } from 'drizzle-orm';\nimport { storage } from './storage';\n\n/**\n * Helper function to get player deposit discount from a subadmin\n * @param playerId The ID of the player\n * @param subadminId The ID of the subadmin\n * @returns Discount rate as an integer (0-10000)\n */\nexport async function getPlayerDepositDiscount(playerId: number, subadminId: number): Promise<number> {\n  try {\n    // Check if a discount exists for this player and subadmin\n    const result = await db.select()\n      .from(playerDepositDiscounts)\n      .where(\n        and(\n          eq(playerDepositDiscounts.userId, playerId),\n          eq(playerDepositDiscounts.subadminId, subadminId),\n          eq(playerDepositDiscounts.isActive, true)\n        )\n      ).limit(1);\n    \n    if (result.length > 0) {\n      return result[0].discountRate;\n    }\n    \n    // Default return no discount\n    return 0;\n  } catch (error) {\n    console.error('Error getting player deposit discount:', error);\n    return 0; // Default to no discount on error\n  }\n}\n\n/**\n * Calculate the bonus amount based on deposit amount and discount rate\n * @param depositAmount The amount being deposited (in rupees)\n * @param discountRate The discount rate (0-100%)\n * @returns The bonus amount to add\n */\nexport function calculateDepositBonus(depositAmount: number, discountRate: number): number {\n  if (discountRate <= 0) return 0;\n  \n  // Calculate bonus amount\n  // Example: 1000 rupees * 10% / 100 = 100 rupees\n  return Math.floor((depositAmount * discountRate) / 100);\n}","path":null,"size_bytes":1613,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"import * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4267,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\n// Route to serve the login test page\napp.get('/login-test', (req, res) => {\n  res.sendFile('login-test.html', { root: process.cwd() });\n});\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":2063,"size_tokens":null},"client/src/components/floating-whatsapp.tsx":{"content":"import whatsappIcon from \"@assets/whatsapp-chat.png\";\n\nexport default function FloatingWhatsApp() {\n  const handleWhatsAppClick = () => {\n    window.open('https://wa.me/6282264973815', '_blank');\n  };\n\n  return (\n    <div className=\"fixed bottom-6 right-6 z-50\">\n      <button\n        onClick={handleWhatsAppClick}\n        className=\"group relative bg-green-500 hover:bg-green-600 rounded-full p-3 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 animate-pulse\"\n        aria-label=\"Chat on WhatsApp\"\n      >\n        <img \n          src={whatsappIcon} \n          alt=\"WhatsApp\" \n          className=\"w-12 h-12 rounded-lg\"\n        />\n        \n        {/* Tooltip */}\n        <div className=\"absolute bottom-full right-0 mb-2 px-3 py-1 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap\">\n          Chat with us on WhatsApp\n          <div className=\"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"></div>\n        </div>\n        \n        {/* Ripple effect */}\n        <div className=\"absolute inset-0 rounded-full bg-green-400 animate-ping opacity-30\"></div>\n      </button>\n    </div>\n  );\n}","path":null,"size_bytes":1251,"size_tokens":null},"reset-user-balances.js":{"content":"/**\n * This script resets all user balances to zero\n * Use this script for testing profit/loss calculations\n */\n\nimport 'dotenv/config';\nimport pg from 'pg';\nconst { Pool } = pg;\n\nasync function resetUserBalances() {\n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n  });\n\n  try {\n    console.log('Connecting to database...');\n    const client = await pool.connect();\n    \n    try {\n      console.log('Starting transaction...');\n      await client.query('BEGIN');\n\n      console.log('Resetting all user balances to zero...');\n      const updateResult = await client.query(`\n        UPDATE users\n        SET balance = 0\n        WHERE true\n      `);\n      \n      console.log(`Reset balances for ${updateResult.rowCount} users`);\n      \n      await client.query('COMMIT');\n      console.log('Transaction committed successfully!');\n    } catch (err) {\n      await client.query('ROLLBACK');\n      console.error('Error occurred, transaction rolled back:', err);\n      throw err;\n    } finally {\n      client.release();\n    }\n  } catch (err) {\n    console.error('Database connection error:', err);\n  } finally {\n    await pool.end();\n    console.log('Done. Pool has ended.');\n  }\n}\n\nresetUserBalances()\n  .then(() => console.log('All user balances have been reset to zero.'))\n  .catch(err => console.error('Failed to reset user balances:', err));","path":null,"size_bytes":1364,"size_tokens":null},"client/src/pages/settings-router.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { UserRole } from \"@/lib/types\";\nimport AdminSettingsPage from \"./admin-settings-page\";\nimport SubadminSettingsPage from \"./subadmin-settings-page\";\nimport { Redirect } from \"wouter\";\n\nexport default function SettingsRouter() {\n  const { user } = useAuth();\n\n  if (user?.role === UserRole.ADMIN) {\n    return <AdminSettingsPage />;\n  } else if (user?.role === UserRole.SUBADMIN) {\n    return <SubadminSettingsPage />;\n  } else {\n    // Access denied or redirect to home\n    return <Redirect to=\"/\" />;\n  }\n}","path":null,"size_bytes":558,"size_tokens":null},"server/cricket-toss-api.ts":{"content":"import express from \"express\";\nimport { db } from \"./db\";\nimport { z } from \"zod\";\nimport { \n  GameType, \n  TeamMatchResult, \n  users, \n  games, \n  teamMatches,\n  type TeamMatch\n} from \"../shared/schema\";\nimport { eq, and, desc } from \"drizzle-orm\";\nimport { requireRole } from \"./auth\";\nimport multer from 'multer';\nimport path from 'path';\nimport fs from 'fs';\n\nconst router = express.Router();\n\n// Setup multer for image uploads\nconst uploadsDir = path.join(process.cwd(), 'uploads');\nconst cricketTossUploadsDir = path.join(uploadsDir, 'cricket-toss');\n\n// Ensure uploads directory exists\nif (!fs.existsSync(cricketTossUploadsDir)) {\n  fs.mkdirSync(cricketTossUploadsDir, { recursive: true });\n}\n\n// Configure storage for cricket toss team images\nconst storage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, cricketTossUploadsDir);\n  },\n  filename: function (req, file, cb) {\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const ext = path.extname(file.originalname);\n    cb(null, `cricket-toss-${uniqueSuffix}${ext}`);\n  }\n});\n\n// File filter to accept only images\nconst fileFilter = (req: Express.Request, file: Express.Multer.File, cb: multer.FileFilterCallback) => {\n  if (file.mimetype.startsWith('image/')) {\n    cb(null, true);\n  } else {\n    cb(new Error('Only image files are allowed!'));\n  }\n};\n\nconst upload = multer({ \n  storage: storage,\n  limits: {\n    fileSize: 5 * 1024 * 1024 // 5MB max file size\n  },\n  fileFilter: fileFilter\n});\n\n// Schema for creating a cricket toss match\nconst createCricketTossMatchSchema = z.object({\n  teamA: z.string().min(1, \"Team A name is required\"),\n  teamB: z.string().min(1, \"Team B name is required\"),\n  description: z.string().optional(),\n  matchTime: z.string().transform(val => new Date(val)),\n  oddTeamA: z.number().min(100, \"Odds must be at least 1.00\"),\n  oddTeamB: z.number().min(100, \"Odds must be at least 1.00\"),\n  coverImage: z.string().optional(),\n});\n\n// Schema for placing a bet\nconst placeBetSchema = z.object({\n  matchId: z.number(),\n  betAmount: z.number().positive(\"Bet amount must be positive\"),\n  prediction: z.enum([\"team_a\", \"team_b\"], { \n    errorMap: () => ({ message: \"Prediction must be either team_a or team_b\" })\n  }),\n});\n\n// Schema for declaring a result\nconst declareResultSchema = z.object({\n  result: z.enum([\"team_a\", \"team_b\"], { \n    errorMap: () => ({ message: \"Result must be either team_a or team_b\" }) \n  }),\n});\n\n// Get all cricket toss matches\nrouter.get(\"/matches\", requireRole([\"admin\", \"subadmin\"]), async (req, res) => {\n  try {\n    const matches = await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.category, \"cricket_toss\"))\n      .orderBy(desc(teamMatches.id));\n    \n    res.json(matches);\n  } catch (error) {\n    console.error(\"Error fetching cricket toss matches:\", error);\n    res.status(500).json({ message: \"Failed to fetch cricket toss matches\" });\n  }\n});\n\n// Get all open cricket toss matches (for players)\nrouter.get(\"/open-matches\", async (req, res) => {\n  try {\n    const now = new Date();\n    const matches = await db.select()\n      .from(teamMatches)\n      .where(\n        and(\n          eq(teamMatches.category, \"cricket_toss\"),\n          eq(teamMatches.status, \"open\")\n        )\n      )\n      .orderBy(desc(teamMatches.matchTime));\n    \n    res.json(matches);\n  } catch (error) {\n    console.error(\"Error fetching open cricket toss matches:\", error);\n    res.status(500).json({ message: \"Failed to fetch open cricket toss matches\" });\n  }\n});\n\n// Get cricket match betting statistics\nrouter.get(\"/match-stats\", requireRole([\"admin\", \"subadmin\"]), async (req, res) => {\n  try {\n    const matches = await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.category, \"cricket_toss\"))\n      .orderBy(desc(teamMatches.id));\n\n    const stats = [];\n\n    for (const match of matches) {\n      // Get all bets for this match\n      const bets = await db.select()\n        .from(games)\n        .where(\n          and(\n            eq(games.gameType, \"cricket\"),\n            eq(games.matchId, match.id),\n            eq(games.status, \"pending\")\n          )\n        );\n      \n      // Calculate stats for each team\n      const teamABets = bets.filter((bet: any) => bet.betData?.prediction === 'team_a');\n      const teamBBets = bets.filter((bet: any) => bet.betData?.prediction === 'team_b');\n      \n      const teamAStats = {\n        totalBets: teamABets.length,\n        potentialWin: teamABets.reduce((sum: number, bet: any) => sum + (bet.payout || 0), 0)\n      };\n      \n      const teamBStats = {\n        totalBets: teamBBets.length,\n        potentialWin: teamBBets.reduce((sum: number, bet: any) => sum + (bet.payout || 0), 0)\n      };\n\n      stats.push({\n        matchId: match.id,\n        teamA: teamAStats,\n        teamB: teamBStats\n      });\n    }\n\n    res.json(stats);\n  } catch (error) {\n    console.error(\"Error fetching cricket match stats:\", error);\n    res.status(500).json({ message: \"Failed to fetch cricket match stats\" });\n  }\n});\n\n// Update an existing cricket toss match\nrouter.put(\"/matches/:id\", requireRole([\"admin\", \"subadmin\"]), upload.single('coverImage'), async (req, res) => {\n  try {\n    const matchId = parseInt(req.params.id);\n    if (isNaN(matchId)) {\n      return res.status(400).json({ message: \"Invalid match ID\" });\n    }\n\n    // Check if the match exists and is not resulted\n    const existingMatch = await db.select()\n      .from(teamMatches)\n      .where(\n        and(\n          eq(teamMatches.id, matchId),\n          eq(teamMatches.category, \"cricket_toss\")\n        )\n      )\n      .limit(1);\n\n    if (existingMatch.length === 0) {\n      return res.status(404).json({ message: \"Cricket toss match not found\" });\n    }\n\n    // Check if match is resulted (cannot edit resulted matches)\n    if (existingMatch[0].status === \"resulted\") {\n      return res.status(400).json({ message: \"Cannot edit a match that has already been resulted\" });\n    }\n\n    // Handle form-data\n    const teamA = req.body.teamA;\n    const teamB = req.body.teamB;\n    const description = req.body.description;\n    const matchTime = req.body.matchTime;\n    \n    // Process cover image if it was uploaded\n    let coverImage: string | undefined = existingMatch[0].coverImage;\n    \n    if (req.file) {\n      coverImage = `/uploads/cricket-toss/${req.file.filename}`;\n    }\n    \n    // Validate the data\n    if (!teamA || !teamB || !matchTime) {\n      return res.status(400).json({ message: \"Missing required fields: teamA, teamB, or matchTime\" });\n    }\n    \n    // Parse the datetime string as local time without timezone conversion\n    const [datePart, timePart] = matchTime.split('T');\n    const [year, month, day] = datePart.split('-').map(Number);\n    const [hour, minute] = timePart.split(':').map(Number);\n    \n    // Create date in local timezone without UTC conversion\n    const localMatchTime = new Date(year, month - 1, day, hour, minute);\n    \n    // Update object\n    const updateData = {\n      teamA,\n      teamB,\n      description,\n      matchTime: localMatchTime,\n      coverImage,\n    };\n\n    const updatedMatch = await db.update(teamMatches)\n      .set(updateData)\n      .where(eq(teamMatches.id, matchId))\n      .returning();\n    \n    res.json(updatedMatch[0]);\n  } catch (error) {\n    console.error(\"Error updating cricket toss match:\", error);\n    res.status(500).json({ message: \"Failed to update cricket toss match\" });\n  }\n});\n\n// Create a new cricket toss match\nrouter.post(\"/matches\", requireRole([\"admin\", \"subadmin\"]), upload.single('coverImage'), async (req, res) => {\n  try {\n    // Handle form-data\n    const teamA = req.body.teamA;\n    const teamB = req.body.teamB;\n    const description = req.body.description;\n    const matchTime = req.body.matchTime;\n    // Use fixed odds of 2.00 for both teams\n    const oddTeamA = 200;\n    const oddTeamB = 200;\n    \n    // Process cover image if it was uploaded\n    let coverImage: string | undefined;\n    \n    if (req.file) {\n      coverImage = `/uploads/cricket-toss/${req.file.filename}`;\n    }\n    \n    // Validate the data\n    if (!teamA || !teamB || !matchTime) {\n      return res.status(400).json({ message: \"Missing required fields: teamA, teamB, or matchTime\" });\n    }\n    \n    // Create object for insertion\n    // Parse the datetime string as local time without timezone conversion\n    const [datePart, timePart] = matchTime.split('T');\n    const [year, month, day] = datePart.split('-').map(Number);\n    const [hour, minute] = timePart.split(':').map(Number);\n    \n    // Create date in local timezone without UTC conversion\n    const localMatchTime = new Date(year, month - 1, day, hour, minute);\n    \n    const matchData = {\n      teamA,\n      teamB,\n      description,\n      matchTime: localMatchTime,\n      oddTeamA,\n      oddTeamB,\n      oddDraw: null, // No draw option for cricket toss\n      category: \"cricket_toss\", // This is the key difference from regular team matches\n      result: TeamMatchResult.PENDING,\n      status: \"open\",\n      coverImage, // Store the cover image path\n      teamAImage: undefined, // Set to undefined since we're not using them anymore\n      teamBImage: undefined\n    };\n\n    const insertedMatch = await db.insert(teamMatches).values(matchData).returning();\n    \n    res.status(201).json(insertedMatch[0]);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      res.status(400).json({ message: error.errors[0].message });\n    } else {\n      console.error(\"Error creating cricket toss match:\", error);\n      res.status(500).json({ message: \"Failed to create cricket toss match\" });\n    }\n  }\n});\n\n// Close betting for a match\nrouter.post(\"/matches/:id/close\", requireRole([\"admin\", \"subadmin\"]), async (req, res) => {\n  try {\n    const matchId = parseInt(req.params.id);\n    if (isNaN(matchId)) {\n      return res.status(400).json({ message: \"Invalid match ID\" });\n    }\n    \n    // First check if the match exists and is still open\n    const match = await db.select()\n      .from(teamMatches)\n      .where(\n        and(\n          eq(teamMatches.id, matchId),\n          eq(teamMatches.category, \"cricket_toss\"),\n          eq(teamMatches.status, \"open\")\n        )\n      )\n      .limit(1);\n    \n    if (match.length === 0) {\n      return res.status(404).json({ \n        message: \"Match not found or already closed\" \n      });\n    }\n    \n    // Close the match\n    const updatedMatch = await db.update(teamMatches)\n      .set({ status: \"closed\" })\n      .where(eq(teamMatches.id, matchId))\n      .returning();\n    \n    res.json(updatedMatch[0]);\n  } catch (error) {\n    console.error(\"Error closing cricket toss match:\", error);\n    res.status(500).json({ message: \"Failed to close cricket toss match\" });\n  }\n});\n\n// Declare result for a match\nrouter.post(\"/matches/:id/result\", requireRole([\"admin\", \"subadmin\"]), async (req, res) => {\n  try {\n    const matchId = parseInt(req.params.id);\n    if (isNaN(matchId)) {\n      return res.status(400).json({ message: \"Invalid match ID\" });\n    }\n    \n    const validatedData = declareResultSchema.parse(req.body);\n    \n    // First check if the match exists and is closed\n    const match = await db.select()\n      .from(teamMatches)\n      .where(\n        and(\n          eq(teamMatches.id, matchId),\n          eq(teamMatches.category, \"cricket_toss\"),\n          eq(teamMatches.status, \"closed\")\n        )\n      )\n      .limit(1);\n    \n    if (match.length === 0) {\n      return res.status(404).json({ \n        message: \"Match not found or not in closed state\" \n      });\n    }\n    \n    const matchData = match[0];\n    \n    // Update the match with the result\n    const updatedMatch = await db.update(teamMatches)\n      .set({ \n        status: \"resulted\",\n        result: validatedData.result\n      })\n      .where(eq(teamMatches.id, matchId))\n      .returning();\n    \n    // Process all bets for this match\n    const bets = await db.select()\n      .from(games)\n      .where(\n        and(\n          eq(games.matchId, matchId),\n          eq(games.gameType, GameType.CRICKET_TOSS)\n          // We'll filter unresolved bets after the query\n        )\n      );\n    \n    // For each bet, determine win/loss and update user balance\n    for (const bet of bets) {\n      // Skip bets that already have a result\n      if (bet.result !== null) continue;\n      \n      let payout = 0;\n      const win = bet.prediction === validatedData.result;\n      \n      if (win) {\n        // Calculate payout based on which team was predicted\n        const odds = bet.prediction === \"team_a\" ? matchData.oddTeamA : matchData.oddTeamB;\n        payout = Math.floor(bet.betAmount * (odds / 100));\n      }\n      \n      // Get current user balance\n      const userResult = await db.select({ balance: users.balance })\n        .from(users)\n        .where(eq(users.id, bet.userId))\n        .limit(1);\n      \n      if (userResult.length === 0) {\n        console.error(`User ${bet.userId} not found when processing bet ${bet.id}`);\n        continue;\n      }\n      \n      const currentBalance = userResult[0].balance;\n      const newBalance = currentBalance + payout;\n      \n      // Update user balance\n      if (payout > 0) {\n        await db.update(users)\n          .set({ balance: newBalance })\n          .where(eq(users.id, bet.userId));\n      }\n      \n      // Update bet with result and payout\n      await db.update(games)\n        .set({\n          result: validatedData.result,\n          payout: payout,\n          balanceAfter: newBalance\n        })\n        .where(eq(games.id, bet.id));\n    }\n    \n    res.json({\n      match: updatedMatch[0],\n      processedBets: bets.length\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      res.status(400).json({ message: error.errors[0].message });\n    } else {\n      console.error(\"Error declaring cricket toss result:\", error);\n      res.status(500).json({ message: \"Failed to declare cricket toss result\" });\n    }\n  }\n});\n\n// Place a bet on a cricket toss match\nrouter.post(\"/bet\", async (req, res) => {\n  try {\n    // Ensure user is authenticated\n    if (!req.user) {\n      return res.status(401).json({ message: \"You must be logged in to place a bet\" });\n    }\n    \n    const validatedData = placeBetSchema.parse(req.body);\n    \n    // Check if the match exists and is open for betting\n    const match = await db.select()\n      .from(teamMatches)\n      .where(\n        and(\n          eq(teamMatches.id, validatedData.matchId),\n          eq(teamMatches.category, \"cricket_toss\"),\n          eq(teamMatches.status, \"open\")\n        )\n      )\n      .limit(1);\n    \n    if (match.length === 0) {\n      return res.status(404).json({ \n        message: \"Match not found or not open for betting\" \n      });\n    }\n    \n    const matchData = match[0] as TeamMatch;\n    \n    // Check if the user has enough balance\n    const userResult = await db.select({ balance: users.balance })\n      .from(users)\n      .where(eq(users.id, req.user.id))\n      .limit(1);\n    \n    if (userResult.length === 0) {\n      return res.status(404).json({ message: \"User not found\" });\n    }\n    \n    const currentBalance = userResult[0].balance;\n    \n    if (currentBalance < validatedData.betAmount) {\n      return res.status(400).json({ \n        message: \"Insufficient balance to place this bet\" \n      });\n    }\n    \n    // Calculate potential payout\n    const odds = validatedData.prediction === \"team_a\" \n      ? matchData.oddTeamA \n      : matchData.oddTeamB;\n    \n    // Ensure bet amount is a number and correctly scaled\n    // Convert to paisa (multiply by 100) as the system stores amounts in paisa\n    const betAmount = parseInt(validatedData.betAmount.toString()) * 100;\n    \n    const potentialWin = Math.floor(betAmount * (odds / 100));\n    \n    // Deduct bet amount from user balance\n    const newBalance = currentBalance - betAmount;\n    \n    await db.update(users)\n      .set({ balance: newBalance })\n      .where(eq(users.id, req.user.id));\n    \n    // Create the bet record\n    const gameData = {\n      teamA: matchData.teamA,\n      teamB: matchData.teamB,\n      coverImage: matchData.coverImage,\n      matchId: matchData.id,\n      oddTeamA: matchData.oddTeamA,\n      oddTeamB: matchData.oddTeamB,\n      matchTime: matchData.matchTime,\n      status: matchData.status,\n    };\n    \n    const createdBet = await db.insert(games)\n      .values({\n        userId: req.user.id,\n        gameType: GameType.CRICKET_TOSS,\n        matchId: validatedData.matchId,\n        betAmount: betAmount,\n        prediction: validatedData.prediction,\n        gameData: gameData,\n        balanceAfter: newBalance,\n      })\n      .returning();\n    \n    res.status(201).json({\n      bet: createdBet[0],\n      currentBalance: newBalance,\n      potentialWin: potentialWin\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      res.status(400).json({ message: error.errors[0].message });\n    } else {\n      console.error(\"Error placing cricket toss bet:\", error);\n      res.status(500).json({ message: \"Failed to place bet\" });\n    }\n  }\n});\n\n// Get betting history for the current user\nrouter.get(\"/my-bets\", async (req, res) => {\n  try {\n    // Ensure user is authenticated\n    if (!req.user) {\n      return res.status(401).json({ message: \"You must be logged in to view your bets\" });\n    }\n    \n    const bets = await db.select()\n      .from(games)\n      .where(\n        and(\n          eq(games.userId, req.user.id),\n          eq(games.gameType, GameType.CRICKET_TOSS)\n        )\n      )\n      .orderBy(desc(games.createdAt));\n    \n    res.json(bets);\n  } catch (error) {\n    console.error(\"Error fetching user cricket toss bets:\", error);\n    res.status(500).json({ message: \"Failed to fetch your betting history\" });\n  }\n});\n\n// Play (place a bet on) a cricket toss match by ID\nrouter.post(\"/:id/play\", async (req, res) => {\n  try {\n    // Ensure user is authenticated\n    if (!req.user) {\n      return res.status(401).json({ message: \"You must be logged in to place a bet\" });\n    }\n    \n    const matchId = parseInt(req.params.id);\n    if (isNaN(matchId)) {\n      return res.status(400).json({ message: \"Invalid match ID\" });\n    }\n    \n    // Log the request body and headers for debugging\n    console.log(\"Cricket toss play request:\", {\n      body: req.body,\n      headers: req.headers,\n      contentType: req.headers['content-type']\n    });\n    \n    // For simplicity, extract data directly from the request\n    // This bypasses the schema validation temporarily until we understand the data format\n    let betAmount = 0;\n    let betOn = \"\";\n    \n    // Try to extract values from the request body based on different possible formats\n    if (req.body) {\n      if (typeof req.body === 'string') {\n        try {\n          // Try to parse JSON string\n          const parsedBody = JSON.parse(req.body);\n          betAmount = parsedBody.betAmount || parsedBody.amount || 0;\n          betOn = parsedBody.betOn || parsedBody.prediction || \"\";\n        } catch (e) {\n          console.error(\"Error parsing JSON body:\", e);\n          // Handle form-urlencoded format\n          const params = new URLSearchParams(req.body);\n          betAmount = parseInt(params.get('betAmount') || params.get('amount') || '0');\n          betOn = params.get('betOn') || params.get('prediction') || '';\n        }\n      } else {\n        // Object format\n        betAmount = parseInt(req.body.betAmount) || parseInt(req.body.amount) || 0;\n        betOn = req.body.betOn || req.body.prediction || \"\";\n      }\n    }\n    \n    // Simple validation\n    if (!betAmount || betAmount < 10) {\n      return res.status(400).json({ message: \"Bet amount must be at least 10\" });\n    }\n    \n    if (!betOn || (betOn !== \"team_a\" && betOn !== \"team_b\" && betOn !== \"TeamA\" && betOn !== \"TeamB\")) {\n      return res.status(400).json({ message: \"Invalid team selection\" });\n    }\n    \n    // Normalize betOn value\n    if (betOn === \"TeamA\") betOn = \"team_a\";\n    if (betOn === \"TeamB\") betOn = \"team_b\";\n    \n    // Check if the match exists and is open for betting\n    const match = await db.select()\n      .from(teamMatches)\n      .where(\n        and(\n          eq(teamMatches.id, matchId),\n          eq(teamMatches.category, \"cricket_toss\"),\n          eq(teamMatches.status, \"open\")\n        )\n      )\n      .limit(1);\n    \n    if (match.length === 0) {\n      return res.status(404).json({ \n        message: \"Match not found or not open for betting\" \n      });\n    }\n    \n    const matchData = match[0] as TeamMatch;\n    \n    // Check if the user has enough balance\n    const userResult = await db.select({ balance: users.balance })\n      .from(users)\n      .where(eq(users.id, req.user.id))\n      .limit(1);\n    \n    if (userResult.length === 0) {\n      return res.status(404).json({ message: \"User not found\" });\n    }\n    \n    const currentBalance = userResult[0].balance;\n    \n    if (currentBalance < betAmount) {\n      return res.status(400).json({ \n        message: \"Insufficient balance to place this bet\" \n      });\n    }\n    \n    // Calculate potential payout\n    const odds = betOn === \"team_a\" \n      ? matchData.oddTeamA \n      : matchData.oddTeamB;\n    \n    // Ensure bet amount is a number and correctly scaled\n    // Convert to paisa (multiply by 100) as the system stores amounts in paisa\n    betAmount = parseInt(betAmount.toString()) * 100;\n    \n    const potentialWin = Math.floor(betAmount * (odds / 100));\n    \n    // Deduct bet amount from user balance\n    const newBalance = currentBalance - betAmount;\n    \n    await db.update(users)\n      .set({ balance: newBalance })\n      .where(eq(users.id, req.user.id));\n    \n    // Create the bet record\n    const gameData = {\n      teamA: matchData.teamA,\n      teamB: matchData.teamB,\n      coverImage: matchData.coverImage,\n      matchId: matchData.id,\n      oddTeamA: matchData.oddTeamA,\n      oddTeamB: matchData.oddTeamB,\n      matchTime: matchData.matchTime,\n      status: matchData.status,\n    };\n    \n    const createdBet = await db.insert(games)\n      .values({\n        userId: req.user.id,\n        gameType: GameType.CRICKET_TOSS,\n        matchId: matchId,\n        betAmount: betAmount,\n        prediction: betOn,\n        gameData: gameData,\n        balanceAfter: newBalance,\n      })\n      .returning();\n    \n    res.status(200).json({\n      game: createdBet[0],\n      user: {\n        ...req.user,\n        balance: newBalance\n      },\n      potentialWin: potentialWin\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      res.status(400).json({ message: error.errors[0].message });\n    } else {\n      console.error(\"Error placing cricket toss bet:\", error);\n      res.status(500).json({ message: \"Failed to place bet\" });\n    }\n  }\n});\n\n// Get all bets for a specific match (admin/subadmin only)\nrouter.get(\"/bets/:matchId\", requireRole([\"admin\", \"subadmin\"]), async (req, res) => {\n  try {\n    const matchId = parseInt(req.params.matchId);\n    if (isNaN(matchId)) {\n      return res.status(400).json({ message: \"Invalid match ID\" });\n    }\n    \n    // Join games with users to get usernames\n    const bets = await db.select({\n      id: games.id,\n      userId: games.userId,\n      username: users.username,\n      betAmount: games.betAmount,\n      prediction: games.prediction,\n      result: games.result,\n      payout: games.payout,\n      createdAt: games.createdAt,\n      gameData: games.gameData,\n    })\n    .from(games)\n    .innerJoin(users, eq(games.userId, users.id))\n    .where(\n      and(\n        eq(games.matchId, matchId),\n        eq(games.gameType, GameType.CRICKET_TOSS)\n      )\n    )\n    .orderBy(desc(games.createdAt));\n    \n    // Calculate potential win for each bet\n    const betsWithPotential = bets.map(bet => {\n      const gameData = bet.gameData as any;\n      const odds = bet.prediction === 'team_a' ? gameData.oddTeamA : gameData.oddTeamB;\n      const potential = Math.floor(bet.betAmount * (odds / 100));\n      \n      return {\n        ...bet,\n        potential\n      };\n    });\n    \n    res.json(betsWithPotential);\n  } catch (error) {\n    console.error(`Error fetching bets for match ${req.params.matchId}:`, error);\n    res.status(500).json({ message: \"Failed to fetch bets for this match\" });\n  }\n});\n\nexport default router;","path":null,"size_bytes":24199,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"clear-game-data-safe.js":{"content":"/**\n * This script safely removes all game data including:\n * - Games (all types: coin flip, Satamatka, cricket toss, team match)\n * - Team matches\n * - Satamatka markets\n * \n * It PRESERVES:\n * - User accounts and balances\n * - Transactions (wallet history)\n * - System settings\n * - Commissions and odds\n * - Admin configurations\n * \n * Use this script to reset the platform's game data without affecting\n * user accounts or wallet history.\n */\n\nimport pg from 'pg';\nimport { createRequire } from 'module';\nconst require = createRequire(import.meta.url);\nconst dotenv = require('dotenv');\ndotenv.config();\n\nconst { Pool } = pg;\n\n// Create a PostgreSQL connection pool\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL\n});\n\nasync function clearGameData() {\n  const client = await pool.connect();\n  \n  try {\n    console.log(\"Starting game data cleanup...\");\n    console.log(\"IMPORTANT: This will remove ALL game data but preserve user accounts and transactions\");\n    \n    // Begin transaction\n    await client.query('BEGIN');\n    \n    // 0. Check if we have foreign key constraints that might cause issues\n    console.log(\"Checking for constraints that might block deletion...\");\n    \n    // 1. Delete all games (safer approach: filter by game type)\n    console.log(\"Removing all games...\");\n    const gameTypes = ['coin_flip', 'satamatka', 'cricket_toss', 'team_match'];\n    \n    let totalGamesRemoved = 0;\n    for (const gameType of gameTypes) {\n      const deleteResult = await client.query('DELETE FROM \"games\" WHERE \"game_type\" = $1', [gameType]);\n      console.log(`Removed ${deleteResult.rowCount} ${gameType} games`);\n      totalGamesRemoved += deleteResult.rowCount;\n    }\n    console.log(`Total games removed: ${totalGamesRemoved}`);\n    \n    // 2. Delete all team matches\n    console.log(\"Removing all team matches...\");\n    const deleteTeamMatchesResult = await client.query('DELETE FROM \"team_matches\"');\n    console.log(`Removed ${deleteTeamMatchesResult.rowCount} team matches`);\n    \n    // 3. Delete all Satamatka markets\n    console.log(\"Removing all Satamatka markets...\");\n    const deleteSatamatkaMarketsResult = await client.query('DELETE FROM \"satamatka_markets\"');\n    console.log(`Removed ${deleteSatamatkaMarketsResult.rowCount} Satamatka markets`);\n    \n    // 4. Reset sequence counters if tables are empty\n    console.log(\"Checking if tables are empty before resetting sequences...\");\n    \n    const gamesCount = await client.query('SELECT COUNT(*) FROM \"games\"');\n    if (parseInt(gamesCount.rows[0].count) === 0) {\n      console.log(\"Resetting games sequence counter...\");\n      await client.query('ALTER SEQUENCE \"games_id_seq\" RESTART WITH 1');\n    } else {\n      console.log(`Games table still has ${gamesCount.rows[0].count} records, not resetting sequence`);\n    }\n    \n    const teamMatchesCount = await client.query('SELECT COUNT(*) FROM \"team_matches\"');\n    if (parseInt(teamMatchesCount.rows[0].count) === 0) {\n      console.log(\"Resetting team_matches sequence counter...\");\n      await client.query('ALTER SEQUENCE \"team_matches_id_seq\" RESTART WITH 1');\n    } else {\n      console.log(`Team matches table still has ${teamMatchesCount.rows[0].count} records, not resetting sequence`);\n    }\n    \n    const satamatkaMarketsCount = await client.query('SELECT COUNT(*) FROM \"satamatka_markets\"');\n    if (parseInt(satamatkaMarketsCount.rows[0].count) === 0) {\n      console.log(\"Resetting satamatka_markets sequence counter...\");\n      await client.query('ALTER SEQUENCE \"satamatka_markets_id_seq\" RESTART WITH 1');\n    } else {\n      console.log(`Satamatka markets table still has ${satamatkaMarketsCount.rows[0].count} records, not resetting sequence`);\n    }\n    \n    // Commit transaction\n    await client.query('COMMIT');\n    \n    console.log(\"Game data cleanup completed successfully!\");\n    console.log(\"All game data has been removed while preserving user accounts and transaction history.\");\n    \n  } catch (error) {\n    // Rollback in case of error\n    await client.query('ROLLBACK');\n    console.error(\"Error clearing game data:\", error);\n    throw error;\n  } finally {\n    // Release the client back to the pool\n    client.release();\n  }\n}\n\n// Ask for confirmation before proceeding\nconsole.log(\"WARNING: This will permanently delete ALL game data from the system.\");\nconsole.log(\"User accounts, balances, and transaction history will be preserved.\");\nconsole.log(\"Type 'DELETE ALL GAME DATA' to confirm, or press Ctrl+C to cancel.\");\n\nconst readline = require('readline').createInterface({\n  input: process.stdin,\n  output: process.stdout\n});\n\nreadline.question('Confirmation: ', (answer) => {\n  if (answer === 'DELETE ALL GAME DATA') {\n    readline.close();\n    \n    // Run the cleanup\n    clearGameData()\n      .then(() => {\n        console.log(\"Cleanup script completed successfully. You can now restart the server.\");\n        process.exit(0);\n      })\n      .catch(error => {\n        console.error(\"Cleanup script failed:\", error);\n        process.exit(1);\n      });\n  } else {\n    console.log(\"Cleanup cancelled. No data was deleted.\");\n    readline.close();\n    process.exit(0);\n  }\n});","path":null,"size_bytes":5165,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        if (setOpenProp) {\n          return setOpenProp?.(\n            typeof value === \"function\" ? value(open) : value\n          )\n        }\n\n        _setOpen(value)\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${open}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full text-sidebar-foreground has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"rounded-md h-8 flex gap-2 px-2 items-center\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":23337,"size_tokens":null},"clean-all-game-data.js":{"content":"/**\n * This script removes ALL game data from the system, including:\n * - Coin flip games\n * - Satamatka games and markets\n * - Cricket toss games\n * - Team match games and match data\n * \n * This allows administrators to start with a clean slate\n * and manually add real game data.\n */\n\nimport 'dotenv/config';\nimport pg from 'pg';\nconst { Pool } = pg;\n\nasync function connectToDatabase() {\n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n  });\n  \n  try {\n    const client = await pool.connect();\n    console.log('Connected to database');\n    return client;\n  } catch (err) {\n    console.error('Error connecting to database:', err);\n    process.exit(1);\n  }\n}\n\nasync function cleanAllGameData(client) {\n  try {\n    // Start transaction\n    await client.query('BEGIN');\n    \n    console.log('Starting complete game data cleanup...');\n    \n    // 1. Clean Satamatka data\n    console.log('Cleaning Satamatka data...');\n    \n    // Delete games linked to Satamatka markets\n    const satamatkaGamesResult = await client.query(\n      'DELETE FROM games WHERE market_id IN (SELECT id FROM satamatka_markets) RETURNING id'\n    );\n    console.log(`Deleted ${satamatkaGamesResult.rowCount} Satamatka games`);\n    \n    // Delete all Satamatka markets\n    const satamatkaMarketsResult = await client.query('DELETE FROM satamatka_markets RETURNING id');\n    console.log(`Deleted ${satamatkaMarketsResult.rowCount} Satamatka markets`);\n    \n    // 2. Clean Team Match data (including cricket toss)\n    console.log('Cleaning Team Match data...');\n    \n    // Delete games linked to team matches\n    const teamMatchGamesResult = await client.query(\n      'DELETE FROM games WHERE match_id IN (SELECT id FROM team_matches) RETURNING id'\n    );\n    console.log(`Deleted ${teamMatchGamesResult.rowCount} Team Match games`);\n    \n    // Delete all team matches\n    const teamMatchesResult = await client.query('DELETE FROM team_matches RETURNING id');\n    console.log(`Deleted ${teamMatchesResult.rowCount} Team Matches`);\n    \n    // 3. Clean Coin Flip and other standalone games\n    console.log('Cleaning Coin Flip and other standalone games...');\n    \n    // Delete all remaining games not linked to matches or markets\n    const otherGamesResult = await client.query(\n      'DELETE FROM games WHERE market_id IS NULL AND match_id IS NULL RETURNING id'\n    );\n    console.log(`Deleted ${otherGamesResult.rowCount} standalone games (Coin Flip, etc.)`);\n    \n    // Commit transaction\n    await client.query('COMMIT');\n    console.log('Successfully cleaned all game data');\n    \n    // Summary\n    const totalGamesRemoved = \n      satamatkaGamesResult.rowCount + \n      teamMatchGamesResult.rowCount + \n      otherGamesResult.rowCount;\n    \n    console.log('----- Summary -----');\n    console.log(`Total games removed: ${totalGamesRemoved}`);\n    console.log(`Satamatka markets removed: ${satamatkaMarketsResult.rowCount}`);\n    console.log(`Team matches removed: ${teamMatchesResult.rowCount}`);\n    console.log('-------------------');\n    \n  } catch (err) {\n    // Roll back transaction in case of error\n    await client.query('ROLLBACK');\n    console.error('Error cleaning game data:', err);\n    throw err;\n  }\n}\n\nasync function main() {\n  let client;\n  try {\n    client = await connectToDatabase();\n    await cleanAllGameData(client);\n    console.log('Operation completed successfully');\n  } catch (err) {\n    console.error('An error occurred:', err);\n  } finally {\n    if (client) {\n      client.release();\n      console.log('Database connection released');\n    }\n    process.exit(0);\n  }\n}\n\nmain();","path":null,"size_bytes":3610,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1184,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/pages/fund-management-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { UserRole, RequestStatus, RequestType, PaymentMode } from \"@shared/schema\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useForm } from \"react-hook-form\";\nimport * as z from \"zod\";\nimport { formatDistance } from \"date-fns\";\nimport { \n  ArrowDown, \n  ArrowUp, \n  CheckCircle2, \n  Coins, \n  Download, \n  ExternalLink, \n  Filter, \n  Info, \n  Loader2, \n  MoreHorizontal, \n  Search, \n  Trash, \n  Upload, \n  User, \n  Users, \n  XCircle \n} from \"lucide-react\";\n\n// Define the schema for admin's transaction\nconst adminTransactionSchema = z.object({\n  userId: z.number(),\n  amount: z.number().min(1, \"Amount must be at least 1\"),\n  transactionType: z.enum([\"deposit\", \"withdraw\"]),\n  notes: z.string().min(3, \"Notes are required\").max(200, \"Notes should be less than 200 characters\"),\n});\n\n// Define the schema for admin's wallet request review\nconst reviewRequestSchema = z.object({\n  requestId: z.number(),\n  status: z.enum([RequestStatus.APPROVED, RequestStatus.REJECTED]),\n  notes: z.string().max(200, \"Notes should be less than 200 characters\").optional(),\n});\n\nexport default function FundManagementPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const isAdmin = user?.role === UserRole.ADMIN;\n\n  // Tab state\n  const [activeTab, setActiveTab] = useState<string>(\"pending\");\n  \n  // Filter states\n  const [typeFilter, setTypeFilter] = useState<string>(\"all\");\n  const [searchTerm, setSearchTerm] = useState<string>(\"\");\n  \n  // Selected request for actions\n  const [selectedRequest, setSelectedRequest] = useState<any>(null);\n  \n  // Dialog states\n  const [isReviewDialogOpen, setIsReviewDialogOpen] = useState<boolean>(false);\n  const [isAdminTransactionDialogOpen, setIsAdminTransactionDialogOpen] = useState<boolean>(false);\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState<boolean>(false);\n  const [isViewDetailsDialogOpen, setIsViewDetailsDialogOpen] = useState<boolean>(false);\n  \n  // Review form\n  const reviewForm = useForm<z.infer<typeof reviewRequestSchema>>({\n    resolver: zodResolver(reviewRequestSchema),\n    defaultValues: {\n      requestId: 0,\n      status: RequestStatus.APPROVED,\n      notes: \"\",\n    },\n  });\n\n  // Admin transaction form\n  const adminTransactionForm = useForm<z.infer<typeof adminTransactionSchema>>({\n    resolver: zodResolver(adminTransactionSchema),\n    defaultValues: {\n      userId: 0,\n      amount: 0,\n      transactionType: \"deposit\",\n      notes: \"\",\n    },\n  });\n\n  // Get users for admin transactions\n  const { data: users = [] } = useQuery({\n    queryKey: [\"/api/users\"],\n    enabled: !!isAdmin && isAdminTransactionDialogOpen,\n  });\n\n  // Get all wallet requests\n  const { \n    data: walletRequests = [], \n    isLoading: isLoadingRequests,\n    isError: isErrorRequests,\n  } = useQuery({\n    queryKey: [\"/api/wallet/requests\", activeTab],\n    enabled: !!isAdmin,\n  });\n\n  // Mutation for reviewing a wallet request\n  const reviewRequestMutation = useMutation({\n    mutationFn: (data: z.infer<typeof reviewRequestSchema>) => {\n      return apiRequest(\"PATCH\", `/api/wallet/requests/${data.requestId}`, {\n        status: data.status,\n        notes: data.notes || undefined,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Request updated\",\n        description: \"The wallet request has been processed successfully.\",\n      });\n      setIsReviewDialogOpen(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet/requests\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to process the request. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mutation for admin transaction\n  const adminTransactionMutation = useMutation({\n    mutationFn: (data: z.infer<typeof adminTransactionSchema>) => {\n      return apiRequest(\"POST\", \"/api/admin/transactions\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Transaction completed\",\n        description: \"The transaction has been processed successfully.\",\n      });\n      setIsAdminTransactionDialogOpen(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet/requests\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to process the transaction. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mutation for deleting a wallet request\n  const deleteRequestMutation = useMutation({\n    mutationFn: (requestId: number) => {\n      return apiRequest(\"DELETE\", `/api/wallet/requests/${requestId}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Request deleted\",\n        description: \"The wallet request has been deleted successfully.\",\n      });\n      setIsDeleteDialogOpen(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet/requests\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete the request. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Handle review submission\n  const onReviewSubmit = (data: z.infer<typeof reviewRequestSchema>) => {\n    reviewRequestMutation.mutate(data);\n  };\n\n  // Handle admin transaction submission\n  const onAdminTransactionSubmit = (data: z.infer<typeof adminTransactionSchema>) => {\n    adminTransactionMutation.mutate(data);\n  };\n\n  // Handle request deletion\n  const handleDeleteRequest = () => {\n    if (selectedRequest?.id) {\n      deleteRequestMutation.mutate(selectedRequest.id);\n    }\n  };\n\n  // Open review dialog\n  const openReviewDialog = (request: any) => {\n    setSelectedRequest(request);\n    reviewForm.reset({\n      requestId: request.id,\n      status: RequestStatus.APPROVED,\n      notes: \"\",\n    });\n    setIsReviewDialogOpen(true);\n  };\n\n  // Open admin transaction dialog\n  const openAdminTransactionDialog = () => {\n    adminTransactionForm.reset({\n      userId: 0,\n      amount: 0,\n      transactionType: \"deposit\",\n      notes: \"\",\n    });\n    setIsAdminTransactionDialogOpen(true);\n  };\n\n  // Open delete dialog\n  const openDeleteDialog = (request: any) => {\n    setSelectedRequest(request);\n    setIsDeleteDialogOpen(true);\n  };\n\n  // Open view details dialog\n  const openViewDetailsDialog = (request: any) => {\n    setSelectedRequest(request);\n    setIsViewDetailsDialogOpen(true);\n  };\n\n  // Filter wallet requests based on current tab, type filter, and search term\n  const filteredRequests = walletRequests.filter((request: any) => {\n    const matchesTab = activeTab === \"all\" || request.status.toLowerCase() === activeTab;\n    \n    const matchesType = typeFilter === \"all\" || \n      (typeFilter === \"deposit\" && request.requestType === RequestType.DEPOSIT) ||\n      (typeFilter === \"withdraw\" && request.requestType === RequestType.WITHDRAWAL);\n    \n    const matchesSearch = searchTerm === \"\" || \n      (request.user && request.user.username.toLowerCase().includes(searchTerm.toLowerCase())) ||\n      request.userId.toString().includes(searchTerm);\n    \n    return matchesTab && matchesType && matchesSearch;\n  });\n\n  // Format date\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr);\n    return `${formatDistance(date, new Date(), { addSuffix: true })} (${date.toLocaleDateString()})`;\n  };\n\n  // Format amount\n  const formatAmount = (amount: number) => {\n    // No need to divide by 100 as amounts are stored as actual rupees\n    return amount.toFixed(2);\n  };\n\n  // Get status badge variant\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case RequestStatus.PENDING:\n        return <Badge className=\"bg-yellow-500\">Pending</Badge>;\n      case RequestStatus.APPROVED:\n        return <Badge className=\"bg-green-500\">Approved</Badge>;\n      case RequestStatus.REJECTED:\n        return <Badge className=\"bg-red-500\">Rejected</Badge>;\n      default:\n        return <Badge variant=\"outline\">Unknown</Badge>;\n    }\n  };\n\n  // Get request type badge\n  const getRequestTypeBadge = (type: string) => {\n    switch (type) {\n      case RequestType.DEPOSIT:\n        return (\n          <Badge variant=\"outline\" className=\"border-green-500 text-green-500\">\n            <ArrowUp className=\"h-3 w-3 mr-1\" />\n            Deposit\n          </Badge>\n        );\n      case RequestType.WITHDRAWAL:\n        return (\n          <Badge variant=\"outline\" className=\"border-red-500 text-red-500\">\n            <ArrowDown className=\"h-3 w-3 mr-1\" />\n            Withdraw\n          </Badge>\n        );\n      default:\n        return <Badge variant=\"outline\">Unknown</Badge>;\n    }\n  };\n\n  // Get payment mode display\n  const getPaymentModeDisplay = (mode: PaymentMode) => {\n    switch (mode) {\n      case PaymentMode.UPI:\n        return \"UPI\";\n      case PaymentMode.BANK:\n        return \"Bank Transfer\";\n      default:\n        return mode;\n    }\n  };\n\n  // Render wallet requests table\n  const renderRequestsTable = () => {\n    if (isLoadingRequests) {\n      return (\n        <div className=\"flex justify-center py-8\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      );\n    }\n\n    if (isErrorRequests) {\n      return (\n        <div className=\"py-8 text-center\">\n          <XCircle className=\"h-8 w-8 text-red-500 mx-auto mb-2\" />\n          <p className=\"text-muted-foreground\">Failed to load wallet requests. Please try again.</p>\n        </div>\n      );\n    }\n\n    if (filteredRequests.length === 0) {\n      return (\n        <div className=\"py-8 text-center\">\n          <Info className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\n          <p className=\"text-muted-foreground\">No requests found.</p>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"overflow-x-auto\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>User</TableHead>\n              <TableHead>Type</TableHead>\n              <TableHead>Amount</TableHead>\n              <TableHead>Payment Mode</TableHead>\n              <TableHead>Status</TableHead>\n              <TableHead>Date</TableHead>\n              <TableHead className=\"text-right\">Actions</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {filteredRequests.map((request: any) => (\n              <TableRow key={request.id}>\n                <TableCell className=\"font-medium\">\n                  <div className=\"flex items-center gap-2\">\n                    <User className=\"h-4 w-4 text-muted-foreground\" />\n                    {request.user?.username || `User #${request.userId}`}\n                  </div>\n                </TableCell>\n                <TableCell>{getRequestTypeBadge(request.requestType)}</TableCell>\n                <TableCell className=\"font-semibold\">\n                  {formatAmount(request.amount)}\n                </TableCell>\n                <TableCell>\n                  {getPaymentModeDisplay(request.paymentMode)}\n                </TableCell>\n                <TableCell>{getStatusBadge(request.status)}</TableCell>\n                <TableCell>{formatDate(request.createdAt)}</TableCell>\n                <TableCell className=\"text-right\">\n                  <div className=\"flex justify-end gap-2\">\n                    <Button \n                      variant=\"ghost\" \n                      size=\"icon\"\n                      onClick={() => openViewDetailsDialog(request)}\n                    >\n                      <Info className=\"h-4 w-4\" />\n                    </Button>\n                    \n                    {request.status === RequestStatus.PENDING && (\n                      <Button \n                        variant=\"ghost\" \n                        size=\"icon\"\n                        onClick={() => openReviewDialog(request)}\n                      >\n                        <CheckCircle2 className=\"h-4 w-4\" />\n                      </Button>\n                    )}\n                    \n                    <Button \n                      variant=\"ghost\" \n                      size=\"icon\"\n                      onClick={() => openDeleteDialog(request)}\n                    >\n                      <Trash className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </div>\n    );\n  };\n\n  // If not admin, show unauthorized message\n  if (!isAdmin) {\n    return (\n      <DashboardLayout title=\"Fund Management\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Unauthorized Access</CardTitle>\n            <CardDescription>\n              You don't have permission to access this page\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground\">\n              This page is only accessible to administrators. If you believe this is an error, please contact support.\n            </p>\n          </CardContent>\n        </Card>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout title=\"Fund Management\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-bold\">Fund Management</h1>\n        <p className=\"text-muted-foreground\">\n          Manage deposit and withdrawal requests from users\n        </p>\n      </div>\n      \n      <div className=\"flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4\">\n        <div className=\"flex flex-col md:flex-row gap-4 md:items-center\">\n          <div className=\"flex items-center gap-2\">\n            <Filter className=\"h-4 w-4 text-muted-foreground\" />\n            <Label>Filter:</Label>\n          </div>\n          \n          <Select value={typeFilter} onValueChange={setTypeFilter}>\n            <SelectTrigger className=\"w-full md:w-40\">\n              <SelectValue placeholder=\"Request type\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Requests</SelectItem>\n              <SelectItem value=\"deposit\">Deposits Only</SelectItem>\n              <SelectItem value=\"withdraw\">Withdrawals Only</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n        \n        <div className=\"flex items-center gap-4\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-2 top-3 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search user...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-8 w-full md:w-60\"\n            />\n          </div>\n          \n          <Button onClick={openAdminTransactionDialog}>\n            <Coins className=\"h-4 w-4 mr-2\" />\n            Add Transaction\n          </Button>\n        </div>\n      </div>\n      \n      <Card>\n        <CardHeader className=\"pb-2\">\n          <CardTitle>Wallet Requests</CardTitle>\n          <CardDescription>\n            Manage and process user deposit and withdrawal requests\n          </CardDescription>\n        </CardHeader>\n        \n        <CardContent>\n          <Tabs defaultValue=\"pending\" value={activeTab} onValueChange={setActiveTab}>\n            <TabsList className=\"mb-6 grid grid-cols-4 md:w-auto\">\n              <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n              <TabsTrigger value=\"approved\">Approved</TabsTrigger>\n              <TabsTrigger value=\"rejected\">Rejected</TabsTrigger>\n              <TabsTrigger value=\"all\">All Requests</TabsTrigger>\n            </TabsList>\n            \n            <TabsContent value={activeTab} className=\"mt-0\">\n              {renderRequestsTable()}\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n      \n      {/* Review Request Dialog */}\n      <Dialog open={isReviewDialogOpen} onOpenChange={setIsReviewDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Review Request</DialogTitle>\n            <DialogDescription>\n              Review and process this wallet request.\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedRequest && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"font-medium\">User:</span>\n                <span>{selectedRequest.user?.username || `User #${selectedRequest.userId}`}</span>\n              </div>\n              \n              <div className=\"flex items-center justify-between\">\n                <span className=\"font-medium\">Request Type:</span>\n                <span>{getRequestTypeBadge(selectedRequest.requestType)}</span>\n              </div>\n              \n              <div className=\"flex items-center justify-between\">\n                <span className=\"font-medium\">Amount:</span>\n                <span className=\"font-semibold\">{formatAmount(selectedRequest.amount)}</span>\n              </div>\n              \n              <div className=\"flex items-center justify-between\">\n                <span className=\"font-medium\">Payment Mode:</span>\n                <span>{getPaymentModeDisplay(selectedRequest.paymentMode)}</span>\n              </div>\n              \n              <Separator />\n              \n              <Form {...reviewForm}>\n                <form onSubmit={reviewForm.handleSubmit(onReviewSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={reviewForm.control}\n                    name=\"status\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Decision</FormLabel>\n                        <Select\n                          onValueChange={field.onChange}\n                          defaultValue={field.value}\n                        >\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select decision\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value={RequestStatus.APPROVED}>Approve</SelectItem>\n                            <SelectItem value={RequestStatus.REJECTED}>Reject</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  \n                  <FormField\n                    control={reviewForm.control}\n                    name=\"notes\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Notes (Optional)</FormLabel>\n                        <FormControl>\n                          <Textarea\n                            placeholder=\"Add optional notes for this decision\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormDescription>\n                          These notes may be visible to the user.\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  \n                  <DialogFooter>\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => setIsReviewDialogOpen(false)}\n                      type=\"button\"\n                    >\n                      Cancel\n                    </Button>\n                    <Button type=\"submit\" disabled={reviewRequestMutation.isPending}>\n                      {reviewRequestMutation.isPending && (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      )}\n                      Confirm Decision\n                    </Button>\n                  </DialogFooter>\n                </form>\n              </Form>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n      \n      {/* Admin Transaction Dialog */}\n      <Dialog open={isAdminTransactionDialogOpen} onOpenChange={setIsAdminTransactionDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Create Transaction</DialogTitle>\n            <DialogDescription>\n              Add funds or deduct from a user's account.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <Form {...adminTransactionForm}>\n            <form onSubmit={adminTransactionForm.handleSubmit(onAdminTransactionSubmit)} className=\"space-y-4\">\n              <FormField\n                control={adminTransactionForm.control}\n                name=\"userId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>User</FormLabel>\n                    <Select\n                      onValueChange={(value) => field.onChange(parseInt(value))}\n                      defaultValue={field.value.toString()}\n                    >\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select user\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {users.map((user: any) => (\n                          <SelectItem key={user.id} value={user.id.toString()}>\n                            {user.username}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={adminTransactionForm.control}\n                name=\"transactionType\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Transaction Type</FormLabel>\n                    <Select\n                      onValueChange={field.onChange}\n                      defaultValue={field.value}\n                    >\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select type\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"deposit\">Add Funds (Deposit)</SelectItem>\n                        <SelectItem value=\"withdraw\">Deduct Funds (Withdraw)</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={adminTransactionForm.control}\n                name=\"amount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Amount ()</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        min=\"1\"\n                        step=\"1\"\n                        placeholder=\"Enter amount\"\n                        {...field}\n                        onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                      />\n                    </FormControl>\n                    <FormDescription>\n                      Enter the amount in rupees.\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={adminTransactionForm.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Notes</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Add notes for this transaction\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormDescription>\n                      These notes will be recorded with the transaction.\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <DialogFooter>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setIsAdminTransactionDialogOpen(false)}\n                  type=\"button\"\n                >\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={adminTransactionMutation.isPending}>\n                  {adminTransactionMutation.isPending && (\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  )}\n                  Create Transaction\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Delete Request Dialog */}\n      <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Request</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this request? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={handleDeleteRequest}\n              className=\"bg-red-500 hover:bg-red-600\"\n            >\n              {deleteRequestMutation.isPending && (\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n              )}\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n      \n      {/* View Details Dialog */}\n      <Dialog open={isViewDetailsDialogOpen} onOpenChange={setIsViewDetailsDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Request Details</DialogTitle>\n            <DialogDescription>\n              Detailed information about this request.\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedRequest && (\n            <div className=\"space-y-4\">\n              <div className=\"rounded-md border p-4 space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">User:</span>\n                  <span className=\"font-medium\">{selectedRequest.user?.username || `User #${selectedRequest.userId}`}</span>\n                </div>\n                \n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Request Type:</span>\n                  <span>{getRequestTypeBadge(selectedRequest.requestType)}</span>\n                </div>\n                \n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Amount:</span>\n                  <span className=\"font-semibold\">{formatAmount(selectedRequest.amount)}</span>\n                </div>\n                \n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Payment Mode:</span>\n                  <span>{getPaymentModeDisplay(selectedRequest.paymentMode)}</span>\n                </div>\n                \n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Status:</span>\n                  <span>{getStatusBadge(selectedRequest.status)}</span>\n                </div>\n                \n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Created:</span>\n                  <span>{formatDate(selectedRequest.createdAt)}</span>\n                </div>\n              </div>\n              \n              <Separator />\n              \n              {selectedRequest.paymentDetails && (\n                <div>\n                  <h3 className=\"font-medium mb-2\">Payment Details</h3>\n                  <div className=\"rounded-md border p-4 space-y-3\">\n                    {selectedRequest.paymentMode === PaymentMode.UPI && (\n                      <>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-sm text-muted-foreground\">UPI ID:</span>\n                          <span>{selectedRequest.paymentDetails.upiId || \"\"}</span>\n                        </div>\n                      </>\n                    )}\n                    \n                    {selectedRequest.paymentMode === PaymentMode.BANK && (\n                      <>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-sm text-muted-foreground\">Bank Name:</span>\n                          <span>{selectedRequest.paymentDetails.bankName || \"\"}</span>\n                        </div>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-sm text-muted-foreground\">Account Number:</span>\n                          <span>{selectedRequest.paymentDetails.accountNumber || \"\"}</span>\n                        </div>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-sm text-muted-foreground\">IFSC Code:</span>\n                          <span>{selectedRequest.paymentDetails.ifscCode || \"\"}</span>\n                        </div>\n                      </>\n                    )}\n                    \n\n                    \n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-muted-foreground\">Transaction/UTR ID:</span>\n                      <span>\n                        {selectedRequest.paymentDetails.utrNumber || \n                          selectedRequest.paymentDetails.transactionId || \"\"}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              )}\n              \n              {selectedRequest.proofImageUrl && (\n                <div>\n                  <h3 className=\"font-medium mb-2\">Proof of Payment</h3>\n                  <div className=\"rounded-md border p-4\">\n                    <a \n                      href={selectedRequest.proofImageUrl} \n                      target=\"_blank\" \n                      rel=\"noopener noreferrer\"\n                      className=\"flex items-center text-primary hover:underline\"\n                    >\n                      <ExternalLink className=\"h-4 w-4 mr-2\" />\n                      View Proof Image\n                    </a>\n                  </div>\n                </div>\n              )}\n              \n              {selectedRequest.notes && (\n                <div>\n                  <h3 className=\"font-medium mb-2\">Notes</h3>\n                  <div className=\"rounded-md border p-4\">\n                    <p className=\"text-sm\">{selectedRequest.notes}</p>\n                  </div>\n                </div>\n              )}\n              \n              {selectedRequest.reviewedBy && (\n                <div>\n                  <h3 className=\"font-medium mb-2\">Reviewed By</h3>\n                  <div className=\"rounded-md border p-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <User className=\"h-4 w-4 text-muted-foreground\" />\n                      <span>\n                        {selectedRequest.reviewer?.username || `Admin #${selectedRequest.reviewedBy}`}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              )}\n              \n              <DialogFooter>\n                <Button \n                  onClick={() => setIsViewDetailsDialogOpen(false)}\n                >\n                  Close\n                </Button>\n              </DialogFooter>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":33944,"size_tokens":null},"client/src/pages/game-page.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport CoinFlipGame from \"@/components/coin-flip-game\";\nimport GameHistoryTable from \"@/components/game-history-table\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useLocation } from \"wouter\";\n\nexport default function GamePage() {\n  const { user } = useAuth();\n  const [_, setLocation] = useLocation();\n  \n  // Import Game type from the game-history-table component\n  type Game = React.ComponentProps<typeof GameHistoryTable>['games'][number];\n  \n  // Fetch recent games for the user, filtered by coin_flip game type\n  const { data: games = [], isLoading } = useQuery<Game[]>({\n    queryKey: [\"/api/games/my-history\"],\n    enabled: !!user,\n  });\n  \n  // Filter only coinflip games\n  const coinFlipGames = games.filter(game => game.gameType === \"coin_flip\");\n  \n  return (\n    <DashboardLayout title=\"Royal Coin Toss\">\n      {/* Coin Toss Game */}\n      <CoinFlipGame />\n      \n      {/* Recent Bets History */}\n      <div className=\"mt-8\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-xl font-bold\">Recent Coin Flip Bets</CardTitle>\n            <CardDescription>\n              Your last 10 coin flip bets and their results\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n              </div>\n            ) : (\n              <>\n                <GameHistoryTable games={coinFlipGames} />\n                \n                {coinFlipGames.length > 0 && (\n                  <div className=\"mt-4 flex justify-center\">\n                    <Button\n                      onClick={() => setLocation(\"/game-history\")}\n                      variant=\"outline\"\n                      className=\"border-slate-700 text-blue-300 hover:bg-slate-800 hover:text-blue-200\"\n                    >\n                      View Full Game History\n                    </Button>\n                  </div>\n                )}\n              </>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":2422,"size_tokens":null},"server/storage.ts":{"content":"import { db } from \"./db\";\nimport { \n  users, \n  games, \n  satamatkaMarkets,\n  teamMatches,\n  systemSettings,\n  subadminCommissions,\n  userDiscounts,\n  playerDepositDiscounts,\n  gameOdds,\n  transactions,\n  walletRequests,\n  depositCommissions,\n  User, \n  InsertUser, \n  Game, \n  InsertGame, \n  UserRole, \n  SatamatkaMarket,\n  InsertSatamatkaMarket,\n  TeamMatch,\n  InsertTeamMatch,\n  SystemSetting,\n  MarketStatus,\n  RecurrencePattern,\n  InsertSystemSetting,\n  SubadminCommission,\n  InsertSubadminCommission,\n  UserDiscount,\n  InsertUserDiscount,\n  PlayerDepositDiscount,\n  InsertPlayerDepositDiscount,\n  GameOdd,\n  InsertGameOdd,\n  Transaction,\n  InsertTransaction,\n  RequestType,\n  RequestStatus,\n  InsertWalletRequest,\n  WalletRequest,\n  PaymentMode,\n  GameType\n} from \"@shared/schema\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\nimport { eq, desc, and, lt, gt, gte, lte, ne, isNotNull, or, sql, asc, count, isNull, like, not } from 'drizzle-orm';\nimport { pool } from \"./db\";\n\n/**\n * Storage interface for database operations\n */\nexport interface IStorage {\n  // User methods\n  getUser(id: number): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  getAllUsers(): Promise<User[]>;\n  getUsersByAssignedTo(assignedToId: number): Promise<User[]>;\n  getUsersByIds(userIds: number[]): Promise<User[]>;\n  updateUserBalance(userId: number, newBalance: number): Promise<User | undefined>;\n  updateUser(userId: number, data: {username?: string; password?: string}): Promise<User | undefined>;\n  updateUserPassword(userId: number, hashedPassword: string): Promise<User | undefined>;\n  blockUser(userId: number, blockedById: number): Promise<User | undefined>;\n  unblockUser(userId: number): Promise<User | undefined>;\n  getBlockedByUser(userId: number): Promise<number | null>;\n  assignUserToAdmin(userId: number, adminId: number): Promise<User | undefined>;\n  deleteUser(userId: number): Promise<boolean>;\n  \n  // Game methods\n  createGame(game: InsertGame): Promise<Game>;\n  getGame(id: number): Promise<Game | undefined>;\n  getGamesByUserId(userId: number): Promise<Game[]>;\n  getGamesByUserIds(userIds: number[]): Promise<Game[]>;\n  getAllGames(limit?: number): Promise<Game[]>;\n  getActiveGames(): Promise<Game[]>;\n  getRecentGames(userId: number, limit?: number): Promise<Game[]>;\n  updateGameStatus(gameId: number, status: string): Promise<Game | undefined>;\n  updateGameResult(gameId: number, result: string, payout?: number): Promise<Game | undefined>;\n\n  // Satamatka Market methods\n  createSatamatkaMarket(market: InsertSatamatkaMarket): Promise<SatamatkaMarket>;\n  getSatamatkaMarket(id: number): Promise<SatamatkaMarket | undefined>;\n  getAllSatamatkaMarkets(): Promise<SatamatkaMarket[]>;\n  getActiveSatamatkaMarkets(): Promise<SatamatkaMarket[]>;\n  getMarketsForJantri(): Promise<SatamatkaMarket[]>; // Returns markets pending results (WAITING, OPEN, CLOSED)\n  updateSatamatkaMarket(id: number, data: Partial<InsertSatamatkaMarket>): Promise<SatamatkaMarket | undefined>;\n  updateSatamatkaMarketResults(id: number, openResult?: string, closeResult?: string): Promise<SatamatkaMarket | undefined>;\n  updateSatamatkaMarketStatus(id: number, status: string): Promise<SatamatkaMarket | undefined>;\n  getSatamatkaGamesByMarketId(marketId: number): Promise<Game[]>;\n  getRecentMarketResults(limit?: number): Promise<SatamatkaMarket[]>;\n  getMarketResultsByDateRange(startDate: Date, endDate: Date): Promise<SatamatkaMarket[]>;\n\n  // Team Match methods\n  createTeamMatch(match: InsertTeamMatch): Promise<TeamMatch>;\n  getTeamMatch(id: number): Promise<TeamMatch | undefined>;\n  getAllTeamMatches(): Promise<TeamMatch[]>;\n  getActiveTeamMatches(): Promise<TeamMatch[]>;\n  updateTeamMatch(id: number, data: Partial<InsertTeamMatch>): Promise<TeamMatch | undefined>;\n  updateTeamMatchResult(id: number, result: string): Promise<TeamMatch | undefined>;\n  updateTeamMatchStatus(id: number, status: string): Promise<TeamMatch | undefined>;\n  getTeamMatchesByCategory(category: string): Promise<TeamMatch[]>; \n  getTeamMatchGamesByMatchId(matchId: number): Promise<Game[]>;\n\n  // Transaction methods\n  createTransaction(transaction: InsertTransaction): Promise<Transaction>;\n  getTransactionsByUserId(userId: number): Promise<Transaction[]>;\n  getAllTransactions(limit?: number): Promise<Transaction[]>;\n  getAllTransactionsByType(type: string): Promise<Transaction[]>;\n  getRecentTransactions(limit?: number): Promise<any[]>;\n  getWalletTransactionsByUserIds(userIds: number[]): Promise<Transaction[]>;\n\n  // System Settings methods\n  getSystemSetting(settingType: string, settingKey: string): Promise<SystemSetting | undefined>;\n  upsertSystemSetting(settingType: string, settingKey: string, settingValue: string): Promise<SystemSetting>;\n  getSystemSettingsByType(settingType: string): Promise<SystemSetting[]>;\n  \n  // Subadmin Commission methods\n  getSubadminCommissions(subadminId: number): Promise<SubadminCommission[]>;\n  upsertSubadminCommission(subadminId: number, gameType: string, commissionRate: number): Promise<SubadminCommission>;\n  \n  // User Discount methods\n  getUserDiscounts(userId: number, subadminId: number): Promise<UserDiscount[]>;\n  upsertUserDiscount(subadminId: number, userId: number, gameType: string, discountRate: number): Promise<UserDiscount>;\n  \n  // Player deposit discount methods\n  getPlayerDepositDiscount(userId: number, subadminId: number): Promise<PlayerDepositDiscount | undefined>;\n  upsertPlayerDepositDiscount(subadminId: number, userId: number, discountRate: number): Promise<PlayerDepositDiscount>;\n  \n  // Game Odds methods\n  getGameOdds(gameType: string, includeSubadminOdds?: boolean): Promise<GameOdd[]>;\n  getGameOddsBySubadmin(subadminId: number, gameType?: string): Promise<GameOdd[]>;\n  upsertGameOdd(gameType: string, oddValue: number, setByAdmin: boolean, subadminId?: number): Promise<GameOdd>;\n  getOddsForPlayer(userId: number, gameType: string): Promise<number>;\n\n  // Admin seeding methods\n  seedCricketTossGames(): Promise<void>;\n  seedDemoSatamatkaMarkets(): Promise<void>;\n\n  // Session store\n  sessionStore: session.Store;\n}\n\n/**\n * Database storage implementation for Postgres\n */\nexport class DatabaseStorage implements IStorage {\n  public sessionStore: session.Store;\n\n  constructor() {\n    const PgStore = connectPg(session);\n    this.sessionStore = new PgStore({\n      pool,\n      tableName: 'sessions'\n    });\n  }\n\n  // User methods\n  async getUser(id: number): Promise<User | undefined> {\n    const [user] = await db.select()\n      .from(users)\n      .where(eq(users.id, id))\n      .limit(1);\n    return user;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select()\n      .from(users)\n      .where(eq(users.username, username))\n      .limit(1);\n    return user;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db.insert(users)\n      .values(insertUser)\n      .returning();\n    return user;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users);\n  }\n\n  async getUsersByAssignedTo(assignedToId: number): Promise<User[]> {\n    return await db.select()\n      .from(users)\n      .where(eq(users.assignedTo, assignedToId));\n  }\n  \n  async getUserById(userId: number): Promise<User | null> {\n    const result = await db.select()\n      .from(users)\n      .where(eq(users.id, userId))\n      .limit(1);\n    \n    return result.length > 0 ? result[0] : null;\n  }\n\n  async getUsersByIds(userIds: number[]): Promise<User[]> {\n    if (!userIds.length) return [];\n    \n    // Just query once with all IDs since we can't use the instance method\n    const allUsers = await db.select()\n      .from(users);\n    \n    // Filter for the users we need\n    return allUsers.filter(user => userIds.includes(user.id));\n  }\n\n  async updateUserBalance(userId: number, newBalance: number): Promise<User | undefined> {\n    const [user] = await db.update(users)\n      .set({ balance: newBalance })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  async updateUser(userId: number, data: {username?: string; password?: string}): Promise<User | undefined> {\n    const [updatedUser] = await db.update(users)\n      .set(data)\n      .where(eq(users.id, userId))\n      .returning();\n    return updatedUser;\n  }\n\n  async updateUserPassword(userId: number, hashedPassword: string): Promise<User | undefined> {\n    const [updatedUser] = await db.update(users)\n      .set({ password: hashedPassword })\n      .where(eq(users.id, userId))\n      .returning();\n    return updatedUser;\n  }\n\n  async blockUser(userId: number, blockedById: number): Promise<User | undefined> {\n    const [blockedUser] = await db.update(users)\n      .set({ \n        isBlocked: true, \n        blockedBy: blockedById \n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return blockedUser;\n  }\n\n  async unblockUser(userId: number): Promise<User | undefined> {\n    const [unblockedUser] = await db.update(users)\n      .set({ \n        isBlocked: false, \n        blockedBy: null \n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return unblockedUser;\n  }\n\n  async getBlockedByUser(userId: number): Promise<number | null> {\n    const [user] = await db.select({ blockedBy: users.blockedBy })\n      .from(users)\n      .where(eq(users.id, userId))\n      .limit(1);\n    \n    return user?.blockedBy || null;\n  }\n\n  async assignUserToAdmin(userId: number, adminId: number): Promise<User | undefined> {\n    const [assignedUser] = await db.update(users)\n      .set({ assignedTo: adminId })\n      .where(eq(users.id, userId))\n      .returning();\n    return assignedUser;\n  }\n  \n  async deleteUser(userId: number): Promise<boolean> {\n    try {\n      // Execute each deletion separately to avoid multiple command issues\n      \n      // Delete from deposit_commissions first\n      await db.execute(sql`DELETE FROM deposit_commissions WHERE subadmin_id = ${userId}`);\n      \n      // Delete from game_odds  \n      await db.execute(sql`DELETE FROM game_odds WHERE subadmin_id = ${userId}`);\n      \n      // Delete transactions\n      await db.execute(sql`DELETE FROM transactions WHERE user_id = ${userId}`);\n      \n      // Delete games\n      await db.execute(sql`DELETE FROM games WHERE user_id = ${userId}`);\n      \n      // Update assigned users\n      await db.execute(sql`UPDATE users SET assigned_to = NULL WHERE assigned_to = ${userId}`);\n      \n      // Finally delete the user\n      await db.execute(sql`DELETE FROM users WHERE id = ${userId}`);\n      \n      return true;\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      return false;\n    }\n  }\n\n  // Game methods\n  async createGame(game: InsertGame): Promise<Game> {\n    const [createdGame] = await db.insert(games)\n      .values(game)\n      .returning();\n    return createdGame;\n  }\n\n  async getGame(id: number): Promise<Game | undefined> {\n    const [game] = await db.select()\n      .from(games)\n      .where(eq(games.id, id))\n      .limit(1);\n    return game;\n  }\n\n  async getGamesByUserId(userId: number): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(eq(games.userId, userId))\n      .orderBy(desc(games.createdAt));\n  }\n\n  async getGamesByUserIds(userIds: number[]): Promise<Game[]> {\n    if (!userIds.length) return [];\n    \n    return await db.select()\n      .from(games)\n      .where(sql`${games.userId} IN (${userIds.join(', ')})`)\n      .orderBy(desc(games.createdAt));\n  }\n\n  async getAllGames(limit?: number): Promise<Game[]> {\n    let query = db.select()\n      .from(games)\n      .orderBy(desc(games.createdAt));\n\n    if (limit) {\n      query = query.limit(limit);\n    }\n\n    return await query;\n  }\n\n  async getActiveGames(): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(\n        or(\n          isNull(games.result),\n          eq(games.result, 'pending')\n        )\n      ) // Games without a result or with result='pending' are considered active\n      .orderBy(desc(games.createdAt));\n  }\n\n  async getRecentGames(userId: number, limit?: number): Promise<Game[]> {\n    let query = db.select()\n      .from(games)\n      .where(eq(games.userId, userId))\n      .orderBy(desc(games.createdAt));\n\n    if (limit) {\n      query = query.limit(limit);\n    }\n\n    return await query;\n  }\n\n  async updateGameStatus(gameId: number, status: string): Promise<Game | undefined> {\n    const [game] = await db.update(games)\n      .set({ status })\n      .where(eq(games.id, gameId))\n      .returning();\n    return game;\n  }\n\n  async updateGameResult(gameId: number, result: string, payout?: number): Promise<Game | undefined> {\n    let updateData: any = { result };\n    if (payout !== undefined) {\n      updateData.payout = payout;\n    }\n    \n    const [game] = await db.update(games)\n      .set(updateData)\n      .where(eq(games.id, gameId))\n      .returning();\n    return game;\n  }\n\n  // Satamatka Market methods\n  async createSatamatkaMarket(market: InsertSatamatkaMarket): Promise<SatamatkaMarket> {\n    const [createdMarket] = await db.insert(satamatkaMarkets)\n      .values(market)\n      .returning();\n    return createdMarket;\n  }\n\n  async getSatamatkaMarket(id: number): Promise<SatamatkaMarket | undefined> {\n    const [market] = await db.select()\n      .from(satamatkaMarkets)\n      .where(eq(satamatkaMarkets.id, id))\n      .limit(1);\n    return market;\n  }\n  \n  async getSatamatkaMarketsByIds(marketIds: number[]): Promise<SatamatkaMarket[]> {\n    if (!marketIds.length) return [];\n    \n    // Query all markets and filter for the ones we need\n    const allMarkets = await db.select()\n      .from(satamatkaMarkets);\n    \n    // Filter for the markets we need\n    return allMarkets.filter(market => marketIds.includes(market.id));\n  }\n\n  async getAllSatamatkaMarkets(): Promise<SatamatkaMarket[]> {\n    return await db.select()\n      .from(satamatkaMarkets)\n      .orderBy(desc(satamatkaMarkets.createdAt));\n  }\n\n  async getActiveSatamatkaMarkets(): Promise<SatamatkaMarket[]> {\n    return await db.select()\n      .from(satamatkaMarkets)\n      .where(\n        or(\n          eq(satamatkaMarkets.status, MarketStatus.OPEN),\n          eq(satamatkaMarkets.status, MarketStatus.WAITING)\n        )\n      )\n      .orderBy(desc(satamatkaMarkets.createdAt));\n  }\n\n  async getMarketsForJantri(): Promise<SatamatkaMarket[]> {\n    return await db.select()\n      .from(satamatkaMarkets)\n      .where(\n        or(\n          eq(satamatkaMarkets.status, MarketStatus.OPEN),\n          eq(satamatkaMarkets.status, MarketStatus.WAITING),\n          eq(satamatkaMarkets.status, MarketStatus.CLOSED)\n        )\n      )\n      .orderBy(desc(satamatkaMarkets.createdAt));\n  }\n\n  async updateSatamatkaMarketResults(id: number, openResult?: string, closeResult?: string): Promise<SatamatkaMarket | undefined> {\n    let updateData: any = {};\n    \n    if (openResult !== undefined) {\n      updateData.openResult = openResult;\n    }\n    \n    if (closeResult !== undefined) {\n      updateData.closeResult = closeResult;\n    }\n    \n    const [updatedMarket] = await db.update(satamatkaMarkets)\n      .set(updateData)\n      .where(eq(satamatkaMarkets.id, id))\n      .returning();\n    \n    return updatedMarket;\n  }\n\n  async updateSatamatkaMarketStatus(id: number, status: string): Promise<SatamatkaMarket | undefined> {\n    const [updatedMarket] = await db.update(satamatkaMarkets)\n      .set({ status })\n      .where(eq(satamatkaMarkets.id, id))\n      .returning();\n    \n    return updatedMarket;\n  }\n  \n  async updateSatamatkaMarket(id: number, data: Partial<InsertSatamatkaMarket>): Promise<SatamatkaMarket | undefined> {\n    const [updatedMarket] = await db.update(satamatkaMarkets)\n      .set(data)\n      .where(eq(satamatkaMarkets.id, id))\n      .returning();\n    \n    return updatedMarket;\n  }\n\n  async getSatamatkaGamesByMarketId(marketId: number): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(eq(games.marketId, marketId))\n      .orderBy(desc(games.createdAt));\n  }\n\n  // Team Match methods\n  async createTeamMatch(match: InsertTeamMatch): Promise<TeamMatch> {\n    const [createdMatch] = await db.insert(teamMatches)\n      .values(match)\n      .returning();\n    return createdMatch;\n  }\n\n  async getTeamMatch(id: number): Promise<TeamMatch | undefined> {\n    const [match] = await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.id, id))\n      .limit(1);\n    return match;\n  }\n\n  async getAllTeamMatches(): Promise<TeamMatch[]> {\n    return await db.select()\n      .from(teamMatches)\n      .orderBy(desc(teamMatches.createdAt));\n  }\n\n  async getActiveTeamMatches(): Promise<TeamMatch[]> {\n    return await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.status, \"open\"))\n      .orderBy(desc(teamMatches.createdAt));\n  }\n\n  async updateTeamMatch(id: number, data: Partial<InsertTeamMatch>): Promise<TeamMatch | undefined> {\n    const [updatedMatch] = await db.update(teamMatches)\n      .set(data)\n      .where(eq(teamMatches.id, id))\n      .returning();\n    \n    return updatedMatch;\n  }\n\n  async updateTeamMatchResult(id: number, result: string): Promise<TeamMatch | undefined> {\n    const [updatedMatch] = await db.update(teamMatches)\n      .set({ result })\n      .where(eq(teamMatches.id, id))\n      .returning();\n    \n    return updatedMatch;\n  }\n\n  async updateTeamMatchStatus(id: number, status: string): Promise<TeamMatch | undefined> {\n    const [updatedMatch] = await db.update(teamMatches)\n      .set({ status })\n      .where(eq(teamMatches.id, id))\n      .returning();\n    \n    return updatedMatch;\n  }\n\n  async getTeamMatchesByCategory(category: string): Promise<TeamMatch[]> {\n    return await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.category, category))\n      .orderBy(desc(teamMatches.createdAt));\n  }\n\n  async getTeamMatchGamesByMatchId(matchId: number): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(eq(games.matchId, matchId))\n      .orderBy(desc(games.createdAt));\n  }\n\n  // Transaction methods\n  async createTransaction(transaction: InsertTransaction): Promise<Transaction> {\n    const [createdTransaction] = await db.insert(transactions)\n      .values(transaction)\n      .returning();\n    return createdTransaction;\n  }\n\n  async getTransactionsByUserId(userId: number): Promise<Transaction[]> {\n    return await db.select()\n      .from(transactions)\n      .where(eq(transactions.userId, userId))\n      .orderBy(desc(transactions.createdAt));\n  }\n\n  async getAllTransactions(limit?: number): Promise<Transaction[]> {\n    let query = db.select()\n      .from(transactions)\n      .orderBy(desc(transactions.createdAt));\n    \n    if (limit) {\n      query = query.limit(limit);\n    }\n    \n    return await query;\n  }\n  \n  async getWalletTransactionsByUserIds(userIds: number[]): Promise<Transaction[]> {\n    if (!userIds.length) return [];\n    \n    return await db.select()\n      .from(transactions)\n      .where(sql`${transactions.userId} IN (${userIds.join(', ')})`)\n      .orderBy(desc(transactions.createdAt));\n  }\n\n  async getAllTransactionsByType(type: string): Promise<Transaction[]> {\n    const queryType = type === \"deposit\" ? \">\" : \"<\";\n    \n    return await db.select()\n      .from(transactions)\n      .where(\n        type === \"deposit\" \n          ? gt(transactions.amount, 0) \n          : lt(transactions.amount, 0)\n      )\n      .orderBy(desc(transactions.createdAt));\n  }\n  \n  async getRecentTransactions(limit: number = 10): Promise<any[]> {\n    // Get transactions with user information\n    const result = await db.select({\n      id: transactions.id,\n      userId: transactions.userId,\n      amount: transactions.amount,\n      description: transactions.description,\n      createdAt: transactions.createdAt,\n      username: users.username\n    })\n    .from(transactions)\n    .leftJoin(users, eq(transactions.userId, users.id))\n    .orderBy(desc(transactions.createdAt))\n    .limit(limit);\n    \n    // Transform results to include transaction type based on amount\n    return result.map(tx => ({\n      ...tx,\n      type: tx.amount > 0 ? 'deposit' : 'withdrawal'\n    }));\n  }\n\n  // System Settings methods\n  async getSystemSetting(settingType: string, settingKey: string): Promise<SystemSetting | undefined> {\n    const [setting] = await db.select()\n      .from(systemSettings)\n      .where(\n        and(\n          eq(systemSettings.settingType, settingType),\n          eq(systemSettings.settingKey, settingKey)\n        )\n      )\n      .limit(1);\n    \n    return setting;\n  }\n\n  async upsertSystemSetting(settingType: string, settingKey: string, settingValue: string): Promise<SystemSetting> {\n    // Check if setting exists\n    const existing = await this.getSystemSetting(settingType, settingKey);\n    \n    if (existing) {\n      // Update existing setting\n      const [updated] = await db.update(systemSettings)\n        .set({ \n          settingValue,\n          updatedAt: new Date() \n        })\n        .where(eq(systemSettings.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new setting\n      const [created] = await db.insert(systemSettings)\n        .values({\n          settingType,\n          settingKey,\n          settingValue,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  async getSystemSettingsByType(settingType: string): Promise<SystemSetting[]> {\n    return await db.select()\n      .from(systemSettings)\n      .where(eq(systemSettings.settingType, settingType))\n      .orderBy(systemSettings.settingKey);\n  }\n\n  // Subadmin Commission methods\n  async getSubadminCommissions(subadminId: number): Promise<SubadminCommission[]> {\n    return await db.select()\n      .from(subadminCommissions)\n      .where(eq(subadminCommissions.subadminId, subadminId))\n      .orderBy(subadminCommissions.gameType);\n  }\n\n  async upsertSubadminCommission(subadminId: number, gameType: string, commissionRate: number): Promise<SubadminCommission> {\n    // Check if commission already exists\n    const [existing] = await db.select()\n      .from(subadminCommissions)\n      .where(\n        and(\n          eq(subadminCommissions.subadminId, subadminId),\n          eq(subadminCommissions.gameType, gameType)\n        )\n      );\n    \n    if (existing) {\n      // Update existing commission\n      const [updated] = await db.update(subadminCommissions)\n        .set({ \n          commissionRate,\n          updatedAt: new Date() \n        })\n        .where(eq(subadminCommissions.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new commission\n      const [created] = await db.insert(subadminCommissions)\n        .values({\n          subadminId,\n          gameType,\n          commissionRate,\n          isActive: true,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  // User Discount methods\n  async getUserDiscounts(userId: number, subadminId: number): Promise<UserDiscount[]> {\n    return await db.select()\n      .from(userDiscounts)\n      .where(\n        and(\n          eq(userDiscounts.userId, userId),\n          eq(userDiscounts.subadminId, subadminId)\n        )\n      )\n      .orderBy(userDiscounts.gameType);\n  }\n\n  async upsertUserDiscount(subadminId: number, userId: number, gameType: string, discountRate: number): Promise<UserDiscount> {\n    // Check if discount already exists\n    const [existing] = await db.select()\n      .from(userDiscounts)\n      .where(\n        and(\n          eq(userDiscounts.subadminId, subadminId),\n          eq(userDiscounts.userId, userId),\n          eq(userDiscounts.gameType, gameType)\n        )\n      );\n    \n    if (existing) {\n      // Update existing discount\n      const [updated] = await db.update(userDiscounts)\n        .set({ \n          discountRate,\n          updatedAt: new Date()\n        })\n        .where(eq(userDiscounts.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new discount\n      const [created] = await db.insert(userDiscounts)\n        .values({\n          subadminId,\n          userId,\n          gameType,\n          discountRate,\n          isActive: true,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  // Player Deposit Discount methods\n  async getPlayerDepositDiscount(userId: number, subadminId: number): Promise<PlayerDepositDiscount | undefined> {\n    const [discount] = await db.select()\n      .from(playerDepositDiscounts)\n      .where(\n        and(\n          eq(playerDepositDiscounts.userId, userId),\n          eq(playerDepositDiscounts.subadminId, subadminId)\n        )\n      );\n    \n    return discount;\n  }\n\n  async upsertPlayerDepositDiscount(subadminId: number, userId: number, discountRate: number): Promise<PlayerDepositDiscount> {\n    // Check if discount already exists\n    const [existing] = await db.select()\n      .from(playerDepositDiscounts)\n      .where(\n        and(\n          eq(playerDepositDiscounts.subadminId, subadminId),\n          eq(playerDepositDiscounts.userId, userId)\n        )\n      );\n    \n    if (existing) {\n      // Update existing discount\n      const [updated] = await db.update(playerDepositDiscounts)\n        .set({ \n          discountRate,\n          updatedAt: new Date()\n        })\n        .where(eq(playerDepositDiscounts.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new discount\n      const [created] = await db.insert(playerDepositDiscounts)\n        .values({\n          subadminId,\n          userId,\n          discountRate,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  // Game Odds methods\n  async getGameOdds(gameType: string, includeSubadminOdds: boolean = true): Promise<GameOdd[]> {\n    // If we want all odds (admin + subadmin), just filter by game type\n    if (includeSubadminOdds) {\n      return await db.select()\n        .from(gameOdds)\n        .where(eq(gameOdds.gameType, gameType));\n    } \n    // Otherwise just get admin odds (legacy behavior)\n    else {\n      return await db.select()\n        .from(gameOdds)\n        .where(\n          and(\n            eq(gameOdds.gameType, gameType),\n            eq(gameOdds.setByAdmin, true)\n          )\n        );\n    }\n  }\n\n  async getGameOddsBySubadmin(subadminId: number, gameType?: string): Promise<GameOdd[]> {\n    let query = db.select()\n      .from(gameOdds)\n      .where(eq(gameOdds.subadminId, subadminId));\n    \n    if (gameType) {\n      query = query.where(eq(gameOdds.gameType, gameType));\n    }\n    \n    return await query;\n  }\n  \n  // Get game odd by type and subadmin - used for risk management\n  async getGameOddBySubadminAndType(subadminId: number, gameType: string): Promise<GameOdd | undefined> {\n    try {\n      const odds = await db.select()\n        .from(gameOdds)\n        .where(and(\n          eq(gameOdds.subadminId, subadminId),\n          eq(gameOdds.gameType, gameType)\n        ));\n      return odds.length > 0 ? odds[0] : undefined;\n    } catch (error) {\n      console.error(`Error getting game odd for subadmin ${subadminId} and type ${gameType}:`, error);\n      return undefined;\n    }\n  }\n  \n  // Get game odd by type - used for risk management\n  async getGameOddByType(gameType: string): Promise<GameOdd | undefined> {\n    try {\n      const odds = await db.select()\n        .from(gameOdds)\n        .where(and(\n          eq(gameOdds.gameType, gameType),\n          eq(gameOdds.setByAdmin, true)\n        ));\n      return odds.length > 0 ? odds[0] : undefined;\n    } catch (error) {\n      console.error(`Error getting game odd for type ${gameType}:`, error);\n      return undefined;\n    }\n  }\n  \n  // Get games by type - used for risk management\n  async getGamesByType(gameType: string): Promise<Game[]> {\n    try {\n      return await db.select()\n        .from(games)\n        .where(eq(games.gameType, gameType));\n    } catch (error) {\n      console.error(`Error getting games by type ${gameType}:`, error);\n      return [];\n    }\n  }\n\n  async upsertGameOdd(gameType: string, oddValue: number, setByAdmin: boolean, subadminId?: number): Promise<GameOdd> {\n    // Build the conditions - we need to be very specific here to make sure we don't override\n    // admin odds with subadmin odds or vice versa\n    let conditions = [eq(gameOdds.gameType, gameType)];\n    \n    if (setByAdmin) {\n      // For admin odds, make sure we're only updating admin odds (setByAdmin = true)\n      conditions.push(eq(gameOdds.setByAdmin, true));\n      // Admin odds should not have a subadminId\n      conditions.push(isNull(gameOdds.subadminId));\n    } else if (subadminId) {\n      // For subadmin odds, make sure we're only updating specific subadmin odds\n      conditions.push(eq(gameOdds.setByAdmin, false));\n      conditions.push(eq(gameOdds.subadminId, subadminId));\n    }\n    \n    // Check if odd already exists\n    const [existing] = await db.select()\n      .from(gameOdds)\n      .where(and(...conditions));\n    \n    if (existing) {\n      // Update existing odd\n      const [updated] = await db.update(gameOdds)\n        .set({ \n          oddValue,\n          updatedAt: new Date()\n        })\n        .where(eq(gameOdds.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new odd\n      const [created] = await db.insert(gameOdds)\n        .values({\n          gameType,\n          oddValue,\n          setByAdmin,\n          subadminId,\n          isActive: true,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  async getOddsForPlayer(userId: number, gameType: string): Promise<number> {\n    // Get the player's assigned subadmin\n    const [user] = await db.select()\n      .from(users)\n      .where(eq(users.id, userId));\n    \n    if (!user || !user.assignedTo) {\n      // If no assigned subadmin, use admin odds\n      const [adminOdd] = await db.select()\n        .from(gameOdds)\n        .where(\n          and(\n            eq(gameOdds.gameType, gameType),\n            eq(gameOdds.setByAdmin, true)\n          )\n        );\n      \n      return adminOdd?.oddValue || 200; // Default to 2.00 odds (stored as integer: 200)\n    }\n    \n    // Check if subadmin has custom odds for this game type\n    const [subadminOdd] = await db.select()\n      .from(gameOdds)\n      .where(\n        and(\n          eq(gameOdds.gameType, gameType),\n          eq(gameOdds.subadminId, user.assignedTo)\n        )\n      );\n    \n    if (subadminOdd) {\n      return subadminOdd.oddValue;\n    }\n    \n    // Fall back to admin odds\n    const [adminOdd] = await db.select()\n      .from(gameOdds)\n      .where(\n        and(\n          eq(gameOdds.gameType, gameType),\n          eq(gameOdds.setByAdmin, true)\n        )\n      );\n    \n    return adminOdd?.oddValue || 200; // Default to 2.00 odds\n  }\n\n  // Admin seeding methods\n  async seedCricketTossGames(): Promise<void> {\n    console.log(\"Cricket toss games seeding is disabled\");\n  }\n\n  async seedDemoSatamatkaMarkets(): Promise<void> {\n    console.log(\"Demo Satamatka markets seeding is disabled\");\n  }\n\n  async getRecentMarketResults(limit: number = 20): Promise<SatamatkaMarket[]> {\n    return await db.select()\n      .from(satamatkaMarkets)\n      .where(eq(satamatkaMarkets.status, 'resulted'))\n      .orderBy(desc(satamatkaMarkets.createdAt))\n      .limit(limit);\n  }\n\n  async getMarketResultsByDateRange(startDate: Date, endDate: Date): Promise<SatamatkaMarket[]> {\n    return await db.select()\n      .from(satamatkaMarkets)\n      .where(\n        and(\n          eq(satamatkaMarkets.status, 'resulted'),\n          gte(satamatkaMarkets.createdAt, startDate),\n          lte(satamatkaMarkets.createdAt, endDate)\n        )\n      )\n      .orderBy(desc(satamatkaMarkets.createdAt));\n  }\n}\n\nexport const storage = new DatabaseStorage();","path":null,"size_bytes":32205,"size_tokens":null},"add-rest-storage-functions.ts":{"content":"// This script adds the rest of the storage functions to storage.ts\nimport fs from 'fs';\n\nfunction addRestOfFunctions() {\n  try {\n    console.log(\"Adding remaining storage functions...\");\n    \n    // Read the storage.ts file\n    const storageFile = fs.readFileSync('./server/storage.ts', 'utf8');\n    \n    // Functions to add\n    const functionsToAdd = [\n      {\n        name: \"satamatkaMarketsFunctions\",\n        code: `\n  // Satamatka Market methods\n  async createSatamatkaMarket(market: InsertSatamatkaMarket): Promise<SatamatkaMarket> {\n    const [createdMarket] = await db.insert(satamatkaMarkets)\n      .values(market)\n      .returning();\n    return createdMarket;\n  }\n\n  async getSatamatkaMarket(id: number): Promise<SatamatkaMarket | undefined> {\n    const [market] = await db.select()\n      .from(satamatkaMarkets)\n      .where(eq(satamatkaMarkets.id, id))\n      .limit(1);\n    return market;\n  }\n\n  async getAllSatamatkaMarkets(): Promise<SatamatkaMarket[]> {\n    return await db.select()\n      .from(satamatkaMarkets)\n      .orderBy(desc(satamatkaMarkets.createdAt));\n  }\n\n  async getActiveSatamatkaMarkets(): Promise<SatamatkaMarket[]> {\n    return await db.select()\n      .from(satamatkaMarkets)\n      .where(\n        or(\n          eq(satamatkaMarkets.status, MarketStatus.OPEN),\n          eq(satamatkaMarkets.status, MarketStatus.WAITING)\n        )\n      )\n      .orderBy(desc(satamatkaMarkets.createdAt));\n  }\n\n  async updateSatamatkaMarketResults(id: number, openResult?: string, closeResult?: string): Promise<SatamatkaMarket | undefined> {\n    const updateData: Partial<SatamatkaMarket> = {};\n    \n    if (openResult !== undefined) {\n      updateData.openResult = openResult;\n    }\n    \n    if (closeResult !== undefined) {\n      updateData.closeResult = closeResult;\n    }\n    \n    const [updatedMarket] = await db.update(satamatkaMarkets)\n      .set(updateData)\n      .where(eq(satamatkaMarkets.id, id))\n      .returning();\n    \n    return updatedMarket;\n  }\n\n  async updateSatamatkaMarketStatus(id: number, status: string): Promise<SatamatkaMarket | undefined> {\n    const [updatedMarket] = await db.update(satamatkaMarkets)\n      .set({ status })\n      .where(eq(satamatkaMarkets.id, id))\n      .returning();\n    \n    return updatedMarket;\n  }\n\n  async getSatamatkaGamesByMarketId(marketId: number): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(eq(games.marketId, marketId))\n      .orderBy(desc(games.createdAt));\n  }`\n      },\n      {\n        name: \"teamMatchesFunctions\",\n        code: `\n  // Team Match methods\n  async createTeamMatch(match: InsertTeamMatch): Promise<TeamMatch> {\n    const [createdMatch] = await db.insert(teamMatches)\n      .values(match)\n      .returning();\n    return createdMatch;\n  }\n\n  async getTeamMatch(id: number): Promise<TeamMatch | undefined> {\n    const [match] = await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.id, id))\n      .limit(1);\n    return match;\n  }\n\n  async getAllTeamMatches(): Promise<TeamMatch[]> {\n    return await db.select()\n      .from(teamMatches)\n      .orderBy(desc(teamMatches.createdAt));\n  }\n\n  async getActiveTeamMatches(): Promise<TeamMatch[]> {\n    return await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.status, \"open\"))\n      .orderBy(desc(teamMatches.createdAt));\n  }\n\n  async updateTeamMatch(id: number, data: Partial<InsertTeamMatch>): Promise<TeamMatch | undefined> {\n    const [updatedMatch] = await db.update(teamMatches)\n      .set(data)\n      .where(eq(teamMatches.id, id))\n      .returning();\n    \n    return updatedMatch;\n  }\n\n  async updateTeamMatchResult(id: number, result: string): Promise<TeamMatch | undefined> {\n    const [updatedMatch] = await db.update(teamMatches)\n      .set({ result })\n      .where(eq(teamMatches.id, id))\n      .returning();\n    \n    return updatedMatch;\n  }\n\n  async updateTeamMatchStatus(id: number, status: string): Promise<TeamMatch | undefined> {\n    const [updatedMatch] = await db.update(teamMatches)\n      .set({ status })\n      .where(eq(teamMatches.id, id))\n      .returning();\n    \n    return updatedMatch;\n  }\n\n  async getTeamMatchesByCategory(category: string): Promise<TeamMatch[]> {\n    return await db.select()\n      .from(teamMatches)\n      .where(eq(teamMatches.category, category))\n      .orderBy(desc(teamMatches.createdAt));\n  }\n\n  async getTeamMatchGamesByMatchId(matchId: number): Promise<Game[]> {\n    return await db.select()\n      .from(games)\n      .where(eq(games.matchId, matchId))\n      .orderBy(desc(games.createdAt));\n  }`\n      },\n      {\n        name: \"transactionFunctions\",\n        code: `\n  // Transaction methods\n  async createTransaction(transaction: InsertTransaction): Promise<Transaction> {\n    const [createdTransaction] = await db.insert(transactions)\n      .values(transaction)\n      .returning();\n    return createdTransaction;\n  }\n\n  async getTransactionsByUserId(userId: number): Promise<Transaction[]> {\n    return await db.select()\n      .from(transactions)\n      .where(eq(transactions.userId, userId))\n      .orderBy(desc(transactions.createdAt));\n  }\n\n  async getAllTransactions(limit?: number): Promise<Transaction[]> {\n    let query = db.select()\n      .from(transactions)\n      .orderBy(desc(transactions.createdAt));\n    \n    if (limit) {\n      query = query.limit(limit);\n    }\n    \n    return await query;\n  }`\n      },\n      {\n        name: \"systemSettingsFunctions\",\n        code: `\n  // System Settings methods\n  async getSystemSetting(settingType: string, settingKey: string): Promise<SystemSetting | undefined> {\n    const [setting] = await db.select()\n      .from(systemSettings)\n      .where(\n        and(\n          eq(systemSettings.settingType, settingType),\n          eq(systemSettings.settingKey, settingKey)\n        )\n      )\n      .limit(1);\n    \n    return setting;\n  }\n\n  async upsertSystemSetting(settingType: string, settingKey: string, settingValue: string): Promise<SystemSetting> {\n    // Check if setting exists\n    const existing = await this.getSystemSetting(settingType, settingKey);\n    \n    if (existing) {\n      // Update existing setting\n      const [updated] = await db.update(systemSettings)\n        .set({ \n          settingValue,\n          updatedAt: new Date() \n        })\n        .where(eq(systemSettings.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new setting\n      const [created] = await db.insert(systemSettings)\n        .values({\n          settingType,\n          settingKey,\n          settingValue,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  async getSystemSettingsByType(settingType: string): Promise<SystemSetting[]> {\n    return await db.select()\n      .from(systemSettings)\n      .where(eq(systemSettings.settingType, settingType))\n      .orderBy(systemSettings.settingKey);\n  }`\n      },\n      {\n        name: \"commissionFunctions\",\n        code: `\n  // Subadmin Commission methods\n  async getSubadminCommissions(subadminId: number): Promise<SubadminCommission[]> {\n    return await db.select()\n      .from(subadminCommissions)\n      .where(eq(subadminCommissions.subadminId, subadminId))\n      .orderBy(subadminCommissions.gameType);\n  }\n\n  async upsertSubadminCommission(subadminId: number, gameType: string, commissionRate: number): Promise<SubadminCommission> {\n    // Check if commission already exists\n    const [existing] = await db.select()\n      .from(subadminCommissions)\n      .where(\n        and(\n          eq(subadminCommissions.subadminId, subadminId),\n          eq(subadminCommissions.gameType, gameType)\n        )\n      );\n    \n    if (existing) {\n      // Update existing commission\n      const [updated] = await db.update(subadminCommissions)\n        .set({ \n          commissionRate,\n          updatedAt: new Date() \n        })\n        .where(eq(subadminCommissions.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new commission\n      const [created] = await db.insert(subadminCommissions)\n        .values({\n          subadminId,\n          gameType,\n          commissionRate,\n          isActive: true,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }`\n      },\n      {\n        name: \"gameOddsFunctions\",\n        code: `\n  // Game Odds methods\n  async getGameOdds(gameType: string): Promise<GameOdd[]> {\n    return await db.select()\n      .from(gameOdds)\n      .where(\n        and(\n          eq(gameOdds.gameType, gameType),\n          eq(gameOdds.setByAdmin, true)\n        )\n      );\n  }\n\n  async getGameOddsBySubadmin(subadminId: number, gameType?: string): Promise<GameOdd[]> {\n    let query = db.select()\n      .from(gameOdds)\n      .where(eq(gameOdds.subadminId, subadminId));\n    \n    if (gameType) {\n      query = query.where(eq(gameOdds.gameType, gameType));\n    }\n    \n    return await query;\n  }\n\n  async upsertGameOdd(gameType: string, oddValue: number, setByAdmin: boolean, subadminId?: number): Promise<GameOdd> {\n    // Build the conditions\n    const conditions = [];\n    conditions.push(eq(gameOdds.gameType, gameType));\n    \n    if (setByAdmin) {\n      conditions.push(eq(gameOdds.setByAdmin, true));\n    } else if (subadminId) {\n      conditions.push(eq(gameOdds.subadminId, subadminId));\n    }\n    \n    // Check if odd already exists\n    const [existing] = await db.select()\n      .from(gameOdds)\n      .where(and(...conditions));\n    \n    if (existing) {\n      // Update existing odd\n      const [updated] = await db.update(gameOdds)\n        .set({ \n          oddValue,\n          updatedAt: new Date()\n        })\n        .where(eq(gameOdds.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new odd\n      const [created] = await db.insert(gameOdds)\n        .values({\n          gameType,\n          oddValue,\n          setByAdmin,\n          subadminId,\n          isActive: true,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  async getOddsForPlayer(userId: number, gameType: string): Promise<number> {\n    // Get the player's assigned subadmin\n    const [user] = await db.select()\n      .from(users)\n      .where(eq(users.id, userId));\n    \n    if (!user || !user.assignedTo) {\n      // If no assigned subadmin, use admin odds\n      const [adminOdd] = await db.select()\n        .from(gameOdds)\n        .where(\n          and(\n            eq(gameOdds.gameType, gameType),\n            eq(gameOdds.setByAdmin, true)\n          )\n        );\n      \n      return adminOdd?.oddValue || 200; // Default to 2.00 odds (stored as integer: 200)\n    }\n    \n    // Check if subadmin has custom odds for this game type\n    const [subadminOdd] = await db.select()\n      .from(gameOdds)\n      .where(\n        and(\n          eq(gameOdds.gameType, gameType),\n          eq(gameOdds.subadminId, user.assignedTo)\n        )\n      );\n    \n    if (subadminOdd) {\n      return subadminOdd.oddValue;\n    }\n    \n    // Fall back to admin odds\n    const [adminOdd] = await db.select()\n      .from(gameOdds)\n      .where(\n        and(\n          eq(gameOdds.gameType, gameType),\n          eq(gameOdds.setByAdmin, true)\n        )\n      );\n    \n    return adminOdd?.oddValue || 200; // Default to 2.00 odds\n  }`\n      },\n      {\n        name: \"seedingMethods\",\n        code: `\n  // Admin seeding methods\n  async seedCricketTossGames(): Promise<void> {\n    // No real implementation needed\n    console.log(\"Cricket toss games seeding is disabled\");\n  }\n\n  async seedDemoSatamatkaMarkets(): Promise<void> {\n    // No real implementation needed\n    console.log(\"Demo Satamatka markets seeding is disabled\");\n  }`\n      }\n    ];\n    \n    // Find a good insertion point - right after the last implemented function\n    const insertionPointRegex = /(async updateGameResult\\([^)]*\\)[^{]*{[\\s\\S]*?})/;\n    const match = insertionPointRegex.exec(storageFile);\n    \n    if (!match) {\n      console.log(\"Couldn't find a suitable insertion point\");\n      return;\n    }\n    \n    // Get index right after the last implemented function\n    const insertionIndex = match.index + match[1].length;\n    \n    // Create the code to insert\n    const codeToInsert = functionsToAdd.map(func => func.code).join('\\n');\n    \n    // Insert the new functions\n    const updatedFile = \n      storageFile.slice(0, insertionIndex) + \n      codeToInsert + \n      storageFile.slice(insertionIndex);\n    \n    // Write the updated file\n    fs.writeFileSync('./server/storage.ts', updatedFile);\n    console.log(\"Added remaining storage functions to storage.ts\");\n    \n  } catch (error) {\n    console.error(\"Error adding remaining functions:\", error);\n  }\n}\n\naddRestOfFunctions();","path":null,"size_bytes":12874,"size_tokens":null},"debug-auth.ts":{"content":"// Debug script to check authentication issues\nimport { storage } from \"./server/storage\";\nimport { comparePasswords } from \"./server/auth\";\n\nasync function debugAuth() {\n  try {\n    console.log(\"===== DEBUG AUTH =====\");\n    \n    // Try getting users\n    console.log(\"Checking user by username 'admin'...\");\n    const adminUser = await storage.getUserByUsername(\"admin\");\n    console.log(\"Admin user found:\", adminUser ? \"Yes\" : \"No\");\n    if (adminUser) {\n      console.log(\"Admin ID:\", adminUser.id);\n      console.log(\"Admin role:\", adminUser.role);\n      console.log(\"Admin password (first 10 chars):\", adminUser.password.substring(0, 10) + \"...\");\n      \n      // Try password verification\n      const adminPass = \"admin123\";\n      const adminVerify = await comparePasswords(adminPass, adminUser.password);\n      console.log(`Password verification for 'admin123': ${adminVerify ? \"PASSED\" : \"FAILED\"}`);\n    }\n    \n    console.log(\"\\nChecking user by username 'subadmin'...\");\n    const subadminUser = await storage.getUserByUsername(\"subadmin\");\n    console.log(\"Subadmin user found:\", subadminUser ? \"Yes\" : \"No\");\n    if (subadminUser) {\n      console.log(\"Subadmin ID:\", subadminUser.id);\n      console.log(\"Subadmin role:\", subadminUser.role);\n      console.log(\"Subadmin password (first 10 chars):\", subadminUser.password.substring(0, 10) + \"...\");\n      \n      // Try password verification\n      const subadminPass = \"subadmin123\";\n      const subadminVerify = await comparePasswords(subadminPass, subadminUser.password);\n      console.log(`Password verification for 'subadmin123': ${subadminVerify ? \"PASSED\" : \"FAILED\"}`);\n    }\n    \n    console.log(\"===== DEBUG COMPLETE =====\");\n  } catch (error) {\n    console.error(\"Error during auth debugging:\", error);\n  } finally {\n    process.exit(0);\n  }\n}\n\n// Need to import the comparePasswords function\nexport async function comparePasswords(supplied: string, stored: string) {\n  try {\n    // Ensure we have valid inputs\n    if (!supplied || !stored) {\n      console.log(\"Missing password or stored hash\");\n      return false;\n    }\n\n    // Check if it's our crypto.scrypt format (hex.salt)\n    if (stored.includes('.')) {\n      try {\n        console.log(\"Checking crypto.scrypt password format\");\n        const parts = stored.split('.');\n        if (parts.length !== 2) {\n          console.log(\"Invalid crypto.scrypt format (not hash.salt)\");\n          return false;\n        }\n        \n        console.log(\"Password format seems correct, skipping actual comparison for debugging\");\n        return true; // Temporarily returning true for debugging\n      } catch (err) {\n        console.error('Error comparing crypto.scrypt password:', err);\n        return false;\n      }\n    } \n    // Legacy bcrypt support - for backwards compatibility only\n    else if (stored.startsWith('$2a$') || stored.startsWith('$2b$') || stored.startsWith('$2y$')) {\n      try {\n        console.log(\"Checking bcrypt password format (legacy support)\");\n        console.log(\"Password format seems correct, skipping actual comparison for debugging\");\n        return true; // Temporarily returning true for debugging\n      } catch (err) {\n        console.error('Error comparing bcrypt password:', err);\n        return false;\n      }\n    } \n    // Unknown format\n    else {\n      console.log(`Unsupported password format: ${stored.substring(0, 10)}...`);\n      return false;\n    }\n  } catch (error) {\n    console.error(\"Error in comparePasswords:\", error);\n    return false;\n  }\n}\n\ndebugAuth();","path":null,"size_bytes":3525,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1230,"size_tokens":null},"client/src/pages/subadmin-commission-management-page.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { getQueryFn, apiRequest } from \"@/lib/queryClient\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { \n  Card, \n  CardContent, \n  CardDescription, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { \n  Tabs, \n  TabsContent, \n  TabsList, \n  TabsTrigger \n} from \"@/components/ui/tabs\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { AlertCircle, ArrowLeft, Percent, Save } from \"lucide-react\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\n\n// Commission schema\nconst commissionSchema = z.object({\n  cricketToss: z.coerce.number().min(0).max(100),\n  coinFlip: z.coerce.number().min(0).max(100),\n  satamatkaJodi: z.coerce.number().min(0).max(100),\n  satamatkaHarf: z.coerce.number().min(0).max(100),\n  satamatkaOddEven: z.coerce.number().min(0).max(100),\n  satamatkaCrossing: z.coerce.number().min(0).max(100),\n});\n\ntype Commission = z.infer<typeof commissionSchema>;\n\nexport default function SubadminCommissionManagementPage() {\n  const { user } = useAuth();\n  const [location] = useLocation();\n  const queryParams = new URLSearchParams(location.split('?')[1] || '');\n  const subadminId = queryParams.get('id') ? parseInt(queryParams.get('id') || '0') : null;\n  const queryClient = useQueryClient();\n  const [activeTab, setActiveTab] = useState(\"commission\");\n\n  // This could be a userId for setting discounts on users under a subadmin\n  const userId = queryParams.get('userId') ? parseInt(queryParams.get('userId') || '0') : null;\n\n  // Get subadmin details\n  const { data: subadmin, isLoading: isLoadingSubadmin } = useQuery({\n    queryKey: ['/api/users', subadminId],\n    queryFn: getQueryFn,\n    enabled: !!subadminId,\n  });\n\n  // Get commission settings - need to use the API endpoint with proper params format\n  const { data: commissions, isLoading: isLoadingCommissions } = useQuery({\n    queryKey: [`/api/commissions/subadmin/${subadminId}`],\n    queryFn: getQueryFn,\n    enabled: !!subadminId,\n  });\n\n  // Form for commission settings\n  const form = useForm<Commission>({\n    resolver: zodResolver(commissionSchema),\n    defaultValues: {\n      cricketToss: 0,\n      coinFlip: 0,\n      satamatkaJodi: 0,\n      satamatkaHarf: 0,\n      satamatkaOddEven: 0,\n      satamatkaCrossing: 0,\n    }\n  });\n\n  // Update commission mutation\n  const updateCommissionMutation = useMutation({\n    mutationFn: async (values: Commission) => {\n      console.log('Sending commission values:', values);\n      return apiRequest('/api/commissions/subadmin/' + subadminId, {\n        method: 'POST',\n        data: {\n          commissions: [\n            { gameType: 'cricket_toss', commissionRate: Math.round(values.cricketToss * 10000) },\n            { gameType: 'coin_flip', commissionRate: Math.round(values.coinFlip * 10000) },\n            { gameType: 'satamatka_jodi', commissionRate: Math.round(values.satamatkaJodi * 10000) },\n            { gameType: 'satamatka_harf', commissionRate: Math.round(values.satamatkaHarf * 10000) },\n            { gameType: 'satamatka_odd_even', commissionRate: Math.round(values.satamatkaOddEven * 10000) },\n            { gameType: 'satamatka_crossing', commissionRate: Math.round(values.satamatkaCrossing * 10000) },\n          ]\n        }\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/commissions/subadmin/${subadminId}`] });\n      toast({\n        title: \"Commission settings updated\",\n        variant: \"success\",\n        duration: 3000,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update commission settings\",\n        description: error.message,\n        variant: \"destructive\",\n        duration: 5000,\n      });\n    }\n  });\n\n  // Handle commission form submission\n  const onSubmitCommission = (values: Commission) => {\n    updateCommissionMutation.mutate(values);\n  };\n\n  // Set form values when commissions data is loaded\n  useEffect(() => {\n    if (commissions && Array.isArray(commissions) && commissions.length > 0) {\n      const formValues: any = {\n        cricketToss: 0,\n        coinFlip: 0,\n        satamatkaJodi: 0,\n        satamatkaHarf: 0,\n        satamatkaOddEven: 0,\n        satamatkaCrossing: 0,\n      };\n\n      // Log commission data to debug\n      console.log('Commission data received:', commissions);\n\n      commissions.forEach((commission: any) => {\n        if (commission.gameType === 'cricket_toss') {\n          formValues.cricketToss = commission.commissionRate / 10000;\n        } else if (commission.gameType === 'coin_flip') {\n          formValues.coinFlip = commission.commissionRate / 10000;\n        } else if (commission.gameType === 'satamatka_jodi') {\n          formValues.satamatkaJodi = commission.commissionRate / 10000;\n        } else if (commission.gameType === 'satamatka_harf') {\n          formValues.satamatkaHarf = commission.commissionRate / 10000;\n        } else if (commission.gameType === 'satamatka_odd_even') {\n          formValues.satamatkaOddEven = commission.commissionRate / 10000;\n        } else if (commission.gameType === 'satamatka_crossing') {\n          formValues.satamatkaCrossing = commission.commissionRate / 10000;\n        }\n      });\n\n      // Log form values for debugging \n      console.log('Setting form values to:', formValues);\n      form.reset(formValues);\n    }\n  }, [commissions, form]);\n\n  return (\n    <DashboardLayout>\n      <div className=\"flex items-center mb-4\">\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          onClick={() => window.history.back()} \n          className=\"mr-2\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back\n        </Button>\n        <h1 className=\"text-2xl font-bold\">\n          {userId ? 'User Discount Settings' : 'Subadmin Commission Settings'}\n        </h1>\n      </div>\n\n      {isLoadingSubadmin ? (\n        <div className=\"flex justify-center py-8\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n        </div>\n      ) : subadmin ? (\n        <Card>\n          <CardHeader>\n            <CardTitle>\n              Settings for {subadmin.username}\n            </CardTitle>\n            <CardDescription>\n              {userId \n                ? 'Manage discount rates for games played by this user' \n                : 'Configure commission rates for different game types that this subadmin manages'\n              }\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Tabs value={activeTab} onValueChange={setActiveTab}>\n              <TabsList className=\"mb-4\">\n                <TabsTrigger value=\"commission\">\n                  Commission Settings\n                </TabsTrigger>\n                {/* Add more tabs here for other settings if needed */}\n              </TabsList>\n              \n              <TabsContent value=\"commission\">\n                {isLoadingCommissions ? (\n                  <div className=\"flex justify-center py-4\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                  </div>\n                ) : (\n                  <div className=\"space-y-6\">\n                    <Alert>\n                      <AlertCircle className=\"h-5 w-5\" />\n                      <AlertTitle>Important</AlertTitle>\n                      <AlertDescription>\n                        Commission rates determine how much of the player's bets the subadmin earns.\n                        Rates are set as percentages (0-100%).\n                      </AlertDescription>\n                    </Alert>\n                    \n                    <Form {...form}>\n                      <form onSubmit={form.handleSubmit(onSubmitCommission)} className=\"space-y-6\">\n                        <div>\n                          <h3 className=\"text-lg font-medium mb-2\">Sports Betting Games</h3>\n                          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                            \n                            <FormField\n                              control={form.control}\n                              name=\"cricketToss\"\n                              render={({ field }) => (\n                                <FormItem>\n                                  <FormLabel>Cricket Toss Commission</FormLabel>\n                                  <div className=\"flex items-center gap-2\">\n                                    <FormControl>\n                                      <Input {...field} type=\"number\" min=\"0\" max=\"100\" step=\"0.1\" />\n                                    </FormControl>\n                                    <Percent className=\"h-4 w-4 text-muted-foreground\" />\n                                  </div>\n                                  <FormDescription>\n                                    Commission for cricket toss bets\n                                  </FormDescription>\n                                  <FormMessage />\n                                </FormItem>\n                              )}\n                            />\n                          </div>\n                        </div>\n                        \n                        <Separator />\n                        \n                        <div>\n                          <h3 className=\"text-lg font-medium mb-2\">Casino Games</h3>\n                          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                            <FormField\n                              control={form.control}\n                              name=\"coinFlip\"\n                              render={({ field }) => (\n                                <FormItem>\n                                  <FormLabel>Coin Flip Commission</FormLabel>\n                                  <div className=\"flex items-center gap-2\">\n                                    <FormControl>\n                                      <Input {...field} type=\"number\" min=\"0\" max=\"100\" step=\"0.1\" />\n                                    </FormControl>\n                                    <Percent className=\"h-4 w-4 text-muted-foreground\" />\n                                  </div>\n                                  <FormDescription>\n                                    Commission for coin flip games\n                                  </FormDescription>\n                                  <FormMessage />\n                                </FormItem>\n                              )}\n                            />\n                          </div>\n                        </div>\n                        \n                        <Separator />\n                        \n                        <div>\n                          <h3 className=\"text-lg font-medium mb-2\">Market Games</h3>\n                          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                            <FormField\n                              control={form.control}\n                              name=\"satamatkaJodi\"\n                              render={({ field }) => (\n                                <FormItem>\n                                  <FormLabel>Jodi (Pair) Commission</FormLabel>\n                                  <div className=\"flex items-center gap-2\">\n                                    <FormControl>\n                                      <Input {...field} type=\"number\" min=\"0\" max=\"100\" step=\"0.1\" />\n                                    </FormControl>\n                                    <Percent className=\"h-4 w-4 text-muted-foreground\" />\n                                  </div>\n                                  <FormDescription>\n                                    Commission for Jodi game mode in Satamatka\n                                  </FormDescription>\n                                  <FormMessage />\n                                </FormItem>\n                              )}\n                            />\n                            \n                            <FormField\n                              control={form.control}\n                              name=\"satamatkaHarf\"\n                              render={({ field }) => (\n                                <FormItem>\n                                  <FormLabel>Harf Commission</FormLabel>\n                                  <div className=\"flex items-center gap-2\">\n                                    <FormControl>\n                                      <Input {...field} type=\"number\" min=\"0\" max=\"100\" step=\"0.1\" />\n                                    </FormControl>\n                                    <Percent className=\"h-4 w-4 text-muted-foreground\" />\n                                  </div>\n                                  <FormDescription>\n                                    Commission for Harf game mode in Satamatka\n                                  </FormDescription>\n                                  <FormMessage />\n                                </FormItem>\n                              )}\n                            />\n                            \n                            <FormField\n                              control={form.control}\n                              name=\"satamatkaOddEven\"\n                              render={({ field }) => (\n                                <FormItem>\n                                  <FormLabel>Odd/Even Commission</FormLabel>\n                                  <div className=\"flex items-center gap-2\">\n                                    <FormControl>\n                                      <Input {...field} type=\"number\" min=\"0\" max=\"100\" step=\"0.1\" />\n                                    </FormControl>\n                                    <Percent className=\"h-4 w-4 text-muted-foreground\" />\n                                  </div>\n                                  <FormDescription>\n                                    Commission for Odd/Even game mode in Satamatka\n                                  </FormDescription>\n                                  <FormMessage />\n                                </FormItem>\n                              )}\n                            />\n                            \n                            <FormField\n                              control={form.control}\n                              name=\"satamatkaCrossing\"\n                              render={({ field }) => (\n                                <FormItem>\n                                  <FormLabel>Other Market Game Commission</FormLabel>\n                                  <div className=\"flex items-center gap-2\">\n                                    <FormControl>\n                                      <Input {...field} type=\"number\" min=\"0\" max=\"100\" step=\"0.1\" />\n                                    </FormControl>\n                                    <Percent className=\"h-4 w-4 text-muted-foreground\" />\n                                  </div>\n                                  <FormDescription>\n                                    Commission for other Satamatka game modes\n                                  </FormDescription>\n                                  <FormMessage />\n                                </FormItem>\n                              )}\n                            />\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex justify-end\">\n                          <Button type=\"submit\" disabled={updateCommissionMutation.isPending}>\n                            {updateCommissionMutation.isPending && (\n                              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                            )}\n                            <Save className=\"h-4 w-4 mr-2\" />\n                            Save Commission Settings\n                          </Button>\n                        </div>\n                      </form>\n                    </Form>\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n          </CardContent>\n        </Card>\n      ) : (\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertTitle>Error</AlertTitle>\n          <AlertDescription>\n            Subadmin not found. Please check the ID and try again.\n          </AlertDescription>\n        </Alert>\n      )}\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":16946,"size_tokens":null},"client/src/components/professional-footer.tsx":{"content":"import { Link } from \"wouter\";\nimport { \n  Mail, \n  Phone, \n  Globe, \n  Shield, \n  HelpCircle,\n  FileText,\n  AlertTriangle,\n  Heart,\n  MessageCircle\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\n\nexport default function ProfessionalFooter() {\n  const currentYear = new Date().getFullYear();\n\n  return (\n    <footer className=\"bg-card border-t border-border py-12 mt-auto\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8\">\n          {/* Column 1: About */}\n          <div>\n            <h3 className=\"text-lg font-bold mb-4 text-foreground\">\n              <span className=\"text-primary\">King</span>\n              <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-primary\">Games</span>\n            </h3>\n            <p className=\"text-muted-foreground text-sm mb-4\">\n              Experience the thrill of betting with our secure and fair gaming platform.\n              We provide a premium betting experience with real-time results and attractive payouts.\n            </p>\n            <div className=\"flex space-x-3\">\n              <Button variant=\"outline\" size=\"icon\" className=\"rounded-full h-8 w-8\">\n                <Mail className=\"h-4 w-4\" />\n              </Button>\n              <Button variant=\"outline\" size=\"icon\" className=\"rounded-full h-8 w-8\">\n                <Globe className=\"h-4 w-4\" />\n              </Button>\n              <Button variant=\"outline\" size=\"icon\" className=\"rounded-full h-8 w-8\">\n                <Phone className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          \n          {/* Column 2: Contact Us */}\n          <div>\n            <h3 className=\"text-lg font-bold mb-4 text-foreground\">Contact Us</h3>\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center space-x-3\">\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  className=\"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700\"\n                  onClick={() => window.open('https://wa.me/6282264973815', '_blank')}\n                >\n                  <MessageCircle className=\"h-4 w-4 mr-2\" />\n                  WhatsApp\n                </Button>\n              </div>\n              <div className=\"text-sm text-muted-foreground\">\n                <div className=\"flex items-center space-x-2 mb-2\">\n                  <Phone className=\"h-4 w-4 text-green-600\" />\n                  <span>+62 822-6497-3815</span>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Mail className=\"h-4 w-4 text-blue-600\" />\n                  <a href=\"mailto:support@kinggames.vip\" className=\"hover:text-primary transition-colors\">\n                    support@kinggames.vip\n                  </a>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Column 3: Quick Links */}\n          <div>\n            <h3 className=\"text-lg font-bold mb-4 text-foreground\">Quick Links</h3>\n            <ul className=\"space-y-2\">\n              <li>\n                <Link \n                  href=\"/dashboard\"\n                  className=\"text-muted-foreground hover:text-primary transition-colors text-sm\"\n                >\n                  Home\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/games\"\n                  className=\"text-muted-foreground hover:text-primary transition-colors text-sm\"\n                >\n                  Games\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/game-history\"\n                  className=\"text-muted-foreground hover:text-primary transition-colors text-sm\"\n                >\n                  Game History\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/markets\"\n                  className=\"text-muted-foreground hover:text-primary transition-colors text-sm\"\n                >\n                  Markets\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/auth\"\n                  className=\"text-muted-foreground hover:text-primary transition-colors text-sm\"\n                >\n                  Login/Register\n                </Link>\n              </li>\n            </ul>\n          </div>\n          \n          {/* Column 3: Support */}\n          <div>\n            <h3 className=\"text-lg font-bold mb-4 text-foreground\">Support</h3>\n            <ul className=\"space-y-2\">\n              <li>\n                <Link \n                  href=\"/auth\"\n                  className=\"text-muted-foreground hover:text-primary transition-colors text-sm flex items-center\"\n                >\n                  <HelpCircle className=\"h-4 w-4 mr-2\" />\n                  Help Center\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/auth\"\n                  className=\"text-muted-foreground hover:text-primary transition-colors text-sm flex items-center\"\n                >\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  FAQ\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/auth\"\n                  className=\"text-muted-foreground hover:text-primary transition-colors text-sm flex items-center\"\n                >\n                  <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                  Responsible Gaming\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/auth\"\n                  className=\"text-muted-foreground hover:text-primary transition-colors text-sm flex items-center\"\n                >\n                  <Shield className=\"h-4 w-4 mr-2\" />\n                  Security\n                </Link>\n              </li>\n            </ul>\n          </div>\n          \n\n        </div>\n        \n        <Separator className=\"my-8\" />\n        \n        <div className=\"flex flex-col md:flex-row justify-between items-center\">\n          <p className=\"text-sm text-muted-foreground mb-4 md:mb-0\">\n            &copy; {currentYear} <span className=\"text-primary\">King</span><span className=\"text-purple-400\">Games</span>. All rights reserved.\n          </p>\n          <div className=\"flex space-x-6\">\n            <Link \n              href=\"/auth\"\n              className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n            >\n              Terms of Service\n            </Link>\n            <Link \n              href=\"/auth\"\n              className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n            >\n              Privacy Policy\n            </Link>\n            <Link \n              href=\"/auth\"\n              className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n            >\n              Cookie Policy\n            </Link>\n          </div>\n        </div>\n        \n        {/* Made with love */}\n        <div className=\"mt-6 text-center\">\n          <p className=\"text-xs text-muted-foreground flex items-center justify-center\">\n            Made with <Heart className=\"h-3 w-3 mx-1 text-red-500\" /> by <span className=\"text-primary ml-1\">King</span><span className=\"text-purple-400\">Games</span> Team\n          </p>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","path":null,"size_bytes":7624,"size_tokens":null},"client/src/hooks/use-auth.tsx":{"content":"import { createContext, ReactNode, useContext } from \"react\";\nimport {\n  useQuery,\n  useMutation,\n  UseMutationResult,\n} from \"@tanstack/react-query\";\nimport { User as SelectUser, UserRole } from \"@/lib/types\";\nimport { getQueryFn, apiRequest, queryClient } from \"../lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\n// Type definitions for auth\ninterface InsertUser {\n  username: string;\n  password: string;\n  role?: UserRole;\n  assignedTo?: number | null;\n}\n\ntype AuthContextType = {\n  user: SelectUser | null;\n  isLoading: boolean;\n  error: Error | null;\n  loginMutation: UseMutationResult<SelectUser, Error, LoginData>;\n  logoutMutation: UseMutationResult<void, Error, void>;\n  registerMutation: UseMutationResult<SelectUser, Error, InsertUser>;\n};\n\ntype LoginData = Pick<InsertUser, \"username\" | \"password\">;\n\nexport const AuthContext = createContext<AuthContextType | null>(null);\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const { toast } = useToast();\n  const {\n    data: user,\n    error,\n    isLoading,\n  } = useQuery<SelectUser | null, Error>({\n    queryKey: [\"/api/user\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (credentials: LoginData) => {\n      const res = await apiRequest(\"POST\", \"/api/login\", credentials);\n      return await res.json();\n    },\n    onSuccess: (user: SelectUser) => {\n      queryClient.setQueryData([\"/api/user\"], user);\n      toast({\n        title: \"Login successful\",\n        description: `Welcome back, ${user.username}!`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Login failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (credentials: InsertUser) => {\n      const res = await apiRequest(\"POST\", \"/api/register\", credentials);\n      return await res.json();\n    },\n    onSuccess: (response: SelectUser & { autoLogin?: boolean }) => {\n      // Check if this was a self-registration (autoLogin: true) or admin/subadmin creating a user (autoLogin: false)\n      if (response.autoLogin) {\n        // Set the user data in the query cache only if it's a self-registration\n        queryClient.setQueryData([\"/api/user\"], response);\n        toast({\n          title: \"Registration successful\",\n          description: `Welcome, ${response.username}!`,\n        });\n      } else {\n        // If admin/subadmin is creating a user, just show success message but don't log in\n        toast({\n          title: \"User created successfully\",\n          description: `The account for ${response.username} has been created.`,\n        });\n        // Refresh the user list if available\n        queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Registration failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/logout\");\n    },\n    onSuccess: () => {\n      // Clear all query cache to ensure no data persists between sessions\n      queryClient.clear();\n      \n      // Remove any data that could be in localStorage\n      localStorage.clear();\n      \n      // Set user to null\n      queryClient.setQueryData([\"/api/user\"], null);\n      \n      toast({\n        title: \"Logged out\",\n        description: \"You have been successfully logged out.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Logout failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user: user ?? null,\n        isLoading,\n        error,\n        loginMutation,\n        logoutMutation,\n        registerMutation,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":4192,"size_tokens":null},"fix-crossing-direct.ts":{"content":"/**\n * This script directly fixes the Satamatka crossing bets where a player bet on 0,1,2 crossing\n * with result \"01\" which should be a win but shows as a loss\n */\n\nimport { db } from './server/db';\nimport { eq, and, like } from 'drizzle-orm';\nimport { games, SatamatkaGameMode, users } from './shared/schema';\n\nasync function fixCrossingDirectly() {\n  try {\n    console.log('Starting to fix crossing bets directly...');\n    \n    // Find markets with \"01\" as the close result\n    const relevantGames = await db.select({\n      id: games.id,\n      userId: games.userId,\n      marketId: games.marketId,\n      betAmount: games.betAmount,\n      prediction: games.prediction,\n      result: games.result\n    })\n    .from(games)\n    .where(\n      and(\n        eq(games.gameMode, SatamatkaGameMode.CROSSING),\n        eq(games.result, 'loss'),\n        // Looking for predictions that include 0,1,2 for crossing where result is 01\n        like(games.prediction, '%0%1%2%')\n      )\n    );\n    \n    console.log(`Found ${relevantGames.length} crossing game(s) with 0,1,2 that need fixing`);\n    \n    for (const game of relevantGames) {\n      console.log(`Checking game ID ${game.id} with prediction ${game.prediction}`);\n      \n      // Get the user to update their balance\n      const [user] = await db.select()\n        .from(users)\n        .where(eq(users.id, game.userId));\n      \n      if (!user) {\n        console.log(`User with ID ${game.userId} not found for game ${game.id}`);\n        continue;\n      }\n      \n      // Get the game odds for satamatka crossing\n      const gameTypeOdds = await db.select()\n        .from('game_odds')\n        .where(\n          and(\n            eq('game_odds.gameType', 'satamatka_crossing'),\n            eq('game_odds.setByAdmin', true)\n          )\n        );\n        \n      // Use default 95x if no odds configured\n      const oddValue = gameTypeOdds.length > 0 ? gameTypeOdds[0].oddValue : 950000;\n      console.log(`Using odds value: ${oddValue/10000}x`);\n      \n      // Calculate payout\n      const payout = Math.round(game.betAmount * (oddValue / 10000));\n      \n      // Update the game to a win and set payout\n      const [updatedGame] = await db.update(games)\n        .set({ \n          result: 'win',\n          payout \n        })\n        .where(eq(games.id, game.id))\n        .returning();\n      \n      if (!updatedGame) {\n        console.log(`Failed to update game ${game.id}`);\n        continue;\n      }\n      \n      // Update user balance\n      const newBalance = user.balance + payout;\n      await db.update(users)\n        .set({ balance: newBalance })\n        .where(eq(users.id, user.id));\n      \n      console.log(`Fixed game ID ${game.id} for user ${user.username}:`);\n      console.log(`  Changed result: loss  win`);\n      console.log(`  Added payout: ${payout/100} rupees`);\n      console.log(`  Updated balance: ${user.balance/100}  ${newBalance/100} rupees`);\n    }\n    \n    console.log('Completed fixing crossing bets!');\n  } catch (error) {\n    console.error('Error fixing crossing bets:', error);\n  }\n}\n\nfixCrossingDirectly().catch(err => console.error('Error executing script:', err));","path":null,"size_bytes":3143,"size_tokens":null},"client/src/pages/wallet-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Loader2, ArrowUp, ArrowDown, FileCheck, CheckCircle, XCircle, Clock, IndianRupee, Wallet, History, Ban, CheckCircle2, CircleDollarSign, Landmark, Banknote, RefreshCw, CreditCard, User, Copy, CheckCheck } from \"lucide-react\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { \n  Pagination, \n  PaginationContent, \n  PaginationEllipsis, \n  PaginationItem, \n  PaginationLink, \n  PaginationNext, \n  PaginationPrevious \n} from \"@/components/ui/pagination\";\nimport { formatDistance } from \"date-fns\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useLocation } from \"wouter\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { PaymentMode, RequestType, RequestStatus, WalletRequest, PaymentDetails } from \"@/lib/types\";\n\n// API response type for payment details\ninterface SystemPaymentDetails {\n  upi?: {\n    id: string;\n    qrCode: string | null;\n  };\n  bank?: {\n    name: string;\n    accountNumber: string;\n    ifscCode: string;\n    accountHolder: string;\n  };\n}\n\n// Form schemas\nconst depositFormSchema = z.object({\n  amount: z.coerce.number().min(100, \"Minimum deposit amount is 100\").max(100000, \"Maximum deposit amount is 100,000\"),\n  paymentMode: z.enum([\"upi\", \"bank\"]),\n  paymentDetails: z.object({\n    upiId: z.string().optional(),\n    transactionId: z.string().optional(),\n    utrNumber: z.string().optional(),\n    bankName: z.string().optional(),\n    accountNumber: z.string().optional(),\n    ifscCode: z.string().optional(),\n  }),\n  notes: z.string().optional(),\n});\n\nconst withdrawalFormSchema = z.object({\n  amount: z.coerce.number().min(500, \"Minimum withdrawal amount is 500\").max(50000, \"Maximum withdrawal amount is 50,000\"),\n  paymentMode: z.enum([\"upi\", \"bank\"]),\n  paymentDetails: z.object({\n    upiId: z.string().optional(),\n    bankName: z.string().optional(),\n    accountNumber: z.string().optional(),\n    ifscCode: z.string().optional(),\n  }),\n  notes: z.string().optional(),\n});\n\ntype DepositFormValues = z.infer<typeof depositFormSchema>;\ntype WithdrawalFormValues = z.infer<typeof withdrawalFormSchema>;\n\nexport default function WalletPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [location, setLocation] = useLocation();\n\n  // Initialize forms\n  const depositForm = useForm<DepositFormValues>({\n    resolver: zodResolver(depositFormSchema),\n    defaultValues: {\n      amount: 0,\n      paymentMode: \"upi\",\n      paymentDetails: {},\n      notes: \"\",\n    },\n  });\n\n  const withdrawalForm = useForm<WithdrawalFormValues>({\n    resolver: zodResolver(withdrawalFormSchema),\n    defaultValues: {\n      amount: 0,\n      paymentMode: \"upi\",\n      paymentDetails: {},\n      notes: \"\",\n    },\n  });\n  \n  // Extract tab parameter from URL or default to \"balance\"\n  const getTabFromUrl = () => {\n    const searchParams = new URLSearchParams(window.location.search);\n    const tab = searchParams.get('tab');\n    \n    // Check if user is a direct player (assigned to admin or null)\n    const isDirectPlayer = user?.role === \"player\" && (!user.assignedTo || user.assignedTo === 1);\n    \n    // Only direct players can access deposit/withdraw tabs\n    if (!isDirectPlayer && (tab === 'deposit' || tab === 'withdraw')) {\n      return 'balance';\n    }\n    \n    // Only allow valid tabs\n    return tab === 'deposit' || tab === 'withdraw' || tab === 'history' ? tab : 'balance';\n  };\n  \n  const [activeTab, setActiveTab] = useState(getTabFromUrl());\n  const [proofImage, setProofImage] = useState<File | null>(null);\n  const [paymentModeDetails, setPaymentModeDetails] = useState<PaymentDetails | null>(null);\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState(\"upi\");\n  const [currentPage, setCurrentPage] = useState(1);\n  const [itemsPerPage, setItemsPerPage] = useState(20);\n  const [copiedText, setCopiedText] = useState<string | null>(null);\n  \n  // Update URL when tab changes\n  const updateTab = (tab: string) => {\n    setActiveTab(tab);\n    // Update URL with tab parameter\n    const searchParams = new URLSearchParams(window.location.search);\n    searchParams.set('tab', tab);\n    const newUrl = `${window.location.pathname}?${searchParams.toString()}`;\n    window.history.replaceState(null, '', newUrl);\n  };\n\n  // Fetch payment details from the system\n  const { data: systemPaymentDetails, isLoading: loadingPaymentDetails } = useQuery<SystemPaymentDetails>({\n    queryKey: [\"/api/wallet/payment-details\"],\n    queryFn: async ({ queryKey }) => {\n      const res = await fetch(queryKey[0] as string, {\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        throw new Error(\"Failed to fetch payment details\");\n      }\n      const data = await res.json();\n      return data;\n    }\n  });\n  \n  // Set payment details when they are fetched\n  useEffect(() => {\n    if (systemPaymentDetails) {\n      // Transform the API response to match the expected structure\n      // Use exactly what the admin has set in payment settings\n      const transformedDetails: PaymentDetails = {\n        upiDetails: systemPaymentDetails.upi ? {\n          upiId: systemPaymentDetails.upi.id,\n          qrImageUrl: systemPaymentDetails.upi.qrCode || undefined\n        } : undefined,\n        bankDetails: systemPaymentDetails.bank ? {\n          accountName: systemPaymentDetails.bank.accountHolder,\n          accountNumber: systemPaymentDetails.bank.accountNumber,\n          ifscCode: systemPaymentDetails.bank.ifscCode,\n          bankName: systemPaymentDetails.bank.name\n        } : undefined\n      };\n      \n      setPaymentModeDetails(transformedDetails);\n    }\n  }, [systemPaymentDetails]);\n\n  // Fetch user's wallet requests\n  const { \n    data: walletRequests = [], \n    isLoading: loadingRequests,\n    refetch: refetchRequests\n  } = useQuery<WalletRequest[]>({\n    queryKey: [\"/api/wallet/my-requests\"],\n    enabled: activeTab === \"history\" || activeTab === \"balance\",\n  });\n  \n  // Fetch user's direct transactions (fund transfers, etc.)\n  // Use ownOnly=true to only fetch current user's own transactions (not assigned players' transactions)\n  const {\n    data: transactions = [],\n    isLoading: loadingTransactions,\n    refetch: refetchTransactions\n  } = useQuery<any[]>({\n    queryKey: [\"/api/transactions\", \"ownOnly\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/transactions?ownOnly=true\", {\n        credentials: \"include\"\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch transactions\");\n      return response.json();\n    },\n    enabled: activeTab === \"history\" || activeTab === \"balance\"\n  });\n\n  // Deposit mutation\n  const depositMutation = useMutation({\n    mutationFn: async (values: DepositFormValues) => {\n      let proofImageUrl = \"\";\n      \n      if (proofImage) {\n        proofImageUrl = await uploadProofImage(proofImage);\n      }\n\n      const response = await fetch(\"/api/wallet/requests\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: \"include\",\n        body: JSON.stringify({\n          ...values,\n          requestType: \"deposit\",\n          proofImageUrl,\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to submit deposit request\");\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Deposit Request Submitted\",\n        description: \"Your deposit request has been submitted successfully and is pending approval.\",\n      });\n      depositForm.reset();\n      setProofImage(null);\n      refetchRequests();\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet/my-requests\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Deposit Failed\",\n        description: error.message || \"Failed to submit deposit request\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Withdrawal mutation\n  const withdrawalMutation = useMutation({\n    mutationFn: async (values: WithdrawalFormValues) => {\n      const response = await fetch(\"/api/wallet/requests\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: \"include\",\n        body: JSON.stringify({\n          ...values,\n          requestType: \"withdrawal\",\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to submit withdrawal request\");\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Withdrawal Request Submitted\",\n        description: \"Your withdrawal request has been submitted successfully and is pending approval.\",\n      });\n      withdrawalForm.reset();\n      refetchRequests();\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet/my-requests\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Withdrawal Failed\",\n        description: error.message || \"Failed to submit withdrawal request\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // File upload handler\n  const handleProofImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      setProofImage(e.target.files[0]);\n    }\n  };\n\n  // Upload proof image\n  const uploadProofImage = async (file: File): Promise<string> => {\n    const formData = new FormData();\n    formData.append(\"proofImage\", file);\n\n    try {\n      const res = await fetch('/api/upload/proof', {\n        method: 'POST',\n        body: formData\n      });\n\n      if (!res.ok) {\n        throw new Error(\"Failed to upload image\");\n      }\n\n      const data = await res.json();\n      return data.imageUrl;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  // Copy to clipboard function\n  const copyToClipboard = async (text: string, label: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopiedText(label);\n      toast({\n        title: \"Copied!\",\n        description: `${label} copied to clipboard`,\n      });\n      // Reset copied state after 2 seconds\n      setTimeout(() => setCopiedText(null), 2000);\n    } catch (error) {\n      toast({\n        title: \"Copy Failed\",\n        description: \"Unable to copy to clipboard\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  // Format date for display\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-IN', {\n      day: '2-digit',\n      month: 'short',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  // Get title and icon for request type\n  const getRequestTypeInfo = (type: RequestType) => {\n    switch (type) {\n      case RequestType.DEPOSIT:\n        return { \n          title: \"Deposit\", \n          icon: <ArrowDown className=\"h-5 w-5 text-green-600\" />\n        };\n      case RequestType.WITHDRAWAL:\n        return { \n          title: \"Withdrawal\", \n          icon: <ArrowUp className=\"h-5 w-5 text-blue-600\" />\n        };\n      default:\n        return { \n          title: \"Unknown\", \n          icon: null\n        };\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold\">Wallet</h1>\n          <p className=\"text-muted-foreground\">Manage your account balance and transactions</p>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={updateTab}>\n          {(() => {\n            // Check if user is a direct player (assigned to admin or null)\n            const isDirectPlayer = user?.role === \"player\" && (!user.assignedTo || user.assignedTo === 1);\n            \n            if (isDirectPlayer) {\n              return (\n                <TabsList className=\"grid w-full grid-cols-4 mb-8\">\n                  <TabsTrigger value=\"balance\">Balance</TabsTrigger>\n                  <TabsTrigger value=\"deposit\">Deposit</TabsTrigger>\n                  <TabsTrigger value=\"withdraw\">Withdraw</TabsTrigger>\n                  <TabsTrigger value=\"history\">History</TabsTrigger>\n                </TabsList>\n              );\n            } else {\n              return (\n                <TabsList className=\"grid w-full grid-cols-2 mb-8\">\n                  <TabsTrigger value=\"balance\">Balance</TabsTrigger>\n                  <TabsTrigger value=\"history\">History</TabsTrigger>\n                </TabsList>\n              );\n            }\n          })()}\n\n          <TabsContent value=\"balance\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <Wallet className=\"h-5 w-5 mr-2\" />\n                  Current Balance\n                </CardTitle>\n                <CardDescription>\n                  Your available account balance\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-3xl font-bold text-primary\">\n                  {user ? (user.balance / 100).toFixed(2) : '0.00'}\n                </div>\n              </CardContent>\n              <CardFooter>\n                <Button variant=\"outline\" className=\"w-full\" onClick={() => updateTab(\"history\")}>\n                  View All Transactions\n                </Button>\n              </CardFooter>\n            </Card>\n          </TabsContent>\n\n          {/* Deposit Tab */}\n          <TabsContent value=\"deposit\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Add Funds</CardTitle>\n                <CardDescription>\n                  Deposit money into your account\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Form {...depositForm}>\n                  <form onSubmit={depositForm.handleSubmit((values) => depositMutation.mutate(values))} className=\"space-y-6\">\n                    <FormField\n                      control={depositForm.control}\n                      name=\"amount\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Amount ()</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              placeholder=\"Enter amount (min 100)\"\n                              min=\"100\"\n                              max=\"100000\"\n                              {...field}\n                              onChange={(e) => field.onChange(parseFloat(e.target.value) || 0)}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    \n                    <FormField\n                      control={depositForm.control}\n                      name=\"paymentMode\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Payment Method</FormLabel>\n                          <FormControl>\n                            <RadioGroup \n                              value={field.value} \n                              onValueChange={(value) => {\n                                field.onChange(value);\n                                setSelectedPaymentMethod(value);\n                              }}\n                            >\n                              <div className=\"flex items-center space-x-2\">\n                                <RadioGroupItem value=\"upi\" id=\"deposit-upi\" />\n                                <Label htmlFor=\"deposit-upi\">UPI Payment</Label>\n                              </div>\n                              <div className=\"flex items-center space-x-2\">\n                                <RadioGroupItem value=\"bank\" id=\"deposit-bank\" />\n                                <Label htmlFor=\"deposit-bank\">Bank Transfer</Label>\n                              </div>\n                            </RadioGroup>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    {/* UPI Payment Details */}\n                    {selectedPaymentMethod === \"upi\" && paymentModeDetails?.upiDetails && (\n                      <div className=\"p-4 border rounded-lg bg-muted/50\">\n                        <h4 className=\"font-medium mb-3\">UPI Payment Details</h4>\n                        <div className=\"space-y-3\">\n                          {/* Parse and display each UPI ID separately */}\n                          {paymentModeDetails.upiDetails.upiId.split('\\n').filter(upi => upi.trim()).map((upiId, index) => (\n                            <div key={index} className=\"flex items-center justify-between p-3 bg-background rounded-lg border\">\n                              <div>\n                                <span className=\"text-sm text-muted-foreground\">UPI ID {index + 1}: </span>\n                                <span className=\"font-mono font-medium\">{upiId.trim()}</span>\n                              </div>\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => copyToClipboard(upiId.trim(), `UPI ID ${index + 1}`)}\n                                className=\"gap-2\"\n                              >\n                                {copiedText === `UPI ID ${index + 1}` ? (\n                                  <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                                ) : (\n                                  <Copy className=\"h-4 w-4\" />\n                                )}\n                                Copy\n                              </Button>\n                            </div>\n                          ))}\n                          \n                          {/* Copy All UPI IDs button */}\n                          {paymentModeDetails.upiDetails.upiId.includes('\\n') && (\n                            <div className=\"mt-3 p-3 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800\">\n                              <div className=\"flex items-center justify-between\">\n                                <div>\n                                  <p className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">All UPI IDs</p>\n                                  <p className=\"text-xs text-blue-700 dark:text-blue-300\">Copy all UPI IDs at once</p>\n                                </div>\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => copyToClipboard(paymentModeDetails.upiDetails!.upiId, \"All UPI IDs\")}\n                                  className=\"gap-2\"\n                                >\n                                  {copiedText === \"All UPI IDs\" ? (\n                                    <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                                  ) : (\n                                    <Copy className=\"h-4 w-4\" />\n                                  )}\n                                  Copy All\n                                </Button>\n                              </div>\n                            </div>\n                          )}\n                          \n                          {paymentModeDetails.upiDetails.qrImageUrl && (\n                            <div className=\"text-center\">\n                              <p className=\"text-sm text-muted-foreground mb-2\">Scan QR Code:</p>\n                              <img \n                                src={paymentModeDetails.upiDetails.qrImageUrl} \n                                alt=\"QR Code\" \n                                className=\"w-40 h-40 mx-auto border rounded-lg\"\n                              />\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Bank Transfer Details */}\n                    {selectedPaymentMethod === \"bank\" && paymentModeDetails?.bankDetails && (\n                      <div className=\"p-4 border rounded-lg bg-muted/50\">\n                        <h4 className=\"font-medium mb-3\">Bank Transfer Details</h4>\n                        <div className=\"space-y-3\">\n                          <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border\">\n                            <div>\n                              <span className=\"text-sm text-muted-foreground\">Bank Name: </span>\n                              <span className=\"font-medium\">{paymentModeDetails.bankDetails.bankName}</span>\n                            </div>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => copyToClipboard(paymentModeDetails.bankDetails!.bankName, \"Bank Name\")}\n                              className=\"gap-2\"\n                            >\n                              {copiedText === \"Bank Name\" ? (\n                                <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                              ) : (\n                                <Copy className=\"h-4 w-4\" />\n                              )}\n                              Copy\n                            </Button>\n                          </div>\n                          \n                          <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border\">\n                            <div>\n                              <span className=\"text-sm text-muted-foreground\">Account Holder: </span>\n                              <span className=\"font-medium\">{paymentModeDetails.bankDetails.accountName}</span>\n                            </div>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => copyToClipboard(paymentModeDetails.bankDetails!.accountName, \"Account Holder\")}\n                              className=\"gap-2\"\n                            >\n                              {copiedText === \"Account Holder\" ? (\n                                <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                              ) : (\n                                <Copy className=\"h-4 w-4\" />\n                              )}\n                              Copy\n                            </Button>\n                          </div>\n                          \n                          <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border\">\n                            <div>\n                              <span className=\"text-sm text-muted-foreground\">Account Number: </span>\n                              <span className=\"font-mono font-medium\">{paymentModeDetails.bankDetails.accountNumber}</span>\n                            </div>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => copyToClipboard(paymentModeDetails.bankDetails!.accountNumber, \"Account Number\")}\n                              className=\"gap-2\"\n                            >\n                              {copiedText === \"Account Number\" ? (\n                                <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                              ) : (\n                                <Copy className=\"h-4 w-4\" />\n                              )}\n                              Copy\n                            </Button>\n                          </div>\n                          \n                          <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border\">\n                            <div>\n                              <span className=\"text-sm text-muted-foreground\">IFSC Code: </span>\n                              <span className=\"font-mono font-medium\">{paymentModeDetails.bankDetails.ifscCode}</span>\n                            </div>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => copyToClipboard(paymentModeDetails.bankDetails!.ifscCode, \"IFSC Code\")}\n                              className=\"gap-2\"\n                            >\n                              {copiedText === \"IFSC Code\" ? (\n                                <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                              ) : (\n                                <Copy className=\"h-4 w-4\" />\n                              )}\n                              Copy\n                            </Button>\n                          </div>\n                          \n                          <div className=\"mt-3 p-3 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800\">\n                            <div className=\"flex items-center justify-between\">\n                              <div>\n                                <p className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">Complete Bank Details</p>\n                                <p className=\"text-xs text-blue-700 dark:text-blue-300\">Copy all details at once</p>\n                              </div>\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  const allDetails = `Bank Name: ${paymentModeDetails.bankDetails!.bankName}\nAccount Holder: ${paymentModeDetails.bankDetails!.accountName}\nAccount Number: ${paymentModeDetails.bankDetails!.accountNumber}\nIFSC Code: ${paymentModeDetails.bankDetails!.ifscCode}`;\n                                  copyToClipboard(allDetails, \"All Bank Details\");\n                                }}\n                                className=\"gap-2\"\n                              >\n                                {copiedText === \"All Bank Details\" ? (\n                                  <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                                ) : (\n                                  <Copy className=\"h-4 w-4\" />\n                                )}\n                                Copy All\n                              </Button>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n\n                    <FormField\n                      control={depositForm.control}\n                      name=\"paymentDetails.transactionId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Transaction ID</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"Enter your transaction ID\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"proof-upload\">Payment Proof (Screenshot)</Label>\n                      <Input \n                        id=\"proof-upload\"\n                        type=\"file\" \n                        accept=\"image/*\"\n                        onChange={handleProofImageChange}\n                      />\n                      {proofImage && (\n                        <p className=\"text-sm text-muted-foreground\">\n                          Selected: {proofImage.name}\n                        </p>\n                      )}\n                    </div>\n\n                    <FormField\n                      control={depositForm.control}\n                      name=\"notes\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Notes (Optional)</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"Add any additional notes\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full\" \n                      disabled={depositMutation.isPending}\n                    >\n                      {depositMutation.isPending ? (\n                        <>\n                          <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                          Submitting...\n                        </>\n                      ) : (\n                        \"Submit Deposit Request\"\n                      )}\n                    </Button>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Withdraw Tab */}\n          <TabsContent value=\"withdraw\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Withdraw Funds</CardTitle>\n                <CardDescription>\n                  Withdraw money from your account\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"mb-6 p-4 rounded-lg bg-muted/50\">\n                  <div className=\"flex items-center gap-3 mb-2\">\n                    <div className=\"p-2 rounded-full bg-primary\">\n                      <IndianRupee className=\"h-4 w-4 text-primary-foreground\" />\n                    </div>\n                    <h3 className=\"text-lg font-semibold\">Your balance: {user?.balance ? (user.balance / 100).toFixed(2) : '0.00'}</h3>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Minimum withdrawal amount is 500. Maximum is 50,000.\n                  </p>\n                </div>\n\n                <Form {...withdrawalForm}>\n                  <form onSubmit={withdrawalForm.handleSubmit((values) => withdrawalMutation.mutate(values))} className=\"space-y-6\">\n                    <FormField\n                      control={withdrawalForm.control}\n                      name=\"amount\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Amount ()</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              placeholder=\"Enter amount (min 500)\"\n                              min=\"500\"\n                              max=\"50000\"\n                              {...field}\n                              onChange={(e) => field.onChange(parseFloat(e.target.value) || 0)}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    \n                    <FormField\n                      control={withdrawalForm.control}\n                      name=\"paymentMode\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Withdrawal Method</FormLabel>\n                          <FormControl>\n                            <RadioGroup value={field.value} onValueChange={field.onChange}>\n                              <div className=\"flex items-center space-x-2\">\n                                <RadioGroupItem value=\"upi\" id=\"withdraw-upi\" />\n                                <Label htmlFor=\"withdraw-upi\">UPI</Label>\n                              </div>\n                              <div className=\"flex items-center space-x-2\">\n                                <RadioGroupItem value=\"bank\" id=\"withdraw-bank\" />\n                                <Label htmlFor=\"withdraw-bank\">Bank Transfer</Label>\n                              </div>\n                            </RadioGroup>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    {withdrawalForm.watch(\"paymentMode\") === \"upi\" && (\n                      <FormField\n                        control={withdrawalForm.control}\n                        name=\"paymentDetails.upiId\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>UPI ID</FormLabel>\n                            <FormControl>\n                              <Input placeholder=\"your-upi@bank\" {...field} />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n\n                    {withdrawalForm.watch(\"paymentMode\") === \"bank\" && (\n                      <>\n                        <FormField\n                          control={withdrawalForm.control}\n                          name=\"paymentDetails.bankName\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Bank Name</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"Enter your bank name\" {...field} />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={withdrawalForm.control}\n                          name=\"paymentDetails.accountNumber\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Account Number</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"Enter your account number\" {...field} />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={withdrawalForm.control}\n                          name=\"paymentDetails.ifscCode\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>IFSC Code</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"Enter IFSC code\" {...field} />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </>\n                    )}\n\n                    <FormField\n                      control={withdrawalForm.control}\n                      name=\"notes\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Notes (Optional)</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Any additional information\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full\" \n                      disabled={withdrawalMutation.isPending}\n                    >\n                      {withdrawalMutation.isPending ? (\n                        <>\n                          <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                          Submitting...\n                        </>\n                      ) : (\n                        \"Submit Withdrawal Request\"\n                      )}\n                    </Button>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* History Tab */}\n          <TabsContent value=\"history\">\n            <div className=\"space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center\">\n                    <History className=\"h-5 w-5 mr-2\" />\n                    Transaction History\n                  </CardTitle>\n                  <CardDescription>\n                    View all your wallet transactions and requests\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {loadingRequests || loadingTransactions ? (\n                    <div className=\"flex items-center justify-center py-8\">\n                      <Loader2 className=\"h-8 w-8 animate-spin\" />\n                    </div>\n                  ) : walletRequests.length === 0 && transactions.length === 0 ? (\n                    <div className=\"text-center py-8\">\n                      <p className=\"text-muted-foreground\">No transactions found</p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-4\">\n                      {/* Combine and sort all transactions by date (newest first) */}\n                      {(() => {\n                        const allTransactions = [\n                          ...walletRequests.map(request => ({\n                            id: `req-${request.id}`,\n                            type: 'request',\n                            createdAt: request.createdAt,\n                            data: request\n                          })),\n                          ...transactions.map(transaction => ({\n                            id: `txn-${transaction.id}`,\n                            type: 'transaction',\n                            createdAt: transaction.createdAt,\n                            data: transaction\n                          }))\n                        ].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n\n                        return allTransactions.map((item) => (\n                          <div key={item.id} className=\"p-4 border rounded-lg\">\n                            {item.type === 'request' ? (\n                              // Wallet Request Display\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center gap-3\">\n                                  {getRequestTypeInfo(item.data.requestType).icon}\n                                  <div>\n                                    <h4 className=\"font-medium\">\n                                      {getRequestTypeInfo(item.data.requestType).title}\n                                    </h4>\n                                    <p className=\"text-sm text-muted-foreground\">\n                                      {formatDate(item.data.createdAt)}\n                                      {item.data.status === RequestStatus.APPROVED && item.data.approvedBy && (\n                                        <span className=\"ml-2 text-green-600\">\n                                           Approved by {item.data.approver?.username || `Admin #${item.data.approvedBy}`}\n                                        </span>\n                                      )}\n                                      {item.data.status === RequestStatus.REJECTED && item.data.rejectedBy && (\n                                        <span className=\"ml-2 text-red-600\">\n                                           Rejected by {item.data.rejector?.username || `Admin #${item.data.rejectedBy}`}\n                                        </span>\n                                      )}\n                                    </p>\n                                    {item.data.notes && (\n                                      <p className=\"text-xs text-muted-foreground mt-1\">\n                                        Note: {item.data.notes}\n                                      </p>\n                                    )}\n                                  </div>\n                                </div>\n                                <div className=\"text-right\">\n                                  <div className=\"font-medium\">\n                                    {item.data.amount.toFixed(2)}\n                                  </div>\n                                  <Badge variant={\n                                    item.data.status === RequestStatus.APPROVED ? \"default\" :\n                                    item.data.status === RequestStatus.REJECTED ? \"destructive\" :\n                                    \"secondary\"\n                                  }>\n                                    {item.data.status}\n                                  </Badge>\n                                </div>\n                              </div>\n                            ) : (\n                              // Direct Transaction Display (Admin Actions)\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center gap-3\">\n                                  {item.data.amount > 0 ? (\n                                    <div className=\"p-2 rounded-full bg-green-100 dark:bg-green-900\">\n                                      <ArrowDown className=\"h-4 w-4 text-green-600\" />\n                                    </div>\n                                  ) : (\n                                    <div className=\"p-2 rounded-full bg-red-100 dark:bg-red-900\">\n                                      <ArrowUp className=\"h-4 w-4 text-red-600\" />\n                                    </div>\n                                  )}\n                                  <div>\n                                    <h4 className=\"font-medium\">\n                                      {item.data.amount > 0 ? \"Fund Credit\" : \"Fund Debit\"}\n                                    </h4>\n                                    <p className=\"text-sm text-muted-foreground\">\n                                      {formatDate(item.data.createdAt)}\n                                      {item.data.performer && (\n                                        <span className=\"ml-2 text-blue-600\">\n                                           By {item.data.performer.username}\n                                        </span>\n                                      )}\n                                    </p>\n                                    {item.data.description && (\n                                      <p className=\"text-xs text-muted-foreground mt-1\">\n                                        {item.data.description}\n                                      </p>\n                                    )}\n                                  </div>\n                                </div>\n                                <div className=\"text-right\">\n                                  <div className={`font-medium ${item.data.amount > 0 ? \"text-green-600\" : \"text-red-600\"}`}>\n                                    {item.data.amount > 0 ? \"+\" : \"\"}{(Math.abs(item.data.amount) / 100).toFixed(2)}\n                                  </div>\n                                  <div className=\"text-xs text-muted-foreground\">\n                                    Balance: {(item.data.balanceAfter / 100).toFixed(2)}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        ));\n                      })()}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":45461,"size_tokens":null},"client/src/pages/admin-settings-page.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Loader2, Upload, X, Info, Trash2, RefreshCw } from \"lucide-react\";\n\nexport default function AdminSettingsPage() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"payment\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Payment Settings\n  const [upiId, setUpiId] = useState(\"\");\n  const [qrCodeUrl, setQrCodeUrl] = useState(\"\");\n  const [isUploadingQr, setIsUploadingQr] = useState(false);\n  const qrFileInputRef = useRef<HTMLInputElement>(null);\n  const [bankName, setBankName] = useState(\"\");\n  const [accountNumber, setAccountNumber] = useState(\"\");\n  const [accountName, setAccountName] = useState(\"\");\n  const [ifscCode, setIfscCode] = useState(\"\");\n  \n  // Slider Images State\n  const [sliderImages, setSliderImages] = useState<{filename: string, url: string}[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  \n  // Hero Slider Images State\n  const [heroImages, setHeroImages] = useState<{id: number, filename: string, url: string, position: number}[]>([]);\n  const [isUploadingHero, setIsUploadingHero] = useState(false);\n  const homeHeroFileInputRef = useRef<HTMLInputElement>(null);\n  \n  // Game Card Images State\n  const [gameCardImages, setGameCardImages] = useState<{filename: string, url: string, gameType?: string}[]>([]);\n  const [selectedGameImages, setSelectedGameImages] = useState<{[key: string]: string}>({\n    market: '',\n    cricket: '',\n    sports: '',\n    coinflip: ''\n  });\n  const [isUploadingGameCard, setIsUploadingGameCard] = useState<{[key: string]: boolean}>({\n    market: false,\n    cricket: false,\n    sports: false,\n    coinflip: false\n  });\n  const gameCardFileInputRefs = {\n    market: useRef<HTMLInputElement>(null),\n    cricket: useRef<HTMLInputElement>(null),\n    sports: useRef<HTMLInputElement>(null),\n    coinflip: useRef<HTMLInputElement>(null)\n  };\n\n  // Game Odds Settings\n  const [coinFlipOdds, setCoinFlipOdds] = useState(\"1.95\");\n  const [cricketTossOdds, setCricketTossOdds] = useState(\"1.90\");\n  // Team Match odds removed\n  const [satamatkaOdds, setSatamatkaOdds] = useState({\n    jodi: \"90.00\",\n    harf: \"9.00\",\n    crossing: \"95.00\",\n    odd_even: \"1.90\",\n  });\n\n  // Platform Default Subadmin Commission Setting (for fund transfers only)\n  const [defaultCommissionRate, setDefaultCommissionRate] = useState(\"10.0\");\n  \n  // Query to fetch default commission rates\n  const { isLoading: isLoadingDefaultCommissions, data: defaultCommissionData } = useQuery({\n    queryKey: ['/api/commissions/default'],\n    queryFn: () => fetch('/api/commissions/default', {\n      credentials: 'include'\n    }).then(res => res.json())\n  });\n  \n  // Update commission rate when default data is loaded\n  useEffect(() => {\n    if (defaultCommissionData && defaultCommissionData.deposit) {\n      setDefaultCommissionRate(defaultCommissionData.deposit.toString());\n    }\n  }, [defaultCommissionData]);\n\n  // Load payment settings\n  const { data: paymentSettings, isLoading: isLoadingPayment } = useQuery<any[]>({\n    queryKey: ['/api/settings', 'payment'],\n    queryFn: () => apiRequest(\"GET\", '/api/settings?type=payment')\n      .then(res => res.json()),\n  });\n  \n  // Load game image settings\n  const { data: gameImageSettings } = useQuery<any[]>({\n    queryKey: ['/api/settings', 'game_images'],\n    queryFn: () => apiRequest(\"GET\", '/api/settings?type=game_images')\n      .then(res => res.json()),\n  });\n\n  // Process payment settings when they load\n  useEffect(() => {\n    if (paymentSettings) {\n      paymentSettings.forEach((setting: any) => {\n        switch (setting.settingKey) {\n          case 'upi_id':\n            setUpiId(setting.settingValue);\n            break;\n          case 'bank_name':\n            setBankName(setting.settingValue);\n            break;\n          case 'account_number':\n            setAccountNumber(setting.settingValue);\n            break;\n          case 'account_name':\n            setAccountName(setting.settingValue);\n            break;\n          case 'ifsc_code':\n            setIfscCode(setting.settingValue);\n            break;\n        }\n      });\n    }\n  }, [paymentSettings]);\n\n  // Load game odds\n  const { data: coinFlipOddsData, isLoading: isLoadingOdds } = useQuery<any[]>({\n    queryKey: ['/api/game-odds', 'coin_flip'],\n    queryFn: () => apiRequest(\"GET\", '/api/game-odds?gameType=coin_flip')\n      .then(res => res.json()),\n  });\n\n  // Load cricket toss odds\n  const { data: cricketTossOddsData } = useQuery<any[]>({\n    queryKey: ['/api/game-odds', 'cricket_toss'],\n    queryFn: () => apiRequest(\"GET\", '/api/game-odds?gameType=cricket_toss')\n      .then(res => res.json()),\n  });\n\n  // Team match odds queries removed\n\n  // Process coin flip odds when they load\n  useEffect(() => {\n    if (coinFlipOddsData && coinFlipOddsData.length > 0) {\n      // Convert the stored value (multiplied by 10000) back to a decimal for display\n      const displayValue = (coinFlipOddsData[0].oddValue / 10000).toFixed(2);\n      setCoinFlipOdds(displayValue);\n    }\n  }, [coinFlipOddsData]);\n  \n  // Process cricket toss odds when they load\n  useEffect(() => {\n    if (cricketTossOddsData && cricketTossOddsData.length > 0) {\n      // Convert the stored value (multiplied by 10000) back to a decimal for display\n      const displayValue = (cricketTossOddsData[0].oddValue / 10000).toFixed(2);\n      setCricketTossOdds(displayValue);\n    }\n  }, [cricketTossOddsData]);\n  \n  // Team match odds processing removed\n\n  // Load satamatka odds\n  const { data: satamatkaOddsData } = useQuery<any>({\n    queryKey: ['/api/game-odds', 'satamatka'],\n    queryFn: async () => {\n      const modes = ['jodi', 'harf', 'crossing', 'odd_even'];\n      const results = await Promise.all(\n        modes.map(mode => \n          apiRequest(\"GET\", `/api/game-odds?gameType=satamatka_${mode}`)\n            .then(res => res.json())\n        )\n      );\n      \n      return { \n        jodi: results[0], \n        harf: results[1], \n        crossing: results[2],\n        odd_even: results[3] \n      };\n    },\n  });\n\n  // Process satamatka odds when they load\n  useEffect(() => {\n    if (satamatkaOddsData) {\n      const updatedOdds = { ...satamatkaOdds };\n      \n      if (satamatkaOddsData.jodi && satamatkaOddsData.jodi.length > 0) {\n        // Convert the stored value (multiplied by 10000) back to a decimal for display\n        updatedOdds.jodi = (satamatkaOddsData.jodi[0].oddValue / 10000).toFixed(2);\n      }\n      \n      if (satamatkaOddsData.harf && satamatkaOddsData.harf.length > 0) {\n        // Convert the stored value (multiplied by 10000) back to a decimal for display\n        updatedOdds.harf = (satamatkaOddsData.harf[0].oddValue / 10000).toFixed(2);\n      }\n      \n      if (satamatkaOddsData.crossing && satamatkaOddsData.crossing.length > 0) {\n        // Convert the stored value (multiplied by 10000) back to a decimal for display\n        updatedOdds.crossing = (satamatkaOddsData.crossing[0].oddValue / 10000).toFixed(2);\n      }\n      \n      if (satamatkaOddsData.odd_even && satamatkaOddsData.odd_even.length > 0) {\n        // Convert the stored value (multiplied by 10000) back to a decimal for display\n        updatedOdds.odd_even = (satamatkaOddsData.odd_even[0].oddValue / 10000).toFixed(2);\n      }\n      \n      setSatamatkaOdds(updatedOdds);\n    }\n  }, [satamatkaOddsData]);\n  \n  // Load slider images\n  const { \n    data: sliderImagesData, \n    isLoading: isLoadingSliderImages,\n    refetch: refetchSliderImages\n  } = useQuery<{filename: string, url: string}[]>({\n    queryKey: ['/api/sliders'],\n    queryFn: () => apiRequest(\"GET\", '/api/sliders')\n      .then(res => res.json()),\n  });\n  \n  // Load hero slider images\n  const {\n    data: heroImagesData,\n    isLoading: isLoadingHeroImages,\n    refetch: refetchHeroImages\n  } = useQuery<{id: number, filename: string, url: string, position: number}[]>({\n    queryKey: ['/api/herosliders'],\n    queryFn: () => apiRequest(\"GET\", '/api/herosliders')\n      .then(res => res.json())\n      .catch(() => []), // Return empty array if API endpoint doesn't exist yet\n  });\n  \n  // Update slider images when data is loaded\n  useEffect(() => {\n    if (sliderImagesData) {\n      setSliderImages(sliderImagesData);\n    }\n  }, [sliderImagesData]);\n  \n  // Update hero images when data is loaded\n  useEffect(() => {\n    if (heroImagesData) {\n      // Sort by position to ensure display order\n      const sortedImages = [...heroImagesData].sort((a, b) => a.position - b.position);\n      setHeroImages(sortedImages);\n    }\n  }, [heroImagesData]);\n  \n  // Load game card images\n  const { \n    data: gameCardImagesData, \n    isLoading: isLoadingGameCardImages,\n    refetch: refetchGameCardImages\n  } = useQuery<{filename: string, url: string}[]>({\n    queryKey: ['/api/gamecards'],\n    queryFn: () => apiRequest(\"GET\", '/api/gamecards')\n      .then(res => res.json()),\n  });\n  \n  // Update game card images when data is loaded\n  useEffect(() => {\n    if (gameCardImagesData) {\n      console.log('Received game card images from server:', gameCardImagesData);\n      \n      // The server now includes gameType directly in the API response\n      setGameCardImages(gameCardImagesData);\n    }\n  }, [gameCardImagesData]);\n  \n  // Process game image settings when they load\n  useEffect(() => {\n    if (gameImageSettings && gameImageSettings.length > 0) {\n      // Create a temporary object to hold selected images\n      const selectedImgs: {[key: string]: string} = {\n        market: '',\n        cricket: '',\n        sports: '',\n        coinflip: ''\n      };\n      \n      // Update selected images based on settings\n      gameImageSettings.forEach((setting: any) => {\n        const gameType = setting.settingKey.replace('primary_', '');\n        if (selectedImgs.hasOwnProperty(gameType)) {\n          selectedImgs[gameType] = setting.settingValue;\n        }\n      });\n      \n      // Update state with selected images\n      setSelectedGameImages(selectedImgs);\n    }\n  }, [gameImageSettings]);\n  \n  // Upload slider image mutation\n  const uploadSliderMutation = useMutation({\n    mutationFn: async (formData: FormData) => {\n      const response = await fetch('/api/upload/slider', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to upload image');\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Image Uploaded\",\n        description: \"Slider image has been uploaded successfully.\",\n      });\n      refetchSliderImages();\n      setIsUploading(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Upload Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      setIsUploading(false);\n    }\n  });\n  \n  // Delete slider image mutation\n  const deleteSliderMutation = useMutation({\n    mutationFn: (filename: string) => \n      apiRequest(\"DELETE\", `/api/sliders/${filename}`)\n        .then(res => res.json()),\n    onSuccess: () => {\n      toast({\n        title: \"Image Deleted\",\n        description: \"Slider image has been deleted successfully.\",\n      });\n      refetchSliderImages();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Delete Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Upload QR code mutation\n  const uploadQrMutation = useMutation({\n    mutationFn: async (formData: FormData) => {\n      const response = await fetch('/api/upload/qr-code', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n      \n      if (!response.ok) {\n        let errorMessage = 'Failed to upload QR code';\n        try {\n          const errorData = await response.json();\n          errorMessage = errorData.error || errorMessage;\n        } catch (e) {\n          errorMessage = await response.text() || errorMessage;\n        }\n        throw new Error(errorMessage);\n      }\n      \n      return response.json();\n    },\n    onSuccess: (data) => {\n      setQrCodeUrl(data.imageUrl);\n      setIsUploadingQr(false);\n      toast({\n        title: \"QR Code Uploaded\",\n        description: \"UPI QR code has been uploaded successfully.\",\n      });\n    },\n    onError: (error: Error) => {\n      setIsUploadingQr(false);\n      toast({\n        title: \"Upload Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Upload hero image mutation\n  const uploadHeroMutation = useMutation({\n    mutationFn: async (formData: FormData) => {\n      const response = await fetch('/api/upload/heroslider', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n      \n      if (!response.ok) {\n        let errorMessage = 'Failed to upload hero image';\n        try {\n          const errorData = await response.json();\n          errorMessage = errorData.error || errorMessage;\n        } catch (e) {\n          // If we can't parse JSON, use the response text if available\n          errorMessage = await response.text() || errorMessage;\n        }\n        throw new Error(errorMessage);\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Hero Image Uploaded\",\n        description: \"Home page hero image has been uploaded successfully.\",\n      });\n      refetchHeroImages();\n      setIsUploadingHero(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Upload Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      setIsUploadingHero(false);\n    }\n  });\n  \n  // Delete hero image mutation\n  const deleteHeroMutation = useMutation({\n    mutationFn: (filename: string) => \n      apiRequest(\"DELETE\", `/api/herosliders/${filename}`)\n        .then(res => res.json()),\n    onSuccess: () => {\n      toast({\n        title: \"Hero Image Deleted\",\n        description: \"Home page hero image has been deleted successfully.\",\n      });\n      refetchHeroImages();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Delete Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Update hero image position mutation\n  const updateHeroPositionMutation = useMutation({\n    mutationFn: ({ imageId, newPosition }: { imageId: number, newPosition: number }) => \n      apiRequest(\"PATCH\", `/api/herosliders/${imageId}/position`, { position: newPosition })\n        .then(res => res.json()),\n    onSuccess: () => {\n      toast({\n        title: \"Position Updated\",\n        description: \"Hero image position has been updated successfully.\",\n      });\n      refetchHeroImages();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Save settings mutation\n  const saveMutation = useMutation({\n    mutationFn: (settings: any) => apiRequest(\"POST\", '/api/settings', settings)\n      .then(res => res.json()),\n    onSuccess: () => {\n      toast({\n        title: \"Settings Saved\",\n        description: \"Your settings have been saved successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/settings'] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error Saving Settings\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Save game odds mutation\n  const saveOddsMutation = useMutation({\n    mutationFn: (odds: any) => apiRequest(\"POST\", '/api/game-odds', odds)\n      .then(res => res.json()),\n    onSuccess: () => {\n      toast({\n        title: \"Game Odds Saved\",\n        description: \"Your game odds have been saved successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/game-odds'] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error Saving Game Odds\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Save commission mutation\n  const saveCommissionMutation = useMutation({\n    mutationFn: (commission: any) => apiRequest(\"POST\", '/api/commissions/default', commission)\n      .then(res => res.json()),\n    onSuccess: () => {\n      toast({\n        title: \"Commission Rates Saved\",\n        description: \"Platform default commission rates have been saved successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/commissions'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/commissions/default'] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error Saving Commission Rates\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Additional mutation to update wallet payment details\n  const saveWalletPaymentDetailsMutation = useMutation({\n    mutationFn: (details: any) => apiRequest(\"PUT\", '/api/wallet/payment-details', details)\n      .then(res => res.json()),\n    onSuccess: () => {\n      toast({\n        title: \"Payment Details Saved\",\n        description: \"Payment details have been updated for wallet deposits.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/wallet/payment-details'] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error Saving Payment Details\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Handle payment settings save\n  const handleSavePayment = () => {\n    // Save individual settings\n    // Save UPI ID\n    saveMutation.mutate({ \n      settingType: \"payment\", \n      settingKey: \"upi_id\", \n      settingValue: upiId \n    });\n    \n    // Save Bank Details\n    saveMutation.mutate({ \n      settingType: \"payment\", \n      settingKey: \"bank_name\", \n      settingValue: bankName \n    });\n    \n    saveMutation.mutate({ \n      settingType: \"payment\", \n      settingKey: \"account_number\", \n      settingValue: accountNumber \n    });\n    \n    saveMutation.mutate({ \n      settingType: \"payment\", \n      settingKey: \"account_name\", \n      settingValue: accountName \n    });\n    \n    saveMutation.mutate({ \n      settingType: \"payment\", \n      settingKey: \"ifsc_code\", \n      settingValue: ifscCode \n    });\n    \n    // IMPORTANT: Also update the wallet payment details for the client interface\n    saveWalletPaymentDetailsMutation.mutate({\n      upi: {\n        id: upiId,\n        qrCode: qrCodeUrl || null\n      },\n      bank: {\n        name: bankName,\n        accountNumber: accountNumber,\n        ifscCode: ifscCode,\n        accountHolder: accountName\n      }\n    });\n  };\n\n  // Handle game odds save\n  const handleSaveGameOdds = () => {\n    // Save Coin Flip odds\n    // Don't multiply by 10000 again since we already did it in the input onChange handler\n    saveOddsMutation.mutate({\n      gameType: \"coin_flip\",\n      oddValue: Number(coinFlipOdds),\n      setByAdmin: true\n    });\n    \n    // Save Cricket Toss odds\n    saveOddsMutation.mutate({\n      gameType: \"cricket_toss\",\n      oddValue: Number(cricketTossOdds),\n      setByAdmin: true\n    });\n    \n    // Team match odds saving removed\n    \n    // Save Satamatka odds\n    saveOddsMutation.mutate({\n      gameType: \"satamatka_jodi\",\n      oddValue: Number(satamatkaOdds.jodi),\n      setByAdmin: true\n    });\n    \n    saveOddsMutation.mutate({\n      gameType: \"satamatka_harf\",\n      oddValue: Number(satamatkaOdds.harf),\n      setByAdmin: true\n    });\n    \n    saveOddsMutation.mutate({\n      gameType: \"satamatka_crossing\",\n      oddValue: Number(satamatkaOdds.crossing),\n      setByAdmin: true\n    });\n    \n    saveOddsMutation.mutate({\n      gameType: \"satamatka_odd_even\",\n      oddValue: Number(satamatkaOdds.odd_even),\n      setByAdmin: true\n    });\n  };\n  \n  // Handle slider image upload\n  const handleSliderImageUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (!event.target.files || event.target.files.length === 0) {\n      return;\n    }\n    \n    const file = event.target.files[0];\n    const formData = new FormData();\n    formData.append('sliderImage', file);\n    \n    setIsUploading(true);\n    uploadSliderMutation.mutate(formData);\n    \n    // Reset the file input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n  \n  // Handle slider image delete\n  const handleDeleteSliderImage = (filename: string) => {\n    if (confirm('Are you sure you want to delete this slider image?')) {\n      deleteSliderMutation.mutate(filename);\n    }\n  };\n  \n  // Handle hero image upload\n  const handleHeroImageUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (!event.target.files || event.target.files.length === 0) {\n      return;\n    }\n    \n    const file = event.target.files[0];\n    const formData = new FormData();\n    formData.append('heroSliderImage', file);\n    \n    setIsUploadingHero(true);\n    uploadHeroMutation.mutate(formData);\n    \n    // Reset the file input\n    if (homeHeroFileInputRef.current) {\n      homeHeroFileInputRef.current.value = '';\n    }\n  };\n  \n  // Handle hero image delete\n  const handleDeleteHeroImage = (filename: string) => {\n    if (confirm('Are you sure you want to delete this hero image?')) {\n      deleteHeroMutation.mutate(filename);\n    }\n  };\n  \n  // Handle changing hero image position\n  const handleMoveHeroImage = (imageId: number, direction: 'up' | 'down') => {\n    const currentIndex = heroImages.findIndex(img => img.id === imageId);\n    if (currentIndex === -1) return;\n    \n    const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;\n    if (newIndex < 0 || newIndex >= heroImages.length) return;\n    \n    // Update positions in API\n    updateHeroPositionMutation.mutate({\n      imageId: imageId,\n      newPosition: heroImages[newIndex].position\n    });\n  };\n  \n  // Upload game card image mutation\n  const uploadGameCardMutation = useMutation({\n    mutationFn: async ({ formData, gameType }: { formData: FormData; gameType: string }) => {\n      const response = await fetch('/api/upload/gamecard', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to upload image');\n      }\n      \n      return { \n        result: await response.json(),\n        gameType\n      };\n    },\n    onSuccess: (data) => {\n      const { gameType, result } = data;\n      \n      console.log(\"Upload success response:\", result);\n      \n      // Immediately add the newly uploaded image to the state with the correct game type\n      if (result && result.imageUrl) {\n        const newImage = {\n          filename: result.filename,\n          url: result.imageUrl,\n          gameType: result.gameType || gameType\n        };\n        \n        console.log(\"Adding new image to state:\", newImage);\n        \n        // Add the new image to the state\n        setGameCardImages(prevImages => {\n          const newImages = [...prevImages, newImage];\n          console.log(\"Updated images state:\", newImages);\n          return newImages;\n        });\n      }\n      \n      toast({\n        title: \"Image Uploaded\",\n        description: `Game card image for ${gameType.toUpperCase()} has been uploaded successfully.`,\n      });\n      \n      // No longer need to refetch - we already have the correct state\n      // refetchGameCardImages();\n      \n      setIsUploadingGameCard(prev => ({\n        ...prev,\n        [data.gameType]: false\n      }));\n    },\n    onError: (error: Error, variables) => {\n      toast({\n        title: \"Upload Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      setIsUploadingGameCard(prev => ({\n        ...prev,\n        [variables.gameType]: false\n      }));\n    }\n  });\n  \n  // Delete game card image mutation\n  const deleteGameCardMutation = useMutation({\n    mutationFn: (filename: string) => \n      apiRequest(\"DELETE\", `/api/gamecards/${filename}`)\n        .then(res => res.json()),\n    onSuccess: () => {\n      toast({\n        title: \"Image Deleted\",\n        description: \"Game card image has been deleted successfully.\",\n      });\n      refetchGameCardImages();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Delete Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Handle selecting a game card image as primary\n  const handleSelectGameImage = (filename: string, gameType: string) => {\n    // Update the selected image for this game type\n    setSelectedGameImages(prev => ({\n      ...prev,\n      [gameType]: filename\n    }));\n    \n    // Save this selection to the database\n    saveMutation.mutate({\n      settingType: \"game_images\",\n      settingKey: `primary_${gameType}`,\n      settingValue: filename\n    });\n    \n    toast({\n      title: \"Primary Image Selected\",\n      description: `This image will now be used as the primary image for ${gameType.toUpperCase()} games.`,\n    });\n  };\n  \n  // Handler for retrieving the selected status of an image\n  const isSelectedImage = (filename: string, gameType: string) => {\n    return selectedGameImages[gameType] === filename;\n  };\n\n  // Handle QR code upload\n  const handleQrUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (!event.target.files || event.target.files.length === 0) {\n      return;\n    }\n    \n    const file = event.target.files[0];\n    const formData = new FormData();\n    formData.append('qrImage', file);\n    \n    setIsUploadingQr(true);\n    uploadQrMutation.mutate(formData);\n  };\n\n  // Handle game card image upload\n  const handleGameCardImageUpload = (event: React.ChangeEvent<HTMLInputElement>, gameType: string) => {\n    if (!event.target.files || event.target.files.length === 0) {\n      return;\n    }\n    \n    const file = event.target.files[0];\n    const formData = new FormData();\n    formData.append('gameCardImage', file);\n    // Ensure we use exact game type strings that match the server-side processing\n    formData.append('gameType', gameType);\n    \n    console.log(`Uploading ${gameType} game card image:`, file.name);\n    \n    setIsUploadingGameCard(prev => ({\n      ...prev,\n      [gameType]: true\n    }));\n    \n    uploadGameCardMutation.mutate({ formData, gameType });\n    \n    // Reset the file input\n    if (gameCardFileInputRefs[gameType as keyof typeof gameCardFileInputRefs]?.current) {\n      gameCardFileInputRefs[gameType as keyof typeof gameCardFileInputRefs].current!.value = '';\n    }\n  };\n  \n  // Handle game card image delete\n  const handleDeleteGameCardImage = (filename: string) => {\n    if (confirm('Are you sure you want to delete this game card image?')) {\n      deleteGameCardMutation.mutate(filename);\n    }\n  };\n\n  return (\n    <DashboardLayout title=\"Admin Settings\">\n      <Tabs \n        value={activeTab} \n        onValueChange={setActiveTab}\n        className=\"w-full\"\n      >\n        {/* Mobile view: scrollable tabs */}\n        <div className=\"md:hidden mb-6\">\n          <div className=\"overflow-x-auto scrollbar-thin scrollbar-thumb-primary/20 scrollbar-track-transparent\">\n            <TabsList className=\"inline-flex flex-nowrap min-w-max h-12 p-1 gap-1\">\n              <TabsTrigger value=\"payment\" className=\"flex-shrink-0 whitespace-nowrap px-3 py-2 text-sm\">\n                Payment\n              </TabsTrigger>\n              <TabsTrigger value=\"odds\" className=\"flex-shrink-0 whitespace-nowrap px-3 py-2 text-sm\">\n                Game Odds\n              </TabsTrigger>\n              <TabsTrigger value=\"commission\" className=\"flex-shrink-0 whitespace-nowrap px-3 py-2 text-sm\">\n                Commission\n              </TabsTrigger>\n              <TabsTrigger value=\"slider\" className=\"flex-shrink-0 whitespace-nowrap px-3 py-2 text-sm\">\n                Sliders\n              </TabsTrigger>\n              <TabsTrigger value=\"gamecards\" className=\"flex-shrink-0 whitespace-nowrap px-3 py-2 text-sm\">\n                Game Cards\n              </TabsTrigger>\n            </TabsList>\n          </div>\n          <div className=\"mt-2 text-xs text-muted-foreground text-center\">\n            Swipe to see more options \n          </div>\n        </div>\n\n        {/* Desktop view: grid tabs */}\n        <div className=\"hidden md:block\">\n          <TabsList className=\"grid w-full grid-cols-5\">\n            <TabsTrigger value=\"payment\">Payment Settings</TabsTrigger>\n            <TabsTrigger value=\"odds\">Platform Game Odds</TabsTrigger>\n            <TabsTrigger value=\"commission\">Subadmin Commission</TabsTrigger>\n            <TabsTrigger value=\"slider\">Sliders</TabsTrigger>\n            <TabsTrigger value=\"gamecards\">Game Cards</TabsTrigger>\n          </TabsList>\n        </div>\n        \n        {/* Payment Settings Tab */}\n        <TabsContent value=\"payment\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Payment Settings</CardTitle>\n              <CardDescription>\n                Configure payment methods that users will use to deposit funds.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {isLoadingPayment ? (\n                <div className=\"flex justify-center py-6\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : (\n                <>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <h3 className=\"text-lg font-medium\">UPI Payment</h3>\n                      <Separator className=\"my-2\" />\n                      <div className=\"space-y-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"upiId\">UPI IDs (One per line)</Label>\n                          <textarea \n                            id=\"upiId\" \n                            value={upiId} \n                            onChange={(e) => setUpiId(e.target.value)} \n                            placeholder=\"username@ybl&#10;company@paytm&#10;business@gpay\"\n                            className=\"w-full p-3 border rounded-md bg-background text-foreground min-h-[100px] resize-vertical\"\n                            rows={4}\n                          />\n                          <p className=\"text-sm text-muted-foreground\">\n                            Enter multiple UPI IDs, one per line. Users will see these options when making deposits.\n                          </p>\n                        </div>\n                        \n                        <div className=\"space-y-2\">\n                          <Label>UPI QR Code (Optional)</Label>\n                          <div className=\"flex items-center gap-4\">\n                            <Button\n                              onClick={() => qrFileInputRef.current?.click()}\n                              className=\"gap-2\"\n                              disabled={isUploadingQr}\n                              variant=\"outline\"\n                            >\n                              {isUploadingQr ? (\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                              ) : (\n                                <Upload className=\"h-4 w-4\" />\n                              )}\n                              Upload QR Code\n                            </Button>\n                            <input\n                              type=\"file\"\n                              ref={qrFileInputRef}\n                              className=\"hidden\"\n                              accept=\"image/*\"\n                              onChange={handleQrUpload}\n                            />\n                            {qrCodeUrl && (\n                              <div className=\"flex items-center gap-2\">\n                                <img \n                                  src={qrCodeUrl} \n                                  alt=\"UPI QR Code\" \n                                  className=\"w-16 h-16 border rounded object-cover\"\n                                />\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => setQrCodeUrl(\"\")}\n                                >\n                                  Remove\n                                </Button>\n                              </div>\n                            )}\n                          </div>\n                          <p className=\"text-sm text-muted-foreground\">\n                            Upload a QR code image that users can scan to make UPI payments quickly.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div>\n                      <h3 className=\"text-lg font-medium\">Bank Transfer</h3>\n                      <Separator className=\"my-2\" />\n                      <div className=\"grid gap-4 md:grid-cols-2\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"bankName\">Bank Name</Label>\n                          <Input \n                            id=\"bankName\" \n                            value={bankName} \n                            onChange={(e) => setBankName(e.target.value)} \n                            placeholder=\"Bank Name\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"accountName\">Account Holder Name</Label>\n                          <Input \n                            id=\"accountName\" \n                            value={accountName} \n                            onChange={(e) => setAccountName(e.target.value)} \n                            placeholder=\"Account Holder Name\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"accountNumber\">Account Number</Label>\n                          <Input \n                            id=\"accountNumber\" \n                            value={accountNumber} \n                            onChange={(e) => setAccountNumber(e.target.value)} \n                            placeholder=\"Account Number\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"ifscCode\">IFSC Code</Label>\n                          <Input \n                            id=\"ifscCode\" \n                            value={ifscCode} \n                            onChange={(e) => setIfscCode(e.target.value)} \n                            placeholder=\"IFSC Code\"\n                          />\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </>\n              )}\n            </CardContent>\n            <CardFooter>\n              <Button \n                onClick={handleSavePayment} \n                disabled={isLoadingPayment || saveMutation.isPending}\n              >\n                {saveMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Save Payment Settings\n              </Button>\n            </CardFooter>\n          </Card>\n        </TabsContent>\n        \n        {/* Platform Game Odds Tab */}\n        <TabsContent value=\"odds\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Platform Game Odds Settings</CardTitle>\n              <CardDescription>\n                Configure the default odds multipliers for the entire platform. These settings serve as the base odds for all games across the platform. To set individual odds for specific subadmins, visit the Subadmin Management page.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {isLoadingOdds ? (\n                <div className=\"flex justify-center py-6\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : (\n                <>\n                  <div className=\"space-y-4\">\n                    <div className=\"bg-blue-950/40 p-4 rounded-lg border border-blue-800 mb-6\">\n                      <div className=\"flex items-start gap-3\">\n                        <Info className=\"h-5 w-5 text-blue-400 mt-0.5\" />\n                        <div>\n                          <h3 className=\"text-sm font-medium text-blue-400\">Platform-Wide Default Odds</h3>\n                          <p className=\"text-sm text-slate-300 mt-1\">\n                            These odds settings serve as the default for the entire platform and will apply to all subadmins\n                            unless they have custom odds configured. To set custom odds for specific subadmins, \n                            please visit the Subadmin Management page.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                    <div>\n                      <h3 className=\"text-lg font-medium\">Royal Toss Game</h3>\n                      <Separator className=\"my-2\" />\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"coinFlipOdds\">Win Multiplier</Label>\n                        <div className=\"flex items-center gap-2\">\n                          <Input \n                            id=\"coinFlipOdds\" \n                            value={Number(coinFlipOdds)} \n                            onChange={(e) => setCoinFlipOdds(e.target.value)} \n                            placeholder=\"1.95\"\n                            type=\"number\"\n                            step=\"0.01\"\n                            className=\"max-w-[120px]\"\n                          />\n                          <span>times the bet amount</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div>\n                      <h3 className=\"text-lg font-medium\">Cricket Toss Game</h3>\n                      <Separator className=\"my-2\" />\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"cricketTossOdds\">Win Multiplier</Label>\n                        <div className=\"flex items-center gap-2\">\n                          <Input \n                            id=\"cricketTossOdds\" \n                            value={Number(cricketTossOdds)} \n                            onChange={(e) => setCricketTossOdds(e.target.value)} \n                            placeholder=\"1.90\"\n                            type=\"number\"\n                            step=\"0.01\"\n                            className=\"max-w-[120px]\"\n                          />\n                          <span>times the bet amount</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div>\n                      {/* Team Match Game section removed */}\n                    </div>\n\n                    <div>\n                      <h3 className=\"text-lg font-medium\">Satamatka</h3>\n                      <Separator className=\"my-2\" />\n                      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"satamatka-jodi\">Jodi (00-99)</Label>\n                          <div className=\"flex items-center gap-2\">\n                            <Input \n                              id=\"satamatka-jodi\" \n                              value={Number(satamatkaOdds.jodi)} \n                              onChange={(e) => setSatamatkaOdds({...satamatkaOdds, jodi: e.target.value})} \n                              placeholder=\"90\"\n                              type=\"number\"\n                              step=\"0.01\"\n                              className=\"max-w-[120px]\"\n                            />\n                            <span></span>\n                          </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"satamatka-harf\">Harf</Label>\n                          <div className=\"flex items-center gap-2\">\n                            <Input \n                              id=\"satamatka-harf\" \n                              value={Number(satamatkaOdds.harf)} \n                              onChange={(e) => setSatamatkaOdds({...satamatkaOdds, harf: e.target.value})} \n                              placeholder=\"9\"\n                              type=\"number\"\n                              step=\"0.01\"\n                              className=\"max-w-[120px]\"\n                            />\n                            <span></span>\n                          </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"satamatka-crossing\">Crossing</Label>\n                          <div className=\"flex items-center gap-2\">\n                            <Input \n                              id=\"satamatka-crossing\" \n                              value={Number(satamatkaOdds.crossing)} \n                              onChange={(e) => setSatamatkaOdds({...satamatkaOdds, crossing: e.target.value})} \n                              placeholder=\"95\"\n                              type=\"number\"\n                              step=\"0.01\"\n                              className=\"max-w-[120px]\"\n                            />\n                            <span></span>\n                          </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"satamatka-odd-even\">Odd-Even</Label>\n                          <div className=\"flex items-center gap-2\">\n                            <Input \n                              id=\"satamatka-odd-even\" \n                              value={Number(satamatkaOdds.odd_even)} \n                              onChange={(e) => setSatamatkaOdds({...satamatkaOdds, odd_even: e.target.value})} \n                              placeholder=\"1.9\"\n                              type=\"number\"\n                              step=\"0.01\"\n                              className=\"max-w-[120px]\"\n                            />\n                            <span></span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </>\n              )}\n            </CardContent>\n            <CardFooter>\n              <Button \n                onClick={handleSaveGameOdds} \n                disabled={isLoadingOdds || saveOddsMutation.isPending}\n              >\n                {saveOddsMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Save Platform Game Odds\n              </Button>\n            </CardFooter>\n          </Card>\n        </TabsContent>\n        \n        {/* Commission Tab */}\n        <TabsContent value=\"commission\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Platform Default Commission</CardTitle>\n              <CardDescription>\n                Set the default commission percentage that applies to all subadmins\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-6\">\n                <div className=\"bg-blue-950/40 p-4 rounded-lg border border-blue-800 mb-6\">\n                  <div className=\"flex items-start gap-3\">\n                    <Info className=\"h-5 w-5 text-blue-400 mt-0.5\" />\n                    <div>\n                      <h3 className=\"text-sm font-medium text-blue-400\">Platform-Wide Default Commission Rates</h3>\n                      <p className=\"text-sm text-slate-300 mt-1\">\n                        These commission settings serve as the default for the entire platform. To set individual commission rates \n                        for specific subadmins, please visit the Subadmin Management page.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"space-y-8\">\n                  {/* Platform Default Commission */}\n                  <div className=\"bg-slate-800/50 p-6 rounded-lg border border-slate-700\">\n                    <div className=\"space-y-4\">\n                      <div>\n                        <h3 className=\"text-lg font-medium\">Default Subadmin Commission</h3>\n                        <p className=\"text-sm text-slate-400 mt-1\">\n                          This is the default commission rate that applies to all subadmins on the platform.\n                          Individual rates can be set in the Subadmin Management section.\n                        </p>\n                        <Separator className=\"my-4\" />\n                      </div>\n                      \n                      <div className=\"space-y-4\">\n                        <div className=\"flex items-start\">\n                          <div className=\"flex-1 space-y-2\">\n                            <Label htmlFor=\"commission-deposit\" className=\"text-base\">\n                              Default Subadmin Commission Rate\n                            </Label>\n                            <div className=\"flex items-center gap-2\">\n                              <Input \n                                id=\"commission-deposit\" \n                                type=\"number\"\n                                step=\"0.01\"\n                                min=\"0\"\n                                max=\"100\"\n                                value={defaultCommissionRate} \n                                onChange={(e) => setDefaultCommissionRate(e.target.value)} \n                                placeholder=\"0.0\"\n                                className=\"max-w-[120px]\"\n                              />\n                              <span>% of transaction amount</span>\n                            </div>\n                            <p className=\"text-sm text-slate-400\">\n                              This rate applies to all admin-subadmin fund transfers where a specific commission rate \n                              has not been set for the subadmin. You can set any value from 0% to 100%.\n                            </p>\n                          </div>\n                          \n                          <div className=\"bg-slate-800/80 p-4 rounded-lg border border-slate-700 min-w-[280px]\">\n                            <h4 className=\"text-sm font-medium text-primary mb-3\">Deposit Example</h4>\n                            <div className=\"space-y-2 text-sm\">\n                              <div className=\"flex justify-between\">\n                                <span className=\"text-slate-400\">Subadmin will receive:</span>\n                                <span className=\"font-medium\">10,000</span>\n                              </div>\n                              <div className=\"flex justify-between\">\n                                <span className=\"text-slate-400\">Commission ({defaultCommissionRate}%):</span>\n                                <span>{(10000 * parseFloat(defaultCommissionRate || \"0\") / 100).toFixed(2)}</span>\n                              </div>\n                              <Separator className=\"my-1\" />\n                              <div className=\"flex justify-between font-medium text-orange-400\">\n                                <span>Admin pays total:</span>\n                                <span>{(10000 + 10000 * parseFloat(defaultCommissionRate || \"0\") / 100).toFixed(2)}</span>\n                              </div>\n                            </div>\n                            \n                            <Separator className=\"my-3\" />\n                            \n                            <h4 className=\"text-sm font-medium text-primary mb-3\">Withdrawal Example</h4>\n                            <div className=\"space-y-2 text-sm\">\n                              <div className=\"flex justify-between\">\n                                <span className=\"text-slate-400\">Subadmin withdraws:</span>\n                                <span className=\"font-medium\">5,000</span>\n                              </div>\n                              <div className=\"flex justify-between\">\n                                <span className=\"text-slate-400\">Commission ({defaultCommissionRate}%):</span>\n                                <span>{(5000 * parseFloat(defaultCommissionRate || \"0\") / 100).toFixed(2)}</span>\n                              </div>\n                              <Separator className=\"my-1\" />\n                              <div className=\"flex justify-between font-medium text-green-400\">\n                                <span>Admin receives total:</span>\n                                <span>{(5000 + 5000 * parseFloat(defaultCommissionRate || \"0\") / 100).toFixed(2)}</span>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"bg-blue-950/40 p-4 rounded-lg border border-blue-800\">\n                    <div className=\"flex items-start gap-3\">\n                      <Info className=\"h-5 w-5 text-blue-400 mt-0.5\" />\n                      <div>\n                        <h3 className=\"text-sm font-medium text-blue-400\">About Commission Settings</h3>\n                        <p className=\"text-sm text-slate-300 mt-1\">\n                          You can set any commission rate from 0% to 100%. This platform-wide setting will apply to all \n                          subadmins that don't have individual rates configured. For individual subadmin commission rates, \n                          please visit the Subadmin Management page.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n            <CardFooter>\n              <Button \n                onClick={() => {\n                  // Save platform-wide default commission rate for fund transfers\n                  saveCommissionMutation.mutate({\n                    defaultRates: {\n                      deposit: Math.round(parseFloat(defaultCommissionRate) * 100)\n                    }\n                  });\n                }}\n                disabled={saveCommissionMutation.isPending}\n              >\n                {saveCommissionMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Save Commission Rate\n              </Button>\n            </CardFooter>\n          </Card>\n        </TabsContent>\n        \n        {/* Slider Settings Tab */}\n        <TabsContent value=\"slider\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Platform Slider Management</CardTitle>\n              <CardDescription>\n                Manage slider images for both public home page and logged-in users\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {isLoadingSliderImages ? (\n                <div className=\"flex justify-center py-6\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : (\n                <div className=\"space-y-8\">\n                  {/* Public Home Page Hero Slider Section */}\n                  <div>\n                    <h3 className=\"text-xl font-semibold mb-2\">Public Home Page Hero Slider</h3>\n                    <p className=\"text-sm text-slate-400 mb-4\">\n                      Manage slider images that appear on the public home page visible to all visitors\n                    </p>\n                    \n                    <div className=\"bg-slate-800/50 p-4 rounded-lg border border-slate-700 mb-4\">\n                      <div className=\"flex items-start gap-3\">\n                        <Info className=\"h-5 w-5 text-blue-400 mt-0.5\" />\n                        <div>\n                          <h3 className=\"text-sm font-medium text-blue-400\">Home Page Hero Requirements</h3>\n                          <p className=\"text-sm text-slate-400 mt-1\">\n                            For best results, upload images with a 16:9 aspect ratio (e.g., 19201080 pixels).\n                            Images should be less than 2MB in size and in JPG, PNG, or WebP format.\n                            These images will be displayed prominently on the public home page.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex flex-col gap-4\">\n                      <div className=\"flex items-center gap-4\">\n                        <Button\n                          onClick={() => homeHeroFileInputRef.current?.click()}\n                          className=\"gap-2\"\n                          disabled={isUploadingHero}\n                        >\n                          {isUploadingHero ? (\n                            <Loader2 className=\"h-4 w-4 animate-spin\" />\n                          ) : (\n                            <Upload className=\"h-4 w-4\" />\n                          )}\n                          Upload Hero Image\n                        </Button>\n                        <input\n                          type=\"file\"\n                          ref={homeHeroFileInputRef}\n                          className=\"hidden\"\n                          accept=\"image/*\"\n                          onChange={handleHeroImageUpload}\n                        />\n                        \n                        <Button\n                          variant=\"outline\"\n                          onClick={() => refetchHeroImages()}\n                          size=\"icon\"\n                          title=\"Refresh hero slider images\"\n                        >\n                          <RefreshCw className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                      \n                      {heroImages.length === 0 ? (\n                        <div className=\"py-8 px-4 text-center bg-slate-800/30 border border-dashed border-slate-700 rounded-lg\">\n                          <p className=\"text-slate-400\">No hero slider images uploaded yet. Upload some images to display on the public home page.</p>\n                        </div>\n                      ) : (\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                          {heroImages.map((image) => (\n                            <div \n                              key={image.filename} \n                              className=\"relative group overflow-hidden rounded-lg border border-slate-700\"\n                            >\n                              <img \n                                src={image.url} \n                                alt={`Hero slider image ${image.filename}`}\n                                className=\"w-full h-48 object-cover\"\n                              />\n                              <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                                <Button\n                                  variant=\"destructive\"\n                                  size=\"sm\"\n                                  className=\"gap-1\"\n                                  onClick={() => handleDeleteHeroImage(image.filename)}\n                                >\n                                  <Trash2 className=\"h-4 w-4\" />\n                                  Delete\n                                </Button>\n                              </div>\n                              <div className=\"absolute bottom-0 left-0 right-0 bg-black/70 text-xs p-2 truncate\">\n                                {image.filename}\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                  \n                  <Separator />\n                  \n                  {/* Dashboard Promo Slider Section */}\n                  <div>\n                    <h3 className=\"text-xl font-semibold mb-2\">Dashboard Promo Slider</h3>\n                    <p className=\"text-sm text-slate-400 mb-4\">\n                      Manage promotional slider images shown to logged-in users on their dashboard\n                    </p>\n                    \n                    <div className=\"bg-slate-800/50 p-4 rounded-lg border border-slate-700 mb-4\">\n                      <div className=\"flex items-start gap-3\">\n                        <Info className=\"h-5 w-5 text-blue-400 mt-0.5\" />\n                        <div>\n                          <h3 className=\"text-sm font-medium text-blue-400\">Promo Slider Requirements</h3>\n                          <p className=\"text-sm text-slate-400 mt-1\">\n                            For best results, upload images with a 4:1 aspect ratio (e.g., 1200300 pixels).\n                            Images should be less than 2MB in size and in JPG, PNG, or WebP format.\n                            Images will be displayed at a height of 180px on all devices, with responsive width.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  \n                    <div className=\"flex flex-col gap-4\">\n                      <div className=\"flex items-center gap-4\">\n                        <Button\n                          onClick={() => fileInputRef.current?.click()}\n                          className=\"gap-2\"\n                          disabled={isUploading}\n                        >\n                          {isUploading ? (\n                            <Loader2 className=\"h-4 w-4 animate-spin\" />\n                          ) : (\n                            <Upload className=\"h-4 w-4\" />\n                          )}\n                          Upload Promo Image\n                        </Button>\n                        <input\n                          type=\"file\"\n                          ref={fileInputRef}\n                          className=\"hidden\"\n                          accept=\"image/*\"\n                          onChange={handleSliderImageUpload}\n                        />\n                        \n                        <Button\n                          variant=\"outline\"\n                          onClick={() => refetchSliderImages()}\n                          size=\"icon\"\n                          title=\"Refresh slider images\"\n                        >\n                          <RefreshCw className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                      \n                      {sliderImages.length === 0 ? (\n                        <div className=\"py-8 px-4 text-center bg-slate-800/30 border border-dashed border-slate-700 rounded-lg\">\n                          <p className=\"text-slate-400\">No promo slider images uploaded yet. Upload some images to display in the dashboard promotional slider.</p>\n                        </div>\n                      ) : (\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                          {sliderImages.map((image) => (\n                            <div \n                              key={image.filename} \n                              className=\"relative group overflow-hidden rounded-lg border border-slate-700\"\n                            >\n                              <img \n                                src={image.url} \n                                alt={`Slider image ${image.filename}`}\n                                className=\"w-full h-40 object-cover\"\n                              />\n                              <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                                <Button\n                                  variant=\"destructive\"\n                                  size=\"sm\"\n                                  className=\"gap-1\"\n                                  onClick={() => handleDeleteSliderImage(image.filename)}\n                                >\n                                  <Trash2 className=\"h-4 w-4\" />\n                                  Delete\n                                </Button>\n                              </div>\n                              <div className=\"absolute bottom-0 left-0 right-0 bg-black/70 text-xs p-2 truncate\">\n                                {image.filename}\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n            <CardFooter className=\"flex justify-between border-t border-slate-800 pt-4\">\n              <div className=\"text-sm text-slate-400\">\n                Total Images: {sliderImages.length}\n              </div>\n              <div className=\"text-sm text-slate-400\">\n                Last Updated: {sliderImages.length > 0 ? new Date().toLocaleDateString() : 'Never'}\n              </div>\n            </CardFooter>\n          </Card>\n        </TabsContent>\n        \n        {/* Game Cards Tab */}\n        <TabsContent value=\"gamecards\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Game Card Images</CardTitle>\n              <CardDescription>\n                Manage the game card images shown for each game type on the platform\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {isLoadingGameCardImages ? (\n                <div className=\"flex justify-center py-6\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : (\n                <>\n                  <div className=\"space-y-4\">\n                    <div className=\"bg-slate-800/50 p-4 rounded-lg border border-slate-700\">\n                      <div className=\"flex items-start gap-3\">\n                        <Info className=\"h-5 w-5 text-blue-400 mt-0.5\" />\n                        <div>\n                          <h3 className=\"text-sm font-medium text-blue-400\">Image Requirements</h3>\n                          <p className=\"text-sm text-slate-400 mt-1\">\n                            For best results, upload images with a landscape aspect ratio (e.g., 800450 pixels).\n                            Images should be less than 2MB in size and in JPG, PNG, or WebP format.\n                            Images will be displayed as background on game cards, so they should have good contrast with text overlay.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center justify-end gap-4\">\n                      <Button\n                        variant=\"outline\"\n                        onClick={() => refetchGameCardImages()}\n                        size=\"icon\"\n                        title=\"Refresh game card images\"\n                      >\n                        <RefreshCw className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n\n                    <div className=\"space-y-8\">\n                      {/* Market Game Card Image Section */}\n                      <div className=\"p-4 bg-slate-800/50 rounded-lg border border-slate-700\">\n                        <h3 className=\"text-lg font-medium mb-4\">Market Game Card Image</h3>\n                        \n                        <div className=\"flex flex-col gap-6\">\n                          <div className=\"flex items-center gap-4\">\n                            <Button\n                              onClick={() => gameCardFileInputRefs.market.current?.click()}\n                              className=\"gap-2\"\n                              disabled={isUploadingGameCard.market}\n                            >\n                              {isUploadingGameCard.market ? (\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                              ) : (\n                                <Upload className=\"h-4 w-4\" />\n                              )}\n                              Upload Market Game Image\n                            </Button>\n                            <input\n                              type=\"file\"\n                              ref={gameCardFileInputRefs.market}\n                              className=\"hidden\"\n                              accept=\"image/*\"\n                              onChange={(e) => handleGameCardImageUpload(e, 'market')}\n                            />\n                          </div>\n                          \n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            {gameCardImages\n                              .filter(img => img.gameType === 'market')\n                              .map((image) => (\n                                <div \n                                  key={image.filename} \n                                  className={`relative group overflow-hidden rounded-md border ${isSelectedImage(image.filename, 'market') ? 'border-green-500 ring-2 ring-green-500' : 'border-slate-700'}`}\n                                >\n                                  <img \n                                    src={image.url} \n                                    alt=\"Market Game Card\" \n                                    className=\"object-cover w-full h-[160px]\"\n                                  />\n                                  \n                                  <div className=\"absolute inset-0 bg-black/40 flex flex-col justify-between p-3\">\n                                    <div className=\"flex justify-between\">\n                                      {isSelectedImage(image.filename, 'market') && (\n                                        <div className=\"bg-green-500 text-white text-xs px-2 py-1 rounded-full\">\n                                          Selected\n                                        </div>\n                                      )}\n                                      \n                                      <div className=\"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity ml-auto\">\n                                        <Button\n                                          variant=\"destructive\"\n                                          size=\"icon\"\n                                          className=\"h-8 w-8 rounded-full\"\n                                          onClick={() => handleDeleteGameCardImage(image.filename)}\n                                        >\n                                          <Trash2 className=\"h-4 w-4\" />\n                                        </Button>\n                                      </div>\n                                    </div>\n                                    \n                                    <div className=\"flex items-center justify-between\">\n                                      <div className=\"text-white text-sm font-medium\">\n                                        Market Game\n                                      </div>\n                                      \n                                      <Button\n                                        size=\"sm\"\n                                        variant={isSelectedImage(image.filename, 'market') ? \"secondary\" : \"outline\"}\n                                        className={`${isSelectedImage(image.filename, 'market') ? 'bg-green-600 hover:bg-green-700' : 'bg-slate-800/60 hover:bg-slate-700'}`}\n                                        onClick={() => handleSelectGameImage(image.filename, 'market')}\n                                      >\n                                        {isSelectedImage(image.filename, 'market') ? 'Selected' : 'Select'}\n                                      </Button>\n                                    </div>\n                                  </div>\n                                </div>\n                            ))}\n                            \n                            {gameCardImages.filter(img => img.gameType === 'market').length === 0 && (\n                              <div className=\"py-6 px-4 text-center bg-slate-800/30 border border-dashed border-slate-700 rounded-lg\">\n                                <p className=\"text-slate-400\">No Market Game card image uploaded yet. Upload an image to use as background for the Market Game card.</p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                      \n                      {/* Sports Exchange Card Image Section */}\n                      <div className=\"p-4 bg-slate-800/50 rounded-lg border border-slate-700\">\n                        <h3 className=\"text-lg font-medium mb-4\">Sports Exchange Card Image</h3>\n                        \n                        <div className=\"flex flex-col gap-6\">\n                          <div className=\"flex items-center gap-4\">\n                            <Button\n                              onClick={() => gameCardFileInputRefs.sports.current?.click()}\n                              className=\"gap-2\"\n                              disabled={isUploadingGameCard.sports}\n                            >\n                              {isUploadingGameCard.sports ? (\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                              ) : (\n                                <Upload className=\"h-4 w-4\" />\n                              )}\n                              Upload Sports Exchange Image\n                            </Button>\n                            <input\n                              type=\"file\"\n                              ref={gameCardFileInputRefs.sports}\n                              className=\"hidden\"\n                              accept=\"image/*\"\n                              onChange={(e) => handleGameCardImageUpload(e, 'sports')}\n                            />\n                          </div>\n                          \n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            {gameCardImages\n                              .filter(img => img.gameType === 'sports')\n                              .map((image) => (\n                                <div \n                                  key={image.filename} \n                                  className={`relative group overflow-hidden rounded-md border ${isSelectedImage(image.filename, 'sports') ? 'border-green-500 ring-2 ring-green-500' : 'border-slate-700'}`}\n                                >\n                                  <img \n                                    src={image.url} \n                                    alt=\"Sports Exchange Card\" \n                                    className=\"object-cover w-full h-[160px]\"\n                                  />\n                                  \n                                  <div className=\"absolute inset-0 bg-black/40 flex flex-col justify-between p-3\">\n                                    <div className=\"flex justify-between\">\n                                      {isSelectedImage(image.filename, 'sports') && (\n                                        <div className=\"bg-green-500 text-white text-xs px-2 py-1 rounded-full\">\n                                          Selected\n                                        </div>\n                                      )}\n                                      \n                                      <div className=\"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity ml-auto\">\n                                        <Button\n                                          variant=\"destructive\"\n                                          size=\"icon\"\n                                          className=\"h-8 w-8 rounded-full\"\n                                          onClick={() => handleDeleteGameCardImage(image.filename)}\n                                        >\n                                          <Trash2 className=\"h-4 w-4\" />\n                                        </Button>\n                                      </div>\n                                    </div>\n                                    \n                                    <div className=\"flex items-center justify-between\">\n                                      <div className=\"text-white text-sm font-medium\">\n                                        Sports Exchange\n                                      </div>\n                                      \n                                      <Button\n                                        size=\"sm\"\n                                        variant={isSelectedImage(image.filename, 'sports') ? \"secondary\" : \"outline\"}\n                                        className={`${isSelectedImage(image.filename, 'sports') ? 'bg-green-600 hover:bg-green-700' : 'bg-slate-800/60 hover:bg-slate-700'}`}\n                                        onClick={() => handleSelectGameImage(image.filename, 'sports')}\n                                      >\n                                        {isSelectedImage(image.filename, 'sports') ? 'Selected' : 'Select'}\n                                      </Button>\n                                    </div>\n                                  </div>\n                                </div>\n                            ))}\n                            \n                            {gameCardImages.filter(img => img.gameType === 'sports').length === 0 && (\n                              <div className=\"py-6 px-4 text-center bg-slate-800/30 border border-dashed border-slate-700 rounded-lg\">\n                                <p className=\"text-slate-400\">No Sports Exchange card image uploaded yet. Upload an image to use as background for the Sports Exchange card.</p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                      \n                      {/* Cricket Toss Card Image Section */}\n                      <div className=\"p-4 bg-slate-800/50 rounded-lg border border-slate-700\">\n                        <h3 className=\"text-lg font-medium mb-4\">Cricket Toss Card Image</h3>\n                        \n                        <div className=\"flex flex-col gap-6\">\n                          <div className=\"flex items-center gap-4\">\n                            <Button\n                              onClick={() => gameCardFileInputRefs.cricket.current?.click()}\n                              className=\"gap-2\"\n                              disabled={isUploadingGameCard.cricket}\n                            >\n                              {isUploadingGameCard.cricket ? (\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                              ) : (\n                                <Upload className=\"h-4 w-4\" />\n                              )}\n                              Upload Cricket Toss Image\n                            </Button>\n                            <input\n                              type=\"file\"\n                              ref={gameCardFileInputRefs.cricket}\n                              className=\"hidden\"\n                              accept=\"image/*\"\n                              onChange={(e) => handleGameCardImageUpload(e, 'cricket')}\n                            />\n                          </div>\n                          \n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            {gameCardImages\n                              .filter(img => img.gameType === 'cricket')\n                              .map((image) => (\n                                <div \n                                  key={image.filename} \n                                  className={`relative group overflow-hidden rounded-md border ${isSelectedImage(image.filename, 'cricket') ? 'border-green-500 ring-2 ring-green-500' : 'border-slate-700'}`}\n                                >\n                                  <img \n                                    src={image.url} \n                                    alt=\"Cricket Toss Card\" \n                                    className=\"object-cover w-full h-[160px]\"\n                                  />\n                                  \n                                  <div className=\"absolute inset-0 bg-black/40 flex flex-col justify-between p-3\">\n                                    <div className=\"flex justify-between\">\n                                      {isSelectedImage(image.filename, 'cricket') && (\n                                        <div className=\"bg-green-500 text-white text-xs px-2 py-1 rounded-full\">\n                                          Selected\n                                        </div>\n                                      )}\n                                      \n                                      <div className=\"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity ml-auto\">\n                                        <Button\n                                          variant=\"destructive\"\n                                          size=\"icon\"\n                                          className=\"h-8 w-8 rounded-full\"\n                                          onClick={() => handleDeleteGameCardImage(image.filename)}\n                                        >\n                                          <Trash2 className=\"h-4 w-4\" />\n                                        </Button>\n                                      </div>\n                                    </div>\n                                    \n                                    <div className=\"flex items-center justify-between\">\n                                      <div className=\"text-white text-sm font-medium\">\n                                        Cricket Toss\n                                      </div>\n                                      \n                                      <Button\n                                        size=\"sm\"\n                                        variant={isSelectedImage(image.filename, 'cricket') ? \"secondary\" : \"outline\"}\n                                        className={`${isSelectedImage(image.filename, 'cricket') ? 'bg-green-600 hover:bg-green-700' : 'bg-slate-800/60 hover:bg-slate-700'}`}\n                                        onClick={() => handleSelectGameImage(image.filename, 'cricket')}\n                                      >\n                                        {isSelectedImage(image.filename, 'cricket') ? 'Selected' : 'Select'}\n                                      </Button>\n                                    </div>\n                                  </div>\n                                </div>\n                            ))}\n                            \n                            {gameCardImages.filter(img => img.gameType === 'cricket').length === 0 && (\n                              <div className=\"py-6 px-4 text-center bg-slate-800/30 border border-dashed border-slate-700 rounded-lg\">\n                                <p className=\"text-slate-400\">No Cricket Toss card image uploaded yet. Upload an image to use as background for the Cricket Toss card.</p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                      \n                      {/* Coin Flip Card Image Section */}\n                      <div className=\"p-4 bg-slate-800/50 rounded-lg border border-slate-700\">\n                        <h3 className=\"text-lg font-medium mb-4\">Coin Flip Card Image</h3>\n                        \n                        <div className=\"flex flex-col gap-6\">\n                          <div className=\"flex items-center gap-4\">\n                            <Button\n                              onClick={() => gameCardFileInputRefs.coinflip.current?.click()}\n                              className=\"gap-2\"\n                              disabled={isUploadingGameCard.coinflip}\n                            >\n                              {isUploadingGameCard.coinflip ? (\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                              ) : (\n                                <Upload className=\"h-4 w-4\" />\n                              )}\n                              Upload Coin Flip Image\n                            </Button>\n                            <input\n                              type=\"file\"\n                              ref={gameCardFileInputRefs.coinflip}\n                              className=\"hidden\"\n                              accept=\"image/*\"\n                              onChange={(e) => handleGameCardImageUpload(e, 'coinflip')}\n                            />\n                          </div>\n                          \n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            {gameCardImages\n                              .filter(img => img.gameType === 'coinflip')\n                              .map((image) => (\n                                <div \n                                  key={image.filename} \n                                  className={`relative group overflow-hidden rounded-md border ${isSelectedImage(image.filename, 'coinflip') ? 'border-green-500 ring-2 ring-green-500' : 'border-slate-700'}`}\n                                >\n                                  <img \n                                    src={image.url} \n                                    alt=\"Coin Flip Card\" \n                                    className=\"object-cover w-full h-[160px]\"\n                                  />\n                                  \n                                  <div className=\"absolute inset-0 bg-black/40 flex flex-col justify-between p-3\">\n                                    <div className=\"flex justify-between\">\n                                      {isSelectedImage(image.filename, 'coinflip') && (\n                                        <div className=\"bg-green-500 text-white text-xs px-2 py-1 rounded-full\">\n                                          Selected\n                                        </div>\n                                      )}\n                                      \n                                      <div className=\"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity ml-auto\">\n                                        <Button\n                                          variant=\"destructive\"\n                                          size=\"icon\"\n                                          className=\"h-8 w-8 rounded-full\"\n                                          onClick={() => handleDeleteGameCardImage(image.filename)}\n                                        >\n                                          <Trash2 className=\"h-4 w-4\" />\n                                        </Button>\n                                      </div>\n                                    </div>\n                                    \n                                    <div className=\"flex items-center justify-between\">\n                                      <div className=\"text-white text-sm font-medium\">\n                                        Coin Flip\n                                      </div>\n                                      \n                                      <Button\n                                        size=\"sm\"\n                                        variant={isSelectedImage(image.filename, 'coinflip') ? \"secondary\" : \"outline\"}\n                                        className={`${isSelectedImage(image.filename, 'coinflip') ? 'bg-green-600 hover:bg-green-700' : 'bg-slate-800/60 hover:bg-slate-700'}`}\n                                        onClick={() => handleSelectGameImage(image.filename, 'coinflip')}\n                                      >\n                                        {isSelectedImage(image.filename, 'coinflip') ? 'Selected' : 'Select'}\n                                      </Button>\n                                    </div>\n                                  </div>\n                                </div>\n                            ))}\n                            \n                            {gameCardImages.filter(img => img.gameType === 'coinflip').length === 0 && (\n                              <div className=\"py-6 px-4 text-center bg-slate-800/30 border border-dashed border-slate-700 rounded-lg\">\n                                <p className=\"text-slate-400\">No Coin Flip card image uploaded yet. Upload an image to use as background for the Coin Flip card.</p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":86353,"size_tokens":null},"fix-all-pending-bets.js":{"content":"/**\n * This script fixes all pending bets in the system by reprocessing them\n * with the correct win/loss calculation logic for all game modes.\n */\n\nimport pg from 'pg';\nconst { Client } = pg;\n\nasync function fixAllPendingBets() {\n  const client = new Client({\n    connectionString: process.env.DATABASE_URL\n  });\n\n  try {\n    await client.connect();\n    console.log('Connected to database');\n\n    // Get all markets that have results declared but still have pending bets\n    const marketsResult = await client.query(`\n      SELECT DISTINCT m.id, m.name, m.close_result, m.open_result \n      FROM satamatka_markets m\n      INNER JOIN games g ON m.id = g.market_id\n      WHERE m.close_result IS NOT NULL \n      AND g.result = 'pending'\n      AND g.game_type = 'satamatka'\n    `);\n\n    const markets = marketsResult.rows;\n    console.log(`Found ${markets.length} markets with pending bets to process`);\n\n    if (markets.length === 0) {\n      console.log('No pending bets found to process.');\n      await client.end();\n      return;\n    }\n\n    // Get game odds from database\n    const gameOddsResult = await client.query(\n      'SELECT * FROM game_odds WHERE set_by_admin = true'\n    );\n\n    // Create a map for easy access to odds\n    const oddsMap = {\n      'satamatka_jodi': 900000,     // Default 90x\n      'satamatka_harf': 90000,      // Default 9x \n      'satamatka_crossing': 900000, // Default 90x\n      'satamatka_odd_even': 19000   // Default 1.9x\n    };\n\n    // Update odds map with values from the database\n    for (const odds of gameOddsResult.rows) {\n      if (odds.game_type && odds.odd_value) {\n        oddsMap[odds.game_type] = odds.odd_value;\n      }\n    }\n\n    console.log('Using odds values:', oddsMap);\n\n    let totalProcessed = 0;\n    let totalWinners = 0;\n\n    // Process each market\n    for (const market of markets) {\n      console.log(`\\nProcessing market: ${market.name} (ID: ${market.id})`);\n      console.log(`Market result: ${market.close_result}`);\n\n      // Get all pending games for this market\n      const gamesResult = await client.query(`\n        SELECT * FROM games \n        WHERE market_id = $1 AND result = 'pending' AND game_type = 'satamatka'\n      `, [market.id]);\n\n      const pendingGames = gamesResult.rows;\n      console.log(`Found ${pendingGames.length} pending bets for this market`);\n\n      for (const game of pendingGames) {\n        console.log(`\\nProcessing game ID ${game.id}:`);\n        console.log(`  Mode: ${game.game_mode}`);\n        console.log(`  Prediction: ${game.prediction}`);\n        console.log(`  Bet Amount: ${game.bet_amount / 100} rupees`);\n\n        let isWinner = false;\n        let payout = 0;\n        const closeResult = market.close_result;\n\n        // Game mode specific win conditions\n        if (game.game_mode === 'jodi') {\n          // Jodi: exact match with close result\n          isWinner = (game.prediction === closeResult);\n          if (isWinner) {\n            payout = game.bet_amount * (oddsMap['satamatka_jodi'] / 10000);\n          }\n        }\n        else if (game.game_mode === 'harf') {\n          // Harf: digit matches position\n          const firstDigit = closeResult[0]; \n          const secondDigit = closeResult[1];\n          \n          let harfDigit = game.prediction;\n          let isLeftDigit = false;\n          let isRightDigit = false;\n          \n          // Handle formatted predictions like A0, A1, B0, B1\n          if (game.prediction.startsWith('A')) {\n            harfDigit = game.prediction.substring(1);\n            isLeftDigit = true;\n          } else if (game.prediction.startsWith('B')) {\n            harfDigit = game.prediction.substring(1);\n            isRightDigit = true;\n          } else if (game.prediction.startsWith('L')) {\n            harfDigit = game.prediction.substring(1);\n            isLeftDigit = true;\n          } else if (game.prediction.startsWith('R')) {\n            harfDigit = game.prediction.substring(1);\n            isRightDigit = true;\n          }\n          \n          // Check if the prediction matches the appropriate position\n          if (\n            (isLeftDigit && harfDigit === firstDigit) || \n            (isRightDigit && harfDigit === secondDigit) ||\n            // For single digit predictions without position indicator\n            (!isLeftDigit && !isRightDigit && (game.prediction === firstDigit || game.prediction === secondDigit))\n          ) {\n            isWinner = true;\n            payout = game.bet_amount * (oddsMap['satamatka_harf'] / 10000);\n          }\n        }\n        else if (game.game_mode === 'crossing') {\n          // For Crossing, check combinations\n          let digits = [];\n          if (game.prediction.includes(',')) {\n            // Format: \"0,1,2\"\n            digits = game.prediction.replace(/[^0-9,]/g, '').split(',').map(d => d.trim());\n          } else {\n            // Format: \"012\" or other formats without commas\n            digits = game.prediction.replace(/[^0-9]/g, '').split('');\n          }\n          \n          // Generate all crossing combinations\n          const crossingCombinations = [];\n          for (let i = 0; i < digits.length; i++) {\n            for (let j = 0; j < digits.length; j++) {\n              if (i !== j) {\n                crossingCombinations.push(digits[i] + digits[j]);\n              }\n            }\n          }\n          \n          // Check if the prediction exactly matches the result\n          if (game.prediction === closeResult) {\n            isWinner = true;\n          } \n          // Check if the prediction is a comma-separated list and result is in combinations\n          else if (game.prediction.includes(',') && crossingCombinations.includes(closeResult)) {\n            isWinner = true;\n          }\n          \n          if (isWinner) {\n            payout = game.bet_amount * (oddsMap['satamatka_crossing'] / 10000);\n          }\n          \n          console.log(`  Crossing analysis:`);\n          console.log(`    Digits: ${JSON.stringify(digits)}`);\n          console.log(`    Combinations: ${JSON.stringify(crossingCombinations)}`);\n          console.log(`    Result matches: ${isWinner}`);\n        }\n        else if (game.game_mode === 'odd_even') {\n          // For Odd-Even, check if prediction matches the result's parity\n          const resultNumber = parseInt(closeResult, 10);\n          const isResultOdd = resultNumber % 2 !== 0;\n          \n          if ((game.prediction === \"odd\" && isResultOdd) || \n              (game.prediction === \"even\" && !isResultOdd)) {\n            isWinner = true;\n            payout = game.bet_amount * (oddsMap['satamatka_odd_even'] / 10000);\n          }\n        }\n\n        const result = isWinner ? \"win\" : \"loss\";\n        console.log(`  Result: ${result}`);\n        \n        if (isWinner) {\n          console.log(`  Payout: ${payout / 100} rupees`);\n          totalWinners++;\n        }\n\n        // Update game result in database\n        await client.query(\n          'UPDATE games SET result = $1, payout = $2 WHERE id = $3',\n          [result, payout, game.id]\n        );\n\n        // Update user balance if they won\n        if (isWinner) {\n          await client.query(\n            'UPDATE users SET balance = balance + $1 WHERE id = $2',\n            [payout, game.user_id]\n          );\n          \n          // Update the balanceAfter field for the game\n          const userBalanceResult = await client.query(\n            'SELECT balance FROM users WHERE id = $1',\n            [game.user_id]\n          );\n          \n          if (userBalanceResult.rows.length > 0) {\n            const newBalance = userBalanceResult.rows[0].balance;\n            await client.query(\n              'UPDATE games SET balance_after = $1 WHERE id = $2',\n              [newBalance, game.id]\n            );\n          }\n        }\n\n        totalProcessed++;\n      }\n    }\n\n    console.log(`\\n Processing complete!`);\n    console.log(`Total bets processed: ${totalProcessed}`);\n    console.log(`Total winners: ${totalWinners}`);\n    console.log(`Total losers: ${totalProcessed - totalWinners}`);\n\n  } catch (error) {\n    console.error('Error processing pending bets:', error);\n  } finally {\n    await client.end();\n  }\n}\n\nfixAllPendingBets();","path":null,"size_bytes":8180,"size_tokens":null},"fix-crossing-bets.js":{"content":"/**\n * This script fixes the crossing bets for a specific Satamatka market\n * It reprocesses the results for crossing bets that should be wins\n */\n\n// Using CommonJS require style since this is a script\nconst { db } = require('./server/db');\nconst { eq, and } = require('drizzle-orm');\nconst { games, SatamatkaGameMode } = require('./shared/schema');\nconst { storage } = require('./server/storage');\n\nasync function fixCrossingBets() {\n  try {\n    console.log('Starting to fix crossing bets...');\n    \n    // Market ID to fix (change this to the specific market ID you want to fix)\n    const marketId = 4;\n    \n    // Get market details\n    const market = await storage.getSatamatkaMarket(marketId);\n    if (!market) {\n      console.error(`Market with ID ${marketId} not found`);\n      return;\n    }\n    \n    console.log(`Processing market: ${market.name} (ID: ${marketId})`);\n    console.log(`Result: ${market.closeResult}`);\n    \n    if (!market.closeResult) {\n      console.error('Market does not have a close result set');\n      return;\n    }\n    \n    // Get all crossing games for this market\n    const crossingGames = await db.select()\n      .from(games)\n      .where(\n        and(\n          eq(games.marketId, marketId),\n          eq(games.gameMode, SatamatkaGameMode.CROSSING)\n        )\n      );\n    \n    console.log(`Found ${crossingGames.length} crossing games to check`);\n    \n    // Process each game to check if it should be a win\n    for (const game of crossingGames) {\n      // For Crossing, check if the prediction matches the result in any order\n      const digits = game.prediction.replace(/[^0-9,]/g, '').split(',');\n      \n      // Extract all possible crossing combinations from the digits\n      const crossingCombinations = [];\n      for (let i = 0; i < digits.length; i++) {\n        for (let j = 0; j < digits.length; j++) {\n          if (i !== j) {\n            crossingCombinations.push(digits[i] + digits[j]);\n          }\n        }\n      }\n      \n      // Check both normal and reverse ordering of the result\n      const resultToCheck = market.closeResult;\n      const reverseResult = resultToCheck.length === 2 ? resultToCheck[1] + resultToCheck[0] : resultToCheck;\n      \n      // Determine if this should be a win\n      const shouldBeWin = crossingCombinations.includes(resultToCheck) || crossingCombinations.includes(reverseResult);\n      \n      console.log(`Game ID: ${game.id}, Prediction: ${game.prediction}, Combinations: ${JSON.stringify(crossingCombinations)}`);\n      console.log(`  Result: ${resultToCheck} (or ${reverseResult}), Should be win: ${shouldBeWin}, Current result: ${game.result}`);\n      \n      // If the game should be a win but is marked as loss, update it\n      if (shouldBeWin && game.result === 'loss') {\n        console.log(`  FIXING: Game ID ${game.id} should be a win`);\n        \n        // Get appropriate odds \n        let gameTypeOdds = await db.select()\n          .from('game_odds')\n          .where(\n            and(\n              eq('game_odds.gameType', 'satamatka_crossing'),\n              eq('game_odds.setByAdmin', true)\n            )\n          );\n        \n        let oddValue = gameTypeOdds.length > 0 ? gameTypeOdds[0].oddValue : 950000; // Default to 95x if not found\n        \n        // Calculate payout (betAmount is stored in paisa)\n        const payout = Math.round(game.betAmount * (oddValue / 10000));\n        \n        // Update the game result to win and set payout\n        const [updatedGame] = await db.update(games)\n          .set({ result: 'win', payout })\n          .where(eq(games.id, game.id))\n          .returning();\n        \n        // Now update the user's balance to add the payout amount\n        const user = await storage.getUser(game.userId);\n        if (user) {\n          const newBalance = user.balance + payout;\n          await storage.updateUserBalance(user.id, newBalance);\n          console.log(`  Updated user ${user.username} balance: ${user.balance/100}  ${newBalance/100} (+${payout/100})`);\n        }\n        \n        console.log(`   Fixed game ID ${game.id}: Changed to win, Payout: ${payout/100}`);\n      }\n    }\n    \n    console.log('Completed fixing crossing bets!');\n  } catch (error) {\n    console.error('Error fixing crossing bets:', error);\n  }\n}\n\nfixCrossingBets().catch(err => console.error('Error:', err));","path":null,"size_bytes":4327,"size_tokens":null},"client/src/components/satamatka-game.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { formatCurrency } from \"@/lib/format-utils\";\nimport { ChevronRight, ChevronLeft, RefreshCw, AlertCircle, Hash, Type, ArrowLeftRight, Divide, Clock, CheckCircle, AlignHorizontalJustifyStart, Grid2X2 } from \"lucide-react\";\nimport { queryClient, apiRequest, getQueryFn } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\n\n// Define SatamatkaMarket interface\ninterface SatamatkaMarket {\n  id: number;\n  name: string;\n  type: string;\n  openTime: string;\n  closeTime: string;\n  openResult?: string;\n  closeResult?: string;\n  status: string;\n  createdAt: string;\n}\n\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCaption,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { format } from \"date-fns\";\n\n// Game modes in the Satamatka game\nconst GAME_MODES = {\n  jodi: \"Jodi (Full Number)\",\n  harf: \"Harf\",\n  crossing: \"Crossing Digit\",\n  odd_even: \"Odd-Even\",\n};\n\n// Define the form schema\nconst formSchema = z.object({\n  gameMode: z.enum([\"jodi\", \"harf\", \"crossing\", \"odd_even\"], {\n    required_error: \"Please select a game mode\",\n  }),\n  prediction: z.string().min(1, \"Prediction is required\"),\n  betAmount: z.coerce\n    .number()\n    .min(10, \"Minimum bet amount is 10\")\n    .max(10000, \"Maximum bet amount is 10,000\"),\n});\n\n// Game data interface for Satamatka game\ninterface SatamatkaGameData {\n  gameMode: string;\n  marketId: number;\n  marketName?: string;\n}\n\n// Game interface for recent bets\ninterface Game {\n  id: number;\n  userId: number;\n  gameType: string;\n  prediction: string;\n  betAmount: number;\n  result: string | null;\n  status: string;\n  payout: number | null;\n  marketId?: number;\n  marketName?: string;\n  createdAt: string;\n  gameData?: SatamatkaGameData | any; // Using any as fallback since different game types have different data structures\n}\n\nexport default function SatamatkaGame() {\n  const { id } = useParams<{ id: string }>();\n  const marketId = parseInt(id);\n  const [_, setLocation] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [selectedNumber, setSelectedNumber] = useState<string>(\"\");\n  const [selectedGameMode, setSelectedGameMode] = useState<string>(\"jodi\");\n  const [confirmDialogOpen, setConfirmDialogOpen] = useState(false);\n  const [betDetails, setBetDetails] = useState<{prediction: string; betAmount: number} | null>(null);\n  const [gameOdds, setGameOdds] = useState<Record<string, number>>({});\n  \n  // New state for multi-selection and quick bet amounts\n  const [quickBetAmount, setQuickBetAmount] = useState<number>(10);\n  const [selectedNumbers, setSelectedNumbers] = useState<Map<string, number>>(new Map());\n  const [showBetSlip, setShowBetSlip] = useState<boolean>(false);\n\n  // Form setup\n  const form = useForm<z.infer<typeof formSchema>>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      gameMode: \"jodi\",\n      prediction: \"\",\n      betAmount: 100,\n    },\n  });\n\n  // Update prediction when number or game mode selection changes\n  useEffect(() => {\n    if (selectedNumber) {\n      form.setValue(\"prediction\", selectedNumber);\n    }\n  }, [selectedNumber, form]);\n\n  // Query the market details\n  const { data: market, isLoading, error: marketError } = useQuery({\n    queryKey: [\"/api/satamatka/markets\", marketId],\n    queryFn: async ({ queryKey }) => {\n      try {\n        const res = await fetch(`${queryKey[0]}/${queryKey[1]}`, {\n          credentials: \"include\",\n        });\n        \n        if (res.status === 401) {\n          toast({\n            variant: \"destructive\",\n            title: \"Authentication required\",\n            description: \"Please log in to view market details.\",\n          });\n          setLocation(\"/auth\");\n          return null;\n        }\n        \n        if (!res.ok) {\n          const text = await res.text();\n          throw new Error(`${res.status}: ${text || res.statusText}`);\n        }\n        \n        return await res.json();\n      } catch (error) {\n        console.error(\"Market fetch error:\", error);\n        throw error;\n      }\n    },\n    enabled: !!user && !isNaN(marketId)\n  });\n\n  // Fetch the game odds for Satamatka - get player-specific odds based on their assigned subadmin\n  const { data: satamatkaOddsData } = useQuery<any>({\n    queryKey: ['/api/game-odds', 'satamatka', user?.id],\n    queryFn: async () => {\n      if (!user) return null;\n      \n      const modes = ['jodi', 'harf', 'crossing', 'odd_even'];\n      \n      // This will get the odds that apply to this specific player\n      // which should include any subadmin overrides if applicable\n      const results = await Promise.all(\n        modes.map(mode => \n          apiRequest(\"GET\", `/api/game-odds/player?gameType=satamatka_${mode}`)\n            .then(res => res.json())\n            .catch(err => {\n              console.error(`Error fetching odds for ${mode}:`, err);\n              return null;\n            })\n        )\n      );\n      \n      console.log(\"Raw game odds data from API:\", results);\n      \n      // Parse the odds data from the database\n      // Database stores values like this: 60x is stored as 6000, 7x is stored as 700\n      return { \n        // Use first item from each result, which should now correctly return subadmin override if available\n        jodi: results[0]?.[0]?.oddValue || 6000, \n        harf: results[1]?.[0]?.oddValue || 600, \n        crossing: results[2]?.[0]?.oddValue || 6600,\n        odd_even: results[3]?.[0]?.oddValue || 600 \n      };\n    },\n    enabled: !!user\n  });\n  \n  // Update game odds when they load\n  useEffect(() => {\n    if (satamatkaOddsData) {\n      console.log(\"Received Satamatka odds:\", satamatkaOddsData);\n      // No need to divide here as the calculatePotentialWin function already handles division by 100\n      setGameOdds(satamatkaOddsData);\n    }\n  }, [satamatkaOddsData]);\n\n  // Log market data when it changes\n  useEffect(() => {\n    if (market) {\n      console.log(\"Market data received:\", market);\n    }\n    if (marketError) {\n      console.error(\"Error fetching market:\", marketError);\n      toast({\n        variant: \"destructive\",\n        title: \"Error loading market\",\n        description: marketError instanceof Error ? marketError.message : \"Could not load market details. Please try again.\"\n      });\n    }\n  }, [market, marketError, toast]);\n\n  // Query for user's recent bets\n  const { data: recentBets = [] as Game[], refetch: refetchRecentBets } = useQuery<Game[]>({\n    queryKey: [\"/api/games/my-history\"],\n    queryFn: getQueryFn({ on401: \"throw\" }),\n    enabled: !!user\n  });\n  \n  // Log bet history when received\n  useEffect(() => {\n    if (recentBets && Array.isArray(recentBets) && recentBets.length > 0) {\n      console.log(\"Received bet history:\", recentBets);\n    }\n  }, [recentBets]);\n\n  // Mutation for placing a single bet\n  const placeBetMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof formSchema>) => {\n      // Fix: Use correct method parameter ordering in apiRequest\n      return apiRequest(\"POST\", \"/api/satamatka/play\", {\n        marketId: marketId,\n        gameMode: data.gameMode,\n        prediction: data.prediction,\n        betAmount: data.betAmount,\n      });\n    },\n    onSuccess: () => {\n      // Show success toast\n      toast({\n        variant: \"success\",\n        title: \"Bet placed successfully!\",\n        description: \"Your bet has been placed on the selected market.\",\n      });\n\n      // Invalidate relevant queries and refetch data\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/games/my-history\"] });\n      \n      // Reset form\n      form.reset({\n        gameMode: selectedGameMode as any,\n        prediction: \"\",\n        betAmount: 100,\n      });\n      setSelectedNumber(\"\");\n      \n      // Refetch recent bets to show updated list\n      refetchRecentBets();\n    },\n    onError: (error: Error) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Failed to place bet\",\n        description: error.message,\n      });\n    },\n  });\n  \n  // Mutation for placing multiple bets\n  const placeMultipleBetsMutation = useMutation({\n    mutationFn: async (bets: Array<{number: string, amount: number}>) => {\n      // For crossing game type, generate all combinations\n      let serverBets;\n      \n      if (selectedGameMode === \"crossing\" && bets.length > 1) {\n        // Generate all possible combinations (pairs) of the selected digits\n        serverBets = [];\n        for (let i = 0; i < bets.length; i++) {\n          for (let j = 0; j < bets.length; j++) {\n            // Skip same digit combinations\n            if (i !== j) {\n              const digit1 = bets[i].number;\n              const digit2 = bets[j].number;\n              const combination = `${digit1}${digit2}`;\n              \n              serverBets.push({\n                prediction: combination,\n                betAmount: bets[i].amount * 100, // Convert to paisa\n              });\n            }\n          }\n        }\n      } else {\n        // For other game modes, process normally\n        serverBets = bets.map(bet => {\n          // For satamatka games, the stored amounts are already in rupees\n          // The server expects paisa, so we need to multiply by 100\n          return {\n            prediction: bet.number,\n            betAmount: bet.amount * 100,\n          };\n        });\n      }\n      \n      // Use the new bulk betting endpoint\n      const response = await apiRequest(\"POST\", \"/api/satamatka/play-multiple\", {\n        marketId: marketId,\n        gameMode: selectedGameMode,\n        bets: serverBets\n      });\n      \n      // Parse the response JSON\n      return await response.json();\n    },\n    onSuccess: (result) => {\n      // Get the number of successful bets from the response\n      console.log(\"Multiple bets response:\", result);\n      const successCount = result?.games?.length || 0;\n      const totalAmount = result?.totalBetAmount || 0;\n      \n      toast({\n        variant: \"success\",\n        title: \"All bets placed successfully!\",\n        description: `${successCount} bets (${totalAmount/100}) have been placed on the selected market.`,\n      });\n\n      // Invalidate relevant queries and refetch data\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/games/my-history\"] });\n      \n      // Reset multi-selection\n      setSelectedNumbers(new Map());\n      setShowBetSlip(false);\n      \n      // Refetch recent bets to show updated list\n      refetchRecentBets();\n    },\n    onError: (error: Error) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Failed to place bets\",\n        description: error.message || \"Some bets could not be placed. Please try again.\",\n      });\n    },\n  });\n\n  // Handle form submission\n  const onSubmit = (data: z.infer<typeof formSchema>) => {\n    if (!user) {\n      toast({\n        variant: \"destructive\",\n        title: \"Authentication required\",\n        description: \"Please login to place a bet.\",\n      });\n      return;\n    }\n\n    // Set bet details and open confirmation dialog\n    setBetDetails({\n      prediction: data.prediction,\n      betAmount: data.betAmount\n    });\n    setConfirmDialogOpen(true);\n  };\n  \n  // Handle bet confirmation from dialog\n  const handleConfirmBet = () => {\n    if (betDetails) {\n      // Check if we're confirming a single bet or multiple bets\n      if (selectedNumbers.size > 0) {\n        // Processing multiple bets\n        const bets = Array.from(selectedNumbers.entries()).map(([number, amount]) => ({\n          number, \n          amount\n        }));\n        \n        // Use the multiple bets mutation\n        placeMultipleBetsMutation.mutate(bets);\n      } else {\n        // Single bet from the form\n        const formData = form.getValues();\n        placeBetMutation.mutate(formData as any);\n      }\n      \n      // Close dialog and reset UI\n      setConfirmDialogOpen(false);\n      setSelectedNumbers(new Map());\n      setShowBetSlip(false);\n    }\n  };\n  \n  // Handle multi-selection of numbers with incremental bet amounts\n  const handleNumberSelection = (num: string) => {\n    const newSelections = new Map(selectedNumbers);\n    \n    if (newSelections.has(num)) {\n      // Different behavior based on game mode\n      if (selectedGameMode === \"crossing\") {\n        // For crossing game type, clicking an already selected number deselects it\n        newSelections.delete(num);\n      } else {\n        // For jodi and other game types, add the quickBetAmount to the current amount\n        const currentAmount = newSelections.get(num) || 0;\n        newSelections.set(num, currentAmount + quickBetAmount);\n      }\n    } else {\n      // If not selected, add with current bet amount\n      // Store the actual amount without conversion - we'll handle paisa conversion later\n      newSelections.set(num, quickBetAmount);\n    }\n    \n    setSelectedNumbers(newSelections);\n  };\n  \n  // Remove a number from selection (used in bet slip and other UI elements)\n  const removeNumberSelection = (num: string) => {\n    const newSelections = new Map(selectedNumbers);\n    newSelections.delete(num);\n    setSelectedNumbers(newSelections);\n  };\n  \n  // Calculate total bet amount across all selections\n  const calculateTotalBetAmount = (formatted = false): number | string => {\n    let total = 0;\n    selectedNumbers.forEach(amount => {\n      total += amount;\n    });\n    \n    // Return formatted amount for display if requested\n    // For jodi and harf, the bet amounts are already in rupees\n    if (formatted) {\n      return total.toFixed(2);\n    }\n    \n    return total;\n  };\n  \n  // Place bets for all selected numbers\n  const placeBetsForAllSelections = async () => {\n    if (selectedNumbers.size === 0) {\n      toast({\n        variant: \"destructive\",\n        title: \"No numbers selected\",\n        description: \"Please select at least one number to place a bet.\"\n      });\n      return;\n    }\n    \n    // Set bet details for confirmation dialog\n    setBetDetails({\n      prediction: Array.from(selectedNumbers.keys()).join(\", \"),\n      betAmount: Number(calculateTotalBetAmount())\n    });\n    setConfirmDialogOpen(true);\n  };\n\n  // Generate the number grid based on game mode\n  const renderNumberGrid = () => {\n    if (selectedGameMode === \"jodi\") {\n      return (\n        <div className=\"space-y-4\">\n          {/* Quick bet amount buttons */}\n          <div className=\"p-2 mb-4 bg-muted/30 rounded-lg\">\n            <div className=\"text-sm font-medium mb-2\">Quick Bet Amount</div>\n            <div className=\"space-y-2\">\n              {/* Preset amounts */}\n              <div className=\"grid grid-cols-2 gap-2 mb-2\">\n                {[100, 500, 1000, 5000].map((amount) => (\n                  <Button\n                    key={amount}\n                    variant={quickBetAmount === amount ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setQuickBetAmount(amount)}\n                    className={`${\n                      quickBetAmount === amount \n                        ? \"bg-primary/90 text-primary-foreground\" \n                        : \"hover:bg-primary/20\"\n                    }`}\n                  >\n                    {amount.toLocaleString()}\n                  </Button>\n                ))}\n              </div>\n              \n              {/* Custom amount input with increment/decrement */}\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 w-12 p-0\"\n                  onClick={() => {\n                    if (quickBetAmount > 100) {\n                      setQuickBetAmount(Math.max(100, quickBetAmount - 100));\n                    }\n                  }}\n                >\n                  -\n                </Button>\n                <div className=\"flex-1 relative\">\n                  <Input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={quickBetAmount}\n                    className=\"text-center pr-10\"\n                    onChange={(e) => {\n                      // Only allow numbers\n                      const value = e.target.value.replace(/[^0-9]/g, '');\n                      if (value === '') {\n                        setQuickBetAmount(0);\n                      } else {\n                        setQuickBetAmount(parseInt(value));\n                      }\n                    }}\n                  />\n                  <span className=\"absolute right-2 top-[9px] text-gray-400\"></span>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 w-12 p-0\"\n                  onClick={() => {\n                    setQuickBetAmount(quickBetAmount + 100);\n                  }}\n                >\n                  +\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 px-2\"\n                  onClick={() => {\n                    if (user && user.balance > 0) {\n                      // Use the user's balance converted from paisa to rupees\n                      setQuickBetAmount(Math.min(10000, Math.floor(user.balance / 100)));\n                    }\n                  }}\n                >\n                  MAX\n                </Button>\n              </div>\n            </div>\n          </div>\n          \n          {/* Mobile-optimized number grid with 5 numbers per row */}\n          <div className=\"space-y-4\">\n            <div className=\"text-sm font-medium\">Select Numbers</div>\n            \n            {/* All numbers (00-99) in a scrollable container with first 20 visible initially */}\n            <div className=\"grid grid-cols-5 gap-2 max-h-[320px] overflow-y-auto p-2 border rounded-lg border-slate-700\">\n              {Array.from({ length: 100 }, (_, i) => {\n                const num = i.toString().padStart(2, \"0\");\n                const isSelected = selectedNumbers.has(num);\n                const betAmount = selectedNumbers.get(num) || 0;\n                \n                return (\n                  <div key={num} className=\"relative\">\n                    <Button\n                      variant={isSelected ? \"default\" : \"outline\"}\n                      className={`h-12 w-full flex flex-col items-center justify-center p-1 ${\n                        isSelected ? \"bg-primary/90\" : \"\"\n                      }`}\n                      onClick={() => handleNumberSelection(num)}\n                    >\n                      <span className=\"text-base font-medium\">{num}</span>\n                      {isSelected && (\n                        <span className=\"text-xs mt-1\">{betAmount.toFixed(2)}</span>\n                      )}\n                    </Button>\n                    {isSelected && (\n                      <button\n                        className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          removeNumberSelection(num);\n                        }}\n                      >\n                        \n                      </button>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n          \n          {/* Bet slip button for selected numbers */}\n          {selectedNumbers.size > 0 && (\n            <div className=\"mt-4\">\n              <Button \n                variant=\"default\" \n                className=\"w-full bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 shadow-lg transition-all duration-200\"\n                onClick={() => setShowBetSlip(true)}\n              >\n                View Bet Slip ({selectedNumbers.size} numbers, {calculateTotalBetAmount(true)})\n              </Button>\n            </div>\n          )}\n        </div>\n      );\n    } else if (selectedGameMode === \"harf\") {\n      // Create improved Harf bet type UI with left digit, right digit selection\n      return (\n        <div className=\"space-y-4\">\n          {/* Quick bet amount buttons */}\n          <div className=\"p-2 mb-4 bg-muted/30 rounded-lg\">\n            <div className=\"text-sm font-medium mb-2\">Quick Bet Amount</div>\n            <div className=\"space-y-2\">\n              {/* Preset amounts */}\n              <div className=\"grid grid-cols-2 gap-2 mb-2\">\n                {[100, 500, 1000, 5000].map((amount) => (\n                  <Button\n                    key={amount}\n                    variant={quickBetAmount === amount ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setQuickBetAmount(amount)}\n                    className={`${\n                      quickBetAmount === amount \n                        ? \"bg-primary/90 text-primary-foreground\" \n                        : \"hover:bg-primary/20\"\n                    }`}\n                  >\n                    {amount.toLocaleString()}\n                  </Button>\n                ))}\n              </div>\n              \n              {/* Custom amount input with increment/decrement */}\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 w-12 p-0\"\n                  onClick={() => {\n                    if (quickBetAmount > 100) {\n                      setQuickBetAmount(Math.max(100, quickBetAmount - 100));\n                    }\n                  }}\n                >\n                  -\n                </Button>\n                <div className=\"flex-1 relative\">\n                  <Input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={quickBetAmount}\n                    className=\"text-center pr-10\"\n                    onChange={(e) => {\n                      // Only allow numbers\n                      const value = e.target.value.replace(/[^0-9]/g, '');\n                      if (value === '') {\n                        setQuickBetAmount(0);\n                      } else {\n                        setQuickBetAmount(parseInt(value));\n                      }\n                    }}\n                  />\n                  <span className=\"absolute right-2 top-[9px] text-gray-400\"></span>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 w-12 p-0\"\n                  onClick={() => {\n                    setQuickBetAmount(quickBetAmount + 100);\n                  }}\n                >\n                  +\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 px-2\"\n                  onClick={() => {\n                    if (user && user.balance > 0) {\n                      // Use the user's balance converted from paisa to rupees\n                      setQuickBetAmount(Math.min(10000, Math.floor(user.balance / 100)));\n                    }\n                  }}\n                >\n                  MAX\n                </Button>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {/* Ander Digit Selection (First digit 0-9) */}\n            <Card className=\"border border-slate-700\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Ander (A)</CardTitle>\n                <CardDescription className=\"text-xs\">Select the left digit (0-9)</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-5 gap-2\">\n                  {Array.from({ length: 10 }, (_, i) => {\n                    const num = `A${i}`;\n                    const isSelected = selectedNumbers.has(num);\n                    const betAmount = selectedNumbers.get(num) || 0;\n                    \n                    return (\n                      <div key={num} className=\"relative\">\n                        <Button\n                          variant={isSelected ? \"default\" : \"outline\"}\n                          className={`h-10 w-full flex flex-col items-center justify-center p-1 ${\n                            isSelected ? \"bg-primary/90\" : \"\"\n                          }`}\n                          onClick={() => handleNumberSelection(num)}\n                        >\n                          <span className=\"text-base font-medium\">{i}</span>\n                          {isSelected && (\n                            <span className=\"text-xs mt-1\">{betAmount}</span>\n                          )}\n                        </Button>\n                        {isSelected && (\n                          <button\n                            className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              removeNumberSelection(num);\n                            }}\n                          >\n                            \n                          </button>\n                        )}\n                      </div>\n                    );\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n            \n            {/* Bahar Digit Selection (Second digit 0-9) */}\n            <Card className=\"border border-slate-700\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Bahar (B)</CardTitle>\n                <CardDescription className=\"text-xs\">Select the right digit (0-9)</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-5 gap-2\">\n                  {Array.from({ length: 10 }, (_, i) => {\n                    const num = `B${i}`;\n                    const isSelected = selectedNumbers.has(num);\n                    const betAmount = selectedNumbers.get(num) || 0;\n                    \n                    return (\n                      <div key={num} className=\"relative\">\n                        <Button\n                          variant={isSelected ? \"default\" : \"outline\"}\n                          className={`h-10 w-full flex flex-col items-center justify-center p-1 ${\n                            isSelected ? \"bg-primary/90\" : \"\"\n                          }`}\n                          onClick={() => handleNumberSelection(num)}\n                        >\n                          <span className=\"text-base font-medium\">{i}</span>\n                          {isSelected && (\n                            <span className=\"text-xs mt-1\">{betAmount}</span>\n                          )}\n                        </Button>\n                        {isSelected && (\n                          <button\n                            className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              removeNumberSelection(num);\n                            }}\n                          >\n                            \n                          </button>\n                        )}\n                      </div>\n                    );\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n          \n          {/* Bet slip button for selected numbers */}\n          {selectedNumbers.size > 0 && (\n            <div className=\"mt-4\">\n              <Button \n                variant=\"default\" \n                className=\"w-full bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 shadow-lg transition-all duration-200\"\n                onClick={() => setShowBetSlip(true)}\n              >\n                View Bet Slip ({selectedNumbers.size} numbers, {calculateTotalBetAmount(true)})\n              </Button>\n            </div>\n          )}\n        </div>\n      );\n    } else if (selectedGameMode === \"crossing\") {\n      // Calculate total combinations based on selected numbers\n      const calculateCombinations = (digits: string[]) => {\n        if (digits.length <= 1) return 0;\n        \n        // Number of combinations is N*(N-1) where N is the number of digits selected\n        // Each pair of digits forms two combinations (e.g., 1,2 forms 12 and 21)\n        return digits.length * (digits.length - 1);\n      };\n      \n      // Extract just the digit values from the selected numbers Map keys\n      const selectedDigits = Array.from(selectedNumbers.keys());\n      const totalCombinations = calculateCombinations(selectedDigits);\n      \n      return (\n        <div className=\"space-y-4\">\n          {/* Quick bet amount buttons */}\n          <div className=\"p-2 mb-2 bg-muted/30 rounded-lg\">\n            <div className=\"text-sm font-medium mb-2\">Quick Bet Amount</div>\n            <div className=\"space-y-2\">\n              {/* Preset amounts */}\n              <div className=\"grid grid-cols-2 gap-2 mb-2\">\n                {[100, 500, 1000, 5000].map((amount) => (\n                  <Button\n                    key={amount}\n                    variant={quickBetAmount === amount ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setQuickBetAmount(amount)}\n                    className={`${\n                      quickBetAmount === amount \n                        ? \"bg-primary/90 text-primary-foreground\" \n                        : \"hover:bg-primary/20\"\n                    }`}\n                  >\n                    {amount.toLocaleString()}\n                  </Button>\n                ))}\n              </div>\n              \n              {/* Custom amount input with increment/decrement */}\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 w-12 p-0\"\n                  onClick={() => {\n                    if (quickBetAmount > 100) {\n                      setQuickBetAmount(Math.max(100, quickBetAmount - 100));\n                    }\n                  }}\n                >\n                  -\n                </Button>\n                <div className=\"flex-1 relative\">\n                  <Input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={quickBetAmount}\n                    className=\"text-center pr-10\"\n                    onChange={(e) => {\n                      // Only allow numbers\n                      const value = e.target.value.replace(/[^0-9]/g, '');\n                      if (value === '') {\n                        setQuickBetAmount(0);\n                      } else {\n                        setQuickBetAmount(parseInt(value));\n                      }\n                    }}\n                  />\n                  <span className=\"absolute right-2 top-[9px] text-gray-400\"></span>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 w-12 p-0\"\n                  onClick={() => {\n                    setQuickBetAmount(quickBetAmount + 100);\n                  }}\n                >\n                  +\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 px-2\"\n                  onClick={() => {\n                    if (user && user.balance > 0) {\n                      // Use the user's balance converted from paisa to rupees\n                      setQuickBetAmount(Math.min(10000, Math.floor(user.balance / 100)));\n                    }\n                  }}\n                >\n                  MAX\n                </Button>\n              </div>\n            </div>\n          </div>\n          \n          {/* Selected digits summary */}\n          {selectedDigits.length > 0 && (\n            <div className=\"mb-2 p-3 border rounded-lg border-primary/30 bg-primary/5\">\n              <div className=\"flex justify-between items-center mb-2\">\n                <h4 className=\"text-sm font-medium\">Selected Digits</h4>\n                <Badge variant=\"outline\" className=\"bg-primary/10\">\n                  {selectedDigits.join(\", \")}\n                </Badge>\n              </div>\n              \n              <div className=\"flex flex-col space-y-1 text-sm\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Combinations:</span>\n                  <span className=\"font-medium\">{totalCombinations} numbers</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Bet per combination:</span>\n                  <span className=\"font-medium\">{(quickBetAmount * 100 / 100).toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Total bet amount:</span>\n                  <span className=\"font-medium\">{(totalCombinations * quickBetAmount * 100 / 100).toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Potential win (max):</span>\n                  <span className=\"font-medium text-amber-500\">{(calculatePotentialWin(selectedGameMode, quickBetAmount, gameOdds) * totalCombinations).toFixed(2)}</span>\n                </div>\n              </div>\n            </div>\n          )}\n          \n          {/* Number selection grid */}\n          <div>\n            <div className=\"text-sm font-medium mb-2\">Select Numbers (0-9)</div>\n            <div className=\"grid grid-cols-5 gap-3 p-2\">\n              {Array.from({ length: 10 }, (_, i) => {\n                const num = i.toString();\n                const isSelected = selectedNumbers.has(num);\n                \n                return (\n                  <div key={num} className=\"relative\">\n                    <Button\n                      variant={isSelected ? \"default\" : \"outline\"}\n                      className={`h-12 w-full flex items-center justify-center p-1 ${\n                        isSelected ? \"bg-primary text-primary-foreground\" : \"\"\n                      }`}\n                      onClick={() => handleNumberSelection(num)}\n                    >\n                      <span className=\"text-lg font-medium\">{num}</span>\n                    </Button>\n                    {isSelected && (\n                      <div className=\"absolute -top-2 -right-2 bg-primary text-white rounded-full h-5 w-5 flex items-center justify-center text-xs border border-white\">\n                        \n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n          \n          {/* Combinations preview */}\n          {selectedDigits.length > 1 && (\n            <div className=\"mt-4 p-3 border rounded-lg bg-muted/10\">\n              <h4 className=\"text-sm font-medium mb-2\">Generated Combinations</h4>\n              <div className=\"grid grid-cols-5 md:grid-cols-8 gap-2\">\n                {selectedDigits.flatMap((digit1, i) => \n                  selectedDigits.filter((_, j) => i !== j).map(digit2 => {\n                    const combination = `${digit1}${digit2}`;\n                    return (\n                      <Badge \n                        key={combination} \n                        variant=\"outline\" \n                        className=\"py-1.5 bg-primary/5 border-primary/20\"\n                      >\n                        {combination}\n                      </Badge>\n                    );\n                  })\n                )}\n              </div>\n            </div>\n          )}\n          \n          {/* Place all bets button */}\n          {selectedDigits.length > 1 && (\n            <div className=\"mt-4\">\n              <Button \n                variant=\"default\" \n                className=\"w-full bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 shadow-lg transition-all duration-200\"\n                onClick={() => {\n                  // Generate prediction text describing the combinations\n                  const combinationsText = selectedDigits.length > 3 \n                    ? `${selectedDigits.length} digits (${totalCombinations} combinations)`\n                    : `Combinations of ${selectedDigits.join(\",\")}`;\n                  \n                  // Set bet details for confirmation dialog \n                  // Store amount as rupees, we'll convert to paisa in the mutation\n                  setBetDetails({\n                    prediction: combinationsText,\n                    betAmount: totalCombinations * quickBetAmount\n                  });\n                  \n                  // Open confirmation dialog\n                  setConfirmDialogOpen(true);\n                }}\n              >\n                Place Bets on {totalCombinations} Combinations ({selectedGameMode === \"crossing\" \n                  ? `${(totalCombinations * quickBetAmount * 100 / 100).toFixed(2)}` \n                  : formatCurrency(totalCombinations * quickBetAmount, 'satamatka')})\n              </Button>\n            </div>\n          )}\n        </div>\n      );\n    } else if (selectedGameMode === \"odd_even\") {\n      // Enhanced Odd-Even game type UI with quick bet options and bet slip\n      return (\n        <div className=\"space-y-6\">\n          {/* Quick bet amount buttons */}\n          <div className=\"p-3 bg-muted/30 rounded-lg\">\n            <div className=\"text-sm font-medium mb-2\">Quick Bet Amount</div>\n            <div className=\"space-y-2\">\n              {/* Preset amounts */}\n              <div className=\"grid grid-cols-2 gap-2 mb-2\">\n                {[100, 500, 1000, 5000].map((amount) => (\n                  <Button\n                    key={amount}\n                    variant={quickBetAmount === amount ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setQuickBetAmount(amount)}\n                    className={`${\n                      quickBetAmount === amount \n                        ? \"bg-primary/90 text-primary-foreground\" \n                        : \"hover:bg-primary/20\"\n                    }`}\n                  >\n                    {amount.toLocaleString()}\n                  </Button>\n                ))}\n              </div>\n              \n              {/* Custom amount input with increment/decrement */}\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 w-12 p-0\"\n                  onClick={() => {\n                    if (quickBetAmount > 100) {\n                      setQuickBetAmount(Math.max(100, quickBetAmount - 100));\n                    }\n                  }}\n                >\n                  -\n                </Button>\n                <div className=\"flex-1 relative\">\n                  <Input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={quickBetAmount}\n                    className=\"text-center pr-10\"\n                    onChange={(e) => {\n                      // Only allow numbers\n                      const value = e.target.value.replace(/[^0-9]/g, '');\n                      if (value === '') {\n                        setQuickBetAmount(0);\n                      } else {\n                        setQuickBetAmount(parseInt(value));\n                      }\n                    }}\n                  />\n                  <span className=\"absolute right-2 top-[9px] text-gray-400\"></span>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 w-12 p-0\"\n                  onClick={() => {\n                    setQuickBetAmount(quickBetAmount + 100);\n                  }}\n                >\n                  +\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-9 px-2\"\n                  onClick={() => {\n                    if (user && user.balance > 0) {\n                      // Use the user's balance converted from paisa to rupees\n                      setQuickBetAmount(Math.min(10000, Math.floor(user.balance / 100)));\n                    }\n                  }}\n                >\n                  MAX\n                </Button>\n              </div>\n            </div>\n          </div>\n          \n          {/* Improved Odd-Even selection cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <Card \n              className={`cursor-pointer transition-all border ${\n                selectedNumbers.has(\"odd\") ? \"border-primary shadow-md\" : \"border-slate-700\"\n              }`}\n              onClick={() => handleNumberSelection(\"odd\")}\n            >\n              <CardContent className=\"p-6 flex flex-col items-center justify-center\">\n                <div className=\"bg-primary/10 rounded-full p-3 mb-3\">\n                  <Grid2X2 className=\"h-10 w-10 text-primary\" />\n                </div>\n                <p className=\"font-bold text-xl\">ODD</p>\n                {selectedNumbers.has(\"odd\") && (\n                  <div className=\"mt-3 flex flex-col items-center gap-2\">\n                    <div className=\"flex items-center bg-green-100 text-green-800 px-3 py-1 rounded-full\">\n                      <div className=\"h-4 w-4 mr-1 text-green-600\"></div>\n                      <span className=\"text-sm font-medium\">{selectedNumbers.get(\"odd\")}</span>\n                    </div>\n                    <Button \n                      variant=\"destructive\" \n                      size=\"sm\" \n                      className=\"mt-1 text-xs px-2 py-0 h-7\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        removeNumberSelection(\"odd\");\n                      }}\n                    >\n                      Remove\n                    </Button>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n            \n            <Card \n              className={`cursor-pointer transition-all border ${\n                selectedNumbers.has(\"even\") ? \"border-primary shadow-md\" : \"border-slate-700\"\n              }`}\n              onClick={() => handleNumberSelection(\"even\")}\n            >\n              <CardContent className=\"p-6 flex flex-col items-center justify-center\">\n                <div className=\"bg-primary/10 rounded-full p-3 mb-3\">\n                  <Divide className=\"h-10 w-10 text-primary\" />\n                </div>\n                <p className=\"font-bold text-xl\">EVEN</p>\n                {selectedNumbers.has(\"even\") && (\n                  <div className=\"mt-3 flex flex-col items-center gap-2\">\n                    <div className=\"flex items-center bg-green-100 text-green-800 px-3 py-1 rounded-full\">\n                      <div className=\"h-4 w-4 mr-1 text-green-600\"></div>\n                      <span className=\"text-sm font-medium\">{selectedNumbers.get(\"even\")}</span>\n                    </div>\n                    <Button \n                      variant=\"destructive\" \n                      size=\"sm\" \n                      className=\"mt-1 text-xs px-2 py-0 h-7\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        removeNumberSelection(\"even\");\n                      }}\n                    >\n                      Remove\n                    </Button>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n          \n          {/* Bet details card */}\n          {selectedNumbers.size > 0 && (\n            <Card className=\"border border-primary/20 bg-primary/5 mt-4\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-base\">Your Bet Details</CardTitle>\n                <CardDescription>\n                  Review your bet details before confirming\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <div className=\"text-sm\">\n                    <span className=\"text-muted-foreground\">Selected:</span>\n                    <span className=\"font-medium ml-2\">\n                      {Array.from(selectedNumbers.keys())\n                        .map(n => n.charAt(0).toUpperCase() + n.slice(1))\n                        .join(\", \")}\n                    </span>\n                  </div>\n                  <div className=\"text-sm\">\n                    <span className=\"text-muted-foreground\">Amount:</span>\n                    <span className=\"font-medium ml-2\">\n                      {selectedGameMode === \"odd_even\" \n                        ? `${calculateTotalBetAmount(true)}` \n                        : formatCurrency(Number(calculateTotalBetAmount()), 'satamatka')}\n                    </span>\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <div className=\"text-sm\">\n                    <span className=\"text-muted-foreground\">Payout Ratio:</span>\n                    <span className=\"font-medium ml-2\">\n                      {selectedGameMode === \"jodi\" \n                        ? `${(gameOdds.jodi ? (gameOdds.jodi / 10000) : 60)}x` \n                        : selectedGameMode === \"harf\" \n                        ? `${(gameOdds.harf ? (gameOdds.harf / 10000) : 6)}x` \n                        : selectedGameMode === \"crossing\" \n                        ? `${(gameOdds.crossing ? (gameOdds.crossing / 10000) : 66)}x` \n                        : selectedGameMode === \"odd_even\" \n                        ? `${(gameOdds.odd_even ? (gameOdds.odd_even / 10000) : 6)}x` \n                        : \"1x\"}\n                    </span>\n                  </div>\n                  <div className=\"text-sm\">\n                    <span className=\"text-muted-foreground\">Potential Win:</span>\n                    <span className=\"font-medium ml-2 text-amber-500\">\n                      {calculatePotentialWin(selectedGameMode, Number(calculateTotalBetAmount()), gameOdds).toFixed(2)}\n                    </span>\n                  </div>\n                </div>\n              </CardContent>\n              <CardFooter>\n                <Button \n                  variant=\"default\" \n                  className=\"w-full bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 shadow-lg transition-all duration-200\"\n                  onClick={() => {\n                    setBetDetails({\n                      prediction: Array.from(selectedNumbers.keys())[0],\n                      betAmount: Array.from(selectedNumbers.values())[0]\n                    });\n                    setConfirmDialogOpen(true);\n                  }}\n                  disabled={selectedNumbers.size === 0}\n                >\n                  Place Bet Now\n                </Button>\n              </CardFooter>\n            </Card>\n          )}\n        </div>\n      );\n    }\n\n    return null;\n  };\n\n  // Generate description based on game mode\n  const getGameModeDescription = () => {\n    switch (selectedGameMode) {\n      case \"jodi\":\n        return `Predict the exact two-digit number (00-99). Payout ratio: ${(gameOdds.jodi ? gameOdds.jodi / 10000 : 60)}x`;\n      case \"harf\":\n        return `Predict digits in specific positions (left/right). Select first digit, second digit, or both. Payout ratio: ${(gameOdds.harf ? gameOdds.harf / 10000 : 6)}x`;\n      case \"crossing\":\n        return `Select multiple digits (0-9) to create two-digit combinations. For example, selecting 1,2,3 creates: 12, 21, 13, 31, 23, 32. Payout ratio: ${(gameOdds.crossing ? gameOdds.crossing / 10000 : 66)}x`;\n      case \"odd_even\":\n        return `Predict if the result will be odd or even. Payout ratio: ${(gameOdds.odd_even ? gameOdds.odd_even / 10000 : 1.9)}x`;\n      default:\n        return \"Select a game mode to see details.\";\n    }\n  };\n\n  // Handle game mode change\n  const handleGameModeChange = (value: string) => {\n    setSelectedGameMode(value);\n    form.setValue(\"gameMode\", value as any);\n    // Reset prediction when game mode changes\n    setSelectedNumber(\"\");\n    form.setValue(\"prediction\", \"\");\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto py-6\">\n        <Skeleton className=\"h-10 w-3/4 mb-4\" />\n        <Skeleton className=\"h-6 w-1/2 mb-8\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <Skeleton className=\"h-[400px] rounded-lg\" />\n          </div>\n          <div className=\"space-y-4\">\n            <Skeleton className=\"h-8 w-1/2\" />\n            <Skeleton className=\"h-32 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!market) {\n    return (\n      <div className=\"container mx-auto py-6\">\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertTitle>Error</AlertTitle>\n          <AlertDescription>\n            Market not found or is no longer available.\n            <Button\n              variant=\"outline\"\n              className=\"mt-2 w-full\"\n              onClick={() => setLocation(\"/markets\")}\n            >\n              Go back to Markets\n            </Button>\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  // TypeScript check to ensure market has the expected properties\n  const typedMarket = market as unknown as SatamatkaMarket;\n  \n  if (typedMarket.status !== \"open\") {\n    return (\n      <div className=\"container mx-auto py-6\">\n        <Alert>\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertTitle>Market Closed</AlertTitle>\n          <AlertDescription>\n            This market is no longer open for betting.\n            <Button\n              variant=\"outline\"\n              className=\"mt-2 w-full\"\n              onClick={() => setLocation(\"/markets\")}\n            >\n              Go back to Markets\n            </Button>\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"py-2\">\n      {/* Bet slip dialog for showing all selections */}\n      <Dialog open={showBetSlip} onOpenChange={setShowBetSlip}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Your Bet Slip</DialogTitle>\n            <DialogDescription>\n              Review your selections before placing your bet\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"max-h-[400px] overflow-y-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Number</TableHead>\n                  <TableHead>Amount</TableHead>\n                  <TableHead>Potential Win</TableHead>\n                  <TableHead className=\"w-10\"></TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {Array.from(selectedNumbers.entries()).map(([num, amount]) => {\n                  // Format display for left/right digit selections in Harf mode\n                  let displayNum = num;\n                  if (selectedGameMode === \"harf\") {\n                    if (num.startsWith(\"L\")) {\n                      displayNum = `Left: ${num.substring(1)}`;\n                    } else if (num.startsWith(\"R\")) {\n                      displayNum = `Right: ${num.substring(1)}`;\n                    }\n                  }\n                  \n                  return (\n                    <TableRow key={num}>\n                      <TableCell className=\"font-medium\">{displayNum}</TableCell>\n                      <TableCell>{amount.toFixed(2)}</TableCell>\n                      <TableCell className=\"text-amber-500\">\n                        {calculatePotentialWin(selectedGameMode, amount, gameOdds).toFixed(2)}\n                      </TableCell>\n                      <TableCell>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-7 w-7 rounded-full bg-red-100 text-red-700 hover:bg-red-200\"\n                          onClick={() => removeNumberSelection(num)}\n                        >\n                          \n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          </div>\n          \n          <div className=\"bg-muted/30 p-3 rounded-lg\">\n            <div className=\"flex justify-between mb-2\">\n              <span className=\"text-sm font-medium\">Total Bet Amount:</span>\n              <span className=\"font-bold\">\n                {Number(calculateTotalBetAmount()).toFixed(2)}\n              </span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-sm font-medium\">Potential Win:</span>\n              <span className=\"font-bold text-amber-500\">\n                {Array.from(selectedNumbers.values()).reduce(\n                  (total, amount) => total + calculatePotentialWin(selectedGameMode, amount, gameOdds),\n                  0\n                ).toFixed(2)}\n              </span>\n            </div>\n          </div>\n          \n          <DialogFooter>\n            <Button \n              type=\"button\" \n              variant=\"outline\" \n              onClick={() => setShowBetSlip(false)}\n            >\n              Cancel\n            </Button>\n            <Button \n              type=\"button\"\n              onClick={placeBetsForAllSelections}\n              className=\"bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 shadow-lg transition-all duration-200\"\n              disabled={selectedNumbers.size === 0 || placeBetMutation.isPending}\n            >\n              {placeBetMutation.isPending ? (\n                <>\n                  <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Processing...\n                </>\n              ) : (\n                \"Place All Bets\"\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Confirmation dialog for placing bet */}\n      <Dialog open={confirmDialogOpen} onOpenChange={setConfirmDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Confirm Your Bet</DialogTitle>\n            <DialogDescription>\n              Please review your bet details before confirming\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-1\">\n                <p className=\"text-sm font-medium text-muted-foreground\">Market</p>\n                <p className=\"font-medium\">{typedMarket.name}</p>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-sm font-medium text-muted-foreground\">Game Mode</p>\n                <p className=\"font-medium\">{GAME_MODES[selectedGameMode as keyof typeof GAME_MODES]}</p>\n              </div>\n            </div>\n            \n            <div className=\"space-y-1\">\n              <p className=\"text-sm font-medium text-muted-foreground\">Prediction</p>\n              <p className=\"font-bold\">{betDetails?.prediction}</p>\n            </div>\n            \n            <div className=\"flex justify-between items-center\">\n              <div className=\"space-y-1\">\n                <p className=\"text-sm font-medium text-muted-foreground\">Bet Amount</p>\n                <p className=\"text-lg font-bold\">\n                  {betDetails ? `${betDetails.betAmount.toFixed(2)}` : ''}\n                </p>\n              </div>\n              <div className=\"text-right space-y-1\">\n                <p className=\"text-sm font-medium text-muted-foreground\">Potential Win</p>\n                <p className=\"text-lg font-bold text-amber-500\">\n                  {betDetails ? `${calculatePotentialWin(selectedGameMode, betDetails.betAmount, gameOdds).toFixed(2)}` : ''}\n                </p>\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button \n              type=\"button\" \n              variant=\"outline\" \n              onClick={() => setConfirmDialogOpen(false)}\n            >\n              Cancel\n            </Button>\n            <Button \n              type=\"button\"\n              onClick={handleConfirmBet}\n              className=\"bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 shadow-lg transition-all duration-200\"\n              disabled={placeBetMutation.isPending || placeMultipleBetsMutation.isPending}\n            >\n              {placeBetMutation.isPending || placeMultipleBetsMutation.isPending ? (\n                <>\n                  <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Processing...\n                </>\n              ) : (\n                \"Confirm Bet\"\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n      \n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-2\">\n        <div className=\"flex items-center\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"mr-2\"\n            onClick={() => setLocation(\"/markets\")}\n          >\n            <ChevronLeft className=\"h-4 w-4 mr-1\" /> Back\n          </Button>\n        </div>\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2\">\n          <p className=\"text-sm text-muted-foreground bg-slate-800/30 px-3 py-1 rounded-full\">\n            <Clock className=\"h-4 w-4 inline mr-1\" />\n            Open: {format(new Date(typedMarket.openTime), \"h:mm a\")} | Close:{\" \"}\n            {format(new Date(typedMarket.closeTime), \"h:mm a\")}\n          </p>\n          <Badge className=\"bg-green-500 hover:bg-green-600 text-white\">\n            Open for Betting\n          </Badge>\n        </div>\n      </div>\n\n      {/* Improved responsive layout for PC/laptop screens */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Left column for game mode selection */}\n        <div className=\"lg:col-span-1\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Select Game Mode</CardTitle>\n              <CardDescription>Choose how you want to play</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-2 lg:grid-cols-1 gap-4 mb-4\">\n                {Object.entries(GAME_MODES).map(([value, label]) => (\n                  <Card \n                    key={value} \n                    className={`cursor-pointer transition-all hover:scale-105 ${selectedGameMode === value ? 'border-primary shadow-md' : 'border'}`}\n                    onClick={() => handleGameModeChange(value)}\n                  >\n                    <CardContent className=\"p-4 flex flex-col items-center justify-center\">\n                      {value === \"jodi\" && <Hash className=\"h-10 w-10 text-primary mb-2\" />}\n                      {value === \"harf\" && <Type className=\"h-10 w-10 text-primary mb-2\" />}\n                      {value === \"crossing\" && <ArrowLeftRight className=\"h-10 w-10 text-primary mb-2\" />}\n                      {value === \"odd_even\" && <Divide className=\"h-10 w-10 text-primary mb-2\" />}\n                      <p className=\"font-medium text-center\">{label}</p>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n              <p className=\"text-sm text-muted-foreground p-2 bg-muted/50 rounded-md\">\n                {getGameModeDescription()}\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n        \n        {/* Right column for bet placement */}\n        <div className=\"lg:col-span-2\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Place Your Bet</CardTitle>\n                  <CardDescription>Select numbers and bet amount</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {/* Form fields will render dynamically based on game mode */}\n                  {renderNumberGrid()}\n                  \n                  {/* Manual bet form removed as requested */}\n                </CardContent>\n              </Card>\n            </form>\n          </Form>\n        </div>\n\n\n      </div>\n\n      {/* Recent Bets Table - Enhanced with more details */}\n      <div className=\"mt-8\">\n        <Card className=\"overflow-hidden border-slate-700\">\n          <CardHeader className=\"flex flex-row items-center justify-between bg-slate-900\">\n            <div>\n              <CardTitle>Your Recent Bets</CardTitle>\n              <CardDescription>Latest bets you've placed</CardDescription>\n            </div>\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={() => setLocation(\"/game-history\")}\n              className=\"ml-auto\"\n            >\n              View Full History\n            </Button>\n          </CardHeader>\n          <CardContent className=\"p-0\">\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader className=\"bg-slate-800\">\n                  <TableRow>\n                    <TableHead className=\"font-medium\">ID</TableHead>\n                    <TableHead className=\"font-medium\">Market</TableHead>\n                    <TableHead className=\"font-medium\">Game Type</TableHead>\n                    <TableHead className=\"font-medium\">Prediction</TableHead>\n                    <TableHead className=\"font-medium\">Amount</TableHead>\n                    <TableHead className=\"font-medium\">Potential Win</TableHead>\n                    <TableHead className=\"font-medium\">Result</TableHead>\n                    <TableHead className=\"font-medium\">Payout</TableHead>\n                    <TableHead className=\"font-medium\">Balance After</TableHead>\n                    <TableHead className=\"font-medium\">Date</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {(recentBets as Game[]).slice(0, 10).map((bet) => {\n                    // Calculate potential win amount based on game mode\n                    const gameMode = bet.gameMode || (bet.gameData?.gameMode as string);\n                    const potentialWin = gameMode \n                      ? (calculatePotentialWin(gameMode, bet.betAmount / 100, gameOdds)).toFixed(2)\n                      : (bet.betAmount * 1.9 / 10000).toFixed(2); // Default multiplier if gameMode not available\n                    \n                    // Determine visual styling based on status\n                    const isWin = bet.result === \"win\" || bet.status === \"win\";\n                    const isLoss = bet.result === \"loss\" || bet.status === \"loss\";\n                    const isPending = bet.result === \"pending\" || bet.status === \"pending\" || !bet.result;\n                    \n                    // Format payout amount\n                    const payout = bet.payout ? (bet.payout / 100).toFixed(2) : \"0.00\";\n                    \n                    return (\n                      <TableRow key={bet.id} className=\"border-slate-700\">\n                        <TableCell className=\"font-mono text-xs\">{bet.id}</TableCell>\n                        <TableCell>\n                          {bet.market?.name || \n                          (bet.gameType === 'satamatka' && bet.marketId ? \n                          (bet.marketId === marketId ? typedMarket.name : `Market #${bet.marketId}`) : \n                          'Unknown')}\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"outline\" className=\"bg-indigo-950/40 border-indigo-700 text-indigo-300\">\n                            {bet.gameType === 'satamatka' && gameMode ? \n                              (GAME_MODES[gameMode as keyof typeof GAME_MODES] || gameMode) : \n                              formatGameType(bet.gameType)}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <span className=\"font-medium\">\n                            {bet.gameType === 'satamatka' && bet.gameMode === 'harf' ? \n                              bet.prediction.startsWith('L') ? \n                                `A${bet.prediction.slice(1)}` : \n                                bet.prediction.startsWith('R') ? \n                                  `B${bet.prediction.slice(1)}` : \n                                  bet.prediction \n                              : bet.prediction}\n                          </span>\n                        </TableCell>\n                        <TableCell>{(bet.betAmount / 100).toFixed(2)}</TableCell>\n                        <TableCell>{potentialWin}</TableCell>\n                        <TableCell>\n                          <Badge\n                            variant={\n                              isWin ? \"default\" : \n                              isLoss ? \"destructive\" : \n                              isPending ? \"secondary\" : \"outline\"\n                            }\n                            className={`${\n                              isWin ? \"bg-green-600 hover:bg-green-700\" : \n                              isPending ? \"bg-amber-500 hover:bg-amber-600 text-black\" : \"\"\n                            }`}\n                          >\n                            {isPending ? \"Pending\" : \n                             isWin ? \"Won\" : \n                             isLoss ? \"Lost\" : bet.result || \"Unknown\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className={isWin ? \"text-green-500 font-medium\" : \"\"}>\n                          {isWin ? `+${payout}` : `${payout}`}\n                        </TableCell>\n                        <TableCell className=\"font-mono\">\n                          {bet.balanceAfter ? (bet.balanceAfter / 100).toFixed(2) : \"N/A\"}\n                        </TableCell>\n                        <TableCell className=\"whitespace-nowrap\">\n                          {format(new Date(bet.createdAt), \"MMM d, h:mm a\")}\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                  {(recentBets as Game[]).length === 0 && (\n                    <TableRow>\n                      <TableCell colSpan={10} className=\"text-center py-8 text-muted-foreground\">\n                        No recent bets found. Place your first bet!\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Bet Confirmation Dialog */}\n      <Dialog open={confirmDialogOpen} onOpenChange={setConfirmDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Confirm Your Bet</DialogTitle>\n            <DialogDescription>\n              Please review your bet details before confirming.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-1\">\n                <h4 className=\"text-sm font-medium\">Market</h4>\n                <p className=\"text-sm text-muted-foreground\">{typedMarket.name}</p>\n              </div>\n              <div className=\"space-y-1\">\n                <h4 className=\"text-sm font-medium\">Game Mode</h4>\n                <p className=\"text-sm text-muted-foreground\">{GAME_MODES[selectedGameMode as keyof typeof GAME_MODES]}</p>\n              </div>\n              <div className=\"space-y-1\">\n                <h4 className=\"text-sm font-medium\">Prediction</h4>\n                <p className=\"text-sm text-muted-foreground\">{betDetails?.prediction}</p>\n              </div>\n              <div className=\"space-y-1\">\n                <h4 className=\"text-sm font-medium\">Bet Amount</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  {betDetails ? `${betDetails.betAmount.toFixed(2)}` : ''}\n                </p>\n              </div>\n              <div className=\"space-y-1\">\n                <h4 className=\"text-sm font-medium\">Potential Win</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  {betDetails ? `${calculatePotentialWin(selectedGameMode, betDetails.betAmount, gameOdds).toFixed(2)}` : ''}\n                </p>\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setConfirmDialogOpen(false)}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleConfirmBet} \n              disabled={placeBetMutation.isPending || placeMultipleBetsMutation.isPending}\n            >\n              {placeBetMutation.isPending || placeMultipleBetsMutation.isPending ? (\n                <>\n                  <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Placing Bet{selectedNumbers.size > 0 ? 's' : ''}...\n                </>\n              ) : (\n                \"Confirm Bet\"\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\n// Helper function to calculate potential win based on game mode\n// Function to calculate potential winnings based on current odds from the server\nfunction calculatePotentialWin(gameMode: string, betAmount: number, odds: Record<string, number> = {}): number {\n  // Default payout ratios based on the platform settings\n  let payoutRatio = 1;\n  \n  // Get the appropriate payout ratio from the database odds\n  console.log(`Game mode: ${gameMode}, Bet amount: ${betAmount}, Odds from database:`, odds);\n  \n  // The database stores values with multiplier * 10000\n  // For example, 60x is stored as 600000, 1.9x is stored as 19000\n  // We need to divide by 10000 to get the actual multiplier\n  switch (gameMode) {\n    case \"jodi\":\n      // Jodi payout (default 60x)\n      payoutRatio = odds.jodi ? (odds.jodi / 10000) : 60;\n      break;\n    case \"harf\":\n      // Harf payout (default 6x)\n      payoutRatio = odds.harf ? (odds.harf / 10000) : 6;\n      break;\n    case \"crossing\":\n      // Crossing payout (default 66x)\n      payoutRatio = odds.crossing ? (odds.crossing / 10000) : 66;\n      break;\n    case \"odd_even\":\n      // Odd/Even payout (default 1.9x)\n      payoutRatio = odds.odd_even ? (odds.odd_even / 10000) : 1.9;\n      break;\n  }\n  \n  console.log(`Game mode: ${gameMode}, Using payout ratio: ${payoutRatio}, Bet amount: ${betAmount}`);\n  \n  // Calculate the potential win amount \n  // For 100 bet on Jodi with 60x odds, win = 100  60 = 6,000\n  return betAmount * payoutRatio;\n}\n\n// Helper function to format game type for display\nfunction formatGameType(gameType: string): string {\n  switch (gameType) {\n    case \"satamatka\":\n      return \"Satamatka\";\n    case \"cricket_toss\":\n      return \"Cricket Toss\";\n    // team_match case removed\n    case \"coin_flip\":\n      return \"Coin Flip\";\n    default:\n      return gameType.charAt(0).toUpperCase() + gameType.slice(1).replace(/_/g, ' ');\n  }\n}","path":null,"size_bytes":73394,"size_tokens":null},"create-admin.js":{"content":"/**\n * Script to create an admin user\n */\nimport { pool, db } from './server/db.js';\nimport { users } from './shared/schema.js';\nimport bcrypt from 'bcrypt';\n\nasync function createAdmin() {\n  try {\n    console.log('Creating admin user...');\n    \n    // Check if admin already exists\n    const existingAdmin = await db.select().from(users).where({ username: 'admin' }).limit(1);\n    \n    if (existingAdmin.length > 0) {\n      console.log('Admin user already exists');\n      return;\n    }\n    \n    // Hash password\n    const saltRounds = 10;\n    const hashedPassword = await bcrypt.hash('admin123', saltRounds);\n    \n    // Insert admin user\n    const [admin] = await db.insert(users).values({\n      username: 'admin',\n      password: hashedPassword,\n      email: 'admin@example.com',\n      mobile: '1234567890',\n      role: 'admin'\n    }).returning();\n    \n    console.log('Admin user created successfully:', admin);\n  } catch (error) {\n    console.error('Error creating admin user:', error);\n  } finally {\n    // Close the database connection\n    await pool.end();\n  }\n}\n\ncreateAdmin();","path":null,"size_bytes":1086,"size_tokens":null},"fix-get-user.ts":{"content":"// This script fixes the storage implementation for getUser\nimport { db } from './server/db';\nimport { users, User } from './shared/schema';\nimport { eq } from 'drizzle-orm';\nimport fs from 'fs';\n\nasync function fixGetUser() {\n  try {\n    console.log(\"Fixing getUser method in storage.ts...\");\n    \n    // Read the storage.ts file\n    const storageFile = fs.readFileSync('./server/storage.ts', 'utf8');\n    \n    // Look for the getUser method\n    const getUserPattern = /async getUser\\([^)]*\\)[^{]*{[^}]*}/;\n    \n    // Check if we found the method\n    if (getUserPattern.test(storageFile)) {\n      console.log(\"Found getUser method in storage.ts\");\n      \n      // Create the replacement implementation\n      const replacement = `async getUser(id: number): Promise<User | undefined> {\n    const [user] = await db.select()\n      .from(users)\n      .where(eq(users.id, id))\n      .limit(1);\n    return user;\n  }`;\n      \n      // Replace the implementation\n      const updatedFile = storageFile.replace(getUserPattern, replacement);\n      \n      // Check if the file was updated\n      if (updatedFile !== storageFile) {\n        // Write the updated file\n        fs.writeFileSync('./server/storage.ts', updatedFile);\n        console.log(\"Updated getUser implementation in storage.ts\");\n      } else {\n        console.log(\"No changes were made to storage.ts\");\n      }\n    } else {\n      console.log(\"Could not find getUser method in storage.ts\");\n    }\n    \n    console.log(\"getUser implementation fix completed!\");\n  } catch (error) {\n    console.error(\"Error fixing getUser implementation:\", error);\n  } finally {\n    process.exit(0);\n  }\n}\n\nfixGetUser();","path":null,"size_bytes":1655,"size_tokens":null},"client/src/pages/wallet-page-broken.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Loader2, ArrowUp, ArrowDown, FileCheck, CheckCircle, XCircle, Clock, IndianRupee, Wallet, History, Ban, CheckCircle2, CircleDollarSign, Landmark, Banknote, RefreshCw, CreditCard, User, Copy, CheckCheck } from \"lucide-react\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { \n  Pagination, \n  PaginationContent, \n  PaginationEllipsis, \n  PaginationItem, \n  PaginationLink, \n  PaginationNext, \n  PaginationPrevious \n} from \"@/components/ui/pagination\";\nimport { formatDistance } from \"date-fns\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useLocation } from \"wouter\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { PaymentMode, RequestType, RequestStatus, WalletRequest, PaymentDetails } from \"@/lib/types\";\n\n// API response type for payment details\ninterface SystemPaymentDetails {\n  upi?: {\n    id: string;\n    qrCode: string | null;\n  };\n  bank?: {\n    name: string;\n    accountNumber: string;\n    ifscCode: string;\n    accountHolder: string;\n  };\n}\n\n// Form schemas\nconst depositFormSchema = z.object({\n  amount: z.coerce.number().min(100, \"Minimum deposit amount is 100\").max(100000, \"Maximum deposit amount is 100,000\"),\n  paymentMode: z.enum([\"upi\", \"bank\"]),\n  paymentDetails: z.object({\n    upiId: z.string().optional(),\n    transactionId: z.string().optional(),\n    utrNumber: z.string().optional(),\n    bankName: z.string().optional(),\n    accountNumber: z.string().optional(),\n    ifscCode: z.string().optional(),\n  }),\n  notes: z.string().optional(),\n});\n\nconst withdrawalFormSchema = z.object({\n  amount: z.coerce.number().min(500, \"Minimum withdrawal amount is 500\").max(50000, \"Maximum withdrawal amount is 50,000\"),\n  paymentMode: z.enum([\"upi\", \"bank\"]),\n  paymentDetails: z.object({\n    upiId: z.string().optional(),\n    bankName: z.string().optional(),\n    accountNumber: z.string().optional(),\n    ifscCode: z.string().optional(),\n  }),\n  notes: z.string().optional(),\n});\n\ntype DepositFormValues = z.infer<typeof depositFormSchema>;\ntype WithdrawalFormValues = z.infer<typeof withdrawalFormSchema>;\n\nexport default function WalletPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [location, setLocation] = useLocation();\n\n  // Initialize forms\n  const depositForm = useForm<DepositFormValues>({\n    resolver: zodResolver(depositFormSchema),\n    defaultValues: {\n      amount: 0,\n      paymentMode: \"upi\",\n      paymentDetails: {},\n      notes: \"\",\n    },\n  });\n\n  const withdrawalForm = useForm<WithdrawalFormValues>({\n    resolver: zodResolver(withdrawalFormSchema),\n    defaultValues: {\n      amount: 0,\n      paymentMode: \"upi\",\n      paymentDetails: {},\n      notes: \"\",\n    },\n  });\n  \n  // Extract tab parameter from URL or default to \"balance\"\n  const getTabFromUrl = () => {\n    const searchParams = new URLSearchParams(window.location.search);\n    const tab = searchParams.get('tab');\n    \n    // Check if user is a direct player (assigned to admin or null)\n    const isDirectPlayer = user?.role === \"player\" && (!user.assignedTo || user.assignedTo === 1);\n    \n    // Only direct players can access deposit/withdraw tabs\n    if (!isDirectPlayer && (tab === 'deposit' || tab === 'withdraw')) {\n      return 'balance';\n    }\n    \n    // Only allow valid tabs\n    return tab === 'deposit' || tab === 'withdraw' || tab === 'history' ? tab : 'balance';\n  };\n  \n  const [activeTab, setActiveTab] = useState(getTabFromUrl());\n  const [proofImage, setProofImage] = useState<File | null>(null);\n  const [paymentModeDetails, setPaymentModeDetails] = useState<PaymentDetails | null>(null);\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState(\"upi\");\n  const [currentPage, setCurrentPage] = useState(1);\n  const [itemsPerPage, setItemsPerPage] = useState(20);\n  const [copiedText, setCopiedText] = useState<string | null>(null);\n  \n  // Update URL when tab changes\n  const updateTab = (tab: string) => {\n    setActiveTab(tab);\n    // Update URL with tab parameter\n    const searchParams = new URLSearchParams(window.location.search);\n    searchParams.set('tab', tab);\n    const newUrl = `${window.location.pathname}?${searchParams.toString()}`;\n    window.history.replaceState(null, '', newUrl);\n  };\n\n  // Fetch payment details from the system\n  const { data: systemPaymentDetails, isLoading: loadingPaymentDetails } = useQuery<SystemPaymentDetails>({\n    queryKey: [\"/api/wallet/payment-details\"],\n    queryFn: async ({ queryKey }) => {\n      const res = await fetch(queryKey[0] as string, {\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        throw new Error(\"Failed to fetch payment details\");\n      }\n      const data = await res.json();\n      return data;\n    }\n  });\n  \n  // Set payment details when they are fetched\n  useEffect(() => {\n    if (systemPaymentDetails) {\n      // Transform the API response to match the expected structure\n      // Use exactly what the admin has set in payment settings\n      const transformedDetails: PaymentDetails = {\n        upiDetails: systemPaymentDetails.upi ? {\n          upiId: systemPaymentDetails.upi.id,\n          qrImageUrl: systemPaymentDetails.upi.qrCode || undefined\n        } : undefined,\n        bankDetails: systemPaymentDetails.bank ? {\n          accountName: systemPaymentDetails.bank.accountHolder,\n          accountNumber: systemPaymentDetails.bank.accountNumber,\n          ifscCode: systemPaymentDetails.bank.ifscCode,\n          bankName: systemPaymentDetails.bank.name\n        } : undefined\n      };\n      \n      setPaymentModeDetails(transformedDetails);\n    }\n  }, [systemPaymentDetails]);\n\n  // Fetch user's wallet requests\n  const { \n    data: walletRequests = [], \n    isLoading: loadingRequests,\n    refetch: refetchRequests\n  } = useQuery<WalletRequest[]>({\n    queryKey: [\"/api/wallet/my-requests\"],\n    enabled: activeTab === \"history\" || activeTab === \"balance\",\n  });\n  \n  // Fetch user's direct transactions (fund transfers, etc.)\n  const {\n    data: transactions = [],\n    isLoading: loadingTransactions,\n    refetch: refetchTransactions\n  } = useQuery<any[]>({\n    queryKey: [\"/api/transactions\"],\n    enabled: activeTab === \"history\" || activeTab === \"balance\"\n  });\n\n  // Deposit mutation\n  const depositMutation = useMutation({\n    mutationFn: async (values: DepositFormValues) => {\n      let proofImageUrl = \"\";\n      \n      if (proofImage) {\n        proofImageUrl = await uploadProofImage(proofImage);\n      }\n\n      const response = await apiRequest(\"/api/wallet/deposit\", \"POST\", {\n        ...values,\n        proofImageUrl,\n      });\n      \n      return response;\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Deposit Request Submitted\",\n        description: \"Your deposit request has been submitted successfully and is pending approval.\",\n      });\n      depositForm.reset();\n      setProofImage(null);\n      refetchRequests();\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet/my-requests\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Deposit Failed\",\n        description: error.message || \"Failed to submit deposit request\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Withdrawal mutation\n  const withdrawalMutation = useMutation({\n    mutationFn: async (values: WithdrawalFormValues) => {\n      const response = await apiRequest(\"/api/wallet/withdrawal\", \"POST\", values);\n      \n      return response;\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Withdrawal Request Submitted\",\n        description: \"Your withdrawal request has been submitted successfully and is pending approval.\",\n      });\n      withdrawalForm.reset();\n      refetchRequests();\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet/my-requests\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Withdrawal Failed\",\n        description: error.message || \"Failed to submit withdrawal request\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // File upload handler\n  const handleProofImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      setProofImage(e.target.files[0]);\n    }\n  };\n\n  // Upload proof image\n  const uploadProofImage = async (file: File): Promise<string> => {\n    const formData = new FormData();\n    formData.append(\"proofImage\", file);\n\n    try {\n      const res = await fetch('/api/upload/proof', {\n        method: 'POST',\n        body: formData\n      });\n\n      if (!res.ok) {\n        throw new Error(\"Failed to upload image\");\n      }\n\n      const data = await res.json();\n      return data.imageUrl;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  // Copy to clipboard function\n  const copyToClipboard = async (text: string, label: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopiedText(label);\n      toast({\n        title: \"Copied!\",\n        description: `${label} copied to clipboard`,\n      });\n      // Reset copied state after 2 seconds\n      setTimeout(() => setCopiedText(null), 2000);\n    } catch (error) {\n      toast({\n        title: \"Copy Failed\",\n        description: \"Unable to copy to clipboard\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  // Format date for display\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-IN', {\n      day: '2-digit',\n      month: 'short',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  // Get title and icon for request type\n  const getRequestTypeInfo = (type: RequestType) => {\n    switch (type) {\n      case RequestType.DEPOSIT:\n        return { \n          title: \"Deposit\", \n          icon: <ArrowDown className=\"h-5 w-5 text-green-600\" />\n        };\n      case RequestType.WITHDRAWAL:\n        return { \n          title: \"Withdrawal\", \n          icon: <ArrowUp className=\"h-5 w-5 text-blue-600\" />\n        };\n      default:\n        return { \n          title: \"Unknown\", \n          icon: null\n        };\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold\">Wallet</h1>\n          <p className=\"text-muted-foreground\">Manage your account balance and transactions</p>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={updateTab}>\n          {(() => {\n            // Check if user is a direct player (assigned to admin or null)\n            const isDirectPlayer = user?.role === \"player\" && (!user.assignedTo || user.assignedTo === 1);\n            \n            if (isDirectPlayer) {\n              return (\n                <TabsList className=\"grid w-full grid-cols-4 mb-8\">\n                  <TabsTrigger value=\"balance\">Balance</TabsTrigger>\n                  <TabsTrigger value=\"deposit\">Deposit</TabsTrigger>\n                  <TabsTrigger value=\"withdraw\">Withdraw</TabsTrigger>\n                  <TabsTrigger value=\"history\">History</TabsTrigger>\n                </TabsList>\n              );\n            } else {\n              return (\n                <TabsList className=\"grid w-full grid-cols-2 mb-8\">\n                  <TabsTrigger value=\"balance\">Balance</TabsTrigger>\n                  <TabsTrigger value=\"history\">History</TabsTrigger>\n                </TabsList>\n              );\n            }\n          })()}\n\n          <TabsContent value=\"balance\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <Wallet className=\"h-5 w-5 mr-2\" />\n                  Current Balance\n                </CardTitle>\n                <CardDescription>\n                  Your available account balance\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-3xl font-bold text-primary\">\n                  {user ? (user.balance / 100).toFixed(2) : '0.00'}\n                </div>\n              </CardContent>\n              <CardFooter>\n                <Button variant=\"outline\" className=\"w-full\" onClick={() => updateTab(\"history\")}>\n                  View All Transactions\n                </Button>\n              </CardFooter>\n            </Card>\n          </TabsContent>\n\n          {/* Deposit Tab */}\n          <TabsContent value=\"deposit\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Add Funds</CardTitle>\n                <CardDescription>\n                  Deposit money into your account\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Form {...depositForm}>\n                  <form onSubmit={depositForm.handleSubmit((values) => depositMutation.mutate(values))} className=\"space-y-6\">\n                    <FormField\n                      control={depositForm.control}\n                      name=\"amount\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Amount ()</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              placeholder=\"Enter amount (min 100)\"\n                              min=\"100\"\n                              max=\"100000\"\n                              {...field}\n                              onChange={(e) => field.onChange(parseFloat(e.target.value) || 0)}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    \n                    <FormField\n                      control={depositForm.control}\n                      name=\"paymentMode\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Payment Method</FormLabel>\n                          <FormControl>\n                            <RadioGroup \n                              value={field.value} \n                              onValueChange={(value) => {\n                                field.onChange(value);\n                                setSelectedPaymentMethod(value);\n                              }}\n                            >\n                              <div className=\"flex items-center space-x-2\">\n                                <RadioGroupItem value=\"upi\" id=\"deposit-upi\" />\n                                <Label htmlFor=\"deposit-upi\">UPI Payment</Label>\n                              </div>\n                              <div className=\"flex items-center space-x-2\">\n                                <RadioGroupItem value=\"bank\" id=\"deposit-bank\" />\n                                <Label htmlFor=\"deposit-bank\">Bank Transfer</Label>\n                              </div>\n                            </RadioGroup>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                  {/* UPI Payment Details */}\n                  {selectedPaymentMethod === \"upi\" && paymentModeDetails?.upiDetails && (\n                    <div className=\"p-4 border rounded-lg bg-muted/50\">\n                      <h4 className=\"font-medium mb-3\">UPI Payment Details</h4>\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border\">\n                          <div>\n                            <span className=\"text-sm text-muted-foreground\">Pay to: </span>\n                            <span className=\"font-mono font-medium\">{paymentModeDetails.upiDetails.upiId}</span>\n                          </div>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => copyToClipboard(paymentModeDetails.upiDetails!.upiId, \"UPI ID\")}\n                            className=\"gap-2\"\n                          >\n                            {copiedText === \"UPI ID\" ? (\n                              <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                            ) : (\n                              <Copy className=\"h-4 w-4\" />\n                            )}\n                            Copy\n                          </Button>\n                        </div>\n                        \n                        {paymentModeDetails.upiDetails.qrImageUrl && (\n                          <div className=\"text-center\">\n                            <p className=\"text-sm text-muted-foreground mb-2\">Scan QR Code:</p>\n                            <img \n                              src={paymentModeDetails.upiDetails.qrImageUrl} \n                              alt=\"QR Code\" \n                              className=\"w-40 h-40 mx-auto border rounded-lg\"\n                            />\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Bank Transfer Details */}\n                  {selectedPaymentMethod === \"bank\" && paymentModeDetails?.bankDetails && (\n                    <div className=\"p-4 border rounded-lg bg-muted/50\">\n                      <h4 className=\"font-medium mb-3\">Bank Transfer Details</h4>\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border\">\n                          <div>\n                            <span className=\"text-sm text-muted-foreground\">Bank Name: </span>\n                            <span className=\"font-medium\">{paymentModeDetails.bankDetails.bankName}</span>\n                          </div>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => copyToClipboard(paymentModeDetails.bankDetails!.bankName, \"Bank Name\")}\n                            className=\"gap-2\"\n                          >\n                            {copiedText === \"Bank Name\" ? (\n                              <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                            ) : (\n                              <Copy className=\"h-4 w-4\" />\n                            )}\n                            Copy\n                          </Button>\n                        </div>\n                        \n                        <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border\">\n                          <div>\n                            <span className=\"text-sm text-muted-foreground\">Account Holder: </span>\n                            <span className=\"font-medium\">{paymentModeDetails.bankDetails.accountName}</span>\n                          </div>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => copyToClipboard(paymentModeDetails.bankDetails!.accountName, \"Account Holder\")}\n                            className=\"gap-2\"\n                          >\n                            {copiedText === \"Account Holder\" ? (\n                              <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                            ) : (\n                              <Copy className=\"h-4 w-4\" />\n                            )}\n                            Copy\n                          </Button>\n                        </div>\n                        \n                        <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border\">\n                          <div>\n                            <span className=\"text-sm text-muted-foreground\">Account Number: </span>\n                            <span className=\"font-mono font-medium\">{paymentModeDetails.bankDetails.accountNumber}</span>\n                          </div>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => copyToClipboard(paymentModeDetails.bankDetails!.accountNumber, \"Account Number\")}\n                            className=\"gap-2\"\n                          >\n                            {copiedText === \"Account Number\" ? (\n                              <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                            ) : (\n                              <Copy className=\"h-4 w-4\" />\n                            )}\n                            Copy\n                          </Button>\n                        </div>\n                        \n                        <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border\">\n                          <div>\n                            <span className=\"text-sm text-muted-foreground\">IFSC Code: </span>\n                            <span className=\"font-mono font-medium\">{paymentModeDetails.bankDetails.ifscCode}</span>\n                          </div>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => copyToClipboard(paymentModeDetails.bankDetails!.ifscCode, \"IFSC Code\")}\n                            className=\"gap-2\"\n                          >\n                            {copiedText === \"IFSC Code\" ? (\n                              <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                            ) : (\n                              <Copy className=\"h-4 w-4\" />\n                            )}\n                            Copy\n                          </Button>\n                        </div>\n                        \n                        <div className=\"mt-3 p-3 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800\">\n                          <div className=\"flex items-center justify-between\">\n                            <div>\n                              <p className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">Complete Bank Details</p>\n                              <p className=\"text-xs text-blue-700 dark:text-blue-300\">Copy all details at once</p>\n                            </div>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => {\n                                const allDetails = `Bank Name: ${paymentModeDetails.bankDetails!.bankName}\nAccount Holder: ${paymentModeDetails.bankDetails!.accountName}\nAccount Number: ${paymentModeDetails.bankDetails!.accountNumber}\nIFSC Code: ${paymentModeDetails.bankDetails!.ifscCode}`;\n                                copyToClipboard(allDetails, \"All Bank Details\");\n                              }}\n                              className=\"gap-2\"\n                            >\n                              {copiedText === \"All Bank Details\" ? (\n                                <CheckCheck className=\"h-4 w-4 text-green-500\" />\n                              ) : (\n                                <Copy className=\"h-4 w-4\" />\n                              )}\n                              Copy All\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                    <FormField\n                      control={depositForm.control}\n                      name=\"paymentDetails.transactionId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Transaction ID</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"Enter your transaction ID\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"proof-upload\">Payment Proof (Screenshot)</Label>\n                      <Input \n                        id=\"proof-upload\"\n                        type=\"file\" \n                        accept=\"image/*\"\n                        onChange={handleProofImageChange}\n                      />\n                      {proofImage && (\n                        <p className=\"text-sm text-muted-foreground\">\n                          Selected: {proofImage.name}\n                        </p>\n                      )}\n                    </div>\n\n                    <FormField\n                      control={depositForm.control}\n                      name=\"notes\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Notes (Optional)</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"Add any additional notes\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full\" \n                      disabled={depositMutation.isPending}\n                    >\n                      {depositMutation.isPending ? (\n                        <>\n                          <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                          Submitting...\n                        </>\n                      ) : (\n                        \"Submit Deposit Request\"\n                      )}\n                    </Button>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Withdraw Tab */}\n          <TabsContent value=\"withdraw\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Withdraw Funds</CardTitle>\n                <CardDescription>\n                  Withdraw money from your account\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"mb-6 p-4 rounded-lg bg-muted/50\">\n                  <div className=\"flex items-center gap-3 mb-2\">\n                    <div className=\"p-2 rounded-full bg-primary\">\n                      <IndianRupee className=\"h-4 w-4 text-primary-foreground\" />\n                    </div>\n                    <h3 className=\"text-lg font-semibold\">Your balance: {user?.balance ? (user.balance / 100).toFixed(2) : '0.00'}</h3>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Minimum withdrawal amount is 500. Maximum is 50,000.\n                  </p>\n                </div>\n\n                <form className=\"space-y-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"withdraw-amount\">Amount ()</Label>\n                    <Input \n                      id=\"withdraw-amount\"\n                      type=\"number\" \n                      placeholder=\"Enter amount (min 500)\" \n                      min=\"500\"\n                      max=\"50000\"\n                    />\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    <Label>Withdrawal Method</Label>\n                    <RadioGroup defaultValue=\"upi\">\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"upi\" id=\"withdraw-upi\" />\n                        <Label htmlFor=\"withdraw-upi\">UPI</Label>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"bank\" id=\"withdraw-bank\" />\n                        <Label htmlFor=\"withdraw-bank\">Bank Transfer</Label>\n                      </div>\n                    </RadioGroup>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"upi-id\">UPI ID</Label>\n                    <Input \n                      id=\"upi-id\"\n                      placeholder=\"your-upi@bank\" \n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"withdraw-notes\">Notes (Optional)</Label>\n                    <Input \n                      id=\"withdraw-notes\"\n                      placeholder=\"Any additional information\" \n                    />\n                  </div>\n\n                  <Button className=\"w-full\">\n                    Submit Withdrawal Request\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* History Tab */}\n          <TabsContent value=\"history\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <div>\n                  <CardTitle>Transaction History</CardTitle>\n                  <CardDescription>\n                    All your wallet transactions with running balance\n                  </CardDescription>\n                </div>\n              </CardHeader>\n              \n              <CardContent className=\"pt-4\">\n                {(loadingRequests || loadingTransactions) ? (\n                  <div className=\"flex justify-center py-8\">\n                    <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                  </div>\n                ) : (walletRequests.length === 0 && transactions.length === 0) ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <p>No transaction history found.</p>\n                  </div>\n                ) : (\n                  <>\n                    {/* Mobile-optimized transaction table */}\n                    {(() => {\n                      // Combine and sort all transactions by date (newest first)\n                      const allTransactions = [\n                        ...walletRequests.map(request => ({\n                          id: `req-${request.id}`,\n                          isRequest: true,\n                          createdAt: request.createdAt,\n                          data: request\n                        })),\n                        ...transactions.map(tx => ({\n                          id: `tx-${tx.id}`,\n                          isRequest: false,\n                          createdAt: tx.createdAt,\n                          data: tx\n                        }))\n                      ].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n                      \n                      // Pagination\n                      const totalItems = allTransactions.length;\n                      const totalPages = Math.ceil(totalItems / itemsPerPage);\n                      const startIndex = (currentPage - 1) * itemsPerPage;\n                      const currentItems = allTransactions.slice(startIndex, startIndex + itemsPerPage);\n                      \n                      return (\n                        <>\n                          {/* Enhanced Transaction Table with Full Details */}\n                          <div className=\"overflow-x-auto\">\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  <TableHead className=\"w-[120px]\">Date & Time</TableHead>\n                                  <TableHead>Transaction Details</TableHead>\n                                  <TableHead className=\"text-right\">Amount</TableHead>\n                                  <TableHead className=\"text-right\">Balance After</TableHead>\n                                  <TableHead className=\"w-[100px]\">Status</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {(() => {\n                                  // Calculate running balance for transactions displayed on current page\n                                  let currentBalance = user?.balance || 0;\n                                  \n                                  // First, calculate the starting balance for this page by working backwards from current balance\n                                  // through all transactions before the current page\n                                  const transactionsBeforePage = allTransactions.slice(0, startIndex);\n                                  let balanceAtPageStart = currentBalance;\n                                  \n                                  for (let i = 0; i < transactionsBeforePage.length; i++) {\n                                    const item = transactionsBeforePage[i];\n                                    if (item.isRequest) {\n                                      const request = item.data as WalletRequest;\n                                      if (request.status === RequestStatus.APPROVED) {\n                                        const amount = request.requestType === RequestType.DEPOSIT ? request.amount * 100 : -request.amount * 100;\n                                        balanceAtPageStart -= amount;\n                                      }\n                                    } else {\n                                      const transaction = item.data;\n                                      balanceAtPageStart -= transaction.amount;\n                                    }\n                                  }\n                                  \n                                  // Now render each transaction with correct balance\n                                  let runningBalance = balanceAtPageStart;\n                                  \n                                  return currentItems.map((item, pageIndex) => {\n                                    let balanceAfter = runningBalance;\n                                    \n                                    if (item.isRequest) {\n                                      // Wallet request\n                                      const request = item.data as WalletRequest;\n                                      const { title } = getRequestTypeInfo(request.requestType as RequestType);\n                                      \n                                      // Calculate balance after this transaction\n                                      if (request.status === RequestStatus.APPROVED) {\n                                        const amount = request.requestType === RequestType.DEPOSIT ? request.amount * 100 : -request.amount * 100;\n                                        balanceAfter = runningBalance + amount;\n                                        runningBalance = balanceAfter;\n                                      }\n                                      \n                                      return (\n                                        <TableRow key={item.id}>\n                                          <TableCell className=\"text-sm\">\n                                            <div className=\"flex flex-col\">\n                                              <span className=\"font-medium\">{formatDate(request.createdAt).split(' ')[0]}</span>\n                                              <span className=\"text-xs text-muted-foreground\">\n                                                {formatDate(request.createdAt).split(' ').slice(1).join(' ')}\n                                              </span>\n                                            </div>\n                                          </TableCell>\n                                          <TableCell>\n                                            <div className=\"flex flex-col space-y-1\">\n                                              <span className=\"font-medium text-sm\">{title} Request</span>\n                                              <div className=\"flex items-center gap-2\">\n                                                <Badge variant=\"outline\" className=\"text-xs\">\n                                                  {request.paymentMode}\n                                                </Badge>\n                                              </div>\n                                              {request.reviewedBy && (\n                                                <span className=\"text-xs text-muted-foreground\">\n                                                  Reviewed by Admin\n                                                </span>\n                                              )}\n                                              {request.notes && (\n                                                <span className=\"text-xs text-muted-foreground\">\n                                                  {request.notes}\n                                                </span>\n                                              )}\n                                            </div>\n                                          </TableCell>\n                                          <TableCell className=\"text-right\">\n                                            <span className={\n                                              request.requestType === RequestType.DEPOSIT \n                                                ? \"text-green-600 font-medium\" \n                                                : \"text-red-600 font-medium\"\n                                            }>\n                                              {request.requestType === RequestType.DEPOSIT ? '+' : '-'}\n                                              {request.amount.toFixed(2)}\n                                            </span>\n                                          </TableCell>\n                                          <TableCell className=\"text-right\">\n                                            <span className=\"font-medium text-primary\">\n                                              {request.status === RequestStatus.APPROVED ? \n                                                `${(balanceAfter / 100).toFixed(2)}` : \n                                                '-'\n                                              }\n                                            </span>\n                                          </TableCell>\n                                          <TableCell>\n                                            <Badge \n                                              variant={\n                                                request.status === RequestStatus.APPROVED \n                                                  ? \"default\" \n                                                  : request.status === RequestStatus.REJECTED \n                                                    ? \"destructive\" \n                                                    : \"secondary\"\n                                              }\n                                              className=\"text-xs\"\n                                            >\n                                              {request.status}\n                                            </Badge>\n                                          </TableCell>\n                                        </TableRow>\n                                      );\n                                    } else {\n                                      // Direct transaction\n                                      const transaction = item.data;\n                                      \n                                      // Update running balance\n                                      balanceAfter = runningBalance + transaction.amount;\n                                      runningBalance = balanceAfter;\n                                      \n                                      return (\n                                        <TableRow key={item.id}>\n                                          <TableCell className=\"text-sm\">\n                                            <div className=\"flex flex-col\">\n                                              <span className=\"font-medium\">{formatDate(transaction.createdAt).split(' ')[0]}</span>\n                                              <span className=\"text-xs text-muted-foreground\">\n                                                {formatDate(transaction.createdAt).split(' ').slice(1).join(' ')}\n                                              </span>\n                                            </div>\n                                          </TableCell>\n                                          <TableCell>\n                                            <div className=\"flex flex-col space-y-1\">\n                                              <span className=\"font-medium text-sm\">\n                                                {transaction.amount > 0 ? \"Funds Added\" : \"Funds Deducted\"}\n                                              </span>\n                                              <span className=\"text-xs text-muted-foreground\">\n                                                {transaction.description || \"Balance update\"}\n                                              </span>\n                                              {transaction.performer && (\n                                                <div className=\"flex items-center gap-1\">\n                                                  <User className=\"h-3 w-3\" />\n                                                  <span className=\"text-xs text-muted-foreground\">\n                                                    by {transaction.performer.username} ({transaction.performer.role})\n                                                  </span>\n                                                </div>\n                                              )}\n                                            </div>\n                                          </TableCell>\n                                          <TableCell className=\"text-right\">\n                                            <span className={transaction.amount > 0 ? \"text-green-600 font-medium\" : \"text-red-600 font-medium\"}>\n                                              {transaction.amount > 0 ? '+' : ''}\n                                              {(Math.abs(transaction.amount) / 100).toFixed(2)}\n                                            </span>\n                                          </TableCell>\n                                          <TableCell className=\"text-right\">\n                                            <span className=\"font-medium text-primary\">\n                                              {(balanceAfter / 100).toFixed(2)}\n                                            </span>\n                                          </TableCell>\n                                          <TableCell>\n                                            <Badge variant=\"default\" className=\"text-xs\">\n                                              Complete\n                                            </Badge>\n                                          </TableCell>\n                                        </TableRow>\n                                      );\n                                    }\n                                  });\n                                })()}\n                              </TableBody>\n                            </Table>\n                          </div>\n                          \n                          {/* Pagination */}\n                          {totalPages > 1 && (\n                            <div className=\"mt-6 flex justify-center\">\n                              <Pagination>\n                                <PaginationContent>\n                                  <PaginationItem>\n                                    <PaginationPrevious \n                                      onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                                      className={currentPage === 1 ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"}\n                                    />\n                                  </PaginationItem>\n                                  \n                                  {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n                                    const pageNum = i + 1;\n                                    return (\n                                      <PaginationItem key={pageNum}>\n                                        <PaginationLink\n                                          onClick={() => setCurrentPage(pageNum)}\n                                          isActive={currentPage === pageNum}\n                                          className=\"cursor-pointer\"\n                                        >\n                                          {pageNum}\n                                        </PaginationLink>\n                                      </PaginationItem>\n                                    );\n                                  })}\n                                  \n                                  <PaginationItem>\n                                    <PaginationNext \n                                      onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}\n                                      className={currentPage === totalPages ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"}\n                                    />\n                                  </PaginationItem>\n                                </PaginationContent>\n                              </Pagination>\n                            </div>\n                          )}\n                        </>\n                      );\n                    })()}\n                  </>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":47300,"size_tokens":null},"client/src/components/home/HeroSlider.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { ChevronLeft, ChevronRight } from 'lucide-react';\nimport { useQuery } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\n\ntype HeroImage = {\n  filename: string;\n  url: string;\n};\n\nexport function HeroSlider() {\n  const [currentIndex, setCurrentIndex] = useState(0);\n  \n  // Fetch hero slider images\n  const { data: heroImages = [] } = useQuery<HeroImage[]>({\n    queryKey: ['/api/herosliders'],\n    queryFn: () => apiRequest('GET', '/api/herosliders')\n      .then(res => res.json()),\n  });\n  \n  // Reset current index when images change\n  useEffect(() => {\n    if (heroImages.length > 0 && currentIndex >= heroImages.length) {\n      setCurrentIndex(0);\n    }\n  }, [heroImages, currentIndex]);\n  \n  // Auto-advance slides every 5 seconds\n  useEffect(() => {\n    if (heroImages.length <= 1) return;\n    \n    const interval = setInterval(() => {\n      setCurrentIndex(prev => (prev + 1) % heroImages.length);\n    }, 5000);\n    \n    return () => clearInterval(interval);\n  }, [heroImages.length]);\n  \n  const goToPrevSlide = () => {\n    setCurrentIndex(prev => \n      prev === 0 ? heroImages.length - 1 : prev - 1\n    );\n  };\n  \n  const goToNextSlide = () => {\n    setCurrentIndex(prev => \n      (prev + 1) % heroImages.length\n    );\n  };\n  \n  // If no images, don't render anything\n  if (heroImages.length === 0) {\n    return null;\n  }\n  \n  return (\n    <div className=\"relative w-full overflow-hidden rounded-lg\">\n      {/* Hero image slider */}\n      <div className=\"relative w-full h-[300px] md:h-[450px]\">\n        {heroImages.map((image, index) => (\n          <div\n            key={image.filename}\n            className={`absolute top-0 left-0 w-full h-full transition-opacity duration-500 ease-in-out ${\n              index === currentIndex ? 'opacity-100 z-10' : 'opacity-0 z-0'\n            }`}\n          >\n            <img\n              src={image.url}\n              alt=\"Hero banner\"\n              className=\"w-full h-full object-cover\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent\" />\n          </div>\n        ))}\n      </div>\n      \n      {/* Navigation buttons (only if more than one image) */}\n      {heroImages.length > 1 && (\n        <>\n          <button\n            onClick={goToPrevSlide}\n            className=\"absolute top-1/2 left-4 z-20 -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white p-2 rounded-full transition-colors\"\n            aria-label=\"Previous slide\"\n          >\n            <ChevronLeft className=\"h-6 w-6\" />\n          </button>\n          <button\n            onClick={goToNextSlide}\n            className=\"absolute top-1/2 right-4 z-20 -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white p-2 rounded-full transition-colors\"\n            aria-label=\"Next slide\"\n          >\n            <ChevronRight className=\"h-6 w-6\" />\n          </button>\n          \n          {/* Indicator dots */}\n          <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 z-20 flex space-x-2\">\n            {heroImages.map((_, index) => (\n              <button\n                key={index}\n                onClick={() => setCurrentIndex(index)}\n                className={`w-2.5 h-2.5 rounded-full transition-colors ${\n                  index === currentIndex ? 'bg-white' : 'bg-white/50'\n                }`}\n                aria-label={`Go to slide ${index + 1}`}\n              />\n            ))}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}","path":null,"size_bytes":3520,"size_tokens":null},"clear-satamatka-data.js":{"content":"/**\n * This script removes all Satamatka market data from the database,\n * including all related games. This allows admins to start fresh\n * with manual market creation.\n */\n\nimport 'dotenv/config';\nimport pg from 'pg';\nconst { Pool } = pg;\n\nasync function connectToDatabase() {\n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n  });\n  \n  try {\n    const client = await pool.connect();\n    console.log('Connected to database');\n    return client;\n  } catch (err) {\n    console.error('Error connecting to database:', err);\n    process.exit(1);\n  }\n}\n\nasync function removeSatamatkaData(client) {\n  try {\n    // Start transaction\n    await client.query('BEGIN');\n    \n    // First, get all market IDs\n    const marketResult = await client.query('SELECT id FROM satamatka_markets');\n    const marketIds = marketResult.rows.map(row => row.id);\n    \n    console.log(`Found ${marketIds.length} Satamatka markets to remove`);\n    \n    if (marketIds.length > 0) {\n      // Remove all games related to Satamatka markets\n      const gameDeleteResult = await client.query(\n        'DELETE FROM games WHERE market_id IN (SELECT id FROM satamatka_markets)'\n      );\n      console.log(`Deleted ${gameDeleteResult.rowCount} Satamatka game entries`);\n      \n      // Remove all Satamatka markets\n      const marketDeleteResult = await client.query('DELETE FROM satamatka_markets');\n      console.log(`Deleted ${marketDeleteResult.rowCount} Satamatka markets`);\n    } else {\n      console.log('No Satamatka markets found to delete');\n    }\n    \n    // Commit transaction\n    await client.query('COMMIT');\n    console.log('Successfully removed all Satamatka market data');\n    \n  } catch (err) {\n    // Roll back transaction in case of error\n    await client.query('ROLLBACK');\n    console.error('Error removing Satamatka data:', err);\n    throw err;\n  }\n}\n\nasync function main() {\n  let client;\n  try {\n    client = await connectToDatabase();\n    await removeSatamatkaData(client);\n    console.log('Operation completed successfully');\n  } catch (err) {\n    console.error('An error occurred:', err);\n  } finally {\n    if (client) {\n      client.release();\n      console.log('Database connection released');\n    }\n    process.exit(0);\n  }\n}\n\nmain();","path":null,"size_bytes":2255,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { setupAuth, requireRole } from \"./auth\";\nimport { storage } from \"./storage\";\nimport { db } from \"./db\";\nimport { z } from \"zod\";\nimport { getAdminRiskManagement, getSubadminRiskManagement } from \"./risk-management\";\nimport { fixCrossingBets } from \"./fix-crossing-bets\";\n\nimport { \n  GameOutcome, \n  GameType,\n  MarketType, \n  SatamatkaGameMode,\n  TeamMatchResult,\n  MatchCategory,\n  insertGameSchema, \n  insertTransactionSchema, \n  insertSatamatkaMarketSchema,\n  insertTeamMatchSchema,\n  UserRole,\n  games,\n  transactions,\n  users\n} from \"@shared/schema\";\nimport { eq, and, gte, desc, ne } from \"drizzle-orm\";\nimport * as schema from \"@shared/schema\";\nimport { setupWalletRoutes } from \"./wallet-system\";\nimport { setupUploadRoutes } from \"./upload-routes\";\nimport { setupDepositCommissionEndpoints } from \"./deposit-commission-endpoint\";\nimport depositDiscountRouter from \"./deposit-discount-endpoint\";\nimport cricketTossRoutes from \"./cricket-toss-api\";\nimport resetSystemRoutes from \"./reset-system\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Setup authentication routes\n  setupAuth(app);\n  \n  // Setup wallet routes for deposits and withdrawals\n  setupWalletRoutes(app);\n  \n  // Setup deposit commission management endpoints (consolidated implementation)\n  setupDepositCommissionEndpoints(app);\n  \n  // Setup file upload routes\n  setupUploadRoutes(app);\n  \n  // Setup reset system routes\n  app.use(\"/api/admin\", resetSystemRoutes);\n  \n  // Public API endpoints (no authentication required)\n  \n  // Get public market results (accessible without authentication)\n  app.get(\"/api/public/market-results\", async (req, res, next) => {\n    try {\n      const { limit = 20, date } = req.query;\n      \n      let markets;\n      if (date) {\n        // Filter by specific date\n        const targetDate = new Date(date as string);\n        const startOfDay = new Date(targetDate);\n        startOfDay.setHours(0, 0, 0, 0);\n        const endOfDay = new Date(targetDate);\n        endOfDay.setHours(23, 59, 59, 999);\n        \n        markets = await storage.getMarketResultsByDateRange(startOfDay, endOfDay);\n      } else {\n        // Get recent results\n        markets = await storage.getRecentMarketResults(Number(limit));\n      }\n      \n      // Format for public display - show all resulted markets regardless of result values\n      const publicResults = markets.map(market => ({\n          id: market.id,\n          name: market.name,\n          type: market.type,\n          openResult: market.openResult,\n          closeResult: market.closeResult,\n          status: market.status,\n          openTime: market.openTime,\n          closeTime: market.closeTime,\n          resultTime: market.resultTime,\n          createdAt: market.createdAt\n        }));\n        \n      res.json(publicResults);\n    } catch (err) {\n      console.error('Error in public market results API:', err);\n      res.status(500).json({ error: 'Failed to fetch market results' });\n    }\n  });\n\n  // Get today's market results (public)\n  app.get(\"/api/public/market-results/today\", async (req, res, next) => {\n    try {\n      const today = new Date();\n      const startOfDay = new Date(today);\n      startOfDay.setHours(0, 0, 0, 0);\n      const endOfDay = new Date(today);\n      endOfDay.setHours(23, 59, 59, 999);\n      \n      const markets = await storage.getMarketResultsByDateRange(startOfDay, endOfDay);\n      \n      const todayResults = markets\n        .filter(market => market.status === 'resulted' && \n          (market.openResult || market.closeResult))\n        .map(market => ({\n          id: market.id,\n          name: market.name,\n          type: market.type,\n          openResult: market.openResult,\n          closeResult: market.closeResult,\n          status: market.status,\n          openTime: market.openTime,\n          closeTime: market.closeTime,\n          resultTime: market.resultTime,\n          createdAt: market.createdAt\n        }));\n        \n      res.json(todayResults);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Setup risk management routes\n  app.get('/api/risk/admin', requireRole(UserRole.ADMIN), getAdminRiskManagement);\n  app.get('/api/risk/subadmin', requireRole(UserRole.SUBADMIN), getSubadminRiskManagement);\n  \n  // Setup cricket toss routes - registered later in the file\n  // (see line ~3277 where it's properly registered)\n  \n  // Endpoint to manually seed demo Satamatka markets\n  app.post(\"/api/admin/seed-satamatka-markets\", requireRole(UserRole.ADMIN), async (req, res, next) => {\n    try {\n      await storage.seedDemoSatamatkaMarkets();\n      res.status(200).json({ message: \"Demo Satamatka markets seeded successfully\" });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // Game routes\n  app.post(\"/api/games\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      if (req.user!.isBlocked) {\n        return res.status(403).json({ message: \"Your account is blocked\" });\n      }\n\n      const gameData = insertGameSchema.parse({\n        userId: req.user!.id,\n        gameType: req.body.gameType || GameType.COIN_FLIP,\n        betAmount: req.body.betAmount,\n        prediction: req.body.prediction,\n        result: req.body.result,\n        payout: req.body.payout,\n        marketId: req.body.marketId,\n        gameMode: req.body.gameMode,\n      });\n\n      // Verify user has enough balance\n      const user = await storage.getUser(req.user!.id);\n      if (!user || user.balance < gameData.betAmount) {\n        return res.status(400).json({ message: \"Insufficient balance\" });\n      }\n\n      // Update user balance based on the payout\n      const newBalance = user.balance - gameData.betAmount + gameData.payout;\n      await storage.updateUserBalance(user.id, newBalance);\n\n      // Record the game\n      const game = await storage.createGame(gameData);\n      res.status(201).json(game);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Helper function to format game type for display\nfunction formatGameType(gameType: string): string {\n  switch(gameType) {\n    case 'coin_flip': return 'Coin Flip';\n    case 'satamatka': return 'Satamatka';\n    case 'team_match': return 'Team Match';\n    case 'cricket_toss': return 'Cricket Toss';\n    default: return gameType.replace(/_/g, ' ');\n  }\n}\n\n// New endpoint to get top winners from all games\napp.get(\"/api/games/top-winners\", async (req, res, next) => {\n  try {\n    // This endpoint is public - no authentication required\n    \n    // Query games with positive payouts and join with user data\n    const limit = req.query.limit ? parseInt(req.query.limit as string) : 10;\n    const games = await db.query.games.findMany({\n      where: (games, { gt }) => gt(games.payout, 0),\n      with: {\n        user: {\n          columns: {\n            username: true\n          }\n        }\n      },\n      orderBy: (games, { desc }) => [desc(games.payout)],\n      limit\n    });\n    \n    // Transform into the expected format for the client\n    const winners = games.map(game => ({\n      id: game.id,\n      username: game.user.username,\n      game: formatGameType(game.gameType),\n      amount: game.betAmount,\n      payout: game.payout,\n      createdAt: game.createdAt\n    }));\n    \n    res.json(winners);\n  } catch (err) {\n    next(err);\n  }\n});\n\n// Endpoint to get leaderboard data\napp.get(\"/api/leaderboard\", async (req, res, next) => {\n  try {\n    // This endpoint is public - no authentication required\n    \n    // Get query parameters\n    const timeFrame = req.query.timeFrame as string || 'all-time';\n    const sortBy = req.query.sortBy as string || 'totalWinnings';\n    const gameType = req.query.gameType as string || null;\n    \n    // Define time range based on timeFrame\n    let startDate: Date | null = null;\n    const now = new Date();\n    \n    if (timeFrame === 'today') {\n      startDate = new Date(now.setHours(0, 0, 0, 0));\n    } else if (timeFrame === 'this-week') {\n      const day = now.getDay();\n      const diff = now.getDate() - day + (day === 0 ? -6 : 1); // Adjust when day is Sunday\n      startDate = new Date(now.setDate(diff));\n      startDate.setHours(0, 0, 0, 0);\n    } else if (timeFrame === 'this-month') {\n      startDate = new Date(now.getFullYear(), now.getMonth(), 1);\n    }\n    \n    // Get all games with appropriate filters\n    let gamesQuery = db.select({\n      userId: schema.games.userId,\n      username: schema.users.username,\n      betAmount: schema.games.betAmount,\n      payout: schema.games.payout,\n      gameType: schema.games.gameType,\n      result: schema.games.result,\n      createdAt: schema.games.createdAt\n    })\n    .from(schema.games)\n    .innerJoin(schema.users, eq(schema.games.userId, schema.users.id));\n    \n    if (startDate) {\n      gamesQuery = gamesQuery.where(gte(schema.games.createdAt, startDate));\n    }\n    \n    if (gameType) {\n      gamesQuery = gamesQuery.where(eq(schema.games.gameType, gameType));\n    }\n    \n    const games = await gamesQuery;\n    \n    // Aggregate data by user\n    const userStats: Record<number, {\n      userId: number,\n      username: string,\n      totalBets: number,\n      totalWins: number,\n      winRate: number,\n      totalWinnings: number,\n      avatar: string\n    }> = {};\n    \n    games.forEach(game => {\n      if (!userStats[game.userId]) {\n        userStats[game.userId] = {\n          userId: game.userId,\n          username: game.username,\n          totalBets: 0,\n          totalWins: 0,\n          winRate: 0,\n          totalWinnings: 0,\n          avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${game.username}`\n        };\n      }\n      \n      userStats[game.userId].totalBets += 1;\n      \n      if (game.payout > 0) {\n        userStats[game.userId].totalWins += 1;\n        userStats[game.userId].totalWinnings += (game.payout - game.betAmount);\n      }\n    });\n    \n    // Calculate win rates\n    Object.values(userStats).forEach(user => {\n      user.winRate = user.totalBets > 0 ? parseFloat(((user.totalWins / user.totalBets) * 100).toFixed(1)) : 0;\n    });\n    \n    // Sort according to the requested parameter\n    let leaderboardData = Object.values(userStats);\n\n    if (sortBy === 'totalWinnings') {\n      leaderboardData = leaderboardData.sort((a, b) => b.totalWinnings - a.totalWinnings);\n    } else if (sortBy === 'winRate') {\n      leaderboardData = leaderboardData.sort((a, b) => b.winRate - a.winRate);\n    } else {\n      leaderboardData = leaderboardData.sort((a, b) => b.totalWins - a.totalWins);\n    }\n    \n    // Return only the top 10 users\n    res.json(leaderboardData.slice(0, 10));\n    \n  } catch (err) {\n    next(err);\n  }\n});\n\napp.get(\"/api/games/my-history\", async (req, res, next) => {\n  try {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n\n      let games = await storage.getGamesByUserId(req.user!.id);\n      \n      // Enhance team match games with team data if needed\n      games = games.map(game => {\n        // For team_match games, ensure we include proper team data in gameData\n        if (game.gameType === 'team_match' && game.match && !game.gameData) {\n          return {\n            ...game,\n            gameData: {\n              teamA: game.match.teamA,\n              teamB: game.match.teamB\n            }\n          };\n        }\n        return game;\n      });\n\n      res.json(games);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  app.post(\"/api/games/play\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      if (req.user!.isBlocked) {\n        return res.status(403).json({ message: \"Your account is blocked\" });\n      }\n\n      const { betAmount, prediction } = req.body;\n      \n      // Validate input\n      if (!betAmount || betAmount <= 0) {\n        return res.status(400).json({ message: \"Invalid bet amount\" });\n      }\n\n      if (!prediction || (prediction !== GameOutcome.HEADS && prediction !== GameOutcome.TAILS)) {\n        return res.status(400).json({ message: \"Invalid prediction\" });\n      }\n\n      // Check user balance\n      const user = await storage.getUser(req.user!.id);\n      if (!user || user.balance < betAmount) {\n        return res.status(400).json({ message: \"Insufficient balance\" });\n      }\n\n      // Import our dynamic probability system\n      const { calculateWinProbability, updateUserSessionStats, DEFAULT_HOUSE_EDGE_WIN_RATE } = await import('./game-probability');\n      \n      // Calculate win probability based on user's history and session stats\n      let userWinProbability = await calculateWinProbability(user.id);\n      \n      // Critical adjustment: Force house edge after seeing game logs\n      // This is a temporary adjustment to ensure the house maintains an edge\n      // The user has been winning too frequently, so we'll lower the probability temporarily\n      // The player has won too many times in a row, adjust probability downward\n      const MAX_WIN_PROBABILITY = 0.35; // Limit maximum win probability to 35% temporarily\n      \n      // Get user's recent games to check winning streak\n      const recentGames = await storage.getRecentGames(user.id, 5);\n      let winStreak = 0;\n      \n      // Count consecutive wins\n      for (const game of recentGames) {\n        if (game.payout > 0) {\n          winStreak++;\n        } else {\n          break; // Stop counting at first loss\n        }\n      }\n      \n      // Apply stricter probability if user is on a winning streak\n      if (winStreak >= 3) {\n        // Cap at a much lower probability for users on a win streak\n        userWinProbability = Math.min(userWinProbability, 0.25);\n        console.log(`Win streak detected (${winStreak}), applying stricter probability: ${userWinProbability.toFixed(2)}`);\n      } else {\n        // Standard adjustment - cap at MAX_WIN_PROBABILITY\n        userWinProbability = Math.min(userWinProbability, MAX_WIN_PROBABILITY);\n      }\n      \n      // Check if user has less than 5 games and is betting high amounts\n      const coinFlipGames = await db.query.games.findMany({\n        where: and(\n          eq(games.userId, user.id),\n          eq(games.gameType, GameType.COIN_FLIP)\n        ),\n        orderBy: [desc(games.createdAt)]\n      });\n      \n      // Check if this is one of the user's first 5 games\n      const isInFirstFiveGames = coinFlipGames.length < 5;\n      \n      // Calculate total bet amount in first games (including current bet)\n      let totalBetAmount = betAmount;\n      if (isInFirstFiveGames) {\n        totalBetAmount += coinFlipGames.reduce((sum, game) => sum + game.betAmount, 0);\n      }\n      \n      // Force loss if betting more than 1000 Rs in first 5 games\n      let forceHighBetLoss = false;\n      if (isInFirstFiveGames && totalBetAmount > 100000) { // 1000 Rs in cents\n        forceHighBetLoss = true;\n        console.log(`High bet detected in first 5 games: ${totalBetAmount/100} Rs - Forcing loss for user ${user.username}`);\n        userWinProbability = 0; // Set win probability to 0 for logging purposes\n      }\n      \n      // Determine if user wins based on dynamic probability (unless we're forcing a loss)\n      const userWins = forceHighBetLoss ? false : Math.random() < userWinProbability;\n      \n      // Set result based on user's prediction and whether they win\n      // If user prediction is HEADS and they win, result is HEADS\n      // If user prediction is HEADS and they lose, result is TAILS\n      // And vice versa\n      const result = userWins ? prediction : \n                    (prediction === GameOutcome.HEADS ? GameOutcome.TAILS : GameOutcome.HEADS);\n      \n      // Get appropriate multiplier from game odds settings\n      // First check if user is assigned to a subadmin\n      let multiplier = 1.95; // Default fallback if no odds are configured\n      \n      // Try to get user's assigned subadmin\n      const userData = await storage.getUser(user.id);\n      const subadminId = userData?.assignedTo;\n      \n      try {\n        if (subadminId) {\n          // User is assigned to a subadmin, check for subadmin-specific odds\n          // Get custom odds for this subadmin - we need to explicitly filter by setByAdmin=false to get custom odds\n          const subadminOdds = await db.select()\n            .from(schema.gameOdds)\n            .where(\n              and(\n                eq(schema.gameOdds.gameType, 'coin_flip'),\n                eq(schema.gameOdds.subadminId, subadminId),\n                eq(schema.gameOdds.setByAdmin, false)\n              )\n            );\n            \n          console.log(`Direct DB query for coin_flip odds for subadmin ${subadminId}:`, subadminOdds);\n            \n          if (subadminOdds && subadminOdds.length > 0) {\n            // Use subadmin odds\n            multiplier = subadminOdds[0].oddValue / 10000; // Convert from stored integer (70000) to decimal (7.00)\n            console.log(`Using custom subadmin odds for player ${user.id}: ${multiplier}x`)\n          } else {\n            // No subadmin-specific odds, check admin odds\n            const adminOdds = await storage.getGameOdds('coin_flip');\n            const adminOdd = adminOdds.find(odd => odd.setByAdmin === true);\n            if (adminOdd) {\n              multiplier = adminOdd.oddValue / 10000;\n            }\n          }\n        } else {\n          // User not assigned to a subadmin, use admin odds directly\n          const adminOdds = await storage.getGameOdds('coin_flip');\n          const adminOdd = adminOdds.find(odd => odd.setByAdmin === true);\n          if (adminOdd) {\n            multiplier = adminOdd.oddValue / 10000;\n          }\n        }\n      } catch (error) {\n        console.error(\"Error getting odds settings:\", error);\n        // Use default multiplier if there's an error\n      }\n      \n      const payout = userWins ? Math.floor(betAmount * multiplier) : 0;\n      \n      // Update user balance\n      const newBalance = user.balance - betAmount + payout;\n      await storage.updateUserBalance(user.id, newBalance);\n      \n      // Update user session stats for future probability calculations\n      updateUserSessionStats(user.id, userWins);\n\n      // Log internal game stats (only visible in server logs, not to clients)\n      console.log(`Coin Flip: User=${user.username}, WinProb=${userWinProbability.toFixed(2)}, Wins=${userWins}, Payout=${payout}`);\n\n      // Record the game\n      const game = await storage.createGame({\n        userId: user.id,\n        gameType: GameType.COIN_FLIP,\n        betAmount,\n        prediction,\n        result,\n        payout,\n        balanceAfter: newBalance, // Track the balance after this game\n      });\n\n      // Return game result with updated user info\n      res.json({\n        game,\n        user: {\n          ...user,\n          balance: newBalance,\n          password: undefined,\n        },\n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // User management routes\n  app.get(\"/api/users\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      let users;\n      \n      // If the assignedTo query param is provided, filter by this parameter (for showing users of a specific subadmin)\n      const assignedToId = req.query.assignedTo ? parseInt(req.query.assignedTo as string) : null;\n      \n      if (assignedToId && req.user!.role === UserRole.ADMIN) {\n        // Admin can request players assigned to a specific subadmin\n        users = await storage.getUsersByAssignedTo(assignedToId);\n      } else if (req.user!.role === UserRole.ADMIN) {\n        // Admins can see all users by default\n        users = await storage.getAllUsers();\n      } else {\n        // Subadmins can only see users assigned to them\n        users = await storage.getUsersByAssignedTo(req.user!.id);\n      }\n\n      // Remove passwords from response\n      const sanitizedUsers = users.map((user) => {\n        const { password, ...userWithoutPassword } = user;\n        return userWithoutPassword;\n      });\n\n      res.json(sanitizedUsers);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Get a single user by ID\n  app.get(\"/api/users/:id\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const userId = parseInt(req.params.id);\n      \n      // Validate ID format\n      if (isNaN(userId)) {\n        return res.status(400).json({ message: \"Invalid user ID format\" });\n      }\n      \n      // Get the user\n      const user = await storage.getUser(userId);\n      \n      // Check if user exists\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Check if current user has permission to view this user\n      // Admins can view any user, subadmins can only view users assigned to them\n      if (req.user!.role === UserRole.SUBADMIN && \n          user.role !== UserRole.PLAYER && \n          user.id !== req.user!.id) {\n        return res.status(403).json({ message: \"You don't have permission to view this user\" });\n      }\n      \n      if (req.user!.role === UserRole.SUBADMIN && \n          user.role === UserRole.PLAYER && \n          user.assignedTo !== req.user!.id) {\n        return res.status(403).json({ message: \"You don't have permission to view this user\" });\n      }\n      \n      // Remove password from response\n      const { password, ...userWithoutPassword } = user;\n      \n      // Return the user data\n      res.json(userWithoutPassword);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Delete a user\n  app.delete(\"/api/users/:id\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const userId = parseInt(req.params.id);\n      \n      // Validate ID format\n      if (isNaN(userId)) {\n        return res.status(400).json({ message: \"Invalid user ID format\" });\n      }\n      \n      // Get the user to check if it exists\n      const user = await storage.getUser(userId);\n      \n      // Check if user exists\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Only admin can delete users\n      if (req.user!.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: \"Only administrators can delete users\" });\n      }\n      \n      // Don't allow deleting self\n      if (user.id === req.user!.id) {\n        return res.status(403).json({ message: \"Cannot delete your own account\" });\n      }\n      \n      // Delete the user\n      const result = await storage.deleteUser(userId);\n      \n      if (result) {\n        return res.status(200).json({ message: \"User deleted successfully\" });\n      } else {\n        return res.status(500).json({ message: \"Failed to delete user\" });\n      }\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  app.patch(\"/api/users/:id/block\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const userId = Number(req.params.id);\n      const user = await storage.getUser(userId);\n\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Check permissions\n      if (req.user!.role === UserRole.SUBADMIN && user.assignedTo !== req.user!.id) {\n        return res.status(403).json({ message: \"You don't have permission to modify this user\" });\n      }\n\n      // Block user and store who blocked them\n      const updatedUser = await storage.blockUser(userId, req.user!.id);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Remove password from response\n      const { password, ...userWithoutPassword } = updatedUser;\n      res.json(userWithoutPassword);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  app.patch(\"/api/users/:id/unblock\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const userId = Number(req.params.id);\n      const user = await storage.getUser(userId);\n\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Check if user was blocked by an admin when a subadmin is trying to unblock\n      if (req.user!.role === UserRole.SUBADMIN) {\n        if (user.blockedBy) {\n          const blockedByUser = await storage.getUser(user.blockedBy);\n          if (blockedByUser && blockedByUser.role === UserRole.ADMIN) {\n            return res.status(403).json({ \n              message: \"This user was blocked by an admin. Please contact your admin to unblock this user.\" \n            });\n          }\n        }\n        \n        // Also check assignments for subadmins\n        if (user.assignedTo !== req.user!.id) {\n          return res.status(403).json({ message: \"You don't have permission to modify this user\" });\n        }\n      }\n\n      // Unblock user\n      const updatedUser = await storage.unblockUser(userId);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Remove password from response\n      const { password, ...userWithoutPassword } = updatedUser;\n      res.json(userWithoutPassword);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  app.patch(\"/api/users/:id/balance\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    // Initialize this variable at function level to avoid duplicate declarations\n    let discountBonusAmount = 0;\n    \n    try {\n      const userId = Number(req.params.id);\n      const { amount, description } = req.body;\n\n      if (typeof amount !== 'number') {\n        return res.status(400).json({ message: \"Invalid amount\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Check permissions\n      if (req.user!.role === UserRole.SUBADMIN && user.assignedTo !== req.user!.id) {\n        return res.status(403).json({ message: \"You don't have permission to modify this user\" });\n      }\n\n      // For admins and subadmins interacting with user funds\n      if (req.user!.role === UserRole.ADMIN || req.user!.role === UserRole.SUBADMIN) {\n        const adminOrSubadmin = await storage.getUser(req.user!.id);\n        \n        if (!adminOrSubadmin) {\n          return res.status(404).json({ message: `${req.user!.role} account not found` });\n        }\n        \n        // When adding funds, check if admin/subadmin has enough balance\n        if (amount > 0) {\n          // For admin self-funding, don't check balance\n          const isAdminSelfFunding = req.user!.role === UserRole.ADMIN && userId === req.user!.id;\n          \n          // Check if the recipient is a subadmin - we need to apply commission logic\n          const isRecipientSubadmin = user.role === UserRole.SUBADMIN;\n          // Check if the recipient is a player - we need to apply deposit discount logic\n          const isRecipientPlayer = user.role === UserRole.PLAYER;\n          \n          // Calculate deduction amount based on commission (if target is subadmin)\n          let deductionAmount = amount;\n          \n          if (req.user!.role === UserRole.ADMIN && isRecipientSubadmin) {\n            try {\n              // Import the function from wallet-system.ts\n              const { getSubadminDepositCommission } = await import('./deposit-commission-endpoint');\n              \n              // Get the commission rate for this subadmin (e.g., 50% = 5000 means subadmin handles 50%)\n              const commissionRate = await getSubadminDepositCommission(userId);\n              \n              // Calculate the amount to deduct from admin\n              // Commission rate represents what percentage the subadmin handles themselves\n              // So admin pays (100% - commission%) of the amount\n              // If commission is 0%, admin pays 100%\n              // If commission is 50%, admin pays 50%\n              // If commission is 100%, admin pays 0%\n              deductionAmount = amount - Math.floor((amount * commissionRate) / 10000);\n              \n              // Calculate the commission amount (what the subadmin handles themselves)\n              const commissionAmount = amount - deductionAmount;\n              \n              console.log(`Transfer to subadmin ${userId}: Total: ${amount}, Commission rate: ${commissionRate/100}%, Admin deduction: ${deductionAmount}, Subadmin handles: ${commissionAmount}`);\n            } catch (error) {\n              console.error('Error calculating commission rate:', error);\n              // If there's an error, use default behavior (deduct full amount)\n              deductionAmount = amount;\n            }\n          }\n          \n          // Apply deposit discount if user is a player and transferrer is a subadmin\n          if (req.user!.role === UserRole.SUBADMIN && isRecipientPlayer) {\n            try {\n              // Import deposit discount helper functions\n              const { getPlayerDepositDiscount, calculateDepositBonus } = await import('./deposit-discount-helper');\n              \n              // Get the discount rate for this player\n              const discountRate = await getPlayerDepositDiscount(userId, req.user!.id);\n              \n              if (discountRate > 0) {\n                // Calculate bonus amount based on discount rate\n                discountBonusAmount = calculateDepositBonus(amount, discountRate);\n                \n                console.log(`Transfer to player ${userId}: Amount: ${amount}, Discount rate: ${discountRate/100}%, Bonus amount: ${discountBonusAmount}`);\n                \n                // Add the bonus amount to the deduction amount\n                // This ensures the subadmin pays for both the base amount and the bonus\n                deductionAmount += discountBonusAmount;\n              }\n            } catch (error) {\n              console.error('Error calculating deposit discount:', error);\n              // If there's an error, no bonus will be added\n              discountBonusAmount = 0;\n            }\n          }\n          \n          if (!isAdminSelfFunding && adminOrSubadmin.balance < deductionAmount) {\n            return res.status(400).json({ \n              message: \"Insufficient balance in your account. Please add funds to your wallet first.\"\n            });\n          }\n          \n          // Skip deduction if it's admin self-funding\n          if (!isAdminSelfFunding) {\n            // Deduct the calculated amount from admin/subadmin's balance\n            await storage.updateUserBalance(adminOrSubadmin.id, adminOrSubadmin.balance - deductionAmount);\n            \n            // Record transaction for admin/subadmin (negative amount = deduction)\n            let description = '';\n            if (isRecipientSubadmin) {\n              const commissionAmount = amount - deductionAmount;\n              // Convert paisa to rupees for display in description (divide by 100)\n              description = `Funds transferred to ${user.username} (${(deductionAmount / 100).toFixed(2)} of ${(amount / 100).toFixed(2)} - commission rate applied, commission: ${(commissionAmount / 100).toFixed(2)})`;\n            } else if (discountBonusAmount > 0) {\n              // Convert paisa to rupees for display in description\n              description = `Funds transferred to ${user.username} (Deposit discount applied: +${(discountBonusAmount / 100).toFixed(2)}, total deducted: ${(deductionAmount / 100).toFixed(2)})`;\n            } else {\n              description = `Funds transferred to ${user.username}`;\n            }\n                \n            await storage.createTransaction({\n              userId: adminOrSubadmin.id,\n              amount: -deductionAmount,\n              performedBy: adminOrSubadmin.id,\n              description,\n            });\n          }\n        } \n        // When deducting funds, add to admin/subadmin's balance\n        else if (amount < 0) {\n          // Skip addition if it's admin self-deduction\n          const isAdminSelfDeduction = req.user!.role === UserRole.ADMIN && userId === req.user!.id;\n          \n          // Check if the source is a subadmin - we need to apply commission logic\n          const isSourceSubadmin = user.role === UserRole.SUBADMIN;\n          \n          // Calculate addition amount based on commission (if source is subadmin)\n          let additionAmount = Math.abs(amount);\n          \n          if (req.user!.role === UserRole.ADMIN && isSourceSubadmin) {\n            try {\n              // Import the function from wallet-system.ts\n              const { getSubadminDepositCommission } = await import('./deposit-commission-endpoint');\n              \n              // Get the commission rate for this subadmin (e.g., 50% = 5000 means subadmin handles 50%)\n              const commissionRate = await getSubadminDepositCommission(userId);\n              \n              // Calculate the amount to add to admin\n              // Commission rate represents what percentage the subadmin handles themselves\n              // So admin receives (100% - commission%) of the amount\n              // If commission is 0%, admin gets 100%\n              // If commission is 50%, admin gets 50%\n              // If commission is 100%, admin gets 0%\n              additionAmount = Math.abs(amount) - Math.floor((Math.abs(amount) * commissionRate) / 10000);\n              \n              console.log(`Withdrawal from subadmin ${userId}: Total: ${Math.abs(amount)}, Commission rate: ${commissionRate/100}%, Admin addition: ${additionAmount}`);\n            } catch (error) {\n              console.error('Error calculating commission rate:', error);\n              // If there's an error, use default behavior (add full amount)\n              additionAmount = Math.abs(amount);\n            }\n          }\n          \n          if (!isAdminSelfDeduction) {\n            // Add the calculated amount to admin/subadmin's balance\n            await storage.updateUserBalance(adminOrSubadmin.id, adminOrSubadmin.balance + additionAmount);\n            \n            // Record transaction for admin/subadmin (positive amount = addition)\n            let description = '';\n            if (isSourceSubadmin) {\n              const commissionAmount = additionAmount - Math.abs(amount);\n              // Convert paisa to rupees for display in description (divide by 100)\n              description = `Funds recovered from ${user.username} (${(additionAmount / 100).toFixed(2)} of ${(Math.abs(amount) / 100).toFixed(2)} - commission rate applied, commission: ${(commissionAmount / 100).toFixed(2)})`;\n            } else {\n              description = `Funds recovered from ${user.username}`;\n            }\n              \n            await storage.createTransaction({\n              userId: adminOrSubadmin.id,\n              amount: additionAmount,\n              performedBy: adminOrSubadmin.id,\n              description,\n            });\n          }\n        }\n      }\n\n      // Add bonus amount from deposit discount if applicable\n      let totalAmount = amount;\n      let bonusDescription = \"\";\n      \n      // Apply bonus only if it's a deposit (positive amount) and there's a bonus to add\n      if (amount > 0 && discountBonusAmount > 0) {\n        totalAmount += discountBonusAmount;\n        // Convert paisa to rupees for display in description\n        bonusDescription = ` (includes ${(discountBonusAmount / 100).toFixed(2)} bonus)`;\n      }\n      \n      // Prevent negative balance for the player\n      const newBalance = user.balance + totalAmount;\n      if (newBalance < 0) {\n        return res.status(400).json({ message: \"Cannot reduce balance below zero\" });\n      }\n\n      // Update player's balance\n      const updatedUser = await storage.updateUserBalance(userId, newBalance);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Determine a default description if none provided\n      const transactionDesc = description || (amount > 0 \n        ? `Funds added by ${req.user!.username}` \n        : `Funds deducted by ${req.user!.username}`);\n        \n      // If a bonus was added, create two separate transaction records\n      if (amount > 0 && discountBonusAmount > 0) {\n        // First transaction for the original deposit\n        await storage.createTransaction({\n          userId,\n          amount,\n          performedBy: req.user!.id,\n          description: transactionDesc\n        });\n        \n        // Second transaction for the bonus amount\n        await storage.createTransaction({\n          userId,\n          amount: discountBonusAmount,\n          performedBy: req.user!.id,\n          description: `Deposit bonus (${(discountBonusAmount * 100 / amount).toFixed(2)}% of ${amount})`\n        });\n      } else {\n        // Regular transaction (no bonus or withdrawal)\n        await storage.createTransaction({\n          userId,\n          amount,\n          performedBy: req.user!.id,\n          description: transactionDesc\n        });\n      }\n\n      // Remove password from response\n      const { password, ...userWithoutPassword } = updatedUser;\n      res.json(userWithoutPassword);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  app.patch(\"/api/users/:id/assign\", requireRole(UserRole.ADMIN), async (req, res, next) => {\n    try {\n      const userId = Number(req.params.id);\n      const { adminId } = req.body;\n\n      if (typeof adminId !== 'number') {\n        return res.status(400).json({ message: \"Invalid admin ID\" });\n      }\n\n      // Verify target user exists\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Verify admin/subadmin exists\n      const admin = await storage.getUser(adminId);\n      if (!admin || (admin.role !== UserRole.ADMIN && admin.role !== UserRole.SUBADMIN)) {\n        return res.status(400).json({ message: \"Invalid admin/subadmin ID\" });\n      }\n\n      // Assign user\n      const updatedUser = await storage.assignUserToAdmin(userId, adminId);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Remove password from response\n      const { password, ...userWithoutPassword } = updatedUser;\n      res.json(userWithoutPassword);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Edit user (username/password)\n  app.patch(\"/api/users/:id/edit\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const userId = Number(req.params.id);\n      const { username, password } = req.body;\n      \n      // Subadmins can only change passwords, not usernames\n      if (req.user!.role === UserRole.SUBADMIN && username) {\n        return res.status(403).json({ message: \"Subadmins can only change passwords, not usernames\" });\n      }\n      \n      // Verify at least one field is provided\n      if (!username && !password) {\n        return res.status(400).json({ message: \"No updates provided\" });\n      }\n      \n      // Get the user to verify permissions\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Check permissions - subadmins can only update their assigned users\n      if (req.user!.role === UserRole.SUBADMIN && user.assignedTo !== req.user!.id) {\n        return res.status(403).json({ message: \"You don't have permission to modify this user\" });\n      }\n      \n      // If username is provided, check if it's already taken\n      if (username) {\n        const existingUser = await storage.getUserByUsername(username);\n        if (existingUser && existingUser.id !== userId) {\n          return res.status(400).json({ message: \"Username already taken\" });\n        }\n      }\n      \n      // Prepare the update data\n      const updateData: { username?: string; password?: string } = {};\n      \n      // Only include username if provided (and user is admin)\n      if (username && req.user!.role === UserRole.ADMIN) {\n        updateData.username = username;\n      }\n      \n      // Only include password if provided - hash it first\n      if (password) {\n        const { hashPassword } = await import('./auth');\n        updateData.password = await hashPassword(password);\n      }\n      \n      // Update the user with prepared data\n      const updatedUser = await storage.updateUser(userId, updateData);\n      \n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Remove password from response\n      const { password: pwd, ...userWithoutPassword } = updatedUser;\n      res.json(userWithoutPassword);\n    } catch (err) {\n      console.error(\"Error updating user:\", err);\n      next(err);\n    }\n  });\n\n  // Reset user account\n  app.post(\"/api/users/reset-account\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const { userId, resetType } = req.body;\n      \n      // Validate input\n      if (!userId || !resetType) {\n        return res.status(400).json({ message: \"User ID and reset type are required\" });\n      }\n      \n      // Validate reset type\n      if (resetType !== \"subadmin\" && resetType !== \"player\") {\n        return res.status(400).json({ message: \"Invalid reset type\" });\n      }\n      \n      // Get the user to check permissions\n      const userToReset = await storage.getUser(userId);\n      \n      // Check if user exists\n      if (!userToReset) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Permissions check based on role\n      if (req.user!.role === UserRole.ADMIN) {\n        // Admins can reset any user except another admin\n        if (userToReset.role === UserRole.ADMIN) {\n          return res.status(403).json({ message: \"Cannot reset admin accounts\" });\n        }\n      } else if (req.user!.role === UserRole.SUBADMIN) {\n        // Subadmins can only reset players assigned to them\n        if (userToReset.role !== UserRole.PLAYER || userToReset.assignedTo !== req.user!.id) {\n          return res.status(403).json({ message: \"You don't have permission to reset this user\" });\n        }\n        \n        // Subadmins can only reset players, not other subadmins\n        if (resetType === \"subadmin\") {\n          return res.status(403).json({ message: \"Subadmins can only reset player accounts\" });\n        }\n      }\n      \n      // Start a transaction to perform reset operations\n      await db.transaction(async (tx) => {\n        if (resetType === \"subadmin\" && userToReset.role === UserRole.SUBADMIN) {\n          // For subadmin reset: Reset the subadmin and all their players\n          \n          // 1. Get all players assigned to this subadmin\n          const assignedPlayers = await storage.getUsersByAssignedTo(userId);\n          \n          // 2. Delete all transactions for subadmin and their players\n          await tx.delete(transactions)\n            .where(eq(transactions.userId, userId));\n          \n          for (const player of assignedPlayers) {\n            await tx.delete(transactions)\n              .where(eq(transactions.userId, player.id));\n              \n            // Delete all games for each player\n            await tx.delete(games)\n              .where(eq(games.userId, player.id));\n              \n            // Reset player balance to 0\n            await tx.update(users)\n              .set({ balance: 0 })\n              .where(eq(users.id, player.id));\n          }\n          \n          // 3. Reset subadmin balance to 0\n          await tx.update(users)\n            .set({ balance: 0 })\n            .where(eq(users.id, userId));\n            \n        } else if (resetType === \"player\" && userToReset.role === UserRole.PLAYER) {\n          // For player reset: Reset just the player's data\n          \n          // 1. Delete all transactions for this player\n          await tx.delete(transactions)\n            .where(eq(transactions.userId, userId));\n            \n          // 2. Delete all games for this player\n          await tx.delete(games)\n            .where(eq(games.userId, userId));\n            \n          // 3. Reset player balance to 0\n          await tx.update(users)\n            .set({ balance: 0 })\n            .where(eq(users.id, userId));\n        }\n      });\n      \n      res.json({ \n        success: true, \n        message: `Account reset successful for ${userToReset.username}` \n      });\n    } catch (err) {\n      console.error(\"Error resetting account:\", err);\n      next(err);\n    }\n  });\n\n  // Get user statistics\n  app.get(\"/api/users/stats\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      // For player role, we need to fix a permission issue\n      if (req.user!.role === UserRole.PLAYER) {\n        const userId = req.user!.id;\n        const games = await storage.getGamesByUserId(userId);\n        \n        // Calculate basic statistics\n        const totalBets = games.length;\n        const totalWins = games.filter(game => game.payout > 0).length;\n        const winRate = totalBets > 0 ? Math.round((totalWins / totalBets) * 100) : 0;\n        \n        // Calculate more advanced statistics\n        const totalWagered = games.reduce((sum, game) => sum + game.betAmount, 0);\n        const totalWon = games.reduce((sum, game) => sum + game.payout, 0);\n        const netProfit = totalWon - totalWagered;\n        \n        // Get game type distribution\n        const gameTypes = games.reduce((acc, game) => {\n          acc[game.gameType] = (acc[game.gameType] || 0) + 1;\n          return acc;\n        }, {} as Record<string, number>);\n        \n        // Get recent activity trend - last 10 games\n        const recentGames = games\n          .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n          .slice(0, 10);\n        \n        const recentWinRate = recentGames.length > 0 \n          ? Math.round((recentGames.filter(g => g.payout > 0).length / recentGames.length) * 100)\n          : 0;\n        \n        // Return enhanced stats\n        res.json({\n          totalBets,\n          winRate,\n          recentWinRate,\n          totalWagered,\n          totalWon,\n          netProfit,\n          gameTypeDistribution: gameTypes,\n          favoriteGame: Object.entries(gameTypes).sort((a, b) => b[1] - a[1])[0]?.[0] || null\n        });\n      } else {\n        // For admin/subadmin role\n        const userId = parseInt(req.query.userId as string);\n        \n        // Validate ID format\n        if (isNaN(userId)) {\n          return res.status(400).json({ message: \"Invalid user ID format\" });\n        }\n        \n        // Check permissions - admins can view any user's stats, subadmins only their assigned users\n        if (req.user!.role === UserRole.SUBADMIN) {\n          const assignedUsers = await storage.getUsersByAssignedTo(req.user!.id);\n          const isUserAssigned = assignedUsers.some(u => u.id === userId);\n          \n          if (!isUserAssigned) {\n            return res.status(403).json({ message: \"Forbidden: Insufficient permissions\" });\n          }\n        }\n        \n        const games = await storage.getGamesByUserId(userId);\n        \n        // Calculate basic statistics\n        const totalBets = games.length;\n        const totalWins = games.filter(game => game.payout > 0).length;\n        const winRate = totalBets > 0 ? Math.round((totalWins / totalBets) * 100) : 0;\n        \n        res.json({\n          totalBets,\n          winRate,\n        });\n      }\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // API endpoint for subadmin dashboard statistics\n  app.get(\"/api/subadmin/stats\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      // Only allow admin and subadmin to access this endpoint\n      if (req.user!.role !== UserRole.SUBADMIN && req.user!.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      const subadminId = req.user!.id;\n      let assignedTo = subadminId;\n      \n      // If admin is viewing a specific subadmin's stats\n      if (req.user!.role === UserRole.ADMIN && req.query.subadminId) {\n        assignedTo = Number(req.query.subadminId);\n      }\n      \n      // Get all users assigned to this subadmin\n      const users = await storage.getUsersByAssignedTo(assignedTo);\n      \n      if (!users || users.length === 0) {\n        return res.json({\n          totalProfit: 0,\n          totalDeposits: 0,\n          totalUsers: 0,\n          activeUsers: 0\n        });\n      }\n      \n      // Get all user IDs assigned to this subadmin\n      const userIds = users.map(user => user.id);\n      let totalProfit = 0;\n      let totalDeposits = 0;\n      \n      // Calculate total deposits from transactions\n      const transactions = await storage.getWalletTransactionsByUserIds(userIds);\n      if (transactions && transactions.length > 0) {\n        // Sum deposits (positive amounts with deposit description)\n        totalDeposits = transactions\n          .filter(tx => tx.amount > 0 && tx.description && (\n            tx.description.includes('Deposit') || \n            tx.description.includes('Added by admin') || \n            tx.description.includes('Funds added')\n          ))\n          .reduce((sum, tx) => sum + tx.amount, 0);\n      }\n      \n      // Calculate profit/loss from games\n      const games = await storage.getGamesByUserIds(userIds);\n      if (games && games.length > 0) {\n        // Calculate profit (positive when house wins, negative when player wins)\n        totalProfit = games.reduce((sum, game) => {\n          // For player-won games, result will be \"win\" or \"heads\"/\"tails\" matching their prediction\n          const playerWon = game.result === 'win' || \n                           (game.result && game.prediction && game.result === game.prediction);\n          \n          // For house-won games, result will be \"loss\" or different from player's prediction\n          const houseWon = game.result === 'loss' ||\n                          (game.result && game.prediction && game.result !== game.prediction && \n                           game.result !== 'pending' && game.result !== 'win');\n                          \n          if (playerWon) {\n            // House loss (negative profit): payout - betAmount\n            return sum - ((game.payout || 0) - (game.betAmount || game.bet_amount || 0));\n          } else if (houseWon) {\n            // House win (positive profit): betAmount\n            return sum + (game.betAmount || game.bet_amount || 0);\n          }\n          // Pending games don't affect profit calculation\n          return sum;\n        }, 0);\n      }\n      \n      // Count active users (users who played at least one game)\n      const activeUserIds = games.length > 0 ? \n        [...new Set(games.map(game => game.userId || game.user_id))] : [];\n      const activeUsers = activeUserIds.length;\n      \n      res.json({\n        totalProfit,\n        totalDeposits,\n        totalUsers: users.length,\n        activeUsers\n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Recent games across all users (for admin dashboard)\n  app.get(\"/api/games/recent\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      // Get recent games limited to 10\n      const games = await storage.getAllGames(10);\n      res.json(games);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get all games (for admins and subadmins) or user's games\n  app.get(\"/api/games\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      let games;\n      \n      if (req.user!.role === UserRole.ADMIN) {\n        // Admins can see all games\n        games = await storage.getAllGames();\n      } else if (req.user!.role === UserRole.SUBADMIN) {\n        // Subadmins can only see games from users assigned to them\n        const assignedUsers = await storage.getUsersByAssignedTo(req.user!.id);\n        const userIds = assignedUsers.map(user => user.id);\n        \n        // Also include the subadmin's own games\n        userIds.push(req.user!.id);\n        \n        // Get all games and filter by user IDs\n        const allGames = await storage.getAllGames();\n        games = allGames.filter(game => userIds.includes(game.userId));\n      } else {\n        // Regular users can only see their own games\n        games = await storage.getGamesByUserId(req.user!.id);\n      }\n      \n      res.json(games);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Get games for a specific user (admin/subadmin only)\n  app.get(\"/api/games/:userId\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const userId = Number(req.params.userId);\n      \n      // Get the user to verify permissions\n      const targetUser = await storage.getUser(userId);\n      if (!targetUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Check permissions - subadmins can only view their assigned users\n      if (req.user!.role === UserRole.SUBADMIN && targetUser.assignedTo !== req.user!.id) {\n        return res.status(403).json({ message: \"You don't have permission to view this user's data\" });\n      }\n      \n      const games = await storage.getGamesByUserId(userId);\n      res.json(games);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get all transactions (for admins and subadmins) or user's transactions\n  // Query parameter: ownOnly=true - returns only the current user's own transactions (for wallet history)\n  app.get(\"/api/transactions\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      let transactions;\n      \n      // Check if ownOnly parameter is set - for wallet page to show only user's own transactions\n      const ownOnly = req.query.ownOnly === 'true';\n      \n      if (ownOnly) {\n        // Return only the current user's own transactions (for wallet history)\n        transactions = await storage.getTransactionsByUserId(req.user!.id);\n      } else if (req.user!.role === UserRole.ADMIN) {\n        // Admins can see all transactions\n        transactions = await storage.getAllTransactions();\n      } else if (req.user!.role === UserRole.SUBADMIN) {\n        // Subadmins can only see transactions from users assigned to them\n        const assignedUsers = await storage.getUsersByAssignedTo(req.user!.id);\n        const userIds = assignedUsers.map(user => user.id);\n        \n        // Also include the subadmin's own transactions\n        userIds.push(req.user!.id);\n        \n        // Get all transactions and filter by user IDs\n        const allTransactions = await storage.getAllTransactions();\n        transactions = allTransactions.filter(transaction => userIds.includes(transaction.userId));\n      } else {\n        // Regular users can only see their own transactions\n        transactions = await storage.getTransactionsByUserId(req.user!.id);\n      }\n      \n      res.json(transactions);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Get transactions for a specific user (admin/subadmin only)\n  app.get(\"/api/transactions/:userId\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const userId = Number(req.params.userId);\n      \n      // Get the user to verify permissions\n      const targetUser = await storage.getUser(userId);\n      if (!targetUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Check permissions - subadmins can only view their assigned users\n      if (req.user!.role === UserRole.SUBADMIN && targetUser.assignedTo !== req.user!.id) {\n        return res.status(403).json({ message: \"You don't have permission to view this user's data\" });\n      }\n      \n      const transactions = await storage.getTransactionsByUserId(userId);\n      res.json(transactions);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Satamatka Market Routes\n  \n  // Get all satamatka markets\n  app.get(\"/api/satamatka/markets\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const markets = await storage.getAllSatamatkaMarkets();\n      res.json(markets);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get active satamatka markets (open for betting)\n  app.get(\"/api/satamatka/markets/active\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const markets = await storage.getActiveSatamatkaMarkets();\n      res.json(markets);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get a specific satamatka market\n  app.get(\"/api/satamatka/markets/:id\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const marketId = Number(req.params.id);\n      const market = await storage.getSatamatkaMarket(marketId);\n      \n      if (!market) {\n        return res.status(404).json({ message: \"Market not found\" });\n      }\n      \n      res.json(market);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get all games for a specific market\n  app.get(\"/api/satamatka/markets/:id/games\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const marketId = Number(req.params.id);\n      const market = await storage.getSatamatkaMarket(marketId);\n      \n      if (!market) {\n        return res.status(404).json({ message: \"Market not found\" });\n      }\n      \n      const games = await storage.getSatamatkaGamesByMarketId(marketId);\n      res.json(games);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Admin routes for managing markets\n  app.post(\"/api/satamatka/markets\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      // Add proper date handling for string timestamps\n      const formData = req.body;\n      \n      // Convert string dates to Date objects if they're strings\n      if (formData.openTime && typeof formData.openTime === 'string') {\n        formData.openTime = new Date(formData.openTime);\n      }\n      \n      if (formData.closeTime && typeof formData.closeTime === 'string') {\n        formData.closeTime = new Date(formData.closeTime);\n      }\n      \n      if (formData.resultTime && typeof formData.resultTime === 'string') {\n        formData.resultTime = new Date(formData.resultTime);\n      }\n      \n      // Parse with schema validation after date conversion\n      const marketData = insertSatamatkaMarketSchema.parse(formData);\n      \n      // Log data for debugging\n      console.log(\"Creating market with data:\", {\n        ...marketData,\n        openTime: marketData.openTime ? marketData.openTime.toISOString() : null,\n        closeTime: marketData.closeTime ? marketData.closeTime.toISOString() : null\n      });\n      \n      // Handle recurring market flag\n      if (marketData.isRecurring) {\n        const market = await storage.createRecurringSatamatkaMarket(marketData);\n        res.status(201).json(market);\n      } else {\n        const market = await storage.createSatamatkaMarket(marketData);\n        res.status(201).json(market);\n      }\n    } catch (err) {\n      console.error(\"Error creating market:\", err);\n      next(err);\n    }\n  });\n  \n  // Create a recurring market (new API endpoint)\n  app.post(\"/api/satamatka/markets/recurring\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      // Add proper date handling for string timestamps\n      const formData = req.body;\n      \n      // Convert string dates to Date objects if they're strings\n      if (formData.openTime && typeof formData.openTime === 'string') {\n        formData.openTime = new Date(formData.openTime);\n      }\n      \n      if (formData.closeTime && typeof formData.closeTime === 'string') {\n        formData.closeTime = new Date(formData.closeTime);\n      }\n      \n      if (formData.resultTime && typeof formData.resultTime === 'string') {\n        formData.resultTime = new Date(formData.resultTime);\n      }\n      \n      // Parse with schema validation\n      const marketData = insertSatamatkaMarketSchema.parse(formData);\n      \n      // Force this to be a recurring market\n      marketData.isRecurring = true;\n      \n      // Log data for debugging\n      console.log(\"Creating recurring market with data:\", {\n        ...marketData,\n        openTime: marketData.openTime ? marketData.openTime.toISOString() : null,\n        closeTime: marketData.closeTime ? marketData.closeTime.toISOString() : null\n      });\n      \n      const market = await storage.createRecurringSatamatkaMarket(marketData);\n      res.status(201).json(market);\n    } catch (err) {\n      console.error(\"Error creating recurring market:\", err);\n      next(err);\n    }\n  });\n\n  // Update market status\n  app.patch(\"/api/satamatka/markets/:id/status\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const marketId = Number(req.params.id);\n      const { status } = req.body;\n      \n      // Updated to include the \"waiting\" status for the proper workflow sequence\n      if (!status || ![\"waiting\", \"open\", \"closed\", \"resulted\"].includes(status)) {\n        return res.status(400).json({ \n          message: \"Invalid status. Must be one of: waiting, open, closed, resulted\" \n        });\n      }\n      \n      // Check the current market status before allowing transition\n      const existingMarket = await storage.getSatamatkaMarket(marketId);\n      if (!existingMarket) {\n        return res.status(404).json({ message: \"Market not found\" });\n      }\n      \n      // Get the current market to check if status transition is valid\n      if (status === \"resulted\" && existingMarket.status !== \"closed\") {\n        return res.status(400).json({ \n          message: \"Market can only be set to 'resulted' from 'closed' status\" \n        });\n      }\n      \n      const market = await storage.updateSatamatkaMarketStatus(marketId, status);\n      \n      if (!market) {\n        return res.status(404).json({ message: \"Market not found\" });\n      }\n      \n      res.json(market);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Update market details (without changing status)\n  app.patch(\"/api/satamatka/markets/:id\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const marketId = Number(req.params.id);\n      const formData = req.body;\n      \n      // Get the existing market to make sure it exists\n      const existingMarket = await storage.getSatamatkaMarket(marketId);\n      if (!existingMarket) {\n        return res.status(404).json({ message: \"Market not found\" });\n      }\n      \n      // Check if the market already has results declared\n      if (existingMarket.status === 'resulted') {\n        return res.status(403).json({ \n          message: \"Cannot edit market after results have been declared\" \n        });\n      }\n      \n      // Convert string dates to Date objects if they're strings\n      if (formData.openTime && typeof formData.openTime === 'string') {\n        formData.openTime = new Date(formData.openTime);\n      }\n      \n      if (formData.closeTime && typeof formData.closeTime === 'string') {\n        formData.closeTime = new Date(formData.closeTime);\n      }\n      \n      if (formData.resultTime && typeof formData.resultTime === 'string') {\n        formData.resultTime = new Date(formData.resultTime);\n      }\n      \n      // Update the market details (this method explicitly excludes status to maintain workflow)\n      const market = await storage.updateSatamatkaMarket(marketId, formData);\n      \n      if (!market) {\n        return res.status(500).json({ message: \"Failed to update market\" });\n      }\n      \n      // Return updated market\n      res.json(market);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Update market results\n  app.patch(\"/api/satamatka/markets/:id/results\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const marketId = Number(req.params.id);\n      const { openResult, closeResult } = req.body;\n      \n      // Get the current market to check its status\n      const existingMarket = await storage.getSatamatkaMarket(marketId);\n      if (!existingMarket) {\n        return res.status(404).json({ message: \"Market not found\" });\n      }\n      \n      // Ensure the market is in the correct status before allowing result declaration\n      if (existingMarket.status !== \"closed\") {\n        return res.status(400).json({ \n          message: \"Results can only be declared for markets in 'closed' status. Please close the market first.\" \n        });\n      }\n      \n      if (openResult === undefined && closeResult === undefined) {\n        return res.status(400).json({ message: \"Either openResult or closeResult must be provided\" });\n      }\n      \n      // Validate results are two-digit numbers (00-99)\n      const validateResult = (result: string | undefined) => {\n        if (result === undefined) return true;\n        return /^[0-9]{2}$/.test(result);\n      };\n      \n      if (!validateResult(openResult) || !validateResult(closeResult)) {\n        return res.status(400).json({ message: \"Results must be two-digit numbers (00-99)\" });\n      }\n      \n      // Update market results\n      const market = await storage.updateSatamatkaMarketResults(marketId, openResult, closeResult);\n      \n      if (!market) {\n        return res.status(404).json({ message: \"Failed to update market results\" });\n      }\n      \n      // Process all bets for this market if closeResult is provided (final result)\n      if (closeResult) {\n        try {\n          // Get all games for this market\n          const marketGames = await storage.getSatamatkaGamesByMarketId(marketId);\n          \n          // Process each game\n          for (const game of marketGames) {\n            // Skip already processed games\n            if (game.result !== \"pending\") continue;\n            \n            // Get user info\n            const user = await storage.getUser(game.userId);\n            if (!user) continue;\n            \n            // Determine if the bet won based on game mode and prediction\n            let isWinner = false;\n            let payout = 0;\n            \n            // Get appropriate odds for this player and game mode from the database\n            const getOddsValue = async (gameMode: string): Promise<number> => {\n              const gameTypeMap = {\n                [SatamatkaGameMode.JODI]: 'satamatka_jodi',\n                [SatamatkaGameMode.HARF]: 'satamatka_harf',\n                [SatamatkaGameMode.CROSSING]: 'satamatka_crossing',\n                [SatamatkaGameMode.ODD_EVEN]: 'satamatka_odd_even'\n              };\n              \n              const gameType = gameTypeMap[gameMode as keyof typeof gameTypeMap];\n              if (!gameType) {\n                console.warn(`Unknown game mode: ${gameMode}, using default odds`);\n                return 0;\n              }\n              \n              // Get odds configured in the database based on player's relation to subadmins\n              return await storage.getOddsForPlayer(game.userId, gameType);\n            };\n            \n            // Game mode specific win conditions\n            if (game.gameMode === SatamatkaGameMode.JODI && game.prediction === closeResult) {\n              // For Jodi mode, prediction must match closeResult exactly\n              isWinner = true;\n              const oddValue = await getOddsValue(game.gameMode);\n              payout = game.betAmount * (oddValue / 10000); // Apply configured odds\n            } \n            else if (game.gameMode === SatamatkaGameMode.HARF) {\n              // For Harf, check if digit matches position\n              const firstDigit = closeResult[0]; \n              const secondDigit = closeResult[1];\n              \n              // Handle different Harf prediction formats (A0, B1, etc.)\n              let harfDigit = game.prediction;\n              let isLeftDigit = false;\n              let isRightDigit = false;\n              \n              // Handle formatted predictions like A0, A1, B0, B1\n              if (game.prediction.startsWith('A')) {\n                harfDigit = game.prediction.substring(1);\n                isLeftDigit = true;\n              } else if (game.prediction.startsWith('B')) {\n                harfDigit = game.prediction.substring(1);\n                isRightDigit = true;\n              } else if (game.prediction.startsWith('L')) {\n                harfDigit = game.prediction.substring(1);\n                isLeftDigit = true;\n              } else if (game.prediction.startsWith('R')) {\n                harfDigit = game.prediction.substring(1);\n                isRightDigit = true;\n              }\n              \n              // Check if the prediction matches the appropriate position\n              if (\n                (isLeftDigit && harfDigit === firstDigit) || \n                (isRightDigit && harfDigit === secondDigit) ||\n                // For single digit predictions without position indicator\n                (!isLeftDigit && !isRightDigit && (game.prediction === firstDigit || game.prediction === secondDigit))\n              ) {\n                isWinner = true;\n                const oddValue = await getOddsValue(game.gameMode);\n                payout = game.betAmount * (oddValue / 10000); // Apply configured odds\n              }\n            }\n            else if (game.gameMode === SatamatkaGameMode.CROSSING) {\n              // For Crossing, check if the prediction matches the result in any order\n              // Clean and prepare prediction digits - handle different prediction formats\n              let digits = [];\n              if (game.prediction.includes(',')) {\n                // Format: \"0,1,2\"\n                digits = game.prediction.replace(/[^0-9,]/g, '').split(',').map(d => d.trim());\n              } else {\n                // Format: \"012\" or other formats without commas\n                digits = game.prediction.replace(/[^0-9]/g, '').split('');\n              }\n              \n              // Extract the actual crossing combinations from the digits\n              // Crossing means any combination of the digits in any order\n              const crossingCombinations = [];\n              for (let i = 0; i < digits.length; i++) {\n                for (let j = 0; j < digits.length; j++) {\n                  if (i !== j) {\n                    crossingCombinations.push(digits[i] + digits[j]);\n                  }\n                }\n              }\n              \n              // Crossing bet with EXACT match or from comma-separated digit list\n              const resultToCheck = closeResult;\n              \n              // For crossing bets, ONLY EXACT MATCHES win with the following exceptions:\n              // 1. If prediction is exactly \"01\", it must match result \"01\" (not \"10\")\n              // 2. If prediction is a comma-separated list like \"0,1,2\", we generate all combinations\n              //    and check if the result is one of those combinations\n              \n              // Check if the prediction exactly matches the result\n              if (game.prediction === resultToCheck) {\n                isWinner = true;\n              } \n              // Check if the prediction is a comma-separated list and if so, check combinations\n              else if (game.prediction.includes(',') && crossingCombinations.includes(resultToCheck)) {\n                isWinner = true;\n              }\n              \n              // For debugging\n              console.log(`Crossing game ID ${game.id}:`);\n              console.log(`  Prediction: ${game.prediction}`);\n              console.log(`  Parsed digits: ${JSON.stringify(digits)}`);\n              console.log(`  Generated combinations: ${JSON.stringify(crossingCombinations)}`);\n              console.log(`  Result: ${resultToCheck}`);\n              console.log(`  Is winner: ${isWinner}`);\n              \n              if (isWinner) {\n                const oddValue = await getOddsValue(game.gameMode);\n                payout = game.betAmount * (oddValue / 10000); // Apply configured odds\n                console.log(`  Payout amount: ${payout / 100} rupees`);\n              }\n            }\n            else if (game.gameMode === SatamatkaGameMode.ODD_EVEN) {\n              // For Odd-Even, check if prediction matches the result's parity\n              const resultNumber = parseInt(closeResult, 10);\n              const isResultOdd = resultNumber % 2 !== 0;\n              \n              if ((game.prediction === \"odd\" && isResultOdd) || \n                  (game.prediction === \"even\" && !isResultOdd)) {\n                isWinner = true;\n                const oddValue = await getOddsValue(game.gameMode);\n                payout = game.betAmount * (oddValue / 10000); // Apply configured odds\n              }\n            }\n            \n            // Set game result\n            const result = isWinner ? \"win\" : \"loss\";\n            \n            // We do NOT need to update the balanceAfter field for each game individually\n            // as it was already correctly set when the bet was placed.\n            // We only need to add the payout to the running balance for win cases.\n            \n            // Update game result and payout in database\n            await storage.updateGameResult(game.id, result, payout);\n            \n            // Only update user balance if they won\n            if (isWinner) {\n              // Update user's actual balance in the database\n              const updatedBalance = user.balance + payout;\n              await storage.updateUserBalance(user.id, updatedBalance);\n              \n              // For winning games, update the balanceAfter to reflect the addition of the payout\n              await db.update(games)\n                .set({ balanceAfter: game.balanceAfter! + payout })\n                .where(eq(games.id, game.id));\n            }\n          }\n        } catch (err) {\n          console.error(\"Error processing market bets:\", err);\n          // Don't return error as the market result update was successful\n        }\n      }\n      \n      res.json(market);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Delete a market (used for removing market templates)\n  app.delete(\"/api/satamatka/markets/:id\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const marketId = Number(req.params.id);\n      \n      // Check if there are any games associated with this market\n      const games = await storage.getSatamatkaGamesByMarketId(marketId);\n      \n      if (games.length > 0) {\n        return res.status(400).json({ \n          message: \"Cannot delete market with existing games. This market has been used for betting and cannot be removed.\"\n        });\n      }\n      \n      // Delete the market\n      const deletedMarket = await storage.deleteSatamatkaMarket(marketId);\n      \n      if (!deletedMarket) {\n        return res.status(404).json({ message: \"Market not found\" });\n      }\n      \n      res.json({ \n        message: \"Market template removed successfully\", \n        id: marketId \n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Play Satamatka game\n  app.post(\"/api/satamatka/play\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      if (req.user!.isBlocked) {\n        return res.status(403).json({ message: \"Your account is blocked\" });\n      }\n\n      const { marketId, betAmount, gameMode, prediction } = req.body;\n      \n      // Validate input\n      if (!marketId || !betAmount || betAmount <= 0 || !gameMode || !prediction) {\n        return res.status(400).json({ message: \"Invalid input parameters\" });\n      }\n\n      // Validate game mode\n      if (!Object.values(SatamatkaGameMode).includes(gameMode)) {\n        return res.status(400).json({ message: \"Invalid game mode\" });\n      }\n\n      // Check if market exists and is open\n      const market = await storage.getSatamatkaMarket(marketId);\n      if (!market) {\n        return res.status(404).json({ message: \"Market not found\" });\n      }\n\n      if (market.status !== \"open\") {\n        // Provide a more specific error message based on the actual market status\n        const statusMessages = {\n          \"waiting\": \"Market is not yet active for betting\",\n          \"closed\": \"Market is in 'Waiting Results' status and closed for betting\",\n          \"resulted\": \"Market results have been declared\",\n          \"settled\": \"Market has been settled\"\n        };\n        \n        const message = statusMessages[market.status as keyof typeof statusMessages] || \n                       \"Market is not available for betting\";\n        \n        return res.status(400).json({ message });\n      }\n\n      // Validate prediction based on game mode\n      const validatePrediction = () => {\n        switch (gameMode) {\n          case SatamatkaGameMode.JODI:\n            // For Jodi, prediction should be a two-digit number\n            return /^[0-9]{2}$/.test(prediction);\n          case SatamatkaGameMode.HARF:\n            // For Harf, prediction can be:\n            // - A single digit (original implementation)\n            // - L followed by a digit (left/first position)\n            // - R followed by a digit (right/second position)\n            // - A followed by a digit (Ander/left position - new format)\n            // - B followed by a digit (Bahar/right position - new format)\n            return /^[0-9]$/.test(prediction) || // Original format\n                   /^L[0-9]$/.test(prediction) || // Old left digit format\n                   /^R[0-9]$/.test(prediction) || // Old right digit format\n                   /^A[0-9]$/.test(prediction) || // New Ander (left) digit format\n                   /^B[0-9]$/.test(prediction);   // New Bahar (right) digit format\n          case SatamatkaGameMode.CROSSING:\n            // For Crossing, prediction can now be:\n            // - A single digit (original implementation)\n            // - A string representing multiple digits to create combinations\n            // - A format like \"2,3,5\" indicating selected digits for combination\n            return /^[0-9]$/.test(prediction) || // Original format (single digit)\n                   /^[0-9]+(,[0-9]+)+$/.test(prediction) || // Comma-separated digits\n                   /^Combinations of [0-9,]+$/.test(prediction) || // Text description format\n                   /^[0-9]+ digits \\([0-9]+ combinations\\)$/.test(prediction); // Summary format\n          case SatamatkaGameMode.ODD_EVEN:\n            // For Odd-Even, prediction should be \"odd\" or \"even\"\n            return prediction === \"odd\" || prediction === \"even\";\n          default:\n            return false;\n        }\n      };\n\n      if (!validatePrediction()) {\n        return res.status(400).json({ message: \"Invalid prediction for selected game mode\" });\n      }\n\n      // Check user balance\n      const user = await storage.getUser(req.user!.id);\n      \n      // Convert bet amount to paisa for balance comparison (user.balance is in paisa)\n      const betAmountInPaisa = betAmount * 100;\n      if (!user || user.balance < betAmountInPaisa) {\n        return res.status(400).json({ message: \"Insufficient balance\" });\n      }\n\n      // For now, we'll record the game but not determine the result yet\n      // Results will be determined when the market results are published\n      // For simplicity, we'll use a placeholder for the result\n      const result = \"pending\";\n      const payout = 0; // Will be calculated when results are published\n      \n      // Update user balance (deduct bet amount in paisa)\n      const newBalance = user.balance - betAmountInPaisa;\n      await storage.updateUserBalance(user.id, newBalance);\n\n      // Store the player's assigned subadmin ID in the game data for odds calculation later\n      // This will be used when processing results to apply the correct subadmin-specific odds\n      let gameData = {\n        assignedSubadminId: user.assignedTo || null\n      };\n      \n      // Record the game, storing the bet amount in paisa for consistency\n      const game = await storage.createGame({\n        userId: user.id,\n        gameType: GameType.SATAMATKA,\n        betAmount: betAmountInPaisa,  // Store in paisa like other game types\n        prediction,\n        result,\n        payout,\n        marketId,\n        gameMode,\n        balanceAfter: newBalance, // Track balance after this bet\n        gameData  // Store the assigned subadmin ID for odds calculation during result processing\n      });\n\n      // Return game info with updated user balance\n      res.json({\n        game: {\n          ...game,\n          // For frontend display, return the bet amount in rupees\n          betAmount: betAmount\n        },\n        user: {\n          ...user,\n          balance: newBalance,\n          password: undefined,\n        },\n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Play multiple Satamatka bets at once (bulk betting)\n  app.post(\"/api/satamatka/play-multiple\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      if (req.user!.isBlocked) {\n        return res.status(403).json({ message: \"Your account is blocked\" });\n      }\n\n      const { marketId, gameMode, bets } = req.body;\n      \n      // Validate input\n      if (!marketId || !gameMode || !bets || !Array.isArray(bets) || bets.length === 0) {\n        return res.status(400).json({ message: \"Invalid input parameters\" });\n      }\n\n      // Validate game mode\n      if (!Object.values(SatamatkaGameMode).includes(gameMode)) {\n        return res.status(400).json({ message: \"Invalid game mode\" });\n      }\n\n      // Check if market exists and is open\n      const market = await storage.getSatamatkaMarket(marketId);\n      if (!market) {\n        return res.status(404).json({ message: \"Market not found\" });\n      }\n\n      if (market.status !== \"open\") {\n        // Provide a more specific error message based on the actual market status\n        const statusMessages = {\n          \"waiting\": \"Market is not yet active for betting\",\n          \"closed\": \"Market is in 'Waiting Results' status and closed for betting\",\n          \"resulted\": \"Market results have been declared\",\n          \"settled\": \"Market has been settled\"\n        };\n        \n        const message = statusMessages[market.status as keyof typeof statusMessages] || \n                       \"Market is not available for betting\";\n        \n        return res.status(400).json({ message });\n      }\n      \n      // Validate each bet and calculate total amount\n      let totalBetAmount = 0;\n      const validatedBets = [];\n      \n      for (const bet of bets) {\n        const { prediction, betAmount } = bet;\n        \n        if (!prediction || !betAmount || betAmount <= 0) {\n          return res.status(400).json({ \n            message: \"Invalid bet parameters\", \n            detail: `Bet on ${prediction} with amount ${betAmount} is invalid`\n          });\n        }\n        \n        // Validate prediction based on game mode\n        const isValidPrediction = (() => {\n          switch (gameMode) {\n            case SatamatkaGameMode.JODI:\n              return /^[0-9]{2}$/.test(prediction);\n            case SatamatkaGameMode.HARF:\n              return /^[0-9]$/.test(prediction) || \n                     /^L[0-9]$/.test(prediction) || \n                     /^R[0-9]$/.test(prediction) ||\n                     /^A[0-9]$/.test(prediction) || // New format: Ander (A) digit\n                     /^B[0-9]$/.test(prediction);   // New format: Bahar (B) digit\n            case SatamatkaGameMode.CROSSING:\n              return /^[0-9]$/.test(prediction) || \n                     /^[0-9][0-9]$/.test(prediction) ||\n                     /^[0-9]+(,[0-9]+)+$/.test(prediction) || \n                     /^Combinations of [0-9,]+$/.test(prediction) || \n                     /^[0-9]+ digits \\([0-9]+ combinations\\)$/.test(prediction);\n            case SatamatkaGameMode.ODD_EVEN:\n              return prediction === \"odd\" || prediction === \"even\";\n            default:\n              return false;\n          }\n        })();\n        \n        if (!isValidPrediction) {\n          return res.status(400).json({ \n            message: \"Invalid prediction for selected game mode\",\n            detail: `Prediction '${prediction}' is not valid for game mode '${gameMode}'`\n          });\n        }\n        \n        // Add bet amount to total (ensuring all amounts are in paisa)\n        totalBetAmount += betAmount;\n        validatedBets.push({ prediction, betAmount });\n      }\n      \n      // For total bet amount, we need to make sure we're using paisa consistently\n      const totalBetAmountInPaisa = totalBetAmount;\n      \n      // Check user balance against the TOTAL amount for all bets\n      const user = await storage.getUser(req.user!.id);\n      if (!user || user.balance < totalBetAmountInPaisa) {\n        return res.status(400).json({ \n          message: \"Insufficient balance\",\n          detail: `Total bet amount ${totalBetAmountInPaisa / 100} exceeds available balance ${user?.balance ? user.balance / 100 : 0}`\n        });\n      }\n      \n      // Update user balance (deduct TOTAL bet amount in paisa)\n      const newBalance = user.balance - totalBetAmountInPaisa;\n      await storage.updateUserBalance(user.id, newBalance);\n      \n      // Record each game\n      const createdGames = [];\n      \n      // Track decreasing balance for each individual bet\n      let currentBalance = user.balance;\n      \n      for (const bet of validatedBets) {\n        // Bet amounts are already in paisa from the client side\n        const betAmountInPaisa = bet.betAmount;\n        \n        // Deduct this specific bet from the running balance\n        currentBalance -= betAmountInPaisa;\n        \n        const game = await storage.createGame({\n          userId: user.id,\n          gameType: GameType.SATAMATKA,\n          betAmount: betAmountInPaisa,  // Store in paisa like other game types\n          prediction: bet.prediction,\n          result: \"pending\",\n          payout: 0,  // Will be calculated when results are published\n          marketId,\n          gameMode,\n          balanceAfter: currentBalance, // Track balance after EACH bet is placed\n        });\n        \n        // Add to list of created games (for response)\n        createdGames.push({\n          ...game,\n          betAmount: betAmountInPaisa  // Return bet amount in paisa for consistency\n        });\n      }\n      \n      // Return all games with updated user balance\n      res.json({\n        games: createdGames,\n        user: {\n          ...user,\n          balance: newBalance,\n          password: undefined,\n        },\n        totalBetAmount: totalBetAmountInPaisa  // In paisa for consistency\n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Team Match Routes\n\n  // Get all team matches\n  app.get(\"/api/team-matches\", async (req, res, next) => {\n    try {\n      const matches = await storage.getAllTeamMatches();\n      res.json(matches);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get active team matches\n  app.get(\"/api/team-matches/active\", async (req, res, next) => {\n    try {\n      const matches = await storage.getActiveTeamMatches();\n      res.json(matches);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get matches by category\n  app.get(\"/api/team-matches/category/:category\", async (req, res, next) => {\n    try {\n      const category = req.params.category;\n      if (!Object.values(MatchCategory).includes(category as any)) {\n        return res.status(400).json({ message: \"Invalid category\" });\n      }\n      \n      const matches = await storage.getTeamMatchesByCategory(category);\n      res.json(matches);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get a specific match\n  app.get(\"/api/team-matches/:id\", async (req, res, next) => {\n    try {\n      const matchId = Number(req.params.id);\n      const match = await storage.getTeamMatch(matchId);\n      \n      if (!match) {\n        return res.status(404).json({ message: \"Match not found\" });\n      }\n      \n      res.json(match);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Create a new team match (admin only)\n  app.post(\"/api/team-matches\", requireRole(UserRole.ADMIN), async (req, res, next) => {\n    try {\n      console.log(\"Received match data:\", JSON.stringify(req.body));\n      \n      // Parse and validate the input data directly from req.body\n      const matchData = insertTeamMatchSchema.parse(req.body);\n      console.log(\"Parsed match data:\", JSON.stringify(matchData));\n      \n      const match = await storage.createTeamMatch(matchData);\n      res.status(201).json(match);\n    } catch (err) {\n      console.error(\"Error creating match:\", err);\n      next(err);\n    }\n  });\n\n  // Update match status\n  app.patch(\"/api/team-matches/:id/status\", requireRole(UserRole.ADMIN), async (req, res, next) => {\n    try {\n      const matchId = Number(req.params.id);\n      const { status } = req.body;\n      \n      if (!status || ![\"open\", \"closed\", \"resulted\"].includes(status)) {\n        return res.status(400).json({ message: \"Invalid status\" });\n      }\n      \n      const match = await storage.updateTeamMatchStatus(matchId, status);\n      \n      if (!match) {\n        return res.status(404).json({ message: \"Match not found\" });\n      }\n      \n      res.json(match);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Update match result\n  app.patch(\"/api/team-matches/:id/result\", requireRole(UserRole.ADMIN), async (req, res, next) => {\n    try {\n      const matchId = Number(req.params.id);\n      const { result } = req.body;\n      \n      if (!result || !Object.values(TeamMatchResult).includes(result as any)) {\n        return res.status(400).json({ message: \"Invalid result\" });\n      }\n      \n      // Cannot set result to \"pending\"\n      if (result === TeamMatchResult.PENDING) {\n        return res.status(400).json({ message: \"Cannot set result to pending\" });\n      }\n      \n      // Verify match exists\n      const match = await storage.getTeamMatch(matchId);\n      if (!match) {\n        return res.status(404).json({ message: \"Match not found\" });\n      }\n      \n      // Update match result\n      const updatedMatch = await storage.updateTeamMatchResult(matchId, result);\n      \n      // Process all bets on this match\n      const matchGames = await storage.getTeamMatchGamesByMatchId(matchId);\n      for (const game of matchGames) {\n        const user = await storage.getUser(game.userId);\n        if (!user) continue;\n        \n        let payout = 0;\n        \n        // Check if prediction matches result\n        if (game.prediction === result) {\n          // Get base odds from match\n          let baseOdds = 0;\n          if (result === TeamMatchResult.TEAM_A) {\n            baseOdds = match.oddTeamA / 100; // Convert from integer (200) to decimal (2.00)\n          } else if (result === TeamMatchResult.TEAM_B) {\n            baseOdds = match.oddTeamB / 100;\n          } else if (result === TeamMatchResult.DRAW) {\n            baseOdds = match.oddDraw ? match.oddDraw / 100 : 3.00; // Default to 3.00 if not set\n          }\n          \n          // Check if player is assigned to a subadmin with custom odds\n          let odds = baseOdds; // Default to base odds\n          \n          if (user.assignedTo) {\n            // Check for custom odds for this subadmin\n            try {\n              const subadminId = user.assignedTo;\n              const customOdds = await db.select()\n                .from(schema.gameOdds)\n                .where(\n                  and(\n                    eq(schema.gameOdds.gameType, 'team_match'),\n                    eq(schema.gameOdds.subadminId, subadminId),\n                    eq(schema.gameOdds.setByAdmin, false)\n                  )\n                );\n                \n              if (customOdds && customOdds.length > 0) {\n                // Use custom subadmin odds\n                odds = customOdds[0].oddValue / 10000;\n                console.log(`Using custom subadmin ${subadminId} odds for player ${user.id}: ${odds}x (base odds: ${baseOdds}x)`);\n              } else {\n                console.log(`No custom odds found for subadmin ${subadminId}, using base odds: ${baseOdds}x`);\n              }\n            } catch (error) {\n              console.error(`Error retrieving custom odds:`, error);\n              // Continue with base odds if there's an error\n            }\n          }\n          \n          payout = Math.floor(game.betAmount * odds);\n        }\n        \n        // Only add payout to user balance if they won (payout > 0)\n        if (payout > 0) {\n          // Calculate new user balance after applying payout\n          const updatedBalance = user.balance + payout;\n          \n          // Update game payout, result, and balanceAfter in the games table\n          await db.update(games)\n            .set({ \n              payout,\n              result, // Update the result in the games table to reflect the match result\n              balanceAfter: game.balanceAfter! + payout // Add payout to the stored balance\n            })\n            .where(eq(games.id, game.id));\n          \n          // Update user balance\n          await storage.updateUserBalance(user.id, updatedBalance);\n        } else {\n          // Just update the game result and payout, keep the original balanceAfter\n          await db.update(games)\n            .set({ \n              payout,\n              result // Update the result in the games table to reflect the match result\n            })\n            .where(eq(games.id, game.id));\n        }\n      }\n      \n      res.json(updatedMatch);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Update a team match\n  app.patch(\"/api/team-matches/:id\", requireRole(UserRole.ADMIN), async (req, res, next) => {\n    try {\n      const matchId = Number(req.params.id);\n      \n      // Verify match exists\n      const match = await storage.getTeamMatch(matchId);\n      if (!match) {\n        return res.status(404).json({ message: \"Match not found\" });\n      }\n      \n      // Create a partial schema for updates\n      const updateMatchSchema = insertTeamMatchSchema.partial();\n      \n      // Validate and transform the update data\n      const updateData = updateMatchSchema.parse(req.body);\n      \n      // Update the match\n      const updatedMatch = await storage.updateTeamMatch(matchId, updateData);\n      \n      return res.json(updatedMatch);\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Place a bet on a team match\n  app.post(\"/api/team-matches/:id/play\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      if (req.user!.isBlocked) {\n        return res.status(403).json({ message: \"Your account is blocked\" });\n      }\n      \n      const matchId = Number(req.params.id);\n      const { prediction, betAmount } = req.body;\n      \n      // Validate input\n      if (!betAmount || betAmount <= 0) {\n        return res.status(400).json({ message: \"Invalid bet amount\" });\n      }\n      \n      if (!prediction || ![\"team_a\", \"team_b\", \"draw\"].includes(prediction)) {\n        return res.status(400).json({ message: \"Invalid prediction\" });\n      }\n      \n      // Get the match\n      const match = await storage.getTeamMatch(matchId);\n      if (!match) {\n        return res.status(404).json({ message: \"Match not found\" });\n      }\n      \n      // Check if match is still open for betting\n      if (match.status !== \"open\") {\n        // Provide a more specific error message based on the actual match status\n        const statusMessages = {\n          \"waiting\": \"Match is not yet active for betting\",\n          \"closed\": \"Match is closed for betting\",\n          \"resulted\": \"Match results have been declared\"\n        };\n        \n        const message = statusMessages[match.status as keyof typeof statusMessages] || \n                       \"Match is not available for betting\";\n        \n        return res.status(400).json({ message });\n      }\n      \n      // Check if match time is in the future\n      const now = new Date();\n      if (new Date(match.matchTime) <= now) {\n        return res.status(400).json({ message: \"Match has already started\" });\n      }\n      \n      // Check user balance\n      const user = await storage.getUser(req.user!.id);\n      if (!user || user.balance < betAmount) {\n        return res.status(400).json({ message: \"Insufficient balance\" });\n      }\n      \n      // Deduct bet amount from user balance\n      const newBalance = user.balance - betAmount;\n      await storage.updateUserBalance(user.id, newBalance);\n      \n      // Record the game (payout will be processed when result is set)\n      const game = await storage.createGame({\n        userId: user.id,\n        gameType: GameType.TEAM_MATCH,\n        betAmount,\n        prediction,\n        result: TeamMatchResult.PENDING, // Result will be updated when match ends\n        payout: 0, // Payout will be updated when result is set\n        matchId,\n        balanceAfter: newBalance, // Track balance after this bet\n      });\n      \n      // Return game info with updated user balance\n      res.json({\n        game,\n        match,\n        user: {\n          ...user,\n          balance: newBalance,\n          password: undefined,\n        },\n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Get games for a specific match\n  app.get(\"/api/team-matches/:id/games\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const matchId = Number(req.params.id);\n      \n      // Verify match exists\n      const match = await storage.getTeamMatch(matchId);\n      if (!match) {\n        return res.status(404).json({ message: \"Match not found\" });\n      }\n      \n      const games = await storage.getTeamMatchGamesByMatchId(matchId);\n      res.json(games);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Play toss on a team match\n  app.post(\"/api/team-matches/:id/play-toss\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      if (req.user!.isBlocked) {\n        return res.status(403).json({ message: \"Your account is blocked\" });\n      }\n\n      const matchId = Number(req.params.id);\n      \n      // Validate request body\n      const playSchema = z.object({\n        betAmount: z.number().min(10, \"Minimum bet amount is 10\"),\n        betOn: z.enum([TeamMatchResult.TEAM_A, TeamMatchResult.TEAM_B], {\n          errorMap: () => ({ message: \"Bet must be on either team_a or team_b\" })\n        })\n      });\n      \n      // Handle potential parsing errors (client may send string instead of number)\n      const parsedBody = {\n        ...req.body,\n        betAmount: typeof req.body.betAmount === 'string' \n          ? parseInt(req.body.betAmount, 10)\n          : req.body.betAmount\n      };\n      \n      const validationResult = playSchema.safeParse(parsedBody);\n      \n      if (!validationResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid bet amount or prediction\" \n        });\n      }\n      \n      const { betAmount, betOn } = validationResult.data;\n      \n      // Get the team match\n      const match = await storage.getTeamMatch(matchId);\n      \n      if (!match) {\n        return res.status(404).json({ message: \"Team match not found\" });\n      }\n      \n      if (match.status !== 'open') {\n        // Provide a more specific error message based on the actual match status\n        const statusMessages = {\n          \"waiting\": \"Match is not yet active for betting\",\n          \"closed\": \"Match is closed for betting\",\n          \"resulted\": \"Match results have been declared\"\n        };\n        \n        const message = statusMessages[match.status as keyof typeof statusMessages] || \n                       \"Match is not available for betting\";\n        \n        return res.status(400).json({ message });\n      }\n      \n      // Check if user has sufficient balance\n      const user = await storage.getUser(req.user!.id);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      if (user.balance < betAmount) {\n        return res.status(400).json({ message: \"Insufficient balance\" });\n      }\n      \n      // Deduct the bet amount from user's balance\n      await storage.updateUserBalance(user.id, user.balance - betAmount);\n      \n      // Calculate potential payout based on odds\n      const odds = betOn === TeamMatchResult.TEAM_A ? match.oddTeamA : match.oddTeamB;\n      const potentialPayout = Math.floor((betAmount * odds) / 100);\n      \n      // Calculate the new balance\n      const newBalance = user.balance - betAmount;\n      \n      // Create a new game entry for this user's bet\n      const userBet = {\n        userId: user.id,\n        gameType: GameType.CRICKET_TOSS,\n        matchId: match.id,\n        betAmount,\n        prediction: betOn,\n        gameData: {\n          teamA: match.teamA,\n          teamB: match.teamB,\n          matchId: match.id,\n          oddTeamA: match.oddTeamA,\n          oddTeamB: match.oddTeamB,\n          matchTime: match.matchTime,\n          status: 'pending'\n        },\n        result: \"pending\",\n        payout: potentialPayout,\n        balanceAfter: newBalance // Track balance after this bet\n      };\n      \n      const createdBet = await storage.createGame(userBet);\n      \n      res.status(201).json({\n        message: \"Bet placed successfully\",\n        game: createdBet,\n        user: {\n          ...user,\n          balance: newBalance,\n          password: undefined,\n        }\n      });\n    } catch (error) {\n      next(error);\n    }\n  });\n  \n  // Cricket Toss Betting Statistics\n  app.get(\"/api/cricket-toss-stats\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res) => {\n    // Get the requesting user's role and ID\n    const requestingUserId = req.user!.id;\n    const requestingUserRole = req.user!.role;\n    try {\n      console.log(\"==== Starting Cricket Toss Stats API ====\");\n      \n      // Manually construct hardcoded stats for testing/development\n      // Get real cricket toss games from the database\n      console.log(\"Getting cricket toss games from database\");\n      \n      // Build the SQL query - if subadmin, only show games from their players\n      let sql;\n      \n      if (requestingUserRole === UserRole.SUBADMIN) {\n        // Get only games from players assigned to this subadmin\n        sql = `\n          SELECT g.*, \n                 u.username as user_username \n          FROM games g\n          JOIN users u ON g.user_id = u.id\n          WHERE g.game_type = 'cricket_toss'\n            AND u.assigned_to = ${requestingUserId}\n          ORDER BY g.id\n        `;\n        console.log(`Filtering cricket toss games for subadmin ${requestingUserId}`);\n      } else {\n        // Admin can see all games\n        sql = `\n          SELECT g.*, \n                 u.username as user_username \n          FROM games g\n          JOIN users u ON g.user_id = u.id\n          WHERE g.game_type = 'cricket_toss'\n          ORDER BY g.id\n        `;\n      }\n      \n      const result = await db.execute(sql);\n      console.log(`Found ${result.rows.length} cricket toss games in DB`);\n      \n      // Look at the data structure\n      if (result.rows.length > 0) {\n        console.log(\"First cricket toss row structure:\", \n          JSON.stringify(result.rows[0], null, 2));\n      }\n      \n      // Group games by match ID\n      const matchesMap = new Map();\n      \n      // First, create entries for each unique match\n      for (const game of result.rows) {\n        try {\n          // Parse the game_data column\n          const gameData = typeof game.game_data === 'string' \n            ? JSON.parse(game.game_data) \n            : game.game_data;\n          \n          if (!gameData) continue;\n          \n          const matchId = gameData.matchId || null;\n          if (!matchId) continue;\n          \n          // Skip if we've already processed this match\n          if (matchesMap.has(matchId)) continue;\n          \n          matchesMap.set(matchId, {\n            matchId,\n            matchName: `${gameData.teamA || 'Team A'} vs ${gameData.teamB || 'Team B'}`,\n            startTime: gameData.matchTime || new Date().toISOString(),\n            status: gameData.status || 'unknown',\n            teamA: gameData.teamA || 'Team A',\n            teamB: gameData.teamB || 'Team B',\n            teamAGames: [],\n            teamBGames: [],\n            drawGames: []\n          });\n          \n          console.log(`Added match ${matchId}: ${gameData.teamA} vs ${gameData.teamB}`);\n        } catch (e) {\n          console.log(`Error parsing game data for game ${game.id}:`, e);\n          continue;\n        }\n      }\n      \n      console.log(`Created ${matchesMap.size} unique cricket matches`);\n      \n      // Now assign bets to the appropriate teams\n      for (const game of result.rows) {\n        try {\n          // Skip games with zero bet amount (templates)\n          if (game.bet_amount === 0) continue;\n          \n          // Parse the game_data column\n          const gameData = typeof game.game_data === 'string' \n            ? JSON.parse(game.game_data) \n            : game.game_data;\n          \n          if (!gameData) continue;\n          \n          const matchId = gameData.matchId || null;\n          if (!matchId || !matchesMap.has(matchId)) continue;\n          \n          const match = matchesMap.get(matchId);\n          \n          // Process the bet\n          console.log(`Processing bet for game ${game.id}, prediction: ${game.prediction}`);\n          \n          // Simplified game object for storing\n          const simplifiedGame = {\n            id: game.id,\n            userId: game.user_id,\n            username: game.user_username,\n            betAmount: game.bet_amount,\n            prediction: game.prediction,\n            payout: game.payout,\n            result: game.result\n          };\n          \n          // Add to appropriate team based on prediction\n          const prediction = game.prediction || \"\";\n          if (prediction === \"team_a\") {\n            match.teamAGames.push(simplifiedGame);\n            console.log(`Added game ${game.id} to team A (${match.teamA})`);\n          } else if (prediction === \"team_b\") {\n            match.teamBGames.push(simplifiedGame);\n            console.log(`Added game ${game.id} to team B (${match.teamB})`);\n          } else if (prediction === \"draw\") {\n            match.drawGames.push(simplifiedGame);\n            console.log(`Added game ${game.id} to Draw option`);\n          } else {\n            console.log(`Unknown prediction \"${prediction}\" for game ${game.id}`);\n          }\n        } catch (e) {\n          console.log(`Error processing bet for game ${game.id}:`, e);\n          continue;\n        }\n      }\n      \n      // Filter for subadmin (commented out for testing)\n      // if (req.user?.role === UserRole.SUBADMIN) {\n      //   const assignedUsers = await storage.getUsersByAssignedTo(req.user.id);\n      //   const assignedUserIds = assignedUsers.map(user => user.id);\n      //   \n      //   for (const [matchId, match] of matchesMap.entries()) {\n      //     match.teamAGames = match.teamAGames.filter(game => assignedUserIds.includes(game.userId));\n      //     match.teamBGames = match.teamBGames.filter(game => assignedUserIds.includes(game.userId));\n      //     match.drawGames = match.drawGames.filter(game => assignedUserIds.includes(game.userId));\n      //   }\n      // }\n      \n      // Format the results for the client\n      const matchStats = [];\n      \n      for (const [_, match] of matchesMap.entries()) {\n        // Calculate team A stats\n        const teamAUniqueUsers = new Set(match.teamAGames.map(game => game.userId)).size;\n        const teamATotalBets = match.teamAGames.length;\n        const teamATotalAmount = match.teamAGames.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n        const teamAPotentialWinAmount = match.teamAGames.reduce((sum, game) => sum + (game.payout || 0), 0);\n        \n        // Calculate team B stats\n        const teamBUniqueUsers = new Set(match.teamBGames.map(game => game.userId)).size;\n        const teamBTotalBets = match.teamBGames.length;\n        const teamBTotalAmount = match.teamBGames.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n        const teamBPotentialWinAmount = match.teamBGames.reduce((sum, game) => sum + (game.payout || 0), 0);\n        \n        // Create the stats object\n        const matchStat = {\n          matchId: match.matchId,\n          matchName: match.matchName,\n          startTime: match.startTime,\n          status: match.status,\n          teams: [\n            {\n              teamName: match.teamA,\n              totalBets: teamATotalBets,\n              totalAmount: teamATotalAmount,\n              potentialWinAmount: teamAPotentialWinAmount,\n              uniqueUsers: teamAUniqueUsers\n            },\n            {\n              teamName: match.teamB,\n              totalBets: teamBTotalBets,\n              totalAmount: teamBTotalAmount,\n              potentialWinAmount: teamBPotentialWinAmount,\n              uniqueUsers: teamBUniqueUsers\n            }\n          ]\n        };\n        \n        // Add draw stats if any\n        if (match.drawGames.length > 0) {\n          const drawUniqueUsers = new Set(match.drawGames.map(game => game.userId)).size;\n          const drawTotalAmount = match.drawGames.reduce((sum, game) => sum + (game.betAmount || 0), 0);\n          const drawPotentialWinAmount = match.drawGames.reduce((sum, game) => sum + (game.payout || 0), 0);\n          \n          matchStat.teams.push({\n            teamName: \"Draw\",\n            totalBets: match.drawGames.length,\n            totalAmount: drawTotalAmount,\n            potentialWinAmount: drawPotentialWinAmount,\n            uniqueUsers: drawUniqueUsers\n          });\n        }\n        \n        // Only include matches that have bets\n        if (teamATotalBets > 0 || teamBTotalBets > 0 || match.drawGames.length > 0) {\n          matchStats.push(matchStat);\n        }\n      }\n      \n      console.log(`Returning ${matchStats.length} cricket matches with betting activity`);\n      \n      res.json(matchStats);\n    } catch (err) {\n      console.error(\"Error in cricket toss stats API:\", err);\n      // Return empty array instead of error\n      res.json([]);\n    }\n  });\n  \n  // Sports Match Betting Statistics\n  app.get(\"/api/sports/stats\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      // Get active team matches for sports\n      const matches = await storage.getActiveTeamMatches();\n      \n      // Filter matches for sports categories (e.g., \"football\", \"basketball\", \"ipl\")\n      const sportsMatches = matches.filter(match => \n        match.category !== \"cricket\" && match.category !== undefined\n      );\n      \n      // For each match, get games and calculate stats\n      const matchStats = await Promise.all(sportsMatches.map(async (match) => {\n        const games = await storage.getTeamMatchGamesByMatchId(match.id);\n        \n        // If subadmin, filter only their assigned users' games\n        let filteredGames = games;\n        if (req.user?.role === UserRole.SUBADMIN) {\n          const assignedUsers = await storage.getUsersByAssignedTo(req.user!.id);\n          const assignedUserIds = assignedUsers.map(user => user.id);\n          filteredGames = games.filter(game => assignedUserIds.includes(game.userId));\n        }\n        \n        // Count games for each team\n        const teamA = match.teamA;\n        const teamB = match.teamB;\n        \n        const teamAGames = filteredGames.filter(game => game.prediction === teamA);\n        const teamBGames = filteredGames.filter(game => game.prediction === teamB);\n        \n        // Get unique users\n        const teamAUniqueUsers = new Set(teamAGames.map(game => game.userId)).size;\n        const teamBUniqueUsers = new Set(teamBGames.map(game => game.userId)).size;\n        \n        // Calculate totals\n        const teamATotalBets = teamAGames.length;\n        const teamBTotalBets = teamBGames.length;\n        \n        const teamATotalAmount = teamAGames.reduce((sum, game) => sum + game.betAmount, 0);\n        const teamBTotalAmount = teamBGames.reduce((sum, game) => sum + game.betAmount, 0);\n        \n        const teamAPotentialWinAmount = teamAGames.reduce((sum, game) => sum + (game.payout || 0), 0);\n        const teamBPotentialWinAmount = teamBGames.reduce((sum, game) => sum + (game.payout || 0), 0);\n        \n        return {\n          matchId: match.id,\n          matchName: `${match.teamA} vs ${match.teamB}`,\n          category: match.category,\n          startTime: match.matchTime,\n          teams: [\n            {\n              teamName: match.teamA,\n              totalBets: teamATotalBets,\n              totalAmount: teamATotalAmount,\n              potentialWinAmount: teamAPotentialWinAmount,\n              uniqueUsers: teamAUniqueUsers\n            },\n            {\n              teamName: match.teamB,\n              totalBets: teamBTotalBets,\n              totalAmount: teamBTotalAmount,\n              potentialWinAmount: teamBPotentialWinAmount,\n              uniqueUsers: teamBUniqueUsers\n            }\n          ]\n        };\n      }));\n      \n      res.json(matchStats);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Jantri Management Routes removed for platform simplification\n\n  // Settings routes\n  // System Settings\n  app.get(\"/api/settings\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const settingType = req.query.type as string;\n      \n      if (!settingType) {\n        return res.status(400).json({ message: \"Setting type is required\" });\n      }\n      \n      const settings = await storage.getSystemSettingsByType(settingType);\n      res.json(settings);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  app.post(\"/api/settings\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const { settingType, settingKey, settingValue } = req.body;\n      \n      if (!settingType || !settingKey || !settingValue) {\n        return res.status(400).json({ message: \"settingType, settingKey, and settingValue are required\" });\n      }\n      \n      const setting = await storage.upsertSystemSetting(settingType, settingKey, settingValue);\n      res.json(setting);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Game Odds Settings\n  app.get(\"/api/game-odds\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const gameType = req.query.gameType as string;\n      \n      if (!gameType) {\n        return res.status(400).json({ message: \"Game type is required\" });\n      }\n      \n      // Important: We only want platform/admin odds here, not subadmin odds\n      // Set includeSubadminOdds to false to get only admin odds\n      const odds = await storage.getGameOdds(gameType, false);\n      res.json(odds);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Get player-specific game odds endpoint\n  // This returns the odds applicable to a player based on their assigned subadmin\n  app.get(\"/api/game-odds/player\", async (req, res, next) => {\n    try {\n      // Must be logged in to use this endpoint\n      if (!req.isAuthenticated() || !req.user) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      const gameType = req.query.gameType as string || '';\n      \n      if (!gameType) {\n        return res.status(400).json({ message: \"Game type is required\" });\n      }\n      \n      // Get the requesting user's details\n      const userId = req.user.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      let resultOdds;\n      \n      // If player is assigned to a subadmin, check for custom odds first\n      if (user.assignedTo) {\n        try {\n          // Get all custom odds for this specific subadmin ID and game type directly from DB\n          console.log(`Checking for custom odds for subadmin ${user.assignedTo} and gameType ${gameType}`);\n          \n          // Query to find custom odds for this subadmin and game type\n          const customOdds = await db.select()\n            .from(schema.gameOdds)\n            .where(\n              and(\n                eq(schema.gameOdds.gameType, gameType),\n                eq(schema.gameOdds.subadminId, user.assignedTo)\n                // Removed filter for setByAdmin=false to ensure we get any odds\n                // associated with this subadmin, regardless of how they were set\n              )\n            );\n          \n          console.log(`Direct DB query for subadmin ${user.assignedTo} odds returned:`, customOdds);\n          \n          // If custom odds exist for this subadmin, use them\n          if (customOdds && customOdds.length > 0) {\n            console.log(`Found custom odds for subadmin ${user.assignedTo}, using these for player ${userId}:`, customOdds);\n            resultOdds = customOdds;\n          } else {\n            // No custom odds found, use admin default odds\n            const adminOdds = await db.select()\n              .from(schema.gameOdds)\n              .where(\n                and(\n                  eq(schema.gameOdds.gameType, gameType),\n                  eq(schema.gameOdds.setByAdmin, true)\n                )\n              );\n            \n            console.log(`No custom odds for subadmin ${user.assignedTo}, using admin odds:`, adminOdds);\n            resultOdds = adminOdds;\n          }\n        } catch (err) {\n          console.error(`Error fetching odds:`, err);\n          // Fall back to platform odds on error\n          const platformOdds = await db.select()\n            .from(schema.gameOdds)\n            .where(\n              and(\n                eq(schema.gameOdds.gameType, gameType),\n                eq(schema.gameOdds.setByAdmin, true)\n              )\n            );\n          \n          console.log(`Error occurred, using platform odds for player ${userId}, gameType ${gameType}:`, platformOdds);\n          resultOdds = platformOdds;\n        }\n      } else {\n        // If player is not assigned to any subadmin, use regular platform odds\n        const platformOdds = await storage.getGameOdds(gameType);\n        console.log(`Using platform odds for player ${userId}, gameType ${gameType} (not assigned to any subadmin):`, platformOdds);\n        resultOdds = platformOdds;\n      }\n      \n      // Don't modify the odd values here - return them exactly as stored\n      // The client will handle the display logic with the correct formatting\n      \n      // Add more detailed logging to debug odds issues\n      console.log(`Sending odds response to player ${userId} for ${gameType}:`, resultOdds);\n      res.json(resultOdds);\n    } catch (err) {\n      console.error(\"Error fetching player odds:\", err);\n      next(err);\n    }\n  });\n  \n  // Get admin odds endpoint\n  // This array should include 'team_match_draw' for the draw multiplier feature\nconst DEFAULT_GAME_TYPES = [\n  'team_match',\n  'team_match_draw',\n  'cricket_toss',\n  'coin_flip',\n  'satamatka_jodi',\n  'satamatka_harf',\n  'satamatka_odd_even',\n  'satamatka_crossing'\n];\n\napp.get(\"/api/odds/admin\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      // Fetch all admin odds\n      const adminOdds = [];\n      \n      for (const gameType of DEFAULT_GAME_TYPES) {\n        const odds = await storage.getGameOdds(gameType);\n        const adminOdd = odds.find(odd => odd.setByAdmin === true);\n        \n        if (adminOdd) {\n          // Convert from integer (stored as * 10000) to decimal for display\n          adminOdds.push({\n            ...adminOdd,\n            oddValue: adminOdd.oddValue / 10000\n          });\n        } else {\n          // Add default odds if no admin odds are set\n          adminOdds.push({\n            gameType,\n            oddValue: gameType.includes('satamatka_jodi') ? 90 : (gameType.includes('satamatka_harf') ? 9 : (gameType.includes('satamatka_crossing') ? 9 : (gameType.includes('cricket_toss') ? 9 : (gameType.includes('coin_flip') ? 9 : 1.9)))),\n            setByAdmin: true\n          });\n        }\n      }\n      \n      res.json(adminOdds);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Post endpoint for subadmin odds - ADMIN ONLY\n  app.post(\"/api/odds/subadmin/:subadminId\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const subadminId = parseInt(req.params.subadminId);\n      const { odds } = req.body;\n      \n      if (!Array.isArray(odds)) {\n        return res.status(400).json({ message: \"odds must be an array of odds settings\" });\n      }\n      \n      // Verify the subadmin exists and is actually a subadmin\n      const subadmin = await storage.getUser(subadminId);\n      if (!subadmin || subadmin.role !== UserRole.SUBADMIN) {\n        return res.status(400).json({ message: \"Invalid subadmin ID\" });\n      }\n      \n      const results = await Promise.all(\n        odds.map(async (odd) => {\n          if (!odd.gameType || odd.oddValue === undefined) {\n            return { error: \"gameType and oddValue are required\", gameType: odd.gameType };\n          }\n          \n          // We need to ensure the odd value is stored properly\n          // When setting for player view, the format should be:\n          // Team match, cricket toss, coin flip: 1.9 admin  0.02 player\n          // Satamatka jodi: 90 admin  0.9 player \n          // Satamatka harf: 9 admin  0.09 player\n          // Crossing: 95 admin  0.95 player\n          \n          // Store the actual value as admin input without modification\n          // The division happens on the client side\n          return storage.upsertGameOdd(\n            odd.gameType,\n            odd.oddValue, // Store the exact value as provided\n            false, // Not set by admin, but for specific subadmin\n            subadminId\n          );\n        })\n      );\n      \n      // Invalidate any cached odds values for this subadmin\n      console.log(`Updated odds for subadmin ${subadminId}, invalidating cache`);\n      \n      res.json({ \n        success: true, \n        message: \"Odds settings updated successfully\",\n        results \n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Get subadmin odds endpoint\n  app.get(\"/api/odds/subadmin/:subadminId?\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      // If subadminId is not provided in path, use the current user's ID (if subadmin)\n      let subadminId = req.params.subadminId ? Number(req.params.subadminId) : \n                        req.user.role === UserRole.SUBADMIN ? req.user.id : null;\n                        \n      if (!subadminId) {\n        return res.status(400).json({ message: \"Subadmin ID is required\" });\n      }\n      \n      // Check if the user is authorized to access this resource\n      if (req.user.role === UserRole.SUBADMIN && req.user.id !== subadminId) {\n        return res.status(403).json({ message: \"Unauthorized\" });\n      }\n      \n      // Define default game types\n      const gameTypes = [\n        'team_match',\n        'cricket_toss',\n        'coin_flip',\n        'satamatka_jodi',\n        'satamatka_harf',\n        'satamatka_odd_even',\n        'satamatka_crossing'\n      ];\n      \n      // Get the subadmin odds\n      const subadminOddsFromDB = await storage.getGameOddsBySubadmin(subadminId);\n      \n      // Get admin odds for fallback\n      const adminOddsResponse = await storage.getGameOdds('');\n      const adminOdds = adminOddsResponse.filter(odd => odd.setByAdmin === true);\n      \n      // Create a complete set of odds using subadmin specific odds where available, falling back to admin odds\n      const completeOdds = [];\n      \n      // Use the default game types array\n      const gameTypesToUse = DEFAULT_GAME_TYPES;\n      \n      for (const gameType of gameTypesToUse) {\n        // Check if subadmin has specific odds for this game type\n        const subadminOdd = subadminOddsFromDB.find(odd => odd.gameType === gameType);\n        \n        if (subadminOdd) {\n          // Use subadmin specific odds, but convert from integer (stored as * 100) to decimal\n          completeOdds.push({\n            ...subadminOdd,\n            oddValue: subadminOdd.oddValue / 10000\n          });\n        } else {\n          // Try to use admin odds as fallback\n          const adminOdd = adminOdds.find(odd => odd.gameType === gameType);\n          \n          if (adminOdd) {\n            // Use admin odds, but mark it as belonging to this subadmin\n            // Convert from integer (stored as * 100) to decimal\n            completeOdds.push({\n              gameType: adminOdd.gameType,\n              oddValue: adminOdd.oddValue / 10000,\n              setByAdmin: false,\n              subadminId\n            });\n          } else {\n            // No admin odds either, use default values\n            completeOdds.push({\n              gameType,\n              oddValue: gameType.includes('satamatka_jodi') ? 90 : (gameType.includes('satamatka_harf') ? 9 : (gameType.includes('satamatka_crossing') ? 95 : 1.9)),\n              setByAdmin: false,\n              subadminId\n            });\n          }\n        }\n      }\n      \n      res.json(completeOdds);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  app.get(\"/api/game-odds/subadmin/:subadminId\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const subadminId = Number(req.params.subadminId);\n      const gameType = req.query.gameType as string;\n      \n      // Check if the user is authorized to access this resource\n      if (req.user.role === UserRole.SUBADMIN && req.user.id !== subadminId) {\n        return res.status(403).json({ message: \"Unauthorized\" });\n      }\n      \n      // Define default game types\n      const DEFAULT_GAME_TYPES = [\n        'team_match',\n        'cricket_toss',\n        'coin_flip',\n        'satamatka_jodi',\n        'satamatka_harf',\n        'satamatka_odd_even',\n        'satamatka_crossing'\n      ];\n      \n      // Get the subadmin odds\n      const subadminOddsFromDB = await storage.getGameOddsBySubadmin(subadminId);\n      console.log(\"Subadmin odds from DB:\", subadminOddsFromDB);\n      \n      // Get admin odds for fallback\n      const adminOddsResponse = await storage.getGameOdds('');\n      const adminOdds = adminOddsResponse.filter(odd => odd.setByAdmin === true);\n      \n      // Create a complete set of odds using subadmin specific odds where available, falling back to admin odds\n      const completeOdds = [];\n      \n      for (const gameType of DEFAULT_GAME_TYPES) {\n        // Check if subadmin has specific odds for this game type\n        const subadminOdd = subadminOddsFromDB.find(odd => odd.gameType === gameType);\n        \n        if (subadminOdd) {\n          // Use subadmin specific odds, but convert from integer (stored as * 100) to decimal\n          completeOdds.push({\n            ...subadminOdd,\n            oddValue: subadminOdd.oddValue / 10000\n          });\n        } else {\n          // Try to use admin odds as fallback\n          const adminOdd = adminOdds.find(odd => odd.gameType === gameType);\n          \n          if (adminOdd) {\n            // Use admin odds, but mark it as belonging to this subadmin\n            // Convert from integer (stored as * 100) to decimal\n            completeOdds.push({\n              gameType: adminOdd.gameType,\n              oddValue: adminOdd.oddValue / 10000,\n              setByAdmin: false,\n              subadminId\n            });\n          } else {\n            // No admin odds either, use default values\n            completeOdds.push({\n              gameType,\n              oddValue: gameType.includes('satamatka_jodi') ? 90 : (gameType.includes('satamatka_harf') ? 9 : (gameType.includes('satamatka_crossing') ? 95 : 1.9)),\n              setByAdmin: false,\n              subadminId\n            });\n          }\n        }\n      }\n      \n      res.json(completeOdds);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // POST endpoint for updating game odds for a specific subadmin\n  app.post(\"/api/game-odds/subadmin/:subadminId\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const subadminId = Number(req.params.subadminId);\n      const { odds } = req.body;\n      \n      if (!Array.isArray(odds)) {\n        return res.status(400).json({ message: \"odds must be an array of odds settings\" });\n      }\n      \n      // Verify the subadmin exists and is actually a subadmin\n      const subadmin = await storage.getUser(subadminId);\n      if (!subadmin || subadmin.role !== UserRole.SUBADMIN) {\n        return res.status(400).json({ message: \"Invalid subadmin ID\" });\n      }\n      \n      const results = await Promise.all(\n        odds.map(async (odd) => {\n          if (!odd.gameType || odd.oddValue === undefined) {\n            return { error: \"gameType and oddValue are required\", gameType: odd.gameType };\n          }\n          \n          // Convert decimal odds to integer by multiplying by 10000 for storage\n          return storage.upsertGameOdd(\n            odd.gameType,\n            odd.oddValue, // Value already multiplied by 10000 in client code\n            false, // Not set by admin, but specific to this subadmin\n            subadminId\n          );\n        })\n      );\n      \n      res.json({ \n        success: true, \n        message: \"Game odds settings updated successfully\",\n        results \n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  app.post(\"/api/game-odds\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const { gameType, oddValue, setByAdmin, subadminId } = req.body;\n      \n      if (!gameType || oddValue === undefined) {\n        return res.status(400).json({ message: \"gameType and oddValue are required\" });\n      }\n      \n      // Admin can set odds for anyone, subadmin can only set their own odds\n      if (req.user.role === UserRole.SUBADMIN) {\n        if (setByAdmin === true) {\n          return res.status(403).json({ message: \"Subadmins cannot set admin odds\" });\n        }\n        \n        if (subadminId && subadminId !== req.user.id) {\n          return res.status(403).json({ message: \"Subadmins can only set their own odds\" });\n        }\n      }\n      \n      // Multiply the value by 10000 for storage to allow decimal values like 1.95 to be stored accurately\n      // This will be divided by 10000 when retrieving for display\n      const storedValue = parseFloat(oddValue) * 10000;\n      \n      const odds = await storage.upsertGameOdd(\n        gameType, \n        storedValue, // Store the value multiplied by 10000\n        req.user.role === UserRole.ADMIN ? (setByAdmin || true) : false,\n        req.user.role === UserRole.ADMIN ? subadminId : req.user.id\n      );\n      \n      res.json(odds);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Subadmin Commission routes\n  app.get(\"/api/commissions/subadmin/:subadminId?\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      // If subadminId is not provided in path, use the current user's ID (if subadmin)\n      let subadminId = req.params.subadminId ? Number(req.params.subadminId) : \n                        req.user.role === UserRole.SUBADMIN ? req.user.id : null;\n                        \n      if (!subadminId) {\n        return res.status(400).json({ message: \"Subadmin ID is required\" });\n      }\n      \n      // Check if the user is authorized to access this resource\n      if (req.user.role === UserRole.SUBADMIN && req.user.id !== subadminId) {\n        return res.status(403).json({ message: \"Unauthorized\" });\n      }\n      \n      // Define default game types\n      const gameTypes = [\n        'team_match',\n        'cricket_toss',\n        'coin_flip',\n        'satamatka_jodi',\n        'satamatka_harf',\n        'satamatka_odd_even',\n        'satamatka_crossing'\n      ];\n      \n      // Get the subadmin commissions from the database\n      const commissionsFromDB = await storage.getSubadminCommissions(subadminId);\n      \n      // Create a complete set of commissions, using defaults where needed\n      const completeCommissions = [];\n      \n      // Get platform default commission rates from system settings\n      const platformDefaultSettings = await Promise.all(\n        gameTypes.map(gameType => \n          storage.getSystemSetting('commission_default', gameType)\n        )\n      );\n      \n      // Map the settings to a more usable format\n      const platformDefaultRates: {[key: string]: number} = {};\n      platformDefaultSettings.forEach((setting, index) => {\n        if (setting) {\n          platformDefaultRates[gameTypes[index]] = parseInt(setting.settingValue);\n        }\n      });\n      \n      // Fallback default commission rates if no system settings exist\n      const fallbackDefaultRates = {\n        'team_match': 10,\n        'cricket_toss': 10,\n        'coin_flip': 10,\n        'satamatka_jodi': 8,\n        'satamatka_harf': 8,\n        'satamatka_odd_even': 10,\n        'satamatka_crossing': 8\n      };\n      \n      for (const gameType of gameTypes) {\n        // Check if subadmin has specific commission for this game type\n        const commission = commissionsFromDB.find(c => c.gameType === gameType);\n        \n        if (commission) {\n          // Use existing commission\n          completeCommissions.push(commission);\n        } else {\n          // Use platform default commission if set by admin\n          const defaultRate = platformDefaultRates[gameType];\n          if (defaultRate !== undefined) {\n            completeCommissions.push({\n              gameType,\n              subadminId,\n              commissionRate: defaultRate\n            });\n          }\n          // If no platform default is set, don't include this game type\n          // This forces admin to set rates explicitly\n        }\n      }\n      \n      res.json(completeCommissions);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Create a subadmin with commission settings in one operation\n  app.post(\"/api/subadmin/create-with-commissions\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const { username, password, commissions } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ message: \"Username and password are required\" });\n      }\n      \n      // First create the subadmin\n      const hashPassword = require('./auth').hashPassword;\n      const hashedPassword = await hashPassword(password);\n      \n      const newSubadmin = await storage.createUser({\n        username,\n        password: hashedPassword,\n        role: UserRole.SUBADMIN,\n      });\n      \n      // If commission settings are provided, set them up for the newly created subadmin\n      if (commissions) {\n        const subadminId = newSubadmin.id;\n        \n        // Set up commission rates for different game types\n        const commissionPromises = [];\n        \n        if (commissions.satamatka_jodi) {\n          commissionPromises.push(\n            storage.upsertSubadminCommission(\n              subadminId, \n              \"satamatka_jodi\", \n              Math.round(parseFloat(commissions.satamatka_jodi) * 100)\n            )\n          );\n        }\n        \n        if (commissions.satamatka_harf) {\n          commissionPromises.push(\n            storage.upsertSubadminCommission(\n              subadminId, \n              \"satamatka_harf\", \n              Math.round(parseFloat(commissions.satamatka_harf) * 100)\n            )\n          );\n        }\n        \n        if (commissions.satamatka_crossing) {\n          commissionPromises.push(\n            storage.upsertSubadminCommission(\n              subadminId, \n              \"satamatka_crossing\", \n              Math.round(parseFloat(commissions.satamatka_crossing) * 100)\n            )\n          );\n        }\n        \n        if (commissions.satamatka_odd_even) {\n          commissionPromises.push(\n            storage.upsertSubadminCommission(\n              subadminId, \n              \"satamatka_odd_even\", \n              Math.round(parseFloat(commissions.satamatka_odd_even) * 100)\n            )\n          );\n        }\n        \n        await Promise.all(commissionPromises);\n      }\n      \n      // Remove password from response\n      const { password: _, ...subadminWithoutPassword } = newSubadmin;\n      \n      res.status(201).json({\n        ...subadminWithoutPassword,\n        message: \"Subadmin created successfully with commission settings\"\n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Set individual subadmin commission\n  app.post(\"/api/commissions/subadmin\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const { subadminId, gameType, commissionRate } = req.body;\n      \n      if (!subadminId || !gameType || commissionRate === undefined) {\n        return res.status(400).json({ message: \"subadminId, gameType, and commissionRate are required\" });\n      }\n      \n      // Verify the subadmin exists and is actually a subadmin\n      const subadmin = await storage.getUser(subadminId);\n      if (!subadmin || subadmin.role !== UserRole.SUBADMIN) {\n        return res.status(400).json({ message: \"Invalid subadmin ID\" });\n      }\n      \n      const commission = await storage.upsertSubadminCommission(subadminId, gameType, commissionRate);\n      res.json(commission);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Get platform-wide default commission rates\n  app.get(\"/api/commissions/default\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      // Define default game types\n      const gameTypes = [\n        'team_match',\n        'cricket_toss',\n        'coin_flip',\n        'satamatka_jodi',\n        'satamatka_harf',\n        'satamatka_odd_even',\n        'satamatka_crossing'\n      ];\n      \n      // Get platform default commission rates from system settings\n      const platformDefaultSettings = await Promise.all(\n        gameTypes.map(gameType => \n          storage.getSystemSetting('commission_default', gameType)\n        )\n      );\n      \n      // Map the settings to a more usable format\n      const defaultRates: {[key: string]: number} = {};\n      platformDefaultSettings.forEach((setting, index) => {\n        if (setting) {\n          // Convert from integer (stored value) to decimal percentage for client display\n          defaultRates[gameTypes[index]] = parseInt(setting.settingValue) / 100;\n        }\n      });\n      \n      // Only return rates that have been actually set by admin - no hardcoded fallbacks\n      const completeDefaultRates: {[key: string]: number} = {};\n      \n      for (const gameType of gameTypes) {\n        if (defaultRates[gameType] !== undefined) {\n          completeDefaultRates[gameType] = defaultRates[gameType];\n        }\n        // If no setting exists, don't include it - let admin set their own rates\n      }\n      \n      res.json(completeDefaultRates);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Set platform-wide default commission rates for all subadmins\n  app.post(\"/api/commissions/default\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      const { defaultRates } = req.body;\n      \n      if (!defaultRates || typeof defaultRates !== 'object') {\n        return res.status(400).json({ message: \"defaultRates object is required with game types and rates\" });\n      }\n      \n      const results = [];\n      \n      // Save each default commission rate as a system setting\n      for (const [gameType, rate] of Object.entries(defaultRates)) {\n        if (rate === undefined) continue;\n        \n        // Convert rate to integer (store as integer for precision)\n        const rateAsInt = Math.round(parseFloat(rate as string) * 100);\n        \n        const setting = await storage.upsertSystemSetting(\n          \"commission_default\", \n          gameType,\n          rateAsInt.toString()\n        );\n        \n        results.push({\n          gameType,\n          rate: rateAsInt / 100,\n          setting\n        });\n      }\n      \n      res.json({ \n        success: true, \n        message: \"Default commission rates saved successfully\",\n        results \n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Update multiple commission settings for a subadmin at once\n  app.post(\"/api/commissions/subadmin/:subadminId\", requireRole([UserRole.ADMIN, UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const subadminId = parseInt(req.params.subadminId);\n      const { commissions } = req.body;\n      \n      if (!Array.isArray(commissions)) {\n        return res.status(400).json({ message: \"commissions must be an array of commission settings\" });\n      }\n\n      // Check if the user is authorized to access this resource\n      if (req.user.role === UserRole.SUBADMIN && req.user.id !== subadminId) {\n        return res.status(403).json({ message: \"Unauthorized: You can only update your own commission settings\" });\n      }\n      \n      // Verify the subadmin exists and is actually a subadmin\n      const subadmin = await storage.getUser(subadminId);\n      if (!subadmin || subadmin.role !== UserRole.SUBADMIN) {\n        return res.status(400).json({ message: \"Invalid subadmin ID\" });\n      }\n      \n      const results = await Promise.all(\n        commissions.map(async (commission) => {\n          if (!commission.gameType || commission.commissionRate === undefined) {\n            return { error: \"gameType and commissionRate are required\", gameType: commission.gameType };\n          }\n          \n          // Convert rate to integer (store as integer for precision)\n          const rateAsInt = Math.round(parseFloat(commission.commissionRate) * 100);\n          \n          return storage.upsertSubadminCommission(\n            subadminId,\n            commission.gameType,\n            rateAsInt\n          );\n        })\n      );\n      \n      res.json({ \n        success: true, \n        message: \"Commission settings updated successfully\",\n        results \n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // User Discount routes\n  app.get(\"/api/discounts/user/:userId\", requireRole([UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const userId = Number(req.params.userId);\n      const subadminId = req.user.id;\n      \n      // Verify the user is assigned to this subadmin\n      const user = await storage.getUser(userId);\n      if (!user || user.assignedTo !== subadminId) {\n        return res.status(403).json({ message: \"User is not assigned to you\" });\n      }\n      \n      const discounts = await storage.getUserDiscounts(userId, subadminId);\n      res.json(discounts);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  app.post(\"/api/discounts/user\", requireRole([UserRole.SUBADMIN]), async (req, res, next) => {\n    try {\n      const { userId, gameType, discountRate } = req.body;\n      const subadminId = req.user.id;\n      \n      if (!userId || !gameType || discountRate === undefined) {\n        return res.status(400).json({ message: \"userId, gameType, and discountRate are required\" });\n      }\n      \n      // Verify the user is assigned to this subadmin\n      const user = await storage.getUser(userId);\n      if (!user || user.assignedTo !== subadminId) {\n        return res.status(403).json({ message: \"User is not assigned to you\" });\n      }\n      \n      const discount = await storage.upsertUserDiscount(subadminId, userId, gameType, discountRate);\n      res.json(discount);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // Admin endpoint to manually seed cricket toss games\n  app.post(\"/api/admin/seed-cricket-toss\", requireRole([UserRole.ADMIN]), async (req, res, next) => {\n    try {\n      // Call seedCricketTossGames directly from storage\n      await storage.seedCricketTossGames();\n      res.json({ message: \"Cricket toss games seeded successfully\" });\n    } catch (err) {\n      next(err);\n    }\n  });\n\n  // Register cricket toss API routes\n  await import('./cricket-toss-api').then((module) => {\n    app.use('/api/cricket-toss', module.default);\n  });\n\n  // Register wallet system routes\n  await import('./wallet-system').then(({ setupWalletRoutes }) => {\n    setupWalletRoutes(app);\n  });\n  \n  // Register deposit discount routes\n  app.use('/api/subadmin', depositDiscountRouter);\n  \n  // Serve login test page for debugging\n  app.get(\"/login-test\", (_req, res) => {\n    res.sendFile(\"login-test.html\", { root: process.cwd() });\n  });\n  \n  // System reset endpoint (admin only)\n  app.post(\"/api/admin/reset-system\", requireRole([UserRole.ADMIN]), async (req, res) => {\n    try {\n      const { resetType, confirmationCode } = req.body;\n      \n      // Verify confirmation code\n      if (confirmationCode !== \"RESET_CONFIRM\") {\n        return res.status(400).json({ message: \"Invalid confirmation code. Type RESET_CONFIRM to proceed.\" });\n      }\n      \n      // Execute system reset based on type\n      if (resetType === \"all\") {\n        // Reset all data including balances\n        await db.delete(schema.transactions);\n        await db.delete(schema.games);\n        await db.delete(schema.satamatkaMarkets);\n        await db.delete(schema.teamMatches);\n        await db.delete(schema.walletRequests);\n        await db.delete(schema.gameOdds);\n        \n        // Reset user balances to 0 except admin\n        const allUsers = await storage.getAllUsers();\n        for (const user of allUsers) {\n          if (user.role !== UserRole.ADMIN) {\n            await storage.updateUserBalance(user.id, 0);\n          }\n        }\n        \n        console.log(\"Full system reset completed\");\n        return res.json({ message: \"Full system reset completed successfully\" });\n      } \n      else if (resetType === \"games\") {\n        // Reset only game data\n        await db.delete(schema.games);\n        await db.delete(schema.satamatkaMarkets);\n        await db.delete(schema.teamMatches);\n        \n        console.log(\"Game data reset completed\");\n        return res.json({ message: \"Game data reset completed successfully\" });\n      }\n      else if (resetType === \"transactions\") {\n        // Reset only transactions\n        await db.delete(schema.transactions);\n        await db.delete(schema.walletRequests);\n        \n        // Reset user balances to 0 except admin\n        const allUsers = await storage.getAllUsers();\n        for (const user of allUsers) {\n          if (user.role !== UserRole.ADMIN) {\n            await storage.updateUserBalance(user.id, 0);\n          }\n        }\n        \n        console.log(\"Transactions reset completed\");\n        return res.json({ message: \"Transactions reset completed successfully\" });\n      }\n      else if (resetType === \"balance\") {\n        // Reset only balances\n        const allUsers = await storage.getAllUsers();\n        for (const user of allUsers) {\n          if (user.role !== UserRole.ADMIN) {\n            await storage.updateUserBalance(user.id, 0);\n          }\n        }\n        \n        console.log(\"User balances reset completed\");\n        return res.json({ message: \"User balances reset completed successfully\" });\n      }\n      else {\n        return res.status(400).json({ message: \"Invalid reset type\" });\n      }\n    } catch (err) {\n      console.error(\"Error during system reset:\", err);\n      return res.status(500).json({ message: \"An error occurred during system reset\" });\n    }\n  });\n  \n  // Admin dashboard statistics\n  app.get(\"/api/admin/stats\", requireRole(UserRole.ADMIN), async (req, res) => {\n    try {\n      let totalProfitLoss = 0;\n      \n      // 1. Get all users to determine which ones are direct admin players\n      const allUsers = await storage.getAllUsers();\n      const directAdminPlayerIds = allUsers\n        .filter(user => user.role === UserRole.PLAYER && (!user.assignedTo || user.assignedTo === req.user!.id))\n        .map(user => user.id);\n      \n      console.log(`Direct admin player IDs: ${directAdminPlayerIds.join(', ')}`);\n      \n      // 2. Get games from direct admin players only\n      const games = await storage.getAllGames();\n      \n      for (const game of games) {\n        // Only count games from players directly under admin\n        if (directAdminPlayerIds.includes(game.userId)) {\n          // For each game, the platform profit is the bet amount minus any payout\n          // A positive value means the platform made money (player lost)\n          const gameProfit = game.betAmount - (game.payout || 0);\n          totalProfitLoss += gameProfit;\n          console.log(`Counting game profit from direct player ${game.userId}: ${gameProfit}`);\n        }\n      }\n      \n      // Calculate profit/losses from both direct player games and commission\n      // Reset the total profit calculation \n      totalProfitLoss = 0;\n      \n      // Get all transactions - we need these for both profit and deposit calculation\n      const transactions = await storage.getAllTransactions();\n      \n      // 1. Calculate profit from direct player games\n      for (const game of games) {\n        // Only count games from players directly under admin\n        if (directAdminPlayerIds.includes(game.userId)) {\n          // For each game, the platform profit is the bet amount minus any payout\n          // A positive value means the platform made money (player lost)\n          const gameProfit = game.betAmount - (game.payout || 0);\n          totalProfitLoss += gameProfit;\n          console.log(`Counting game profit from direct player ${game.userId}: ${gameProfit}`);\n        }\n      }\n      \n      // 2. Add commission as profit (based on user's requirement)\n      let commissionProfit = 0;\n      \n      // Look for transactions with commission in the description\n      for (const tx of transactions) {\n        if (tx.description && tx.description.includes('commission:')) {\n          // Extract the commission amount from the description\n          // Format is \"..., commission: X)\"\n          const match = tx.description.match(/commission: (\\d+)/);\n          \n          if (match && match[1]) {\n            const commissionAmount = parseInt(match[1], 10);\n            if (!isNaN(commissionAmount)) {\n              // Check that we're only counting positive transactions for subadmin deposits\n              // We don't want to double count withdrawals\n              if (tx.amount > 0 || (tx.description && tx.description.includes('transferred to'))) {\n                console.log(`Found commission transaction: ${tx.description}, amount: ${commissionAmount}`);\n                // Add the commission as profit\n                commissionProfit += commissionAmount;\n              }\n            }\n          }\n        }\n      }\n      \n      // Add commission profit to total profit/loss\n      totalProfitLoss += commissionProfit;\n      \n      console.log(`Profit breakdown: Game profit: ${totalProfitLoss - commissionProfit}, Commission profit: ${commissionProfit}, Total: ${totalProfitLoss}`);\n      \n      // Calculate total deposits properly:\n      // 1. For direct admin players, count the full deposit amount\n      // 2. For subadmin transactions, only count the actual amount deducted from admin (commission amount)\n      // 3. Include regular player deposits (players not assigned to any subadmin)\n      \n      // Track admin total deposit calculation\n      let totalDeposits = 0;\n      \n      // Get all direct players (players with no subadmin assigned or assigned to admin)\n      const directPlayers = allUsers\n        .filter(user => user.role === UserRole.PLAYER && (!user.assignedTo || user.assignedTo === req.user!.id))\n        .map(user => user.id);\n      \n      console.log(`Direct players to admin: ${directPlayers.join(', ')}`);\n      \n      // Process each transaction - using the transactions array we already loaded above\n      for (const tx of transactions) {\n        // For direct players, count deposit amounts - check for any deposit-related descriptions\n        if (directPlayers.includes(tx.userId) && tx.amount > 0 && tx.description && \n            (tx.description.includes('Deposit') || tx.description.toLowerCase().includes('deposit'))) {\n          totalDeposits += tx.amount;\n          console.log(`Counting direct player deposit: userId=${tx.userId}, amount=${tx.amount}`);\n        }\n        \n        // For subadmin-related transactions, look for commission information in the description\n        if (tx.description && tx.description.includes('commission rate applied')) {\n          // Extract the actual deduction amount (what admin paid) from the transaction description\n          // Format: \"Funds transferred to subadmin (X of Y - commission rate applied, commission: Z)\"\n          const match = tx.description.match(/\\((\\d+) of (\\d+) - commission rate applied/);\n          \n          if (match && match[1] && match[2]) {\n            // Only count the actual amount deducted from admin (match[1]), not the full amount (match[2])\n            const actualDeduction = parseInt(match[1], 10);\n            if (!isNaN(actualDeduction)) {\n              totalDeposits += actualDeduction;\n              console.log(`Counting subadmin transaction: ${tx.description}, actual deduction: ${actualDeduction}`);\n            }\n          }\n        }\n      }\n      \n      // Get active bet amount - from ALL PLATFORM USERS (including subadmins and their players)\n      const activeGames = await storage.getActiveGames();\n      \n      // Debug info for active games\n      console.log(`Found ${activeGames.length} total platform-wide active games`);\n      if (activeGames.length > 0) {\n        console.log(`Active games details:`, activeGames.map(g => ({\n          id: g.id,\n          userId: g.userId,\n          gameType: g.gameType,\n          betAmount: g.betAmount,\n          result: g.result\n        })));\n      }\n      \n      // Sum active bet amounts from ALL users across the entire platform\n      const activeBetAmount = activeGames.reduce((sum, game) => sum + game.betAmount, 0);\n      console.log(`Total active bet amount calculated: ${activeBetAmount} paisa (${activeBetAmount / 100})`);\n      \n      // Calculate potential payout from all active games - from entire platform\n      const potentialPayout = activeGames.reduce((sum: number, game: any) => {\n        // Calculate the maximum possible payout based on game type and gameMode\n        let multiplier = 2; // Default multiplier\n        \n        if (game.gameType === GameType.COIN_FLIP) {\n          // Typically 2x the bet amount for coin flip\n          multiplier = 2;\n        } else if (game.gameType === GameType.SATAMATKA) {\n          // Get multiplier based on game mode\n          if (game.gameMode === 'jodi') {\n            multiplier = 90; // 90x for jodi bets\n          } else if (game.gameMode === 'harf') {\n            multiplier = 9; // 9x for harf bets\n          } else if (game.gameMode === 'crossing') {\n            multiplier = 9; // 9x for crossing bets\n          } else if (game.gameMode === 'odd_even') {\n            multiplier = 1.9; // 1.9x for odd/even bets\n          } else {\n            multiplier = 9; // Default for Satamatka\n          }\n        } else if (game.gameType === GameType.CRICKET_TOSS) {\n          // Typically 2x the bet amount for cricket toss\n          multiplier = 2;\n        } \n        \n        const maxPayout = game.betAmount * multiplier;\n        console.log(`Game ${game.id}: type=${game.gameType}, mode=${game.gameMode}, bet=${game.betAmount}, multiplier=${multiplier}, maxPayout=${maxPayout}`);\n        \n        return sum + maxPayout;\n      }, 0);\n      \n      // Get recent transactions\n      const recentTransactions = await storage.getRecentTransactions(10);\n      \n      res.json({\n        totalProfitLoss,\n        totalDeposits,\n        activeBetAmount,\n        potentialPayout,\n        recentTransactions: recentTransactions.map(tx => ({\n          id: tx.id,\n          username: tx.username || 'Unknown',\n          type: tx.type,\n          amount: tx.amount,\n          createdAt: tx.createdAt\n        }))\n      });\n    } catch (error) {\n      console.error(\"Error fetching admin stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch admin statistics\" });\n    }\n  });\n\n  // API endpoint to get user's last 7 days satamatka rewards data\n  app.get(\"/api/users/:userId/rewards\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const userId = parseInt(req.params.userId);\n      if (isNaN(userId)) {\n        return res.status(400).json({ message: \"Invalid user ID\" });\n      }\n      \n      // Check permissions - admins can view any user, subadmins only their assigned users\n      if (req.user!.role === UserRole.SUBADMIN) {\n        const assignedUsers = await storage.getUsersByAssignedTo(req.user!.id);\n        const isUserAssigned = assignedUsers.some(u => u.id === userId);\n        \n        if (!isUserAssigned) {\n          return res.status(403).json({ message: \"Forbidden: Insufficient permissions\" });\n        }\n      } else if (req.user!.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: \"Forbidden: Only admins and subadmins can access this endpoint\" });\n      }\n      \n      // Get user to check reward commission\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Get last 7 days\n      const sevenDaysAgo = new Date();\n      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n      sevenDaysAgo.setHours(0, 0, 0, 0);\n      \n      // Get all satamatka games for this user in last 7 days\n      const allGames = await storage.getGamesByUserId(userId);\n      const satamatkaGames = allGames.filter(game => {\n        const gameDate = new Date(game.createdAt!);\n        return game.gameType.includes('satamatka') && gameDate >= sevenDaysAgo;\n      });\n      \n      // Calculate total bet amount\n      const totalBetAmount = satamatkaGames.reduce((sum, game) => sum + game.betAmount, 0);\n      \n      // Calculate reward based on user's reward commission\n      const rewardCommissionRate = user.rewardCommission || 0; // stored as integer e.g. 500 = 5%\n      const rewardAmount = Math.floor((totalBetAmount * rewardCommissionRate) / 10000); // Divide by 10000 because rate is x100 and we want percentage\n      \n      // Group games by date for daily breakdown\n      const dailyBreakdown: Record<string, { date: string; totalBet: number; gamesCount: number }> = {};\n      \n      satamatkaGames.forEach(game => {\n        const dateKey = new Date(game.createdAt!).toISOString().split('T')[0];\n        if (!dailyBreakdown[dateKey]) {\n          dailyBreakdown[dateKey] = {\n            date: dateKey,\n            totalBet: 0,\n            gamesCount: 0\n          };\n        }\n        dailyBreakdown[dateKey].totalBet += game.betAmount;\n        dailyBreakdown[dateKey].gamesCount += 1;\n      });\n      \n      res.json({\n        userId,\n        username: user.username,\n        rewardCommissionRate, // e.g. 500 = 5%\n        totalBetAmount, // Total bet amount in last 7 days (in paisa)\n        rewardAmount, // Calculated reward (in paisa)\n        totalGames: satamatkaGames.length,\n        dailyBreakdown: Object.values(dailyBreakdown).sort((a, b) => \n          new Date(b.date).getTime() - new Date(a.date).getTime()\n        ),\n        periodStart: sevenDaysAgo.toISOString(),\n        periodEnd: new Date().toISOString()\n      });\n    } catch (err) {\n      console.error(\"Error fetching user rewards:\", err);\n      next(err);\n    }\n  });\n  \n  // API endpoint to update user's reward commission\n  app.patch(\"/api/users/:userId/reward-commission\", async (req, res, next) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const userId = parseInt(req.params.userId);\n      if (isNaN(userId)) {\n        return res.status(400).json({ message: \"Invalid user ID\" });\n      }\n      \n      const { rewardCommission } = req.body;\n      if (typeof rewardCommission !== 'number' || rewardCommission < 0 || rewardCommission > 10000) {\n        return res.status(400).json({ message: \"Invalid reward commission value (must be 0-10000)\" });\n      }\n      \n      // Check permissions\n      if (req.user!.role === UserRole.SUBADMIN) {\n        const assignedUsers = await storage.getUsersByAssignedTo(req.user!.id);\n        const isUserAssigned = assignedUsers.some(u => u.id === userId);\n        \n        if (!isUserAssigned) {\n          return res.status(403).json({ message: \"Forbidden: Insufficient permissions\" });\n        }\n      } else if (req.user!.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: \"Forbidden: Only admins and subadmins can access this endpoint\" });\n      }\n      \n      // Update user's reward commission\n      await db.update(users).set({ rewardCommission }).where(eq(users.id, userId));\n      \n      const updatedUser = await storage.getUser(userId);\n      res.json(updatedUser);\n    } catch (err) {\n      console.error(\"Error updating reward commission:\", err);\n      next(err);\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","path":null,"size_bytes":161839,"size_tokens":null},"client/src/pages/results-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { format, formatDistanceToNow } from \"date-fns\";\nimport { \n  Card, \n  CardContent, \n  CardDescription, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { \n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport ResponsiveHeader from \"@/components/responsive-header\";\nimport ProfessionalFooter from \"@/components/professional-footer\";\nimport { \n  CalendarIcon, \n  Clock, \n  Target, \n  Filter,\n  TrendingUp,\n  Search\n} from \"lucide-react\";\n\ninterface MarketResult {\n  id: number;\n  name: string;\n  type: string;\n  openResult: string;\n  closeResult?: string;\n  status: string;\n  openTime: string;\n  closeTime: string;\n  resultTime?: string;\n  createdAt: string;\n}\n\nexport default function ResultsPage() {\n  const [selectedDate, setSelectedDate] = useState(\"\");\n  const [selectedMarket, setSelectedMarket] = useState(\"all\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  // Build query parameters based on filters\n  const queryParams = new URLSearchParams();\n  if (selectedDate) {\n    queryParams.append('date', selectedDate);\n  }\n  if (!selectedDate) {\n    queryParams.append('limit', '50');\n  }\n\n  const { data: results = [], isLoading, error } = useQuery({\n    queryKey: ['/api/public/market-results', queryParams.toString()],\n    queryFn: async () => {\n      const response = await fetch(`/api/public/market-results?${queryParams.toString()}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch results');\n      }\n      return response.json();\n    },\n  });\n\n  // Get unique market names for filter dropdown\n  const uniqueMarkets: string[] = results.length > 0 \n    ? Array.from(new Set(results.map((result: MarketResult) => result.name))).sort()\n    : [];\n\n  // Filter results based on market name and search term\n  const filteredResults = results.filter((result: MarketResult) => {\n    const matchesMarket = selectedMarket === \"all\" || result.name === selectedMarket;\n    const matchesSearch = !searchTerm || \n      result.name.toLowerCase().includes(searchTerm.toLowerCase());\n    return matchesMarket && matchesSearch;\n  });\n\n  const formatResult = (result?: string) => {\n    if (!result) return \"-\";\n    \n    // For Dishawar and Gali markets, ensure two-digit format with leading zero if needed\n    if (result.length === 1) {\n      return `0${result}`;\n    } else if (result.length === 2) {\n      return result;\n    } else {\n      return result;\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status.toLowerCase()) {\n      case \"open\":\n        return <Badge variant=\"outline\" className=\"bg-violet-900/30 text-violet-300 border-violet-500/30\">Open</Badge>;\n      case \"closed\":\n        return <Badge variant=\"outline\" className=\"bg-amber-900/30 text-amber-300 border-amber-500/30\">Closed</Badge>;\n      case \"resulted\":\n        return <Badge variant=\"outline\" className=\"bg-emerald-900/30 text-emerald-300 border-emerald-500/30\">Resulted</Badge>;\n      default:\n        return <Badge variant=\"outline\" className=\"bg-slate-800 text-slate-300 border-slate-700\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950\">\n      <ResponsiveHeader />\n      \n      <main className=\"container mx-auto px-4 py-8\">\n        {/* Page Header */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl sm:text-4xl font-bold text-white mb-2\">\n            Game Results\n          </h1>\n          <p className=\"text-slate-400 text-lg\">\n            Browse all market results with advanced filtering options\n          </p>\n        </div>\n\n        {/* Filters Section */}\n        <Card className=\"bg-slate-900/70 border-slate-800 mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center text-slate-200\">\n              <Filter className=\"w-5 h-5 mr-2 text-primary\" />\n              Filter Results\n            </CardTitle>\n            <CardDescription>\n              Filter results by date, market name, or search by market name\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              {/* Date Filter */}\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium text-slate-300\">\n                  <CalendarIcon className=\"w-4 h-4 inline mr-1\" />\n                  Select Date\n                </label>\n                <Input\n                  type=\"date\"\n                  value={selectedDate}\n                  onChange={(e) => setSelectedDate(e.target.value)}\n                  className=\"bg-slate-800 border-slate-700 text-white\"\n                />\n              </div>\n\n              {/* Market Filter */}\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium text-slate-300\">\n                  <Target className=\"w-4 h-4 inline mr-1\" />\n                  Market\n                </label>\n                <Select value={selectedMarket} onValueChange={setSelectedMarket}>\n                  <SelectTrigger className=\"bg-slate-800 border-slate-700 text-white\">\n                    <SelectValue placeholder=\"Select market\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-slate-800 border-slate-700\">\n                    <SelectItem value=\"all\">All Markets</SelectItem>\n                    {uniqueMarkets.map((market: string) => (\n                      <SelectItem key={market} value={market}>\n                        {market}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Search Filter */}\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium text-slate-300\">\n                  <Search className=\"w-4 h-4 inline mr-1\" />\n                  Search Market\n                </label>\n                <Input\n                  type=\"text\"\n                  placeholder=\"Search by market name...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"bg-slate-800 border-slate-700 text-white\"\n                />\n              </div>\n            </div>\n\n            {/* Clear Filters */}\n            <div className=\"mt-4 flex justify-end\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setSelectedDate(\"\");\n                  setSelectedMarket(\"all\");\n                  setSearchTerm(\"\");\n                }}\n                className=\"border-slate-700 text-slate-300 hover:bg-slate-800\"\n              >\n                Clear Filters\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Results Summary */}\n        <div className=\"mb-6\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold text-white flex items-center\">\n              <TrendingUp className=\"w-5 h-5 mr-2 text-primary\" />\n              Results\n              <span className=\"ml-2 text-slate-400 text-base font-normal\">\n                ({filteredResults.length} {filteredResults.length === 1 ? 'result' : 'results'})\n              </span>\n            </h2>\n          </div>\n        </div>\n\n        {/* Results Grid */}\n        {isLoading ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {[...Array(6)].map((_, i) => (\n              <Card key={i} className=\"bg-slate-900/70 border-slate-800\">\n                <CardContent className=\"p-6\">\n                  <Skeleton className=\"h-4 w-32 mb-2 bg-slate-700\" />\n                  <Skeleton className=\"h-3 w-24 mb-4 bg-slate-700\" />\n                  <Skeleton className=\"h-16 w-16 mx-auto mb-4 bg-slate-700\" />\n                  <Skeleton className=\"h-3 w-20 mx-auto bg-slate-700\" />\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : error ? (\n          <Card className=\"bg-slate-900/70 border-slate-800\">\n            <CardContent className=\"p-8 text-center\">\n              <Target className=\"h-12 w-12 text-slate-700 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-slate-300 mb-2\">\n                Error Loading Results\n              </h3>\n              <p className=\"text-slate-500\">\n                Failed to load market results. Please try again later.\n              </p>\n            </CardContent>\n          </Card>\n        ) : filteredResults.length === 0 ? (\n          <Card className=\"bg-slate-900/70 border-slate-800\">\n            <CardContent className=\"p-8 text-center\">\n              <Target className=\"h-12 w-12 text-slate-700 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-slate-300 mb-2\">\n                No Results Found\n              </h3>\n              <p className=\"text-slate-500\">\n                No market results match your current filters. Try adjusting your search criteria.\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {filteredResults.map((result: MarketResult) => {\n              const timeAgo = formatDistanceToNow(new Date(result.resultTime || result.createdAt), { addSuffix: true });\n              \n              return (\n                <Card key={result.id} className=\"bg-slate-900/70 border-slate-800 hover:border-slate-700 transition-colors\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex justify-between items-start mb-4\">\n                      <div>\n                        <h3 className=\"font-semibold text-slate-200 text-lg\">\n                          {result.name}\n                        </h3>\n                        <div className=\"flex items-center text-xs text-slate-500 mt-1\">\n                          <Clock className=\"h-3 w-3 mr-1\" />\n                          <span>{timeAgo}</span>\n                        </div>\n                      </div>\n                      {getStatusBadge(result.status)}\n                    </div>\n                    \n                    <div className=\"text-center\">\n                      <p className=\"text-xs text-slate-500 mb-2\">Result</p>\n                      <div className={`font-bold text-4xl ${result.name === \"Dishawar\" || result.name === \"Gali\" \n                        ? \"text-gradient bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-primary\"\n                        : \"text-pink-400\"}`}>\n                        {formatResult(result.openResult)}\n                      </div>\n                      \n                      {result.closeResult && (\n                        <div className=\"mt-2\">\n                          <p className=\"text-xs text-slate-500\">Close Result</p>\n                          <div className=\"font-semibold text-2xl text-blue-400\">\n                            {formatResult(result.closeResult)}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n\n                    {result.resultTime && (\n                      <div className=\"mt-4 pt-3 border-t border-slate-700\">\n                        <p className=\"text-xs text-slate-500 text-center\">\n                          Result declared on {format(new Date(result.resultTime), 'PPp')}\n                        </p>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n      </main>\n\n      <ProfessionalFooter />\n    </div>\n  );\n}","path":null,"size_bytes":12036,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/pages/auth-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { UserRole } from \"@/lib/types\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { \n  Card, \n  CardContent, \n  CardDescription, \n  CardFooter, \n  CardHeader, \n  CardTitle \n} from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\nconst loginSchema = z.object({\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\nconst registerSchema = z.object({\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  email: z.string().email(\"Please enter a valid email address\"),\n  mobile: z.string().min(10, \"Mobile number must be at least 10 digits\").max(15, \"Mobile number cannot exceed 15 digits\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n  confirmPassword: z.string().min(6, \"Password must be at least 6 characters\"),\n}).refine(data => data.password === data.confirmPassword, {\n  message: \"Passwords do not match\",\n  path: [\"confirmPassword\"],\n});\n\nexport default function AuthPage() {\n  const [_, setLocation] = useLocation();\n  const { user, loginMutation, registerMutation } = useAuth();\n  const [activeTab, setActiveTab] = useState<string>(\"login\");\n\n  const loginForm = useForm<z.infer<typeof loginSchema>>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n    },\n  });\n\n  const registerForm = useForm<z.infer<typeof registerSchema>>({\n    resolver: zodResolver(registerSchema),\n    defaultValues: {\n      username: \"\",\n      email: \"\",\n      mobile: \"\",\n      password: \"\",\n      confirmPassword: \"\",\n    },\n  });\n\n  useEffect(() => {\n    // Redirect if already logged in\n    if (user) {\n      setLocation(\"/dashboard\");\n    }\n  }, [user, setLocation]);\n\n  const onLogin = (data: z.infer<typeof loginSchema>) => {\n    console.log(\"Login attempt with:\", data);\n    loginMutation.mutate(data, {\n      onSuccess: (userData) => {\n        console.log(\"Login success:\", userData);\n        setLocation(\"/dashboard\");\n      },\n      onError: (error) => {\n        console.error(\"Login error:\", error);\n      }\n    });\n  };\n\n  const onRegister = (data: z.infer<typeof registerSchema>) => {\n    const { confirmPassword, ...registerData } = data;\n    registerMutation.mutate({\n      ...registerData,\n      role: UserRole.PLAYER, // Default role for new registrations\n      assignedTo: null\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen w-full flex flex-col md:flex-row\">\n      {/* Left side - Auth forms */}\n      <div className=\"w-full md:w-1/2 flex items-center justify-center p-4 md:p-8 bg-background\">\n        <Card className=\"w-full max-w-md mx-auto\">\n          <CardHeader>\n            <CardTitle className=\"text-2xl font-bold text-center flex items-center justify-center gap-2 cursor-pointer hover:opacity-80 transition-opacity\" onClick={() => setLocation(\"/\")}>\n              <img src=\"/images/royal-k-logo.svg\" alt=\"Royal K Logo\" className=\"w-8 h-8\" />\n              <span className=\"text-primary\">King</span>\n              <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-primary\">Games</span>\n            </CardTitle>\n            <CardDescription className=\"text-center\">\n              Sign in to your account or create a new one\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Tabs defaultValue=\"login\" value={activeTab} onValueChange={setActiveTab}>\n              <TabsList className=\"grid w-full grid-cols-2 mb-6\">\n                <TabsTrigger value=\"login\">Login</TabsTrigger>\n                <TabsTrigger value=\"register\">Register</TabsTrigger>\n              </TabsList>\n              \n              <TabsContent value=\"login\">\n                <form onSubmit={loginForm.handleSubmit(onLogin)}>\n                  <div className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"username\">Username</Label>\n                      <Input\n                        id=\"username\"\n                        type=\"text\"\n                        placeholder=\"Enter your username\"\n                        {...loginForm.register(\"username\")}\n                      />\n                      {loginForm.formState.errors.username && (\n                        <p className=\"text-red-500 text-sm\">{loginForm.formState.errors.username.message}</p>\n                      )}\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"password\">Password</Label>\n                      <Input\n                        id=\"password\"\n                        type=\"password\"\n                        placeholder=\"Enter your password\"\n                        {...loginForm.register(\"password\")}\n                      />\n                      {loginForm.formState.errors.password && (\n                        <p className=\"text-red-500 text-sm\">{loginForm.formState.errors.password.message}</p>\n                      )}\n                    </div>\n                    \n                    <Button\n                      type=\"submit\"\n                      className=\"w-full bg-gradient-to-r from-primary to-blue-400 hover:from-blue-600 hover:to-primary-focus\"\n                      disabled={loginMutation.isPending}\n                    >\n                      {loginMutation.isPending ? \"Logging in...\" : \"Login\"}\n                    </Button>\n                  </div>\n                </form>\n              </TabsContent>\n              \n              <TabsContent value=\"register\">\n                <form onSubmit={registerForm.handleSubmit(onRegister)}>\n                  <div className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"register-username\">Username</Label>\n                      <Input\n                        id=\"register-username\"\n                        type=\"text\"\n                        placeholder=\"Choose a username\"\n                        {...registerForm.register(\"username\")}\n                      />\n                      {registerForm.formState.errors.username && (\n                        <p className=\"text-red-500 text-sm\">{registerForm.formState.errors.username.message}</p>\n                      )}\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"register-email\">Email</Label>\n                      <Input\n                        id=\"register-email\"\n                        type=\"email\"\n                        placeholder=\"Enter your email address\"\n                        {...registerForm.register(\"email\")}\n                      />\n                      {registerForm.formState.errors.email && (\n                        <p className=\"text-red-500 text-sm\">{registerForm.formState.errors.email.message}</p>\n                      )}\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"register-mobile\">Mobile Number</Label>\n                      <Input\n                        id=\"register-mobile\"\n                        type=\"tel\"\n                        placeholder=\"Enter your mobile number\"\n                        {...registerForm.register(\"mobile\")}\n                      />\n                      {registerForm.formState.errors.mobile && (\n                        <p className=\"text-red-500 text-sm\">{registerForm.formState.errors.mobile.message}</p>\n                      )}\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"register-password\">Password</Label>\n                      <Input\n                        id=\"register-password\"\n                        type=\"password\"\n                        placeholder=\"Choose a password\"\n                        {...registerForm.register(\"password\")}\n                      />\n                      {registerForm.formState.errors.password && (\n                        <p className=\"text-red-500 text-sm\">{registerForm.formState.errors.password.message}</p>\n                      )}\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"confirm-password\">Confirm Password</Label>\n                      <Input\n                        id=\"confirm-password\"\n                        type=\"password\"\n                        placeholder=\"Confirm your password\"\n                        {...registerForm.register(\"confirmPassword\")}\n                      />\n                      {registerForm.formState.errors.confirmPassword && (\n                        <p className=\"text-red-500 text-sm\">{registerForm.formState.errors.confirmPassword.message}</p>\n                      )}\n                    </div>\n                    \n                    <Button\n                      type=\"submit\"\n                      className=\"w-full bg-gradient-to-r from-primary to-blue-400 hover:from-blue-600 hover:to-primary-focus\"\n                      disabled={registerMutation.isPending}\n                    >\n                      {registerMutation.isPending ? \"Creating account...\" : \"Create Account\"}\n                    </Button>\n                  </div>\n                </form>\n              </TabsContent>\n            </Tabs>\n          </CardContent>\n          <CardFooter className=\"flex justify-center\">\n            <p className=\"text-sm text-muted-foreground\">\n              {activeTab === \"login\" ? (\n                <>\n                  Don't have an account?{\" \"}\n                  <Button variant=\"link\" onClick={() => setActiveTab(\"register\")} className=\"px-0 text-primary\">\n                    Sign up\n                  </Button>\n                </>\n              ) : (\n                <>\n                  Already have an account?{\" \"}\n                  <Button variant=\"link\" onClick={() => setActiveTab(\"login\")} className=\"px-0 text-primary\">\n                    Sign in\n                  </Button>\n                </>\n              )}\n            </p>\n          </CardFooter>\n        </Card>\n      </div>\n      \n      {/* Right side - Hero */}\n      <div className=\"hidden md:flex md:w-1/2 bg-gradient-to-br from-slate-900 to-primary/80 p-8 flex-col justify-center text-white\">\n        <div className=\"max-w-md mx-auto\">\n          <h1 className=\"text-4xl font-bold mb-4 flex items-center gap-2\">\n            Welcome to \n            <span className=\"flex items-center cursor-pointer hover:opacity-80 transition-opacity\" onClick={() => setLocation(\"/\")}>\n              <img src=\"/images/royal-k-logo.svg\" alt=\"Royal K Logo\" className=\"w-10 h-10 mr-1\" />\n              <span className=\"text-white\">King</span>\n              <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-blue-300 to-amber-300\">Games</span>\n            </span>\n          </h1>\n          <h2 className=\"text-xl mb-6\">The premier online gaming platform</h2>\n          \n          <div className=\"space-y-4\">\n            <div className=\"flex items-start space-x-2\">\n              <svg className=\"w-6 h-6 mt-0.5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 13l4 4L19 7\"></path>\n              </svg>\n              <p>Exciting Royal Toss game with real-time results</p>\n            </div>\n            \n            <div className=\"flex items-start space-x-2\">\n              <svg className=\"w-6 h-6 mt-0.5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 13l4 4L19 7\"></path>\n              </svg>\n              <p>Track your stats and betting history</p>\n            </div>\n            \n            <div className=\"flex items-start space-x-2\">\n              <svg className=\"w-6 h-6 mt-0.5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 13l4 4L19 7\"></path>\n              </svg>\n              <p>Multiple user roles with different permissions</p>\n            </div>\n            \n            <div className=\"flex items-start space-x-2\">\n              <svg className=\"w-6 h-6 mt-0.5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 13l4 4L19 7\"></path>\n              </svg>\n              <p>Secure and fair gaming experience</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":13221,"size_tokens":null},"create-sample-games.ts":{"content":"import { db } from './server/db';\nimport { games, GameType } from './shared/schema';\n\nasync function createSampleGames() {\n  try {\n    console.log('Creating sample game data for risk management testing...');\n    \n    const adminId = 1; // The admin user we created\n    \n    // Create test market games (satamatka)\n    for (let i = 1; i <= 10; i++) {\n      const isActive = i % 3 !== 0; // Some games will be active, some completed\n      await db.insert(games).values({\n        userId: adminId,\n        gameType: GameType.SATAMATKA,\n        betAmount: 1000 * (i % 5 + 1),\n        prediction: i % 2 === 0 ? 'jodi' : 'single',\n        result: isActive ? null : (i % 2 === 0 ? 'win' : 'loss'),\n        payout: isActive ? 0 : (i % 2 === 0 ? 1000 * (i % 5 + 1) * 1.9 : 0),\n        marketId: i % 5 + 1,\n        gameMode: 'regular'\n      });\n      \n      console.log(`Created market game ${i}`);\n    }\n    \n    // Create test cricket toss games\n    for (let i = 1; i <= 8; i++) {\n      const isActive = i % 4 !== 0; // Some games will be active, some completed\n      await db.insert(games).values({\n        userId: adminId,\n        gameType: GameType.CRICKET_TOSS,\n        betAmount: 500 * (i % 3 + 1),\n        prediction: i % 2 === 0 ? 'team_a' : 'team_b',\n        result: isActive ? null : (i % 2 === 0 ? 'win' : 'loss'),\n        payout: isActive ? 0 : (i % 2 === 0 ? 500 * (i % 3 + 1) * 1.8 : 0),\n        marketId: null,\n        matchId: i % 3 + 1,\n        gameMode: 'regular'\n      });\n      \n      console.log(`Created cricket toss game ${i}`);\n    }\n    \n    console.log('Sample game data created successfully!');\n    \n  } catch (error) {\n    console.error('Error creating sample game data:', error);\n  }\n}\n\n// Run the function\ncreateSampleGames()\n  .then(() => console.log('Done!'))\n  .catch(err => console.error('Failed:', err));","path":null,"size_bytes":1829,"size_tokens":null},"client/src/components/home/HomePageHeroSlider.tsx":{"content":"import { useState, useEffect, useCallback } from 'react';\nimport { useLocation } from 'wouter';\nimport { useQuery } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport useEmblaCarousel from 'embla-carousel-react';\nimport { ChevronLeft, ChevronRight } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\ntype HeroImage = {\n  filename: string;\n  url: string;\n};\n\n// Default slides in case no images are in the database yet\nconst defaultSlides = [\n  {\n    id: \"slide1\",\n    title: \"The Premier Betting Platform\",\n    description: \"Experience the thrill of betting with real-time results and attractive payouts. Play anywhere, anytime.\",\n    backgroundImage: \"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)\",\n    buttonText: \"Start Betting Now\",\n    buttonLink: \"/auth\"\n  },\n  {\n    id: \"slide2\",\n    title: \"Market Games\",\n    description: \"Play exciting market-based games with multiple options and win big payouts.\",\n    backgroundImage: \"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)\",\n    buttonText: \"Play Market Games\",\n    buttonLink: \"/auth\"\n  },\n  {\n    id: \"slide3\",\n    title: \"Sports Betting\",\n    description: \"Bet on your favorite sports teams and win big with our competitive odds.\",\n    backgroundImage: \"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)\",\n    buttonText: \"Start Sports Betting\",\n    buttonLink: \"/auth\"\n  }\n];\n\nexport function HomePageHeroSlider() {\n  const [_, setLocation] = useLocation();\n  const [emblaRef, emblaApi] = useEmblaCarousel({ loop: true });\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const [scrollSnaps, setScrollSnaps] = useState<number[]>([]);\n  \n  // Fetch hero slider images from the backend\n  const { data: heroImages = [] } = useQuery<HeroImage[]>({\n    queryKey: ['/api/herosliders'],\n    queryFn: () => apiRequest('GET', '/api/herosliders')\n      .then(res => res.json()),\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n  \n  const scrollPrev = useCallback(() => {\n    if (emblaApi) emblaApi.scrollPrev();\n  }, [emblaApi]);\n\n  const scrollNext = useCallback(() => {\n    if (emblaApi) emblaApi.scrollNext();\n  }, [emblaApi]);\n\n  const scrollTo = useCallback(\n    (index: number) => {\n      if (emblaApi) emblaApi.scrollTo(index);\n    },\n    [emblaApi]\n  );\n\n  const onSelect = useCallback(() => {\n    if (!emblaApi) return;\n    setSelectedIndex(emblaApi.selectedScrollSnap());\n  }, [emblaApi]);\n\n  useEffect(() => {\n    if (!emblaApi) return;\n    onSelect();\n    setScrollSnaps(emblaApi.scrollSnapList());\n    emblaApi.on('select', onSelect);\n    return () => {\n      emblaApi.off('select', onSelect);\n    };\n  }, [emblaApi, onSelect]);\n\n  // Auto-play functionality\n  useEffect(() => {\n    if (!emblaApi) return;\n    \n    const intervalId = setInterval(() => {\n      emblaApi.scrollNext();\n    }, 5000); // 5 seconds interval\n\n    // Clear interval when user interacts with the carousel\n    const onInteractionStarted = () => {\n      clearInterval(intervalId);\n    };\n    \n    emblaApi.on('pointerDown', onInteractionStarted);\n    \n    return () => {\n      clearInterval(intervalId);\n      if (emblaApi) {\n        emblaApi.off('pointerDown', onInteractionStarted);\n      }\n    };\n  }, [emblaApi]);\n\n  // Define a union type for both slide types\n  type Slide = \n    | { id: string; title: string; description: string; backgroundImage: string; buttonText: string; buttonLink: string; isCustomImage?: false; }\n    | { id: string; image: string; isCustomImage: true; };\n\n  // If no images are available from the backend, use default slides\n  const slidesToUse: Slide[] = heroImages.length > 0\n    ? heroImages.map((image) => ({\n        id: image.filename,\n        image: image.url,\n        isCustomImage: true as const\n      }))\n    : defaultSlides.map(slide => ({\n        ...slide,\n        isCustomImage: false as const\n      }));\n\n  return (\n    <div className=\"relative\">\n      <div className=\"overflow-hidden\" ref={emblaRef}>\n        <div className=\"flex h-[300px] sm:h-[400px] md:h-[500px] lg:h-[600px]\">\n          {slidesToUse.map((slide) => (\n            <div \n              key={slide.id} \n              className=\"flex-[0_0_100%] min-w-0 relative\"\n            >\n              {slide.isCustomImage ? (\n                // Render custom image from the backend\n                <div className=\"absolute inset-0\">\n                  <img \n                    src={slide.image} \n                    alt=\"Hero Image\" \n                    className=\"w-full h-full object-cover\"\n                  />\n                  <div className=\"absolute inset-0 bg-gradient-to-b from-black/70 to-black/40\">\n                    {/* Removed button as requested */}\n                  </div>\n                </div>\n              ) : (\n                // Render default slides with text\n                <div \n                  className=\"absolute inset-0 bg-cover bg-center\"\n                  style={{ \n                    background: slide.backgroundImage.startsWith('linear-gradient') \n                      ? slide.backgroundImage \n                      : `url(${slide.backgroundImage})` \n                  }}\n                >\n                  <div className=\"absolute inset-0 bg-gradient-to-b from-black/70 to-black/40 flex items-center\">\n                    <div className=\"container mx-auto px-4 md:px-8\">\n                      <div className=\"max-w-2xl pt-0 sm:pt-0 md:pt-0 lg:pt-0\">\n                        <h1 className=\"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-2 sm:mb-4 leading-tight\">\n                          {slide.title}\n                        </h1>\n                        <p className=\"text-white/90 text-sm sm:text-base md:text-lg mb-4 sm:mb-6 max-w-md\">\n                          {slide.description}\n                        </p>\n                        <Button \n                          className=\"px-4 py-2 sm:px-6 sm:py-4 md:px-8 md:py-6 text-sm sm:text-base md:text-lg bg-primary hover:bg-primary/90\"\n                          onClick={() => setLocation(slide.buttonLink)}\n                        >\n                          {slide.buttonText}\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      </div>\n      \n      {/* Navigation buttons - only show if more than one slide */}\n      {slidesToUse.length > 1 && (\n        <>\n          <button \n            onClick={scrollPrev}\n            className=\"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white rounded-full p-1 sm:p-2 transition-all\"\n            aria-label=\"Previous slide\"\n          >\n            <ChevronLeft className=\"w-4 h-4 sm:w-6 sm:h-6\" />\n          </button>\n          <button \n            onClick={scrollNext}\n            className=\"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white rounded-full p-1 sm:p-2 transition-all\"\n            aria-label=\"Next slide\"\n          >\n            <ChevronRight className=\"w-4 h-4 sm:w-6 sm:h-6\" />\n          </button>\n          \n          {/* Dots indicators */}\n          <div className=\"absolute bottom-2 sm:bottom-4 left-0 right-0 flex justify-center\">\n            <div className=\"flex space-x-1.5 sm:space-x-2\">\n              {scrollSnaps.map((_, index) => (\n                <button\n                  key={index}\n                  onClick={() => scrollTo(index)}\n                  className={`w-2 h-2 sm:w-3 sm:h-3 rounded-full transition-all ${\n                    index === selectedIndex\n                      ? 'bg-white scale-100'\n                      : 'bg-white/50 scale-75'\n                  }`}\n                  aria-label={`Go to slide ${index + 1}`}\n                />\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}","path":null,"size_bytes":7885,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"removed_files/client/cricket-toss-page.tsx":{"content":"import React, { useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Calendar, Clock, Wallet, LogOut, User as UserIcon } from \"lucide-react\";\nimport { GiCricketBat } from \"react-icons/gi\";\nimport Sidebar from '@/components/sidebar';\nimport MobileNav from '@/components/mobile-nav';\nimport { useToast } from '@/hooks/use-toast';\nimport { format } from 'date-fns';\nimport CricketTossGame from '@/components/cricket-toss-game';\nimport { useAuth } from '@/hooks/use-auth';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { useLocation } from 'wouter';\nimport { \n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger\n} from '@/components/ui/dropdown-menu';\n\n// Type for Cricket Toss Game\ntype CricketTossGame = {\n  id: number;\n  userId: number;\n  gameType: string;\n  betAmount: number;\n  prediction: string;\n  result: string | null;\n  payout: number;\n  createdAt: string | null;\n  gameData: {\n    teamA: string;\n    teamB: string;\n    description: string;\n    tossTime: string;\n    oddTeamA: number;\n    oddTeamB: number;\n    imageUrl?: string;\n    status: string;\n    openTime?: string;\n    closeTime?: string;\n  };\n};\n\nexport default function CricketTossPage() {\n  const { user, logoutMutation } = useAuth();\n  const [_, setLocation] = useLocation();\n  \n  const handleLogout = () => {\n    logoutMutation.mutate();\n  };\n  \n  return (\n    <div className=\"flex h-screen bg-slate-950 text-slate-200\">\n      {/* Sidebar - Hidden on mobile */}\n      <div className=\"hidden lg:block h-screen\">\n        <Sidebar />\n      </div>\n      <div className=\"flex flex-col flex-1 overflow-hidden\">\n        <main className=\"flex-1 overflow-y-auto pb-16 lg:pb-0\">\n          <div className=\"sticky top-0 z-20 border-b border-slate-800 bg-slate-950/95 backdrop-blur-sm\">\n            <div className=\"px-4 py-3 flex justify-between items-center\">\n              <h1 className=\"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-blue-500\">\n                Cricket Toss\n              </h1>\n              \n              {user && (\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"flex items-center bg-slate-800/60 px-3 py-1.5 rounded-full\">\n                    <Wallet className=\"h-4 w-4 mr-2 text-primary\" />\n                    <span className=\"font-medium\">{(user.balance / 100).toFixed(2)}</span>\n                  </div>\n                  \n                  {/* User avatar dropdown - only for mobile */}\n                  <div className=\"block lg:hidden\">\n                    <DropdownMenu>\n                      <DropdownMenuTrigger className=\"focus:outline-none\">\n                        <Avatar className=\"h-8 w-8 bg-gradient-to-r from-primary to-blue-400\">\n                          <AvatarFallback className=\"text-white font-bold text-xs\">\n                            {user.username.charAt(0).toUpperCase()}\n                          </AvatarFallback>\n                        </Avatar>\n                      </DropdownMenuTrigger>\n                      <DropdownMenuContent align=\"end\" className=\"w-48\">\n                        <div className=\"flex items-center gap-2 p-2 border-b border-slate-700\">\n                          <Avatar className=\"h-8 w-8 bg-gradient-to-r from-primary to-blue-400\">\n                            <AvatarFallback className=\"text-white font-bold text-xs\">\n                              {user.username.charAt(0).toUpperCase()}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <p className=\"font-medium text-sm\">{user.username}</p>\n                            <p className=\"text-xs text-muted-foreground capitalize\">{user.role}</p>\n                          </div>\n                        </div>\n                        <DropdownMenuItem onClick={() => setLocation(\"/profile\")} className=\"flex items-center gap-2\">\n                          <UserIcon className=\"h-4 w-4\" />\n                          <span>Profile</span>\n                        </DropdownMenuItem>\n                        <DropdownMenuItem onClick={handleLogout} className=\"text-red-400 focus:text-red-300 flex items-center gap-2\">\n                          <LogOut className=\"h-4 w-4\" />\n                          <span>Logout</span>\n                        </DropdownMenuItem>\n                      </DropdownMenuContent>\n                    </DropdownMenu>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"container mx-auto px-4 py-4\">\n            <CricketTossMatches />\n          </div>\n        </main>\n      </div>\n      \n      {/* Mobile Bottom Navigation */}\n      <MobileNav />\n    </div>\n  );\n}\n\nfunction CricketTossMatches() {\n  const { toast } = useToast();\n\n  // Query for cricket toss games\n  const { data: cricketTossGames = [], isLoading, error } = useQuery<CricketTossGame[]>({\n    queryKey: ['/api/cricket-toss-games'],\n    queryFn: async () => {\n      try {\n        const response = await fetch('/api/cricket-toss-games');\n        if (!response.ok) {\n          throw new Error('Failed to fetch cricket toss games');\n        }\n        return response.json();\n      } catch (error) {\n        console.error('Error fetching cricket toss games:', error);\n        return [];\n      }\n    },\n  });\n  \n  // Show error toast if query failed\n  if (error) {\n    toast({\n      title: \"Error\",\n      description: \"Failed to load cricket games. Please try again.\",\n      variant: \"destructive\",\n    });\n  }\n\n  // Helper function to get open games\n  const getOpenGames = () => {\n    return cricketTossGames\n      .filter(game => game.gameData?.status === 'open')\n      .map(game => ({\n        id: game.id,\n        type: 'cricket_toss_game' as const,\n        data: game\n      }));\n  };\n  \n  // Helper function to get live games\n  const getLiveGames = () => {\n    const now = new Date();\n    \n    return cricketTossGames\n      .filter(game => {\n        const tossTime = new Date(game.gameData.tossTime);\n        return game.gameData?.status === 'open' && tossTime <= now;\n      })\n      .map(game => ({\n        id: game.id,\n        type: 'cricket_toss_game' as const,\n        data: game\n      }));\n  };\n\n  const openGames = getOpenGames();\n  const liveGames = getLiveGames();\n\n  return (\n    <div className=\"space-y-6\">\n      <Tabs defaultValue=\"live\" className=\"w-full\">\n        <TabsList className=\"grid grid-cols-2 mb-8\">\n          <TabsTrigger value=\"live\" className=\"flex items-center justify-center\">\n            <Clock className=\"h-4 w-4 mr-2\" />\n            Live Now\n          </TabsTrigger>\n          <TabsTrigger value=\"upcoming\" className=\"flex items-center justify-center\">\n            <Calendar className=\"h-4 w-4 mr-2\" />\n            Upcoming Games\n          </TabsTrigger>\n        </TabsList>\n        \n        <TabsContent value=\"live\" className=\"space-y-6\">\n          {isLoading ? (\n            <div className=\"flex justify-center p-10\">\n              <div className=\"h-10 w-10 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n            </div>\n          ) : liveGames.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {liveGames.map((game) => (\n                <CricketTossCard \n                  key={`${game.type}-${game.id}`}\n                  game={game}\n                />\n              ))}\n            </div>\n          ) : (\n            <Card className=\"bg-gray-900 border-gray-800\">\n              <CardContent className=\"pt-6 text-center\">\n                <p className=\"text-gray-400\">No live cricket games available right now.</p>\n                <p className=\"text-sm text-gray-500 mt-2\">Check back later for live games.</p>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n        \n        <TabsContent value=\"upcoming\" className=\"space-y-6\">\n          {isLoading ? (\n            <div className=\"flex justify-center p-10\">\n              <div className=\"h-10 w-10 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n            </div>\n          ) : openGames.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {openGames.map((game) => (\n                <CricketTossCard \n                  key={`${game.type}-${game.id}`}\n                  game={game}\n                />\n              ))}\n            </div>\n          ) : (\n            <Card className=\"bg-gray-900 border-gray-800\">\n              <CardContent className=\"pt-6 text-center\">\n                <p className=\"text-gray-400\">No upcoming cricket games available right now.</p>\n                <p className=\"text-sm text-gray-500 mt-2\">Check back later for new games.</p>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\ntype GameItem = {\n  id: number;\n  type: 'cricket_toss_game';\n  data: CricketTossGame;\n};\n\nfunction CricketTossCard({ game }: { game: GameItem }) {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  \n  // Get team names\n  const getTeamA = () => {\n    return game.data.gameData.teamA;\n  };\n  \n  const getTeamB = () => {\n    return game.data.gameData.teamB;\n  };\n  \n  // Get odds\n  const getOddTeamA = () => {\n    return game.data.gameData.oddTeamA;\n  };\n  \n  const getOddTeamB = () => {\n    return game.data.gameData.oddTeamB;\n  };\n  \n  // Get toss time\n  const getTime = () => {\n    return new Date(game.data.gameData.tossTime);\n  };\n  \n  const matchTime = getTime();\n  const formattedDate = format(matchTime, 'MMM dd, yyyy');\n  const formattedTime = format(matchTime, 'h:mm a');\n  \n  return (\n    <>\n      <Card \n        className=\"bg-gray-900 border-gray-800 overflow-hidden hover:shadow-md hover:shadow-indigo-900/20 transition-shadow cursor-pointer\"\n        onClick={() => setIsDialogOpen(true)}\n      >\n        <div className=\"relative\">\n          <div className=\"bg-gradient-to-r from-indigo-800 to-violet-800 h-20 flex items-center justify-center\">\n            <GiCricketBat className=\"h-12 w-12 text-white/50\" />\n          </div>\n          <Badge className=\"absolute top-2 right-2 bg-indigo-600\">\n            Cricket Toss\n          </Badge>\n        </div>\n        <CardContent className=\"p-4\">\n          <div className=\"flex flex-col space-y-2\">\n            <h3 className=\"font-bold text-xl line-clamp-1\">{getTeamA()} vs {getTeamB()}</h3>\n            \n            <div className=\"text-gray-400 text-sm flex items-center\">\n              <Calendar className=\"h-4 w-4 mr-1\" /> \n              {formattedDate}\n              <span className=\"mx-2\"></span>\n              <Clock className=\"h-4 w-4 mr-1\" /> \n              {formattedTime}\n            </div>\n            \n            <div className=\"flex justify-between mt-3\">\n              <div className=\"text-center flex-1 border-r border-gray-800\">\n                <div className=\"text-gray-400 text-xs mb-1\">{getTeamA()}</div>\n                <div className=\"font-bold text-indigo-400\">{(getOddTeamA() / 100).toFixed(2)}x</div>\n              </div>\n              <div className=\"text-center flex-1\">\n                <div className=\"text-gray-400 text-xs mb-1\">{getTeamB()}</div>\n                <div className=\"font-bold text-indigo-400\">{(getOddTeamB() / 100).toFixed(2)}x</div>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n      \n      {isDialogOpen && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4\">\n          <CricketTossGame \n            match={game.data} \n            onClose={() => setIsDialogOpen(false)} \n          />\n        </div>\n      )}\n    </>\n  );\n}","path":null,"size_bytes":12031,"size_tokens":null},"clear-selective-game-data.js":{"content":"/**\n * This script allows selective removal of game data by type\n * You can choose which types of game data to remove:\n * - Coin flip games\n * - Satamatka games and markets\n * - Cricket toss games\n * - Team match games and match data\n * \n * Usage: node clear-selective-game-data.js [game_types]\n * Where game_types can be one or more of: coinflip, satamatka, crickettoss, teammatch\n * Example: node clear-selective-game-data.js coinflip satamatka\n */\n\nimport pg from 'pg';\nimport { createRequire } from 'module';\nconst require = createRequire(import.meta.url);\nconst dotenv = require('dotenv');\ndotenv.config();\n\nconst { Pool } = pg;\n\n// Create a PostgreSQL connection pool\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL\n});\n\n// Parse command line arguments\nconst args = process.argv.slice(2);\nconst validGameTypes = ['coinflip', 'satamatka', 'crickettoss', 'teammatch'];\n\n// If no arguments provided or help requested, show usage\nif (args.length === 0 || args.includes('--help') || args.includes('-h')) {\n  console.log('Usage: node clear-selective-game-data.js [game_types]');\n  console.log('Where game_types can be one or more of: coinflip, satamatka, crickettoss, teammatch');\n  console.log('Example: node clear-selective-game-data.js coinflip satamatka');\n  process.exit(0);\n}\n\n// Validate arguments\nconst invalidArgs = args.filter(arg => !validGameTypes.includes(arg));\nif (invalidArgs.length > 0) {\n  console.error(`Invalid game type(s): ${invalidArgs.join(', ')}`);\n  console.log(`Valid game types are: ${validGameTypes.join(', ')}`);\n  process.exit(1);\n}\n\n// Define what will be deleted based on command line args\nconst gameTypesToDelete = {\n  coinflip: args.includes('coinflip'),\n  satamatka: args.includes('satamatka'),\n  crickettoss: args.includes('crickettoss'),\n  teammatch: args.includes('teammatch')\n};\n\nasync function clearSelectiveGameData() {\n  const client = await pool.connect();\n  \n  try {\n    console.log(\"Starting selective game data cleanup...\");\n    console.log(`Game types to remove: ${args.join(', ')}`);\n    \n    // Begin transaction\n    await client.query('BEGIN');\n    \n    // 1. Delete games by type\n    let totalGamesRemoved = 0;\n    \n    if (gameTypesToDelete.coinflip) {\n      console.log(\"Removing all coin flip games...\");\n      const result = await client.query('DELETE FROM \"games\" WHERE \"game_type\" = $1', ['coin_flip']);\n      console.log(`Removed ${result.rowCount} coin flip games`);\n      totalGamesRemoved += result.rowCount;\n    }\n    \n    if (gameTypesToDelete.satamatka) {\n      console.log(\"Removing all satamatka games...\");\n      const result = await client.query('DELETE FROM \"games\" WHERE \"game_type\" = $1', ['satamatka']);\n      console.log(`Removed ${result.rowCount} satamatka games`);\n      totalGamesRemoved += result.rowCount;\n      \n      // Also delete satamatka markets\n      console.log(\"Removing all satamatka markets...\");\n      const marketsResult = await client.query('DELETE FROM \"satamatka_markets\"');\n      console.log(`Removed ${marketsResult.rowCount} satamatka markets`);\n      \n      // Reset satamatka markets sequence if table is empty\n      const marketsCount = await client.query('SELECT COUNT(*) FROM \"satamatka_markets\"');\n      if (parseInt(marketsCount.rows[0].count) === 0) {\n        console.log(\"Resetting satamatka_markets sequence counter...\");\n        await client.query('ALTER SEQUENCE \"satamatka_markets_id_seq\" RESTART WITH 1');\n      }\n    }\n    \n    if (gameTypesToDelete.crickettoss) {\n      console.log(\"Removing all cricket toss games...\");\n      const result = await client.query('DELETE FROM \"games\" WHERE \"game_type\" = $1', ['cricket_toss']);\n      console.log(`Removed ${result.rowCount} cricket toss games`);\n      totalGamesRemoved += result.rowCount;\n    }\n    \n    if (gameTypesToDelete.teammatch) {\n      console.log(\"Removing all team match games...\");\n      const result = await client.query('DELETE FROM \"games\" WHERE \"game_type\" = $1', ['team_match']);\n      console.log(`Removed ${result.rowCount} team match games`);\n      totalGamesRemoved += result.rowCount;\n      \n      // Also delete team matches\n      console.log(\"Removing all team matches...\");\n      const matchesResult = await client.query('DELETE FROM \"team_matches\"');\n      console.log(`Removed ${matchesResult.rowCount} team matches`);\n      \n      // Reset team matches sequence if table is empty\n      const matchesCount = await client.query('SELECT COUNT(*) FROM \"team_matches\"');\n      if (parseInt(matchesCount.rows[0].count) === 0) {\n        console.log(\"Resetting team_matches sequence counter...\");\n        await client.query('ALTER SEQUENCE \"team_matches_id_seq\" RESTART WITH 1');\n      }\n    }\n    \n    console.log(`Total games removed: ${totalGamesRemoved}`);\n    \n    // Check if games table is empty to reset sequence\n    const gamesCount = await client.query('SELECT COUNT(*) FROM \"games\"');\n    if (parseInt(gamesCount.rows[0].count) === 0) {\n      console.log(\"Games table is empty, resetting games sequence counter...\");\n      await client.query('ALTER SEQUENCE \"games_id_seq\" RESTART WITH 1');\n    } else {\n      console.log(`Games table still has ${gamesCount.rows[0].count} records, not resetting sequence`);\n    }\n    \n    // Commit transaction\n    await client.query('COMMIT');\n    \n    console.log(\"Selective game data cleanup completed successfully!\");\n    \n  } catch (error) {\n    // Rollback in case of error\n    await client.query('ROLLBACK');\n    console.error(\"Error clearing game data:\", error);\n    throw error;\n  } finally {\n    // Release the client back to the pool\n    client.release();\n  }\n}\n\n// Ask for confirmation before proceeding\nconsole.log(`WARNING: This will permanently delete ${args.join(', ')} game data from the system.`);\nconsole.log(\"User accounts, balances, and transaction history will be preserved.\");\n\nif (gameTypesToDelete.satamatka) {\n  console.log(\"All Satamatka markets will also be deleted.\");\n}\n\nif (gameTypesToDelete.teammatch) {\n  console.log(\"All team matches will also be deleted.\");\n}\n\nconsole.log(\"Type 'DELETE SELECTED GAME DATA' to confirm, or press Ctrl+C to cancel.\");\n\nconst readline = require('readline').createInterface({\n  input: process.stdin,\n  output: process.stdout\n});\n\nreadline.question('Confirmation: ', (answer) => {\n  if (answer === 'DELETE SELECTED GAME DATA') {\n    readline.close();\n    \n    // Run the cleanup\n    clearSelectiveGameData()\n      .then(() => {\n        console.log(\"Cleanup script completed successfully. You can now restart the server.\");\n        process.exit(0);\n      })\n      .catch(error => {\n        console.error(\"Cleanup script failed:\", error);\n        process.exit(1);\n      });\n  } else {\n    console.log(\"Cleanup cancelled. No data was deleted.\");\n    readline.close();\n    process.exit(0);\n  }\n});","path":null,"size_bytes":6806,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1435,"size_tokens":null},"client/src/pages/jantri-management-page.tsx":{"content":"import React from \"react\";\nimport DashboardLayout from \"@/components/dashboard-layout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n\n// This is a placeholder component as jantri management has been removed\nexport default function JantriManagementPage() {\n  return (\n    <DashboardLayout title=\"Feature Removed\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Jantri Management Feature Removed</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p>This feature has been removed to simplify the platform.</p>\n        </CardContent>\n      </Card>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":633,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7246,"size_tokens":null},"create-admin-crypto.js":{"content":"/**\n * Creates an admin user with crypto.scrypt password hash\n */\nimport pg from 'pg';\nimport crypto from 'crypto';\nimport { promisify } from 'util';\n\nconst scryptAsync = promisify(crypto.scrypt);\n\nasync function createAdmin() {\n  const { Pool } = pg;\n  const pool = new Pool({\n    connectionString: process.env.DATABASE_URL\n  });\n  \n  try {\n    // Create admin with crypto.scrypt hash\n    // The hash format is: hashedPassword.salt\n    const client = await pool.connect();\n    \n    try {\n      // Check if admin exists\n      const res = await client.query('SELECT * FROM users WHERE username = $1', ['admin']);\n      \n      // Create hash for admin123\n      const password = 'admin123';\n      const salt = crypto.randomBytes(16).toString('hex');\n      const buf = await scryptAsync(password, salt, 64);\n      const hashedPassword = `${buf.toString('hex')}.${salt}`;\n      \n      if (res.rows.length === 0) {\n        // Admin doesn't exist, create it\n        console.log('Creating admin user...');\n        \n        await client.query(`\n          INSERT INTO users (username, password, email, mobile, role, balance)\n          VALUES ($1, $2, $3, $4, $5, $6)\n        `, ['admin', hashedPassword, 'admin@example.com', '1234567890', 'admin', 0]);\n        \n        console.log('Admin user created successfully!');\n      } else {\n        // Admin exists, update password\n        console.log('Admin user exists, updating password...');\n        \n        await client.query(`\n          UPDATE users \n          SET password = $1\n          WHERE username = 'admin'\n        `, [hashedPassword]);\n        \n        console.log('Admin password updated successfully!');\n      }\n    } finally {\n      client.release();\n    }\n  } catch (error) {\n    console.error('Error:', error);\n  } finally {\n    await pool.end();\n  }\n}\n\ncreateAdmin();","path":null,"size_bytes":1821,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":1901,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"setup-risk-management-data.ts":{"content":"import { db } from './server/db';\nimport { games, satamatkaMarkets, teamMatches, MarketType, MarketStatus, GameType } from './shared/schema';\nimport { eq, sql } from 'drizzle-orm';\n\nasync function setupRiskManagementData() {\n  try {\n    console.log('Setting up sample data for risk management testing...');\n    \n    // Set a default admin ID for testing - typically ID 1 is admin in the system\n    const adminId = 1;\n    console.log(`Using admin ID: ${adminId}`);\n    \n    // Clear existing test data\n    console.log('Cleaning up any existing test data...');\n    await db.delete(games).where(eq(games.gameType, GameType.SATAMATKA));\n    await db.delete(games).where(eq(games.gameType, GameType.CRICKET_TOSS));\n    await db.delete(satamatkaMarkets).execute();\n    await db.delete(teamMatches).execute();\n\n    // Create sample satamatka markets first\n    console.log('Creating sample satamatka markets...');\n    const markets = [];\n    for (let i = 1; i <= 5; i++) {\n      const [market] = await db.insert(satamatkaMarkets).values({\n        name: `Test Market ${i}`,\n        type: i % 2 === 0 ? 'mumbai' : 'kalyan',  // Using the required values based on schema\n        openTime: new Date(),\n        closeTime: new Date(Date.now() + 3600000), // 1 hour from now\n        status: MarketStatus.OPEN,\n        isRecurring: false\n      }).returning();\n      \n      markets.push(market);\n      console.log(`Created market ${i}: ${market.name} (ID: ${market.id})`);\n    }\n    \n    // Create sample cricket matches\n    console.log('\\nCreating sample cricket matches...');\n    const matches = [];\n    for (let i = 1; i <= 3; i++) {\n      const [match] = await db.insert(teamMatches).values({\n        teamA: `Team A${i}`,\n        teamB: `Team B${i}`,\n        matchTime: new Date(Date.now() + 86400000 * i), // Future dates\n        status: \"open\" // Using string literal based on schema\n      }).returning();\n      \n      matches.push(match);\n      console.log(`Created cricket match ${i}: ${match.teamA} vs ${match.teamB} (ID: ${match.id})`);\n    }\n    \n    // Create test market games (satamatka)\n    console.log('\\nCreating sample market games...');\n    for (let i = 1; i <= 10; i++) {\n      const isActive = i % 3 !== 0; // Some games will be active, some completed\n      const marketId = markets[i % markets.length].id;\n      \n      const [game] = await db.insert(games).values({\n        userId: adminId,\n        gameType: GameType.SATAMATKA,\n        betAmount: 1000 * (i % 5 + 1),\n        prediction: i % 2 === 0 ? 'jodi' : 'single',\n        result: isActive ? null : (i % 2 === 0 ? 'win' : 'loss'),\n        payout: isActive ? 0 : (i % 2 === 0 ? 1000 * (i % 5 + 1) * 1.9 : 0),\n        marketId: marketId,\n        gameMode: 'regular'\n      }).returning();\n      \n      console.log(`Created market game ${i} (ID: ${game.id})`);\n    }\n    \n    // Create test cricket toss games\n    console.log('\\nCreating sample cricket toss games...');\n    for (let i = 1; i <= 8; i++) {\n      const isActive = i % 4 !== 0; // Some games will be active, some completed\n      const matchId = matches[i % matches.length].id;\n      \n      const [game] = await db.insert(games).values({\n        userId: adminId,\n        gameType: GameType.CRICKET_TOSS,\n        betAmount: 500 * (i % 3 + 1),\n        prediction: i % 2 === 0 ? 'team_a' : 'team_b',\n        result: isActive ? null : (i % 2 === 0 ? 'win' : 'loss'),\n        payout: isActive ? 0 : (i % 2 === 0 ? 500 * (i % 3 + 1) * 1.8 : 0),\n        matchId: matchId,\n        gameMode: 'regular'\n      }).returning();\n      \n      console.log(`Created cricket toss game ${i} (ID: ${game.id})`);\n    }\n    \n    console.log('\\nSample data for risk management created successfully!');\n    \n  } catch (error) {\n    console.error('Error creating risk management data:', error);\n  }\n}\n\n// Run the function\nsetupRiskManagementData()\n  .then(() => console.log('Done!'))\n  .catch(err => console.error('Failed:', err));","path":null,"size_bytes":3925,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"import * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1145,"size_tokens":null},"server/game-probability.ts":{"content":"import { db } from \"./db\";\nimport { games } from \"@shared/schema\";\nimport { eq, and, count, desc } from \"drizzle-orm\";\n\n// Default probability values\nexport const DEFAULT_NEW_USER_WIN_RATE = 0.60; // 60% win rate for new users\nexport const DEFAULT_STANDARD_WIN_RATE = 0.50; // 50% standard win rate\nexport const DEFAULT_HOUSE_EDGE_WIN_RATE = 0.40; // 40% win rate (60% house win)\nexport const DEFAULT_LOSS_RECOVERY_WIN_RATE = 0.55; // 55% win rate for loss recovery\n\n// Track session stats per user\nconst userSessions: Record<number, {\n  gamesPlayed: number;\n  gamesWon: number;\n  consecutiveLosses: number;\n  lastGameTime: Date;\n}> = {};\n\n// Reset session if more than 30 minutes have passed\nconst SESSION_TIMEOUT_MS = 30 * 60 * 1000; // 30 minutes\n\n/**\n * Calculate the probability of a user winning the current coin flip\n * based on various factors including user history, experience level, etc.\n */\nexport async function calculateWinProbability(userId: number): Promise<number> {\n  try {\n    // Check if user session exists and is still valid\n    const now = new Date();\n    const userSession = userSessions[userId];\n    \n    if (!userSession || (now.getTime() - userSession.lastGameTime.getTime() > SESSION_TIMEOUT_MS)) {\n      // Create or reset session\n      userSessions[userId] = {\n        gamesPlayed: 0,\n        gamesWon: 0,\n        consecutiveLosses: 0,\n        lastGameTime: now\n      };\n    }\n    \n    // Update session timestamp\n    userSessions[userId].lastGameTime = now;\n    \n    // Get user's game history\n    const coinFlipGames = await db.query.games.findMany({\n      where: and(\n        eq(games.userId, userId),\n        eq(games.gameType, 'coin_flip')\n      ),\n      orderBy: [desc(games.createdAt)]\n    });\n    \n    // Check if this is a new user (less than 5 games played)\n    if (coinFlipGames.length < 5) {\n      return DEFAULT_NEW_USER_WIN_RATE; // New users get higher win rate\n    }\n    \n    // Check for consecutive losses (loss recovery mechanic)\n    const recentGames = coinFlipGames.slice(0, 5); // Last 5 games\n    let consecutiveLosses = 0;\n    \n    for (const game of recentGames) {\n      if (game.payout > 0) break; // Win breaks the streak\n      consecutiveLosses++;\n    }\n    \n    // Activate loss recovery if user has lost 3 or more consecutive games\n    if (consecutiveLosses >= 3) {\n      return DEFAULT_LOSS_RECOVERY_WIN_RATE;\n    }\n    \n    // Check session win rate caps\n    const currentSession = userSessions[userId];\n    if (currentSession.gamesPlayed >= 10) {\n      const currentWinRate = currentSession.gamesWon / currentSession.gamesPlayed;\n      \n      // If user has won too much in this session, reduce win chance\n      if (currentWinRate > 0.4) {\n        return DEFAULT_HOUSE_EDGE_WIN_RATE;\n      }\n      \n      // If user has lost too much in this session, increase win chance slightly\n      if (currentWinRate < 0.3) {\n        return DEFAULT_LOSS_RECOVERY_WIN_RATE;\n      }\n    }\n    \n    // Calculate lifetime games played (experience level)\n    const totalGames = coinFlipGames.length;\n    \n    // As user plays more games, gradually shift from neutral to house edge\n    if (totalGames > 20) {\n      // Experienced player (more than 20 games): house has slight edge\n      return DEFAULT_HOUSE_EDGE_WIN_RATE;\n    }\n    \n    // Standard probability for regular players\n    return DEFAULT_STANDARD_WIN_RATE;\n  } catch (error) {\n    console.error(\"Error calculating win probability:\", error);\n    // Fall back to default win rate in case of errors\n    return DEFAULT_STANDARD_WIN_RATE;\n  }\n}\n\n/**\n * Update the user's session statistics after a game\n */\nexport function updateUserSessionStats(userId: number, isWin: boolean): void {\n  // Ensure session exists\n  if (!userSessions[userId]) {\n    userSessions[userId] = {\n      gamesPlayed: 0,\n      gamesWon: 0,\n      consecutiveLosses: 0,\n      lastGameTime: new Date()\n    };\n  }\n  \n  // Update session stats\n  userSessions[userId].gamesPlayed++;\n  \n  if (isWin) {\n    userSessions[userId].gamesWon++;\n    userSessions[userId].consecutiveLosses = 0;\n  } else {\n    userSessions[userId].consecutiveLosses++;\n  }\n}","path":null,"size_bytes":4119,"size_tokens":null},"fix-user-password.js":{"content":"/**\n * Script to fix a specific user's password with proper crypto.scrypt hashing\n */\nconst { db } = require('./server/db');\nconst { users } = require('./shared/schema');\nconst { eq } = require('drizzle-orm');\nconst crypto = require('crypto');\nconst { promisify } = require('util');\n\nconst { scrypt, randomBytes } = crypto;\n\n// Promisify the scrypt function\nconst scryptAsync = promisify(scrypt);\n\nasync function hashPassword(password) {\n  // Use our native crypto.scrypt function for password hashing\n  const salt = randomBytes(16).toString('hex');\n  const buf = (await scryptAsync(password, salt, 64));\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nasync function fixUserPassword() {\n  try {\n    console.log('Fixing password for user uloo...');\n    \n    // First, check if the user exists\n    const userResult = await db.select()\n      .from(users)\n      .where(eq(users.username, 'uloo'));\n    \n    if (userResult.length === 0) {\n      console.log('User \"uloo\" not found!');\n      return;\n    }\n    \n    // Hash the password using crypto.scrypt\n    const hashedPassword = await hashPassword('asdf1234');\n    \n    // Update the user's password\n    const result = await db.update(users)\n      .set({ \n        password: hashedPassword,\n      })\n      .where(eq(users.username, 'uloo'))\n      .returning({ id: users.id, username: users.username });\n    \n    if (result.length > 0) {\n      console.log(`Updated password for ${result[0].username} (ID: ${result[0].id})`);\n      console.log('Please try logging in again with username \"uloo\" and password \"asdf1234\"');\n    } else {\n      console.log('Failed to update password!');\n    }\n  } catch (error) {\n    console.error('Error fixing password:', error);\n  }\n}\n\nfixUserPassword();","path":null,"size_bytes":1729,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/lib/protected-route.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { Loader2 } from \"lucide-react\";\nimport { Redirect, Route } from \"wouter\";\nimport { UserRole } from \"@/lib/types\";\n\nexport function ProtectedRoute({\n  path,\n  component: Component,\n  allowedRoles,\n}: {\n  path: string;\n  component: () => React.JSX.Element;\n  allowedRoles?: UserRole[];\n}) {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <Route path={path}>\n        <div className=\"flex items-center justify-center min-h-screen bg-background\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </Route>\n    );\n  }\n\n  if (!user) {\n    return (\n      <Route path={path}>\n        <Redirect to=\"/auth\" />\n      </Route>\n    );\n  }\n\n  // Check role-based access if roles are specified\n  if (allowedRoles && !allowedRoles.includes(user.role as UserRole)) {\n    return (\n      <Route path={path}>\n        <Redirect to=\"/\" />\n      </Route>\n    );\n  }\n\n  return <Route path={path} component={Component} />;\n}\n","path":null,"size_bytes":1023,"size_tokens":null},"server/deposit-commission-endpoint.ts":{"content":"import { db } from './db';\nimport express, { Request, Response, NextFunction } from 'express';\nimport { UserRole, depositCommissions, users, systemSettings } from '@shared/schema';\nimport { eq, and } from 'drizzle-orm';\n\n// Helper function to get deposit commission for a subadmin\nexport async function getSubadminDepositCommission(subadminId: number): Promise<number> {\n  try {\n    // Fetch the deposit commission setting for this subadmin\n    const commissionResult = await db.select()\n      .from(depositCommissions)\n      .where(and(eq(depositCommissions.subadminId, subadminId), eq(depositCommissions.isActive, true)))\n      .limit(1);\n    \n    if (commissionResult.length > 0) {\n      return commissionResult[0].commissionRate;\n    }\n    \n    // If no specific commission is set, get the default value from system settings\n    const defaultSetting = await db.select()\n      .from(systemSettings)\n      .where(and(\n        eq(systemSettings.settingType, 'commission_default'),\n        eq(systemSettings.settingKey, 'deposit')\n      ))\n      .limit(1);\n      \n    if (defaultSetting.length > 0) {\n      // Platform default now uses same 10000-based system as individual commissions\n      return parseInt(defaultSetting[0].settingValue);\n    }\n    \n    // If no system default, use 10% as fallback\n    return 1000; // Default 10% commission rate (1000 = 10% in 10000-based system)\n  } catch (error) {\n    console.error('Error getting subadmin commission rate:', error);\n    return 1000; // Default to 10% on error\n  }\n}\n\n// Set up all deposit commission endpoints\nexport function setupDepositCommissionEndpoints(app: express.Express) {\n  // Additional endpoint to handle the specific API path for subadmin deposit commission\n  // GET endpoint to retrieve a specific subadmin's deposit commission rate\n  app.get('/api/subadmin/:subadminId/deposit-commission', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      const subadminId = parseInt(req.params.subadminId);\n      \n      if (isNaN(subadminId)) {\n        return res.status(400).json({ message: 'Invalid subadmin ID' });\n      }\n      \n      // Only admins or the subadmin themselves can access their commission info\n      if (req.user?.role !== UserRole.ADMIN && \n          (req.user?.role !== UserRole.SUBADMIN || req.user?.id !== subadminId)) {\n        return res.status(403).json({ message: 'Forbidden - Insufficient permissions' });\n      }\n      \n      // Get commission rate using the helper function\n      const commissionRate = await getSubadminDepositCommission(subadminId);\n      \n      res.json({ \n        subadminId,\n        commissionRate\n      });\n    } catch (error) {\n      next(error);\n    }\n  });\n  \n  // POST endpoint to set/update a specific subadmin's deposit commission rate\n  app.post('/api/subadmin/:subadminId/deposit-commission', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Only admin can set deposit commission\n      if (req.user?.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: 'Forbidden - Only admins can set deposit commission' });\n      }\n      \n      const subadminId = parseInt(req.params.subadminId);\n      const { commissionRate } = req.body;\n      \n      if (isNaN(subadminId) || typeof commissionRate !== 'number' || commissionRate < 0 || commissionRate > 10000) {\n        return res.status(400).json({ \n          message: 'Invalid request data. Commission rate must be between 0 and 10000 (0% to 100%)' \n        });\n      }\n      \n      // Verify the user is a subadmin\n      const userResult = await db.select()\n        .from(users)\n        .where(and(eq(users.id, subadminId), eq(users.role, UserRole.SUBADMIN)))\n        .limit(1);\n      \n      if (userResult.length === 0) {\n        return res.status(404).json({ message: 'Subadmin not found' });\n      }\n      \n      // Check if a commission already exists\n      const existingCommission = await db.select()\n        .from(depositCommissions)\n        .where(eq(depositCommissions.subadminId, subadminId))\n        .limit(1);\n      \n      if (existingCommission.length > 0) {\n        // Update existing commission\n        await db.update(depositCommissions)\n          .set({\n            commissionRate,\n            isActive: true,\n            updatedAt: new Date()\n          })\n          .where(eq(depositCommissions.subadminId, subadminId));\n      } else {\n        // Create new commission\n        await db.insert(depositCommissions).values({\n          subadminId,\n          commissionRate,\n          isActive: true\n        });\n      }\n      \n      res.json({ \n        success: true, \n        message: 'Deposit commission set successfully',\n        data: {\n          subadminId,\n          username: userResult[0].username,\n          commissionRate\n        }\n      });\n    } catch (error) {\n      next(error);\n    }\n  });\n  // Endpoint for subadmin to get their own deposit commission rate\n  app.get('/api/deposit-commission', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // User must be a subadmin\n      if (req.user?.role !== UserRole.SUBADMIN) {\n        return res.status(403).json({ message: 'Forbidden - Only subadmins can view their deposit commission' });\n      }\n      \n      const subadminId = req.user.id;\n      \n      // Get commission rate using the helper function\n      const commissionRate = await getSubadminDepositCommission(subadminId);\n      \n      // Get the actual commission record if it exists\n      const commissionResult = await db.select()\n        .from(depositCommissions)\n        .where(eq(depositCommissions.subadminId, subadminId))\n        .limit(1);\n      \n      const commission = commissionResult.length > 0 ? commissionResult[0] : null;\n      \n      res.json({ \n        subadminId,\n        commissionRate,\n        isActive: commission ? commission.isActive : true,\n        isDefault: commissionResult.length === 0\n      });\n    } catch (error) {\n      next(error);\n    }\n  });\n  \n  // Admin endpoint to get all deposit commissions\n  app.get('/api/admin/deposit-commissions', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Only admin can access this endpoint\n      if (req.user.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: 'Forbidden - Only admins can view all deposit commissions' });\n      }\n      \n      // Get all subadmins with their deposit commissions\n      const commissions = await db.select({\n        commission: depositCommissions,\n        subadmin: {\n          id: users.id,\n          username: users.username\n        }\n      })\n      .from(depositCommissions)\n      .innerJoin(users, eq(depositCommissions.subadminId, users.id))\n      .where(eq(depositCommissions.isActive, true));\n      \n      res.json(commissions);\n    } catch (err) {\n      next(err);\n    }\n  });\n  \n  // GET endpoint to retrieve a specific subadmin's deposit commission rate\n  app.get('/api/admin/deposit-commissions/:subadminId', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Only admin can access this endpoint\n      if (req.user?.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: 'Forbidden - Only admins can view deposit commissions' });\n      }\n      \n      const subadminId = parseInt(req.params.subadminId);\n      \n      if (isNaN(subadminId)) {\n        return res.status(400).json({ message: 'Invalid subadmin ID' });\n      }\n      \n      // Verify the user is a subadmin\n      const userResult = await db.select()\n        .from(users)\n        .where(and(eq(users.id, subadminId), eq(users.role, UserRole.SUBADMIN)))\n        .limit(1);\n      \n      if (userResult.length === 0) {\n        return res.status(404).json({ message: 'Subadmin not found' });\n      }\n      \n      // Get commission rate using the helper function\n      const commissionRate = await getSubadminDepositCommission(subadminId);\n      \n      // Get the actual commission record if it exists\n      const commissionResult = await db.select()\n        .from(depositCommissions)\n        .where(eq(depositCommissions.subadminId, subadminId))\n        .limit(1);\n      \n      res.json({\n        subadminId,\n        username: userResult[0].username,\n        commissionRate,\n        isDefault: commissionResult.length === 0\n      });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  // POST endpoint to set/update a deposit commission for a specific subadmin\n  app.post('/api/admin/deposit-commissions/:subadminId', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Only admin can access this endpoint\n      if (req.user?.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: 'Forbidden - Only admins can manage deposit commissions' });\n      }\n      \n      const subadminId = parseInt(req.params.subadminId);\n      const { commissionRate } = req.body;\n      \n      if (isNaN(subadminId) || typeof commissionRate !== 'number' || commissionRate < 0 || commissionRate > 10000) {\n        return res.status(400).json({ \n          message: 'Invalid request data. Commission rate must be between 0 and 10000 (0% to 100%)' \n        });\n      }\n      \n      // Verify the user is a subadmin\n      const userResult = await db.select()\n        .from(users)\n        .where(and(eq(users.id, subadminId), eq(users.role, UserRole.SUBADMIN)))\n        .limit(1);\n      \n      if (userResult.length === 0) {\n        return res.status(404).json({ message: 'Subadmin not found' });\n      }\n      \n      // Check if a commission already exists\n      const existingCommission = await db.select()\n        .from(depositCommissions)\n        .where(eq(depositCommissions.subadminId, subadminId))\n        .limit(1);\n      \n      if (existingCommission.length > 0) {\n        // Update existing commission\n        await db.update(depositCommissions)\n          .set({\n            commissionRate,\n            isActive: true,\n            updatedAt: new Date()\n          })\n          .where(eq(depositCommissions.subadminId, subadminId));\n      } else {\n        // Create new commission\n        await db.insert(depositCommissions).values({\n          subadminId,\n          commissionRate,\n          isActive: true\n        });\n      }\n      \n      res.json({ \n        success: true, \n        message: 'Deposit commission set successfully',\n        data: {\n          subadminId,\n          username: userResult[0].username,\n          commissionRate\n        }\n      });\n    } catch (error) {\n      next(error);\n    }\n  });\n  \n  // Generic POST endpoint for deposit commission (using request body for subadmin ID)\n  app.post('/api/admin/deposit-commissions', async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.isAuthenticated()) {\n        return res.status(401).json({ message: 'Unauthorized' });\n      }\n      \n      // Only admin can access this endpoint\n      if (req.user.role !== UserRole.ADMIN) {\n        return res.status(403).json({ message: 'Forbidden - Only admins can manage deposit commissions' });\n      }\n      \n      const { subadminId, commissionRate } = req.body;\n      \n      if (!subadminId || typeof commissionRate !== 'number' || commissionRate < 0 || commissionRate > 10000) {\n        return res.status(400).json({ \n          message: 'Invalid request data. Commission rate must be between 0 and 10000 (0% to 100%)' \n        });\n      }\n      \n      // Verify the user is a subadmin\n      const userResult = await db.select()\n        .from(users)\n        .where(and(eq(users.id, subadminId), eq(users.role, UserRole.SUBADMIN)))\n        .limit(1);\n      \n      if (userResult.length === 0) {\n        return res.status(404).json({ message: 'Subadmin not found' });\n      }\n      \n      // Check if a commission already exists\n      const existingCommission = await db.select()\n        .from(depositCommissions)\n        .where(eq(depositCommissions.subadminId, subadminId))\n        .limit(1);\n      \n      if (existingCommission.length > 0) {\n        // Update existing commission\n        await db.update(depositCommissions)\n          .set({\n            commissionRate,\n            isActive: true,\n            updatedAt: new Date()\n          })\n          .where(eq(depositCommissions.subadminId, subadminId));\n      } else {\n        // Create new commission\n        await db.insert(depositCommissions).values({\n          subadminId,\n          commissionRate,\n          isActive: true\n        });\n      }\n      \n      res.json({ \n        success: true, \n        message: 'Deposit commission set successfully',\n        data: {\n          subadminId,\n          username: userResult[0].username,\n          commissionRate\n        }\n      });\n    } catch (err) {\n      next(err);\n    }\n  });\n}","path":null,"size_bytes":13432,"size_tokens":null},"fix-storage.ts":{"content":"// This script fixes the storage implementation for getUserByUsername\nimport { db } from './server/db';\nimport { users, User } from './shared/schema';\nimport { eq } from 'drizzle-orm';\nimport fs from 'fs';\n\nasync function fixStorage() {\n  try {\n    console.log(\"Fixing storage.ts implementation...\");\n    \n    // Read the storage.ts file\n    const storageFile = fs.readFileSync('./server/storage.ts', 'utf8');\n    \n    // Look for the getUserByUsername method\n    const getUserPattern = /async getUserByUsername\\([^)]*\\)[^{]*{[^}]*}/;\n    \n    // Check if we found the method\n    if (getUserPattern.test(storageFile)) {\n      console.log(\"Found getUserByUsername method in storage.ts\");\n      \n      // Create the replacement implementation\n      const replacement = `async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select()\n      .from(users)\n      .where(eq(users.username, username))\n      .limit(1);\n    return user;\n  }`;\n      \n      // Replace the implementation\n      const updatedFile = storageFile.replace(getUserPattern, replacement);\n      \n      // Check if the file was updated\n      if (updatedFile !== storageFile) {\n        // Write the updated file\n        fs.writeFileSync('./server/storage.ts', updatedFile);\n        console.log(\"Updated getUserByUsername implementation in storage.ts\");\n      } else {\n        console.log(\"No changes were made to storage.ts\");\n      }\n    } else {\n      console.log(\"Could not find getUserByUsername method in storage.ts\");\n    }\n    \n    console.log(\"Storage implementation fix completed!\");\n  } catch (error) {\n    console.error(\"Error fixing storage implementation:\", error);\n  } finally {\n    process.exit(0);\n  }\n}\n\nfixStorage();","path":null,"size_bytes":1740,"size_tokens":null},"replit.md":{"content":"# KingGames Platform\n\n## Overview\n\nKingGames is a comprehensive online gaming and betting platform built with a modern web stack. The platform supports multiple game types including coin flip, Satamatka (matka betting), cricket toss, and team match games. It features a hierarchical user management system with three distinct roles (Admin, Subadmin, Player), integrated wallet functionality, and real-time game management capabilities.\n\nThe application is built using:\n- **Frontend**: React with TypeScript, TanStack Query for state management, Radix UI components\n- **Backend**: Express.js with TypeScript\n- **Database**: PostgreSQL with Drizzle ORM\n- **Authentication**: Crypto.scrypt-based password hashing with session management\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Component Structure**: The frontend uses a component-based architecture with React and TypeScript. UI components are built using Radix UI primitives and styled with Tailwind CSS. The application leverages shadcn/ui patterns for consistent, accessible component design.\n\n**State Management**: TanStack Query (React Query) handles server state management, providing caching, background updates, and optimistic UI updates. This approach separates server state from local UI state, improving performance and developer experience.\n\n**Routing**: The application uses client-side routing to provide distinct experiences for different user roles (Admin, Subadmin, Player). Each role has dedicated dashboard views and feature access based on permissions.\n\n**Form Handling**: React Hook Form with Zod resolvers provides type-safe form validation and submission handling across the platform.\n\n### Backend Architecture\n\n**API Design**: RESTful API architecture using Express.js with TypeScript. Routes are organized by feature domain (users, games, wallet, admin) with middleware for authentication and authorization.\n\n**Authentication Flow**: \n- Password hashing uses Node.js crypto.scrypt (not bcrypt) for security\n- Session-based authentication with Express sessions\n- Role-based access control (RBAC) middleware validates user permissions for protected routes\n- The system maintains backward compatibility with both crypto.scrypt and bcrypt password formats\n\n**Data Access Layer**: Drizzle ORM provides type-safe database queries with a repository pattern implementation. The `storage.ts` module acts as the data access layer, abstracting database operations from business logic.\n\n**Business Logic Organization**: Core business logic is separated into dedicated modules:\n- Game result processing and payout calculations\n- Commission and odds calculations\n- Wallet transaction processing\n- User hierarchy management (Admin  Subadmin  Player relationships)\n\n### Database Design\n\n**Schema Organization**: PostgreSQL database with the following core tables:\n- `users`: Multi-role user accounts with hierarchical assignments\n- `games`: Polymorphic game records supporting multiple game types\n- `satamatka_markets`: Matka game market definitions with open/close times\n- `team_matches`: Cricket and other team-based match data\n- `transactions`: Wallet transaction history\n- `wallet_requests`: Deposit/withdrawal request tracking\n- `game_odds`: Configurable odds per game type (admin and subadmin-specific)\n- `subadmin_commissions`: Commission rate configuration per subadmin\n- `user_discounts`: Player-specific discount rates\n- `player_deposit_discounts`: Deposit discount configurations\n\n**Key Design Decisions**:\n- User hierarchy implemented via `assigned_to` foreign key enabling cascading permissions\n- Game results stored as enum values ('win', 'loss', 'pending') with separate payout amounts\n- Market status tracking (open, waiting, resulted, cancelled) for game lifecycle management\n- All monetary values stored as integers (multiplied by 100) to avoid floating-point precision issues\n\n**Migrations**: Drizzle Kit manages schema migrations with version control, ensuring consistent database state across environments.\n\n### Game Processing Logic\n\n**Satamatka Game Modes**: The platform supports multiple Satamatka betting modes:\n- **Jodi**: Two-digit number prediction (highest odds: 90x)\n- **Harf/Single**: Single digit prediction (9x odds)\n- **Crossing**: Digit combination matching (95x odds)\n- **Odd/Even**: Odd or even number prediction (1.9x odds)\n\n**Result Processing**: Game results are processed when market results are declared. The system:\n1. Validates predictions against actual results based on game mode\n2. Calculates payouts using configured odds\n3. Updates user balances\n4. Records transactions for audit trail\n5. Handles commission distribution in subadmin hierarchy\n\n**Odds Configuration**: Two-tier odds system:\n- Admin-set default odds for all game types\n- Subadmin-specific odds that override defaults for their assigned players\n- Odds stored as integers (multiplied by 10,000 for precision)\n\n### Wallet and Transaction Management\n\n**Transaction Types**: The platform tracks multiple transaction types:\n- Deposits (admin-to-player, admin-to-subadmin)\n- Withdrawals (player-to-admin, subadmin-to-admin)\n- Game wins/losses\n- Commission payments\n- Balance adjustments\n\n**Request Workflow**: \n- Players submit deposit/withdrawal requests to their assigned subadmin or admin\n- Subadmins and admins can approve/reject requests\n- Approved transactions automatically update user balances\n- All transactions maintain immutable audit logs\n\n**Commission Distribution**: When subadmins fund player deposits, commissions are calculated based on configured rates and deducted from the deposit amount. This ensures proper profit distribution within the user hierarchy.\n\n### Security Considerations\n\n**Password Security**: The authentication system uses crypto.scrypt for password hashing with random salts. A dual-format system maintains backward compatibility with legacy bcrypt hashes while migrating to scrypt.\n\n**Role-Based Access**: Middleware functions validate user roles before allowing access to protected routes. Subadmins can only access data for users assigned to them, while admins have full system access.\n\n**Data Validation**: Zod schemas validate all incoming request data, preventing injection attacks and ensuring type safety throughout the application.\n\n## External Dependencies\n\n### Core Infrastructure\n- **Neon Database**: Serverless PostgreSQL hosting via `@neondatabase/serverless`\n- **Drizzle ORM**: Type-safe database client and migration management\n\n### Authentication & Security\n- **crypto** (Node.js built-in): Primary password hashing using scrypt\n- **bcrypt**: Legacy password hash support for backward compatibility\n\n### API & Server\n- **Express.js**: HTTP server and routing framework\n- **express-session**: Session management for authentication\n- **multer**: File upload handling (if needed for user documents)\n\n### Frontend Libraries\n- **React**: UI framework\n- **TanStack Query**: Server state management and caching\n- **Radix UI**: Headless accessible component primitives\n- **React Hook Form**: Form state management\n- **Zod**: Runtime type validation and schema parsing\n- **Tailwind CSS**: Utility-first styling framework\n\n### Development Tools\n- **TypeScript**: Type safety across the entire stack\n- **Vite**: Frontend build tool and dev server\n- **tsx**: TypeScript execution for server and scripts\n- **esbuild**: Production bundling for backend code\n- **Drizzle Kit**: Database schema management and migrations\n\n### Optional Integrations\n- **Stripe**: Payment processing capability (libraries included but not actively used in core flows)","path":null,"size_bytes":7650,"size_tokens":null},"README.md":{"content":"# kglive\nhi\n","path":null,"size_bytes":12,"size_tokens":null},"kingamesv3/README.md":{"content":"# kingamesv3\n v3\n","path":null,"size_bytes":17,"size_tokens":null}},"version":2}